<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>time_ew.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>time_ew.c</h1><a href="time__ew_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: time__ew_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.5  2001/01/23 16:49:43  dietz</span>
00011 <span class="comment"> *     Corrected roundoff problem in datestr23 and datestr23_local</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *     Revision 1.4  2000/11/30 22:12:07  lombard</span>
00014 <span class="comment"> *     fixed bug in timegm_ew: _timezone variable was not being set</span>
00015 <span class="comment"> *     by call to _tzset() before call to mktime(). And the changes</span>
00016 <span class="comment"> *     to the TZ environment variable were unnecessary.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *     Revision 1.3  2000/09/14 19:26:23  lucky</span>
00019 <span class="comment"> *     Added datestr23_local which returns time string in local time</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> *     Revision 1.2  2000/03/10 23:35:58  davidk</span>
00022 <span class="comment"> *     added includes from stdlib.h and stdio.h to resolve some compiler warnings.</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> *     Revision 1.1  2000/02/14 18:53:30  lucky</span>
00025 <span class="comment"> *     Initial revision</span>
00026 <span class="comment"> *</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> */</span>
00029 
00030      <span class="comment">/********************************************************</span>
00031 <span class="comment">      *              time_ew.c   Windows NT version          *</span>
00032 <span class="comment">      *                                                      *</span>
00033 <span class="comment">      *  This file contains earthworm multi-thread safe      *</span>
00034 <span class="comment">      *  versions of time routines.                          *</span>
00035 <span class="comment">      ********************************************************/</span>
00036 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00037 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00038 <span class="preprocessor">#include &lt;string.h&gt;</span>
00039 <span class="preprocessor">#include &lt;sys\timeb.h&gt;</span>
00040 <span class="preprocessor">#include &lt;sys\types.h&gt;</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="time__ew_8h.html">time_ew.h</a>&gt;</span>
00042 
00043 <span class="comment">/********************************************************</span>
00044 <span class="comment"> *  gmtime_ew() converts time in seconds since 1970 to  *</span>
00045 <span class="comment"> *  a time/date structure expressed as UTC (GMT)        *</span>
00046 <span class="comment"> ********************************************************/</span>
<a name="l00047"></a><a class="code" href="time__ew_8c.html#a0">00047</a> <span class="keyword">struct </span>tm *<a class="code" href="time__ew_8c.html#a0">gmtime_ew</a>( const time_t *epochsec, struct tm *res )
00048 {
00049     *res = *gmtime( epochsec );
00050     <span class="keywordflow">return</span>( res );
00051 }
00052 
00053 <span class="comment">/********************************************************</span>
00054 <span class="comment"> *  localtime_ew() converts time in seconds since 1970  *</span>
00055 <span class="comment"> *  to a time/date structure expressed as local time    *</span>
00056 <span class="comment"> *  (using time zone and daylight savings corrections)  *</span>
00057 <span class="comment"> ********************************************************/</span>
<a name="l00058"></a><a class="code" href="time__ew_8c.html#a1">00058</a> <span class="keyword">struct </span>tm *<a class="code" href="time__ew_8c.html#a1">localtime_ew</a>( const time_t *epochsec, struct tm *res )
00059 {
00060     *res = *localtime( epochsec );
00061     <span class="keywordflow">return</span>( res );
00062 }
00063 
00064 <span class="comment">/********************************************************</span>
00065 <span class="comment"> *  ctime_ew() converts time in seconds since 1970 to   *</span>
00066 <span class="comment"> *  a 26 character string expressed as local time       *</span>
00067 <span class="comment"> *  (using time zone and daylight savings corrections)  *</span>
00068 <span class="comment"> *   Example:  "Fri Sep 13 00:00:00 1986\n\0"           *</span>
00069 <span class="comment"> ********************************************************/</span>
<a name="l00070"></a><a class="code" href="time__ew_8c.html#a2">00070</a> <span class="keywordtype">char</span> *<a class="code" href="time__ew_8c.html#a2">ctime_ew</a>( <span class="keyword">const</span> time_t *epochsec, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> buflen )
00071 {
00072     strcpy( buf, ctime( epochsec ) );
00073     <span class="keywordflow">return</span>( buf );
00074 }
00075 
00076 <span class="comment">/********************************************************</span>
00077 <span class="comment"> *  asctime_ew() converts time/date structure to        *</span>
00078 <span class="comment"> *  a 26 character string                               *</span>
00079 <span class="comment"> *   Example:  "Fri Sep 13 00:00:00 1986\n\0"           *</span>
00080 <span class="comment"> ********************************************************/</span>
<a name="l00081"></a><a class="code" href="time__ew_8c.html#a3">00081</a> <span class="keywordtype">char</span> *<a class="code" href="time__ew_8c.html#a3">asctime_ew</a>( <span class="keyword">const</span> <span class="keyword">struct</span> tm *tm, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> buflen )
00082 {
00083     strcpy( buf, asctime( tm ) );
00084     <span class="keywordflow">return</span>( buf );
00085 }
00086 
00087 <span class="comment">/*******************************************************</span>
00088 <span class="comment"> * hrtime_ew() returns a high-resolution system clock  *</span>
00089 <span class="comment"> *             time as a double in seconds since       *</span>
00090 <span class="comment"> *             midnight Jan 1, 1970                    *</span>
00091 <span class="comment"> *******************************************************/</span>
<a name="l00092"></a><a class="code" href="time__ew_8c.html#a4">00092</a> <span class="keywordtype">double</span> <a class="code" href="time__ew_8c.html#a4">hrtime_ew</a>( <span class="keywordtype">double</span> *tnow )
00093 {
00094 <span class="comment">//    struct _timeb t;</span>
00095     <span class="keyword">struct </span>timeb t;
00096 
00097 <span class="comment">//    _ftime( &amp;t );</span>
00098     ftime( &amp;t );
00099     *<a class="code" href="chron3_8c.html#a7">tnow</a> = (double)t.time + (double)t.millitm*0.001;
00100     <span class="keywordflow">return</span>( *tnow );
00101 }
00102 
00103 <span class="comment">/********************************************************</span>
00104 <span class="comment"> *                      timegm_ew()                     *</span>
00105 <span class="comment"> * Convert struct tm to time_t using GMT as time zone   *</span>
00106 <span class="comment"> ********************************************************/</span>
<a name="l00107"></a><a class="code" href="time__ew_8c.html#a5">00107</a> time_t <a class="code" href="time__ew_8c.html#a5">timegm_ew</a>( <span class="keyword">struct</span> tm *stm )
00108 {
00109    time_t tt;
00110 
00111 <span class="comment">/* Change time zone to GMT; do conversion</span>
00112 <span class="comment"> ****************************************/</span>
00113    _timezone = 0L;
00114    tt = mktime( stm ); 
00115 
00116 <span class="comment">/* Restore original _timezone setting</span>
00117 <span class="comment"> *****************************/</span>
00118    _tzset();
00119 
00120    <span class="keywordflow">return</span>( tt );
00121 }
00122 
00123 
00124 <span class="comment">/**********************************************************</span>
00125 <span class="comment"> * Converts time (double, seconds since 1970:01:01) to    *</span>
00126 <span class="comment"> * a 22-character, null-terminated string in the form of  *</span>
00127 <span class="comment"> *            yyyy/mm/dd hh:mm:ss.ss                      *</span>
00128 <span class="comment"> * Time string returned is in UTC time                    *</span>
00129 <span class="comment"> * Target buffer must be 23-chars long to have room for   *</span>
00130 <span class="comment"> * null-character                                         *</span>
00131 <span class="comment"> **********************************************************/</span> 
<a name="l00132"></a><a class="code" href="time__ew_8c.html#a6">00132</a> <span class="keywordtype">char</span> *<a class="code" href="time__ew_8c.html#a6">datestr23</a>( <span class="keywordtype">double</span> t, <span class="keywordtype">char</span> *pbuf, <span class="keywordtype">int</span> len )
00133 {  
00134    time_t    tt;       <span class="comment">/* time as time_t                  */</span>
00135    <span class="keyword">struct </span>tm stm;      <span class="comment">/* time as struct tm               */</span>
00136    <span class="keywordtype">int</span>       t_hsec;   <span class="comment">/* hundredths-seconds part of time */</span>
00137 
00138 <span class="comment">/* Make sure target is big enough</span>
00139 <span class="comment"> ********************************/</span>
00140    <span class="keywordflow">if</span>( len &lt; <a class="code" href="time__ew_8h.html#a0">DATESTR23</a> ) <span class="keywordflow">return</span>( (<span class="keywordtype">char</span> *)NULL );
00141 
00142 <span class="comment">/* Convert double time to other formats </span>
00143 <span class="comment"> **************************************/</span>
00144    t += 0.005;  <span class="comment">/* prepare to round to the nearest 100th */</span>
00145    tt     = (time_t) t;
00146    t_hsec = (int)( (t - tt) * 100. );
00147    <a class="code" href="time__ew_8c.html#a0">gmtime_ew</a>( &amp;tt, &amp;stm );
00148 
00149 <span class="comment">/* Build character string</span>
00150 <span class="comment"> ************************/</span>
00151    sprintf( pbuf, 
00152            <span class="stringliteral">"%04d/%02d/%02d %02d:%02d:%02d.%02d"</span>,
00153             stm.tm_year+1900,
00154             stm.tm_mon+1,
00155             stm.tm_mday,
00156             stm.tm_hour,
00157             stm.tm_min,
00158             stm.tm_sec,            
00159             t_hsec );
00160  
00161    <span class="keywordflow">return</span>( pbuf );
00162 }
00163 
00164 
00165 <span class="comment">/**********************************************************</span>
00166 <span class="comment"> * Converts time (double, seconds since 1970:01:01) to    *</span>
00167 <span class="comment"> * a 22-character, null-terminated string in the form of  *</span>
00168 <span class="comment"> *            yyyy/mm/dd hh:mm:ss.ss                      *</span>
00169 <span class="comment"> * Time string returned is in LOCAL time                  *</span>
00170 <span class="comment"> * Target buffer must be 23-chars long to have room for   *</span>
00171 <span class="comment"> * null-character                                         *</span>
00172 <span class="comment"> **********************************************************/</span> 
<a name="l00173"></a><a class="code" href="time__ew_8c.html#a7">00173</a> <span class="keywordtype">char</span> *<a class="code" href="time__ew_8c.html#a7">datestr23_local</a>( <span class="keywordtype">double</span> t, <span class="keywordtype">char</span> *pbuf, <span class="keywordtype">int</span> len )
00174 {  
00175    time_t    tt;       <span class="comment">/* time as time_t                  */</span>
00176    <span class="keyword">struct </span>tm stm;      <span class="comment">/* time as struct tm               */</span>
00177    <span class="keywordtype">int</span>       t_hsec;   <span class="comment">/* hundredths-seconds part of time */</span>
00178 
00179 <span class="comment">/* Make sure target is big enough</span>
00180 <span class="comment"> ********************************/</span>
00181    <span class="keywordflow">if</span>( len &lt; <a class="code" href="time__ew_8h.html#a0">DATESTR23</a> ) <span class="keywordflow">return</span>( (<span class="keywordtype">char</span> *)NULL );
00182 
00183 <span class="comment">/* Convert double time to other formats </span>
00184 <span class="comment"> **************************************/</span>
00185    t += 0.005;  <span class="comment">/* prepare to round to the nearest 100th */</span>
00186    tt     = (time_t) t;
00187    t_hsec = (int)( (t - tt) * 100. );
00188    <a class="code" href="time__ew_8c.html#a1">localtime_ew</a>( &amp;tt, &amp;stm );
00189 
00190 <span class="comment">/* Build character string</span>
00191 <span class="comment"> ************************/</span>
00192    sprintf( pbuf, 
00193            <span class="stringliteral">"%04d/%02d/%02d %02d:%02d:%02d.%02d"</span>,
00194             stm.tm_year+1900,
00195             stm.tm_mon+1,
00196             stm.tm_mday,
00197             stm.tm_hour,
00198             stm.tm_min,
00199             stm.tm_sec,            
00200             t_hsec );
00201  
00202    <span class="keywordflow">return</span>( pbuf );
00203 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:11 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
