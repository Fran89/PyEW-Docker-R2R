<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sacputaway.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>sacputaway.c</h1><a href="sacputaway_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: sacputaway_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.24  2002/03/22 18:38:13  lucky</span>
00011 <span class="comment"> *     Fixed SACPABase_init prototype</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *     Revision 1.23  2002/03/22 18:25:24  lucky</span>
00014 <span class="comment"> *     Changed SACPABase_init to only create a new directory if told to do so. This way, files</span>
00015 <span class="comment"> *     can be added to a directory.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> *     Revision 1.22  2001/08/02 22:48:50  davidk</span>
00018 <span class="comment"> *     Added explicit float casts to 4 statements to get rid of</span>
00019 <span class="comment"> *     compiler warnings on NT.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> *     Revision 1.21  2001/08/02 22:42:01  lucky</span>
00022 <span class="comment"> *     *** empty log message ***</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> *     Revision 1.20  2001/06/06 20:56:43  lucky</span>
00025 <span class="comment"> *     Fixing support for many mag types and amplitude picks</span>
00026 <span class="comment"> *</span>
00027 <span class="comment"> *     Revision 1.19  2001/05/31 17:08:54  lucky</span>
00028 <span class="comment"> *     Added evdp for event depth - used to only write to evel.</span>
00029 <span class="comment"> *</span>
00030 <span class="comment"> *     Revision 1.18  2001/04/12 03:47:36  lombard</span>
00031 <span class="comment"> *     Major reorganization of SACPABase_write_trace to improve efficiency</span>
00032 <span class="comment"> *     Reformatted code; cleaned up lots of comments and logit calls</span>
00033 <span class="comment"> *     Removed mapping of NC component codes (only needed at UW)</span>
00034 <span class="comment"> *</span>
00035 <span class="comment"> *     Revision 1.17  2000/12/06 17:50:07  lucky</span>
00036 <span class="comment"> *     Added cOnset -- we keep track of the pick's onset in the fourth</span>
00037 <span class="comment"> *     character of the phase label (ka, or kt0)</span>
00038 <span class="comment"> *</span>
00039 <span class="comment"> *     Revision 1.16  2000/11/15 17:03:27  lucky</span>
00040 <span class="comment"> *     Added SACPABase_next_ev_review which sets SacDir variable. (needed this</span>
00041 <span class="comment"> *     to write PZ files correctly). As a result, we no longer need end_ev_review,</span>
00042 <span class="comment"> *     so I removed it.</span>
00043 <span class="comment"> *</span>
00044 <span class="comment"> *     Revision 1.15  2000/09/07 21:17:45  lucky</span>
00045 <span class="comment"> *     Final version after the Review pages have been demonstrated.</span>
00046 <span class="comment"> *</span>
00047 <span class="comment"> *     Revision 1.14  2000/08/25 18:20:41  lucky</span>
00048 <span class="comment"> *     Fixed to work with multiple arrival types (S and P)</span>
00049 <span class="comment"> *</span>
00050 <span class="comment"> *     Revision 1.13  2000/08/17 18:36:51  lucky</span>
00051 <span class="comment"> *     Fixed major potential bugs: Increased size of sacfile to 2*MAXTXT;</span>
00052 <span class="comment"> *     also, we now make sure that the target string is big enough for th</span>
00053 <span class="comment"> *     source and also the termination character.</span>
00054 <span class="comment"> *</span>
00055 <span class="comment"> *     Revision 1.12  2000/07/27 15:55:59  lucky</span>
00056 <span class="comment"> *     Changed MAX_PHS_PER_EQ to DB_MAX_PHS_PER_EQ</span>
00057 <span class="comment"> *</span>
00058 <span class="comment"> *     Revision 1.11  2000/07/03 18:26:24  lucky</span>
00059 <span class="comment"> *     Added SACPABase_end_scn_review for sac writing from inside the</span>
00060 <span class="comment"> *     review pages. This is necessary for the review applet to run.</span>
00061 <span class="comment"> *</span>
00062 <span class="comment"> *     Revision 1.10  2000/05/24 15:58:31  lucky</span>
00063 <span class="comment"> *     Changed calls to creat/write to fopen/fwrite. The old way would not write</span>
00064 <span class="comment"> *     correct SAC files under NT.</span>
00065 <span class="comment"> *</span>
00066 <span class="comment"> *     Revision 1.9  2000/04/13 17:12:58  lucky</span>
00067 <span class="comment"> *     Fixed several logit lines to only log to file.</span>
00068 <span class="comment"> *</span>
00069 <span class="comment"> *     Revision 1.8  2000/04/13 17:06:01  lucky</span>
00070 <span class="comment"> *     In CreateSACSupportFiles: took out the chdir call to SacDir. Instead, the support</span>
00071 <span class="comment"> *     files are opened from the current directory by appending SacDir to the name of the</span>
00072 <span class="comment"> *     file. This was necessary in order to allow for multiple events to be processed by</span>
00073 <span class="comment"> *     the archiver. Before, we would never chdir back to the top level directory, causing</span>
00074 <span class="comment"> *     all subsequent calls to the Sac putaway routines to bomb.</span>
00075 <span class="comment"> *</span>
00076 <span class="comment"> *     Also, fixed zCurEventIDACPABase_next_ev so that if dEventStartTime is 0 for some reason,</span>
00077 <span class="comment"> *     the directory created will have the current time. Before it would always create</span>
00078 <span class="comment"> *     a directory with 1970 date (i.e. time_t of 0).</span>
00079 <span class="comment"> *</span>
00080 <span class="comment"> *     Revision 1.7  2000/03/31 18:26:47  davidk</span>
00081 <span class="comment"> *     *** empty log message ***</span>
00082 <span class="comment"> *</span>
00083 <span class="comment"> *     Revision 1.6  2000/03/24 07:36:40  davidk</span>
00084 <span class="comment"> *     added code to pad the pick label field with blanks, instead of the default (-12345)</span>
00085 <span class="comment"> *</span>
00086 <span class="comment"> *     Revision 1.5  2000/03/14 18:34:41  lucky</span>
00087 <span class="comment"> *     Fixed a bug with creation of SAC directories: they were being created</span>
00088 <span class="comment"> *     as yyyymmmm, instead of yyyymm.</span>
00089 <span class="comment"> *</span>
00090 <span class="comment"> *     Revision 1.4  2000/03/13 21:36:05  lucky</span>
00091 <span class="comment"> *     Fixed error in SACPA_next_ev where pOrigin was used when it was</span>
00092 <span class="comment"> *     still set to NULL.</span>
00093 <span class="comment"> *</span>
00094 <span class="comment"> *     Revision 1.3  2000/03/10 23:27:33  davidk</span>
00095 <span class="comment"> *     Redesigned the sacputaway routines so that they could also be</span>
00096 <span class="comment"> *     used to write parametric event and station data in addition to</span>
00097 <span class="comment"> *     being used for trace disposal.  Moved most of the old functionality</span>
00098 <span class="comment"> *     into a SACPABase_XXX layer.  Now the SACPA_XXX routines serve as</span>
00099 <span class="comment"> *     wrappers for the SACPABase_XXX routines, which do the actual SAC</span>
00100 <span class="comment"> *     header filling and file writing.  Added code adapted from ora2sac</span>
00101 <span class="comment"> *     to write Origin and arrival data.  Added code to write Poles and Zeroes</span>
00102 <span class="comment"> *     station signal response data.  Changed the SACPA_XXX routines to</span>
00103 <span class="comment"> *     matche the new putaway interface in putaway.c</span>
00104 <span class="comment"> *</span>
00105 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00106 <span class="comment"> *     Initial revision</span>
00107 <span class="comment"> *</span>
00108 <span class="comment"> *</span>
00109 <span class="comment"> */</span>
00110 
00111 <span class="comment">/* sacputaway.c </span>
00112 <span class="comment"></span>
00113 <span class="comment">  Wed Feb 23 XX:XX:XX PST 2000 David Kragness</span>
00114 <span class="comment">    Modified the sacputaway routines to use an additional layer.</span>
00115 <span class="comment">        It was desired that the same core code be used to do all </span>
00116 <span class="comment">        data disposal into SAC, and some programs needed/wanted to</span>
00117 <span class="comment">        write parametric data as well as trace data.  In the putaway</span>
00118 <span class="comment">        interface, there is only room for trace data.  So the SACPA_XXX</span>
00119 <span class="comment">        routines have been modified so that the guts of the original </span>
00120 <span class="comment">        routines have gone into a layer of functions called </span>
00121 <span class="comment">        SACPABase_XXX, and the original SACPA_XXX routines have</span>
00122 <span class="comment">        become wrappers for those routines using the XXX_tracesave </span>
00123 <span class="comment">        "putaway" interface.  Additional functionality has been added</span>
00124 <span class="comment">        to the SACPABase_XXX routines for writing parametric data to</span>
00125 <span class="comment">        SAC in addition to the waveform data that was written by the</span>
00126 <span class="comment">        original SACPA_XXX routines.</span>
00127 <span class="comment"></span>
00128 <span class="comment"></span>
00129 <span class="comment">  Thu Dec 30 00:01:12 GMT 1999 Lucky Vidmar</span>
00130 <span class="comment">    Made the fixes necessary to produce SAC files on NT which </span>
00131 <span class="comment">    are readable on Solaris. For this, we needed to do some magic</span>
00132 <span class="comment">    with the SAC header, so that it can be byte-swapped correctly.</span>
00133 <span class="comment">    Namely, we now have two SAC headers floating around: one is </span>
00134 <span class="comment">    in the local machine format, and its values are copied to the </span>
00135 <span class="comment">    temporary header so that it can be swapped (the "problem" being</span>
00136 <span class="comment">    that byte-swapping is done in-place). Then, once we get back</span>
00137 <span class="comment">    a byte-swapped header, we memcpy it back to the memory that is</span>
00138 <span class="comment">    written out along with the previously byte-swapped data. </span>
00139 <span class="comment"></span>
00140 <span class="comment">  Thu Jul 22 14:56:37 MDT 1999 Lucky Vidmar</span>
00141 <span class="comment">    Major structural changes to accomodate making all putaway routines</span>
00142 <span class="comment">    into library calls so that they can be shared between trig2disk </span>
00143 <span class="comment">    and wave2disk. Eliminated global variables set and allocated outside</span>
00144 <span class="comment">    of this file. We should only have static globals from now on, with </span>
00145 <span class="comment">    everything else being passed in via the putaway.c calls.</span>
00146 <span class="comment"></span>
00147 <span class="comment"></span>
00148 <span class="comment">  Tue Apr 13 13:01:23 MDT 1999 Lucky Vidmar</span>
00149 <span class="comment">    Changed target directory names to reflect ora2sac. Also, we now</span>
00150 <span class="comment">    create a bunch of support files (sac macros) in the target directory,</span>
00151 <span class="comment">    much like ora2sac. As a matter of fact, most of the code which </span>
00152 <span class="comment">    creates sac macros was modelled after ora2sac code.</span>
00153 <span class="comment"></span>
00154 <span class="comment"></span>
00155 <span class="comment"> These are the routines which plug into routines in putaway.c, and cause </span>
00156 <span class="comment"> the trace data snippets to be put away into a SAC format trace files.  </span>
00157 <span class="comment"></span>
00158 <span class="comment">   Written by: Pete Lombard, March 1998</span>
00159 <span class="comment"></span>
00160 <span class="comment"> Modified by withers to work with trig2disk Sep, 1998</span>
00161 <span class="comment"> Ported to NT withers Oct 1998</span>
00162 <span class="comment">   </span>
00163 <span class="comment">   */</span>
00164 
00165 <span class="comment">/************************************/</span>
00167 <span class="comment">/************************************/</span>
00168 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00169 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00170 <span class="preprocessor">#include &lt;string.h&gt;</span>
00171 <span class="preprocessor">#include &lt;errno.h&gt;</span>
00172 <span class="preprocessor">#include &lt;<a class="code" href="earthworm_8h.html">earthworm.h</a>&gt;</span>
00173 <span class="preprocessor">#include &lt;time.h&gt;</span>
00174 <span class="preprocessor">#include &lt;<a class="code" href="trace__buf_8h.html">trace_buf.h</a>&gt;</span>
00175 <span class="preprocessor">#include &lt;<a class="code" href="swap_8h.html">swap.h</a>&gt;</span>
00176 <span class="preprocessor">#include &lt;<a class="code" href="ws__clientII_8h.html">ws_clientII.h</a>&gt;</span>
00177 <span class="preprocessor">#include &lt;<a class="code" href="chron3_8h.html">chron3.h</a>&gt;</span>
00178 <span class="preprocessor">#include &lt;<a class="code" href="sacputaway_8h.html">sacputaway.h</a>&gt;</span>
00179 <span class="preprocessor">#include &lt;<a class="code" href="pa__subs_8h.html">pa_subs.h</a>&gt;</span>
00180 <span class="preprocessor">#include &lt;<a class="code" href="time__ew_8h.html">time_ew.h</a>&gt;</span>
00181 
00182 
00183 <span class="comment">/*********************************************/</span>
00185 <span class="comment">/*********************************************/</span>
<a name="l00186"></a><a class="code" href="sacputaway_8c.html#a5">00186</a> <span class="keyword">static</span> <a class="code" href="struct__SACFileList.html">SACFileListStruct</a>   <a class="code" href="sacputaway_8c.html#a5">FileList</a>[<a class="code" href="earthworm__defs_8h.html#a14">DB_MAX_PHS_PER_EQ</a>];
<a name="l00187"></a><a class="code" href="sacputaway_8c.html#a6">00187</a> <span class="keyword">static</span> <span class="keywordtype">int</span>                 <a class="code" href="sacputaway_8c.html#a6">FileIndex</a>;
<a name="l00188"></a><a class="code" href="sacputaway_8c.html#a7">00188</a> <span class="keyword">static</span> <span class="keywordtype">char</span>                <a class="code" href="sacputaway_8c.html#a7">szCurEventID</a>[<a class="code" href="earthworm__defs_8h.html#a18">EVENTID_SIZE</a>+1];
<a name="l00189"></a><a class="code" href="sacputaway_8c.html#a8">00189</a> <span class="keyword">static</span> <span class="keywordtype">int</span>                 <a class="code" href="sacputaway_8c.html#a8">SACPAB_Debug</a>=0;
<a name="l00190"></a><a class="code" href="sacputaway_8c.html#a9">00190</a> <span class="keyword">static</span> <span class="keywordtype">char</span>                <a class="code" href="sacputaway_8c.html#a9">SAC_szOutDir</a>[<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a>];
<a name="l00191"></a><a class="code" href="sacputaway_8c.html#a10">00191</a> <span class="keyword">static</span> <span class="keywordtype">char</span>                <a class="code" href="sacputaway_8c.html#a10">SAC_szOutputFormat</a>[20];
<a name="l00192"></a><a class="code" href="sacputaway_8c.html#a11">00192</a> <span class="keyword">static</span> <span class="keywordtype">double</span>              <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>;
<a name="l00193"></a><a class="code" href="sacputaway_8c.html#a12">00193</a> <span class="keyword">static</span> <a class="code" href="struct__SAC__OriginStruct.html">SAC_OriginStruct</a>    <a class="code" href="sacputaway_8c.html#a12">SAC_Origin</a>;
00194 
00195 
00196 <span class="comment">/* use statically allocated SAC headers.  It's safer and faster</span>
00197 <span class="comment">   than dynamically mallocing them and it's not </span>
00198 <span class="comment">   that much space (6XX bytes each)</span>
00199 <span class="comment">****************************************************************/</span>
<a name="l00200"></a><a class="code" href="sacputaway_8c.html#a13">00200</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="sacputaway_8c.html#a13">default_sachead</a>[<a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a>];
<a name="l00201"></a><a class="code" href="sacputaway_8c.html#a14">00201</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="sacputaway_8c.html#a14">sachead</a>[<a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a>];
00202 
00203 <span class="comment">/* sacheadp is where the "real" representation of the header is, i.e</span>
00204 <span class="comment">   the one that is valid on the architecture that executes the code</span>
00205 <span class="comment">****************************************************************/</span>
<a name="l00206"></a><a class="code" href="sacputaway_8c.html#a15">00206</a> <span class="keyword">static</span> <span class="keyword">struct   </span><a class="code" href="structSAChead.html">SAChead</a> *<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>=(<span class="keyword">struct </span><a class="code" href="structSAChead.html">SAChead</a> *) <a class="code" href="sacputaway_8c.html#a14">sachead</a>;  
00207 
00208 <span class="comment">/* default_sacheadp is the default sac header image.  This way we don't</span>
00209 <span class="comment">   have to go through painful initialization each time, we just slam</span>
00210 <span class="comment">   the default into our target header.</span>
00211 <span class="comment">****************************************************************/</span>
<a name="l00212"></a><a class="code" href="sacputaway_8c.html#a16">00212</a> <span class="keyword">static</span> <span class="keyword">struct   </span><a class="code" href="structSAChead.html">SAChead</a> *<a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>=(<span class="keyword">struct </span><a class="code" href="structSAChead.html">SAChead</a> *) <a class="code" href="sacputaway_8c.html#a13">default_sachead</a>;
00213 
<a name="l00214"></a><a class="code" href="sacputaway_8c.html#a17">00214</a> <span class="keyword">static</span> <span class="keywordtype">char</span>  <a class="code" href="sacputaway_8c.html#a17">SacDir</a>[2*<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a> + 4];
<a name="l00215"></a><a class="code" href="sacputaway_8c.html#a18">00215</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="sacputaway_8c.html#a18">SacBuffer</a>;   <span class="comment">/* buffer for storing output before writing */</span>
<a name="l00216"></a><a class="code" href="sacputaway_8c.html#a19">00216</a> <span class="keyword">static</span> <span class="keywordtype">char</span>  <a class="code" href="sacputaway_8c.html#a19">SAC_szSta</a>[10], <a class="code" href="sacputaway_8c.html#a20">SAC_szChan</a>[10], <a class="code" href="sacputaway_8c.html#a21">SAC_szNet</a>[10];
<a name="l00217"></a><a class="code" href="sacputaway_8c.html#a22">00217</a> <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="sacputaway_8c.html#a22">BufferLen</a>;
<a name="l00218"></a><a class="code" href="sacputaway_8c.html#a23">00218</a> <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="sacputaway_8c.html#a23">bSACPABase_init</a>=<a class="code" href="earthworm__defs_8h.html#a9">FALSE</a>;
<a name="l00219"></a><a class="code" href="sacputaway_8c.html#a24">00219</a> <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="sacputaway_8c.html#a24">bSACPABase_scn_open</a>=<a class="code" href="earthworm__defs_8h.html#a9">FALSE</a>;
00220 
00221 
00222 <span class="comment">/************************************/</span>
00224 <span class="comment">/************************************/</span>
00225 
00226 <span class="comment">/* supporting routines </span>
00227 <span class="comment">*************************************/</span>
00228 <span class="keywordtype">void</span> <a class="code" href="sacputaway_8c.html#a25">sacinit</a> (<span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *);
00229 <span class="keywordtype">void</span> <a class="code" href="sacputaway_8c.html#a26">swapsac</a> (<span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *);
00230 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a27">SAC_Compare</a> (<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *);
00231 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a28">CreateSACSupportFiles</a> (<span class="keywordtype">char</span> *, <a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *, <span class="keywordtype">int</span>);
00232 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a29">SACmac_init</a> (<span class="keywordtype">void</span>);                          
00233 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a30">SACmac_quicklook</a> (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *, <span class="keywordtype">int</span>);
00234 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a31">SACmac_repick</a> (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *, <span class="keywordtype">int</span>);
00235 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a32">SAC_filelist</a> (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *, <span class="keywordtype">int</span>, <span class="keywordtype">char</span> *);
00236 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a33">SAC_SwapDouble</a>(<span class="keywordtype">double</span> * pValue, <span class="keywordtype">char</span> cDataType);
00237 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a34">SAC_SwapLong</a>(<span class="keywordtype">long</span> * pValue, <span class="keywordtype">char</span> cDataType);
00238 <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a35">SAC_SwapShort</a>(<span class="keywordtype">short</span> * pValue, <span class="keywordtype">char</span> cDataType);
00239 
00240 
00241 <span class="comment">/********************************************************************</span>
00242 <span class="comment">*********************************************************************</span>
00243 <span class="comment">###################### SAC PUTAWAY ROUTINES #########################</span>
00244 <span class="comment">*********************************************************************</span>
00245 <span class="comment">********************************************************************/</span>
00246 
00247 <span class="comment">/* Initialization function, </span>
00248 <span class="comment">*       This is the Put Away startup intializer. This is called when    *</span>
00249 <span class="comment">*       the system first comes up. Here is a chance to look around      *</span>
00250 <span class="comment">*       and see if it's possible to do business, and to complain        *</span>
00251 <span class="comment">*       if not ,BEFORE an event has to be processed.                    *</span>
00252 <span class="comment">*/</span>
<a name="l00253"></a><a class="code" href="sacputaway_8c.html#a36">00253</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a36">SACPA_init</a>(<span class="keywordtype">long</span> OutBufferLen, <span class="keywordtype">char</span> *OutDir, <span class="keywordtype">char</span> * OutputFormat, <span class="keywordtype">int</span> debug)
00254 {
00255   <span class="keywordtype">int</span> rc;
00256 
00257   rc=<a class="code" href="sacputaway_8c.html#a41">SACPABase_Debug</a>(debug);
00258   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00259   {
00260     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00261           <span class="stringliteral">"SACPA_init"</span>,<span class="stringliteral">"SACPABase_Debug"</span>,rc);
00262     <span class="keywordflow">return</span>(EW_FAILURE);
00263   }
00264 
00265   rc=<a class="code" href="sacputaway_8c.html#a43">SACPABase_init</a>(OutBufferLen,OutDir,TRUE,OutputFormat);
00266   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00267   {
00268     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00269           <span class="stringliteral">"SACPA_init"</span>,<span class="stringliteral">"SACPABase_init"</span>,rc);
00270     <span class="keywordflow">return</span>(EW_FAILURE);
00271   }
00272   <span class="keywordflow">return</span>(EW_SUCCESS);
00273 }
00274 
00275 <span class="comment">/****************************************************************************</span>
00276 <span class="comment">*       This is the Put Away event initializer. It's called when a snippet  *</span>
00277 <span class="comment">*       has been received, and is about to be processed.                    *</span>
00278 <span class="comment">*       It gets to see the pointer to the TraceRequest array,               *</span>
00279 <span class="comment">*       and the number of loaded trace structures.                          *</span>
00280 <span class="comment">*****************************************************************************/</span>
<a name="l00281"></a><a class="code" href="sacputaway_8c.html#a37">00281</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a37">SACPA_next_ev</a>(<span class="keywordtype">char</span> *EventID, <a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> *ptrReq, <span class="keywordtype">int</span> nReq, 
00282                   <span class="keywordtype">char</span> *OutDir, <span class="keywordtype">char</span> *EventDate, <span class="keywordtype">char</span> *EventTime, <span class="keywordtype">int</span> debug)
00283 {
00284 
00285   <span class="keywordtype">int</span> rc;
00286   <span class="keywordtype">char</span> szTime[40];
00287   <span class="keywordtype">double</span> dTime;
00288 
00289   rc=<a class="code" href="sacputaway_8c.html#a41">SACPABase_Debug</a>(debug);
00290   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00291   {
00292     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00293           <span class="stringliteral">"SACPA_next_ev"</span>,<span class="stringliteral">"SACPABase_Debug"</span>,rc);
00294     <span class="keywordflow">return</span>(EW_FAILURE);
00295   }
00296 
00297   sprintf(szTime,<span class="stringliteral">"%s%s"</span>,EventDate,EventTime);
00298   <span class="keywordflow">if</span>(<a class="code" href="chron3_8c.html#a11">epochsec17</a>(&amp;dTime,szTime))
00299   {
00300     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPA_next_ev(): Error in epochsec17() parsing time:(%s)\n"</span>,
00301           szTime);
00302     <span class="keywordflow">return</span>(EW_FAILURE);
00303   }
00304 
00305   rc=<a class="code" href="sacputaway_8c.html#a44">SACPABase_next_ev</a>(EventID,dTime,NULL);
00306   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00307   {
00308     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00309           <span class="stringliteral">"SACPA_next_ev"</span>,<span class="stringliteral">"SACPABase_next_ev"</span>,rc);
00310     <span class="keywordflow">return</span>(EW_FAILURE);
00311   }
00312 
00313   <span class="keywordflow">return</span>(EW_SUCCESS);
00314 }
00315 
00316 
00317 <span class="comment">/*****************************************************************************</span>
00318 <span class="comment"> *   This is the working entry point into the disposal system. This routine  *</span>
00319 <span class="comment"> *   gets called for each trace snippet which has been recovered. It gets    *</span>
00320 <span class="comment"> *   to see the corresponding SNIPPET structure, and the event id            *</span>
00321 <span class="comment"> *****************************************************************************/</span>
00322 <span class="comment">/* Process one channel of data */</span>
<a name="l00323"></a><a class="code" href="sacputaway_8c.html#a38">00323</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a38">SACPA_next</a>(<a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> *getThis, <span class="keywordtype">double</span> GapThresh, 
00324                <span class="keywordtype">long</span> OutBufferLen, <span class="keywordtype">int</span> debug)
00325      <span class="comment">/*</span>
00326 <span class="comment"> * input:  getThis   pointer to buffer for the trace data request</span>
00327 <span class="comment"> *         eventId   not used here </span>
00328 <span class="comment"> */</span>
00329 
00330 {
00331   <span class="keywordtype">int</span> rc;
00332 
00333   rc=<a class="code" href="sacputaway_8c.html#a41">SACPABase_Debug</a>(debug);
00334   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00335   {
00336     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00337           <span class="stringliteral">"SACPA_next"</span>,<span class="stringliteral">"SACPABase_Debug"</span>,rc);
00338     <span class="keywordflow">return</span>(EW_FAILURE);
00339   }
00340 
00341   rc=<a class="code" href="sacputaway_8c.html#a46">SACPABase_next_scn</a>(getThis-&gt;<a class="code" href="structTRACE__REQ.html#m0">sta</a>,getThis-&gt;<a class="code" href="structTRACE__REQ.html#m1">chan</a>,getThis-&gt;<a class="code" href="structTRACE__REQ.html#m2">net</a>);
00342   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00343   {
00344     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00345           <span class="stringliteral">"SACPA_next"</span>,<span class="stringliteral">"SACPABase_next_scn"</span>,rc);
00346     <span class="keywordflow">return</span>(EW_FAILURE);
00347   }
00348 
00349   rc=<a class="code" href="sacputaway_8c.html#a47">SACPABase_write_trace</a>(getThis,GapThresh);
00350   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00351   {
00352     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00353           <span class="stringliteral">"SACPA_next"</span>,<span class="stringliteral">"SACPABase_write_trace"</span>,rc);
00354     <span class="keywordflow">return</span>(EW_FAILURE);
00355   }
00356 
00357   rc=<a class="code" href="sacputaway_8c.html#a51">SACPABase_end_scn</a>();
00358   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00359   {
00360     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00361           <span class="stringliteral">"SACPA_next"</span>,<span class="stringliteral">"SACPABase_end_scn()"</span>,rc);
00362     <span class="keywordflow">return</span>(EW_FAILURE);
00363   }
00364 
00365   <span class="keywordflow">return</span>(EW_SUCCESS);
00366 }
00367 
00368 
00369 
00370 <span class="comment">/************************************************************************</span>
00371 <span class="comment">*       This is the Put Away end event routine. It's called after we've     *</span>
00372 <span class="comment">*       finished processing one event.                                  *</span>
00373 <span class="comment">*************************************************************************/</span>
<a name="l00374"></a><a class="code" href="sacputaway_8c.html#a39">00374</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a39">SACPA_end_ev</a> (<span class="keywordtype">int</span> debug)
00375 {
00376   <span class="keywordtype">int</span> rc;
00377 
00378   rc=<a class="code" href="sacputaway_8c.html#a41">SACPABase_Debug</a>(debug);
00379   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00380   {
00381     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00382           <span class="stringliteral">"SACPA_end_ev"</span>,<span class="stringliteral">"SACPABase_Debug"</span>,rc);
00383     <span class="keywordflow">return</span>(EW_FAILURE);
00384   }
00385 
00386   rc=<a class="code" href="sacputaway_8c.html#a53">SACPABase_end_ev</a>();
00387   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00388   {
00389     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00390           <span class="stringliteral">"SACPA_end_ev"</span>,<span class="stringliteral">"SACPABase_end_ev"</span>,rc);
00391     <span class="keywordflow">return</span>(EW_FAILURE);
00392   }
00393 
00394   <span class="keywordflow">return</span>(EW_SUCCESS);
00395 }
00396 
00397 
00398 <span class="comment">/************************************************************************</span>
00399 <span class="comment">*       This is the Put Away close routine. It's called after when      *</span>
00400 <span class="comment">*       we're being shut down.                                          *</span>
00401 <span class="comment">*************************************************************************/</span>
<a name="l00402"></a><a class="code" href="sacputaway_8c.html#a40">00402</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a40">SACPA_close</a> (<span class="keywordtype">int</span> debug)
00403 {
00404   <span class="keywordtype">int</span> rc;
00405 
00406   rc=<a class="code" href="sacputaway_8c.html#a41">SACPABase_Debug</a>(debug);
00407   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00408   {
00409     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00410           <span class="stringliteral">"SACPA_close"</span>,<span class="stringliteral">"SACPABase_Debug"</span>,rc);
00411     <span class="keywordflow">return</span>(EW_FAILURE);
00412   }
00413 
00414   rc=<a class="code" href="sacputaway_8c.html#a54">SACPABase_close</a>();
00415   <span class="keywordflow">if</span>(rc!=<a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00416   {
00417     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"%s(): %s() failed returning %d.\n"</span>,
00418           <span class="stringliteral">"SACPA_close"</span>,<span class="stringliteral">"SACPABase_close"</span>,rc);
00419     <span class="keywordflow">return</span>(EW_FAILURE);
00420   }
00421 
00422   <span class="keywordflow">return</span>(EW_SUCCESS);
00423 }
00424 
00425 
00426 
00427 <span class="comment">/********************************************************************</span>
00428 <span class="comment">*********************************************************************</span>
00429 <span class="comment">#################### SAC PUTAWAY BASE ROUTINES ######################</span>
00430 <span class="comment">*********************************************************************</span>
00431 <span class="comment">********************************************************************/</span>
00432 
00433 
00434 
00435 
00436 <span class="comment">/********************************************************************</span>
00437 <span class="comment">*********************************************************************</span>
00438 <span class="comment">    Function:      SACPABase_Debug</span>
00439 <span class="comment"></span>
00440 <span class="comment">    Description:   Turns debugging on/off for SACPABase </span>
00441 <span class="comment">                   functions</span>
00442 <span class="comment">  </span>
00443 <span class="comment">    Return Value:  success: EW_SUCCESS </span>
00444 <span class="comment">                   failure: EW_FAILURE</span>
00445 <span class="comment">                   others:  Undefined</span>
00446 <span class="comment"></span>
00447 <span class="comment">    Comments:</span>
00448 <span class="comment">*********************************************************************</span>
00449 <span class="comment">********************************************************************/</span>
<a name="l00450"></a><a class="code" href="sacputaway_8c.html#a41">00450</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a41">SACPABase_Debug</a>(<span class="keywordtype">int</span> bDebug)
00451 {
00452   <a class="code" href="sacputaway_8c.html#a8">SACPAB_Debug</a>=bDebug;
00453   <span class="keywordflow">return</span>(EW_SUCCESS);
00454 }
00455 
00456 <span class="comment">/********************************************************************</span>
00457 <span class="comment">*********************************************************************</span>
00458 <span class="comment">    Function:      SACPABase_SetOutputFormat</span>
00459 <span class="comment"></span>
00460 <span class="comment">    Description:   Sets the output format for the SACPABase functions.</span>
00461 <span class="comment">                    ("intel" or "sparc")</span>
00462 <span class="comment">  </span>
00463 <span class="comment">    Return Value:  success: EW_SUCCESS </span>
00464 <span class="comment">                   failure: EW_FAILURE</span>
00465 <span class="comment">                            SACPAB_OUTPUT_FORMAT_TOO_LONG</span>
00466 <span class="comment">                   others:  Undefined</span>
00467 <span class="comment"></span>
00468 <span class="comment">    Comments:</span>
00469 <span class="comment">*********************************************************************</span>
00470 <span class="comment">********************************************************************/</span>
<a name="l00471"></a><a class="code" href="sacputaway_8c.html#a42">00471</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a42">SACPABase_SetOutputFormat</a>(<span class="keywordtype">char</span> * szOutputFormat)
00472 {
00473   <span class="keywordflow">if</span>(strlen(szOutputFormat) &gt; <span class="keyword">sizeof</span>(SAC_szOutputFormat))
00474   {
00475     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_SetOutputFormat():Error: %s output format is too long!\n"</span>,
00476           szOutputFormat);
00477     <span class="keywordflow">return</span>(SACPAB_OUTPUT_FORMAT_TOO_LONG);
00478   }
00479   strcpy(SAC_szOutputFormat,szOutputFormat);
00480   <span class="keywordflow">return</span>(EW_SUCCESS);
00481 }
00482 
00483 <span class="comment">/********************************************************************</span>
00484 <span class="comment">*********************************************************************</span>
00485 <span class="comment">    Function:      SACPABase_init</span>
00486 <span class="comment"></span>
00487 <span class="comment">    Description:   SAC Putaway Base initializer.</span>
00488 <span class="comment">  </span>
00489 <span class="comment">    Return Value:  success: EW_SUCCESS </span>
00490 <span class="comment">                   failure: EW_FAILURE (unknown error)</span>
00491 <span class="comment">                            SACPAB_ALREADY_INIT (SACPABase is already </span>
00492 <span class="comment">                             initialized.  Please call SACPABase_close()</span>
00493 <span class="comment">                             before calling SACPABase_init() again.</span>
00494 <span class="comment"></span>
00495 <span class="comment">                   others:  Undefined</span>
00496 <span class="comment"></span>
00497 <span class="comment">    Comments:      This should be called when the system first comes </span>
00498 <span class="comment">                   up.  It gives SACPABase  a chance to look around </span>
00499 <span class="comment">                   and see if it's possible to do business, and to  </span>
00500 <span class="comment">                   complain if not ,BEFORE an event has to be </span>
00501 <span class="comment">                   processed. </span>
00502 <span class="comment">*********************************************************************</span>
00503 <span class="comment">********************************************************************/</span>
<a name="l00504"></a><a class="code" href="sacputaway_8c.html#a43">00504</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a43">SACPABase_init</a>(<span class="keywordtype">int</span> OutBufferLen, <span class="keywordtype">char</span> *szOutDir, <span class="keywordtype">int</span> CreateNewDir, <span class="keywordtype">char</span> * szOutputFormat)
00505 {
00506   <span class="keywordflow">if</span> (bSACPABase_init)
00507   {
00508     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_init() called multiple times.\n"</span>);
00509     <span class="keywordflow">return</span>(SACPAB_ALREADY_INIT);
00510   }
00511 
00512   <span class="keywordflow">if</span>(!(szOutDir &amp;&amp; szOutputFormat))
00513   {
00514     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_init():  Error: Null pointers passed.\n"</span>);
00515     <span class="keywordflow">return</span>(SACPAB_NULL_POINTERS);
00516   }
00517 
00518   <span class="keywordflow">if</span>(OutBufferLen &gt; <a class="code" href="sacputaway_8h.html#a9">MIN_OUTBUFFER_LEN</a>)
00519     <a class="code" href="sacputaway_8c.html#a22">BufferLen</a>=OutBufferLen;
00520   <span class="keywordflow">else</span> 
00521     <a class="code" href="sacputaway_8c.html#a22">BufferLen</a>=<a class="code" href="sacputaway_8h.html#a9">MIN_OUTBUFFER_LEN</a>;
00522 
00523   <span class="comment">/* Allocate SacBuffer */</span>
00524   <span class="keywordflow">if</span> ((<a class="code" href="sacputaway_8c.html#a18">SacBuffer</a> = (<span class="keywordtype">char</span> *) malloc (BufferLen * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>))) == NULL)
00525   {
00526     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_init: couldn't malloc SacBuffer(%d)\n"</span>, BufferLen);
00527     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00528   }
00529 
00530   <span class="comment">/* set init flag here to minimize memory leaks. */</span>
00531   <a class="code" href="sacputaway_8c.html#a23">bSACPABase_init</a>=<a class="code" href="earthworm__defs_8h.html#a8">TRUE</a>;
00532 
00533   <span class="keywordflow">if</span>(strlen(szOutDir) &gt; (<span class="keyword">sizeof</span>(SAC_szOutDir) + 1))
00534   {
00535     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SACPABase_init():Error: %s directory name is too long!\n"</span>,
00536           szOutDir);
00537     <span class="keywordflow">return</span>(SACPAB_DIRECTORY_TOO_LONG);
00538   }
00539   strcpy(SAC_szOutDir,szOutDir);
00540 
00541   <span class="comment">/* Make sure that the top level output directory exists */</span>
00542 
00543   <span class="keywordflow">if</span> (CreateNewDir == <a class="code" href="earthworm__defs_8h.html#a8">TRUE</a>)
00544   {
00545     <span class="keywordflow">if</span> (<a class="code" href="dirops__ew_8c.html#a1">CreateDir</a> (SAC_szOutDir) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00546     {
00547       <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_init: Call to CreateDir(%s) failed\n"</span>,SAC_szOutDir);
00548       <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00549     }
00550   }
00551 
00552   <span class="keywordflow">if</span>(strlen(szOutputFormat) &gt; <span class="keyword">sizeof</span>(SAC_szOutputFormat))
00553   {
00554     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SACPABase_init():Error: %s output format is too long!\n"</span>,
00555           szOutputFormat);
00556     <span class="keywordflow">return</span>(SACPAB_OUTPUT_FORMAT_TOO_LONG);
00557   }
00558   strcpy(SAC_szOutputFormat,szOutputFormat);
00559 
00560   <span class="comment">/* Initialize all header values to SAC defaults */</span>
00561   <a class="code" href="sacputaway_8c.html#a25">sacinit</a>(default_sacheadp);
00562 
00563   <span class="comment">/* the following sac header vars must be set, but not neccessarily </span>
00564 <span class="comment">     here:  npts,b,e,iftype,leven,delta</span>
00565 <span class="comment">  ******************************************************************/</span>
00566   <span class="comment">/* Set some header values that will never change */</span>
00567   <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m74">idep</a>  = <a class="code" href="sachead_8h.html#a11">SAC_IUNKN</a>;      <span class="comment">/* unknown independent data type */</span>
00568   <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m75">iztype</a> = <a class="code" href="sachead_8h.html#a16">SAC_IBEGINTIME</a>; <span class="comment">/* Reference time is Begin time */</span>
00569   <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m73">iftype</a> = <a class="code" href="sachead_8h.html#a17">SAC_ITIME</a>;    <span class="comment">/* File type is time series */</span>
00570   <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m84">leven</a>  = 1;            <span class="comment">/* evenly spaced data */</span>
00571   <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m5">b</a>      = 0; <span class="comment">/* beginning time relative to reference time */</span>
00572   strncpy(<a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m92">ko</a>, <span class="stringliteral">"origin "</span>, K_LEN);
00573 
00574   <span class="comment">/* Initialize CurEventID */</span>
00575   strcpy(szCurEventID,<span class="stringliteral">"-1"</span>);
00576   
00577   <span class="keywordflow">return</span>(EW_SUCCESS); 
00578 }
00579 
00580 
00581 <span class="comment">/****************************************************************************</span>
00582 <span class="comment">*       This is the Put Away event initializer. It's called when a snippet  *</span>
00583 <span class="comment">*       has been received, and is about to be processed.                    *</span>
00584 <span class="comment">*       It gets to see the pointer to the TraceRequest array,               *</span>
00585 <span class="comment">*       and the number of loaded trace structures.                          *</span>
00586 <span class="comment">*****************************************************************************/</span>
<a name="l00587"></a><a class="code" href="sacputaway_8c.html#a44">00587</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a44">SACPABase_next_ev</a>(<span class="keywordtype">char</span> * szEventID, <span class="keywordtype">double</span> dEventStartTime, 
00588                       <a class="code" href="struct__SAC__OriginStruct.html">SAC_OriginStruct</a> * pOrigin)
00589 {
00590 
00591   <span class="keywordtype">char</span>     tmpname[256];
00592   <span class="keywordtype">char</span>     tmp1[256];
00593   time_t tTemp=(int)dEventStartTime;
00594   <span class="keyword">struct </span>tm tmTemp;
00595 
00596 
00597   <span class="keywordflow">if</span> (dEventStartTime == 0.0)
00598     tTemp = time (NULL);
00599 
00600   <a class="code" href="time__ew_8c.html#a0">gmtime_ew</a>(&amp;tTemp,&amp;tmTemp);
00601 
00602   strncpy(szCurEventID,szEventID,EVENTID_SIZE);
00603   <a class="code" href="sacputaway_8c.html#a7">szCurEventID</a>[<a class="code" href="earthworm__defs_8h.html#a18">EVENTID_SIZE</a>]=0;
00604 
00605   <span class="comment">/* Sac files will be written into the directory structure</span>
00606 <span class="comment">   * borrowed from ora2sac:</span>
00607 <span class="comment">   *   SacDir = OutDir/yyyymm/yyyymmdd_hhmmss-iiii/</span>
00608 <span class="comment">   *</span>
00609 <span class="comment">   *  If SacDir does not exist, it will be created</span>
00610 <span class="comment">   */</span>
00611 
00612   <span class="comment">/* tmpname = OutDir/yyyymm */</span>
00613   sprintf (tmpname, <span class="stringliteral">"%s/%04d%02d"</span>, SAC_szOutDir, 
00614            tmTemp.tm_year+1900, tmTemp.tm_mon+1);
00615 
00616   <span class="keywordflow">if</span> (<a class="code" href="dirops__ew_8c.html#a1">CreateDir</a> (tmpname) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00617   {
00618     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPA_init: Call to CreateDir failed\n"</span>);
00619     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00620   }
00621 
00622   <span class="comment">/* build the event directory name */</span>
00623   sprintf (tmp1, <span class="stringliteral">"%04d%02d%02d_%02d%02d%02d_%s"</span>, 
00624            tmTemp.tm_year+1900, tmTemp.tm_mon+1, tmTemp.tm_mday,
00625            tmTemp.tm_hour, tmTemp.tm_min, tmTemp.tm_sec, 
00626            szCurEventID
00627            );
00628 
00629   sprintf (SacDir, <span class="stringliteral">"%s/%s"</span>, tmpname, tmp1); 
00630 
00631   <span class="keywordflow">if</span> (<a class="code" href="dirops__ew_8c.html#a1">CreateDir</a> (SacDir) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00632   {
00633     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_next_ev: Call to CreateDir(%s)failed\n"</span>,
00634            SacDir);
00635     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00636   }
00637 
00638   <span class="comment">/* reset file index to 0 (for support files) */</span>
00639   <a class="code" href="sacputaway_8c.html#a6">FileIndex</a> = 0;
00640         
00641   <span class="keywordflow">if</span>(pOrigin)
00642   {
00643     memcpy(&amp;SAC_Origin,pOrigin,<span class="keyword">sizeof</span>(<a class="code" href="struct__SAC__OriginStruct.html">SAC_OriginStruct</a>));
00644     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m35">evla</a>=(float)(pOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m0">dLat</a>);
00645     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m36">evlo</a>=(float)(pOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m1">dLon</a>);
00646     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m37">evel</a>=(float)(pOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m2">dElev</a>);
00647     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m38">evdp</a>=(float)(pOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m2">dElev</a>);
00648   }
00649   <span class="keywordflow">else</span>
00650   {
00651     <a class="code" href="sacputaway_8c.html#a12">SAC_Origin</a>.<a class="code" href="struct__SAC__OriginStruct.html#m3">tOrigin</a>=dEventStartTime;
00652   }
00653 
00654   <span class="keywordflow">return</span>(EW_SUCCESS);
00655 }
00656 
00657 <span class="comment">/****************************************************************************</span>
00658 <span class="comment">*       This is the Put Away event initializer for the review system.       *</span>
00659 <span class="comment">*       It doesn't do much except for setting the SacDir variable           *</span>
00660 <span class="comment">*       which gets used a lot in the Sac putaway routines                   *</span>
00661 <span class="comment">*****************************************************************************/</span>
<a name="l00662"></a><a class="code" href="sacputaway_8c.html#a45">00662</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a45">SACPABase_next_ev_review</a> (<span class="keywordtype">char</span> *EventDir, <span class="keywordtype">int</span> EventID, <a class="code" href="struct__SAC__OriginStruct.html">SAC_OriginStruct</a> *pSacOrigin)
00663 {
00664 
00665         <span class="keywordtype">char</span>    evtid[256];
00666 
00667         <span class="keywordflow">if</span> ((EventDir == NULL) || (pSacOrigin == NULL))
00668         {
00669                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid arguments passed in.\n"</span>);
00670                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00671         }
00672 
00673         <span class="comment">/* Set SacDir */</span>
00674         strcpy (SacDir, EventDir);
00675 
00676         <span class="comment">/* Set szCurEventID */</span>
00677         sprintf (evtid, <span class="stringliteral">"%d"</span>, EventID);
00678         strncpy (szCurEventID, evtid, EVENTID_SIZE);
00679         <a class="code" href="sacputaway_8c.html#a7">szCurEventID</a>[<a class="code" href="earthworm__defs_8h.html#a18">EVENTID_SIZE</a>] = 0;
00680 
00681 
00682         <span class="comment">/* Set event parameters */</span>
00683     memcpy (&amp;SAC_Origin, pSacOrigin, <span class="keyword">sizeof</span>(<a class="code" href="struct__SAC__OriginStruct.html">SAC_OriginStruct</a>));
00684     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m35">evla</a> = (float)(pSacOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m0">dLat</a>);
00685     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m36">evlo</a> = (float)(pSacOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m1">dLon</a>);
00686     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m37">evel</a> = (float)(pSacOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m2">dElev</a>);
00687     <a class="code" href="sacputaway_8c.html#a16">default_sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m38">evdp</a> = (float)(pSacOrigin-&gt;<a class="code" href="struct__SAC__OriginStruct.html#m2">dElev</a>);
00688   
00689         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00690 
00691 }
00692 
00693 
00694 <span class="comment">/*****************************************************************************</span>
00695 <span class="comment"> *   This is the working entry point into the disposal system. This routine  *</span>
00696 <span class="comment"> *   gets called for each trace snippet which has been recovered. It gets    *</span>
00697 <span class="comment"> *   to see the corresponding SNIPPET structure, and the event id            *</span>
00698 <span class="comment"> *****************************************************************************/</span>
00699 <span class="comment">/* Process one channel of data */</span>
<a name="l00700"></a><a class="code" href="sacputaway_8c.html#a46">00700</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a46">SACPABase_next_scn</a>(<span class="keywordtype">char</span> *szSta, <span class="keywordtype">char</span> * szChan, <span class="keywordtype">char</span> * szNet)
00701 {
00702   <span class="keywordtype">int</span> i;
00703 
00704   <span class="keywordflow">if</span>(bSACPABase_scn_open)
00705   {
00706     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_next_scn(): ERROR! SCN record is already open,\n"</span>
00707           <span class="stringliteral">"please call SACPABase_scn_end() to close the existing record,\n"</span>
00708           <span class="stringliteral">"before calling SACPABase_next_scn() again.\n"</span>);
00709     <span class="keywordflow">return</span>(SACPAB_SCN_ALREADY_OPEN);
00710   }
00711     
00712   <span class="comment">/* slam the default header into our working one. */</span>
00713   memcpy(sacheadp,default_sacheadp,SACHEADERSIZE);
00714 
00715   <span class="comment">/* Save the SCN for use by other SAC_PA routines */</span>
00716   strncpy(SAC_szSta,szSta,<span class="keyword">sizeof</span>(SAC_szSta));
00717   <a class="code" href="sacputaway_8c.html#a19">SAC_szSta</a>[<span class="keyword">sizeof</span>(SAC_szSta)-1]=0;
00718   strncpy(SAC_szChan,szChan,<span class="keyword">sizeof</span>(SAC_szChan));
00719   <a class="code" href="sacputaway_8c.html#a19">SAC_szSta</a>[<span class="keyword">sizeof</span>(SAC_szChan)-1]=0;
00720   strncpy(SAC_szNet,szNet,<span class="keyword">sizeof</span>(SAC_szSta));
00721   <a class="code" href="sacputaway_8c.html#a19">SAC_szSta</a>[<span class="keyword">sizeof</span>(SAC_szNet)-1]=0;
00722 
00723   <span class="comment">/* Copy the SCN into the header and blank bad the trailing chars */</span>
00724   strcpy(<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m89">kstnm</a>, SAC_szSta);   <span class="comment">/* station name */</span>
00725   <span class="keywordflow">for</span> (i = strlen(SAC_szSta); i &lt; <a class="code" href="sachead_8h.html#a10">K_LEN</a>; ++i) 
00726     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m89">kstnm</a>[i] = <span class="charliteral">' '</span>;
00727 
00728   strcpy(<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m108">kcmpnm</a>, SAC_szChan);
00729   <span class="keywordflow">for</span> (i = strlen(SAC_szChan); i &lt; <a class="code" href="sachead_8h.html#a10">K_LEN</a>; ++i) 
00730     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m108">kcmpnm</a>[i] = <span class="charliteral">' '</span>;
00731 
00732   strcpy(<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m109">knetwk</a>, SAC_szNet);
00733   <span class="keywordflow">for</span> (i = strlen(SAC_szNet); i &lt; <a class="code" href="sachead_8h.html#a10">K_LEN</a>; ++i) 
00734     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m109">knetwk</a>[i] = <span class="charliteral">' '</span>;
00735   
00736   <span class="comment">/* orientation of seismometer -</span>
00737 <span class="comment">     determine the orientation based on the third character</span>
00738 <span class="comment">     of the component name */</span>
00739   <span class="keywordflow">switch</span> ((int) <a class="code" href="sacputaway_8c.html#a20">SAC_szChan</a>[2]) 
00740   {
00741     <span class="comment">/* vertical component */</span>
00742   <span class="keywordflow">case</span> <span class="charliteral">'Z'</span> :
00743   <span class="keywordflow">case</span> <span class="charliteral">'z'</span> :
00744     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m57">cmpaz</a> = 0;
00745     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m58">cmpinc</a> = 0;
00746     <span class="keywordflow">break</span>;
00747     <span class="comment">/* north-south component */</span>
00748   <span class="keywordflow">case</span> <span class="charliteral">'N'</span> :
00749   <span class="keywordflow">case</span> <span class="charliteral">'n'</span> :
00750     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m57">cmpaz</a> = 0;
00751     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m58">cmpinc</a> = 90;
00752     <span class="keywordflow">break</span>;
00753     <span class="comment">/* east-west component */</span>
00754   <span class="keywordflow">case</span> <span class="charliteral">'E'</span> :
00755   <span class="keywordflow">case</span> <span class="charliteral">'e'</span> :
00756     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m57">cmpaz</a> = 90;
00757     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m58">cmpinc</a> = 90;
00758     <span class="keywordflow">break</span>;
00759     <span class="comment">/* anything else */</span>
00760   <span class="keywordflow">default</span> :
00761     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m57">cmpaz</a> = <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>;
00762     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m58">cmpinc</a> = <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>;
00763     <span class="keywordflow">break</span>;
00764   } <span class="comment">/* switch */</span>
00765 
00766   <span class="comment">/* so far we have the default header, plus SCN information */</span>
00767   <span class="comment">/* no time or trace info */</span>
00768   <a class="code" href="sacputaway_8c.html#a24">bSACPABase_scn_open</a>=<a class="code" href="earthworm__defs_8h.html#a8">TRUE</a>;
00769   
00770   <span class="keywordflow">return</span>(EW_SUCCESS);
00771 }
00772 
00773 
00774 <span class="comment">/*</span>
00775 <span class="comment"> * SACPABase_write_trace: transfer trace data from TRACE_REQ buffer into</span>
00776 <span class="comment"> *          SAC data section; fill in some header info.</span>
00777 <span class="comment"> *          The actual writing of the file happens in SACPABase_end_scn.</span>
00778 <span class="comment"> */</span>
<a name="l00779"></a><a class="code" href="sacputaway_8c.html#a47">00779</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a47">SACPABase_write_trace</a>(<a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> * pTrace, <span class="keywordtype">double</span> dGapThresh)
00780      <span class="comment">/*</span>
00781 <span class="comment"> * input:  pTrace   pointer to buffer for the trace data request</span>
00782 <span class="comment"> *         eventId   not used here </span>
00783 <span class="comment"> */</span>
00784 {
00785   <a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *wf;
00786   <span class="keywordtype">char</span>        *msg_p;        <span class="comment">/* pointer into tracebuf data */</span>
00787   <span class="keywordtype">short</span>       *s_data;
00788   <span class="keywordtype">long</span>        *l_data;
00789   <span class="keywordtype">float</span>       *f_data;
00790   <span class="keywordtype">float</span>       *sac_p;      <span class="comment">/* the data part of the SAC buffer */</span>  
00791   <span class="keywordtype">int</span>          j;
00792   <span class="keywordtype">int</span>          gap_count = 0;
00793   <span class="keywordtype">long</span>         nsamp, nfill;
00794   <span class="keywordtype">long</span>         nfill_max = 0l;
00795   <span class="keywordtype">long</span>         nsamp_this_scn = 0l;
00796   <span class="keywordtype">long</span>         this_size;
00797   <span class="keywordtype">double</span>       starttime, endtime; <span class="comment">/* times for current scn         */</span>
00798   <span class="keywordtype">double</span>       samprate;
00799   <span class="keywordtype">float</span>        fill = (float)<a class="code" href="sachead_8h.html#a4">SACUNDEF</a>;
00800   <span class="keyword">struct </span>tm    *time;
00801   time_t       ltime;
00802   <span class="keywordtype">char</span>         datatype;  <span class="comment">/* 's' for short, 'l' for long */</span>
00803 
00804   <span class="comment">/* Check validity of the arguments */</span>
00805   <span class="keywordflow">if</span> (pTrace == NULL)
00806   {
00807     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_write_trace: Invalid arguments passed in\n"</span>);
00808     <span class="keywordflow">return</span> (EW_FAILURE);
00809   }
00810 
00811   <span class="keywordflow">if</span> ((msg_p = pTrace-&gt;<a class="code" href="structTRACE__REQ.html#m7">pBuf</a>) == NULL)
00812   {
00813     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_write_trace: message buffer is NULL\n"</span>);
00814     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00815   }
00816 
00817   sac_p = (<span class="keywordtype">float</span> *)(<a class="code" href="sacputaway_8c.html#a18">SacBuffer</a> + <a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a>);
00818 
00819   wf = (<a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *) msg_p;
00820   <span class="keywordflow">if</span> (<a class="code" href="swap_8c.html#a4">WaveMsgMakeLocal</a>(wf) &lt; 0)
00821   {
00822     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_write_trace: unknown trace data type: %s\n"</span>,
00823           wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>);
00824     <span class="keywordflow">return</span>( EW_FAILURE );
00825   }
00826     
00827   nsamp = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m1">nsamp</a>;
00828   starttime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m2">starttime</a>;
00829   endtime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m3">endtime</a>;
00830   samprate = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m4">samprate</a>;
00831   <span class="keywordflow">if</span> (samprate &lt; 0.01)
00832   {
00833     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"SACPABase_write_trace: unreasonable samplerate (%f) for &lt;%s.%s.%s&gt;\n"</span>,
00834           samprate, SAC_szSta, SAC_szChan, SAC_szNet);
00835     <span class="keywordflow">return</span>( EW_FAILURE );
00836   }
00837   
00838   <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a> = starttime;
00839   datatype = <span class="charliteral">'n'</span>;
00840   <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'s'</span> || wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'i'</span>)
00841   {
00842     <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'2'</span>) datatype = <span class="charliteral">'s'</span>;
00843     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'4'</span>) datatype = <span class="charliteral">'l'</span>;
00844   }
00845   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'t'</span> || wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'f'</span>)
00846   {
00847     <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'4'</span>) datatype = <span class="charliteral">'f'</span>;
00848   }
00849   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'n'</span>)
00850   {
00851     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"SACPABase_write_trace: unsupported datatype: %s\n"</span>, datatype);
00852     <span class="keywordflow">return</span>( EW_FAILURE );
00853   }
00854   
00855   <span class="comment">/* loop through all the messages for this s-c-n */</span>
00856   <span class="keywordflow">while</span> (1) 
00857   {
00858     <span class="comment">/* advance message pointer to the data */</span>
00859     msg_p += <span class="keyword">sizeof</span>(TRACE_HEADER);
00860         
00861     <span class="comment">/* check for sufficient memory in output buffer */</span>
00862     this_size = (nsamp_this_scn + nsamp ) * <span class="keyword">sizeof</span>(float);
00863 
00864     <span class="keywordflow">if</span> ( <a class="code" href="sacputaway_8c.html#a22">BufferLen</a> &lt; (this_size + <a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a>) ) 
00865     {
00866       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">""</span>, <span class="stringliteral">"out of space for &lt;%s.%s.%s&gt;; saving short trace.\n"</span>,
00867              SAC_szSta, SAC_szChan, SAC_szNet);
00868       <span class="keywordflow">break</span>;
00869     }
00870 
00871     <span class="keywordflow">switch</span>( datatype )
00872     {
00873     <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
00874       s_data = (<span class="keywordtype">short</span> *)msg_p;
00875       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp ; j++, nsamp_this_scn++ )
00876         sac_p[nsamp_this_scn] = (float) s_data[j];
00877       msg_p += <span class="keyword">sizeof</span>(short) * nsamp;
00878       <span class="keywordflow">break</span>;
00879     <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00880       l_data = (<span class="keywordtype">long</span> *)msg_p;
00881       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp; j++, nsamp_this_scn++ )
00882         sac_p[nsamp_this_scn] = (float) l_data[j];
00883       msg_p += <span class="keyword">sizeof</span>(long) * nsamp;
00884       <span class="keywordflow">break</span>;
00885     <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00886       f_data = (<span class="keywordtype">float</span> *)msg_p;
00887       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp; j++, nsamp_this_scn++ )
00888         sac_p[nsamp_this_scn] = f_data[j];
00889       msg_p += <span class="keyword">sizeof</span>(float) * nsamp;
00890       <span class="keywordflow">break</span>;
00891     }
00892     
00893     <span class="comment">/* End-check based on length of snippet buffer */</span>
00894     <span class="keywordflow">if</span> ((long) msg_p &gt;= ((long) pTrace-&gt;<a class="code" href="structTRACE__REQ.html#m15">actLen</a> + (long) pTrace-&gt;<a class="code" href="structTRACE__REQ.html#m7">pBuf</a>)) 
00895     {
00896       <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a8">SACPAB_Debug</a> == 1)
00897         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Setting done for &lt;%s.%s.%s&gt;\n"</span>, SAC_szSta, SAC_szChan, 
00898                SAC_szNet);
00899       <span class="keywordflow">break</span>;
00900     }
00901 
00902     <span class="comment">/* msg_p has been advanced to the next TRACE_BUF; localize bytes *</span>
00903 <span class="comment">     * and check for gaps.                                           */</span>
00904     wf = (<a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *) msg_p;
00905     <span class="keywordflow">if</span> (<a class="code" href="swap_8c.html#a4">WaveMsgMakeLocal</a>(wf) &lt; 0)
00906     {
00907       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_write_trace: unknown trace data type: %s\n"</span>,
00908             wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>);
00909       <span class="keywordflow">return</span>( EW_FAILURE );
00910     }
00911     nsamp = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m1">nsamp</a>;
00912     starttime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m2">starttime</a>; 
00913     <span class="comment">/* starttime is set for new packet; endtime is still set for old packet */</span>
00914     <span class="keywordflow">if</span> ( endtime + ( 1.0/samprate ) * dGapThresh &lt; starttime ) 
00915     {
00916       <span class="comment">/* there's a gap, so fill it */</span>
00917       nfill = (long) ((float)samprate * 
00918                                                 (float) (starttime - endtime) -(float) 1.0);
00919 
00920       <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a8">SACPAB_Debug</a> == 1)
00921         <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"gap in %s.%s.%s: %lf: %lf, fill with %d samples\n"</span>, 
00922                                 SAC_szSta, SAC_szChan, SAC_szNet, 
00923                                 endtime, starttime - endtime, nfill);
00924 
00925       <span class="keywordflow">if</span> ( (nsamp_this_scn + nfill) * (long)<span class="keyword">sizeof</span>(float) &gt; <a class="code" href="sacputaway_8c.html#a22">BufferLen</a> ) 
00926       {
00927         <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"bogus gap (%d); skipping\n"</span>, nfill);
00928         <span class="keywordflow">return</span>(EW_FAILURE);
00929       }
00930       <span class="comment">/* do the filling */</span>
00931       <span class="keywordflow">for</span> ( j = 0; j &lt; nfill; j++, nsamp_this_scn ++ ) 
00932         sac_p[nsamp_this_scn] = fill;
00933       <span class="comment">/* keep track of how many gaps and the largest one */</span>
00934       gap_count++;
00935       <span class="keywordflow">if</span> (nfill_max &lt; nfill) 
00936         nfill_max = nfill;
00937     }
00938     <span class="comment">/* Advance endtime to the new packet;        *</span>
00939 <span class="comment">     * process this packet in the next iteration */</span>
00940     endtime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m3">endtime</a>;
00941 
00942   } <span class="comment">/* while (1) */</span>
00943 
00944   <span class="comment">/*  All trace data fed into SAC data section.  Now fill in header */</span>
00945   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m69">npts</a> = (long) nsamp_this_scn;  <span class="comment">/* samples in trace */</span>
00946   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m0">delta</a> = (float) (1.0/samprate);   <span class="comment">/* sample period */</span>
00947   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m6">e</a> = (float) nsamp_this_scn * <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m0">delta</a>;  <span class="comment">/* end time */</span>
00948   ltime = (time_t)<a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>;
00949   <span class="comment">/* gmttime makes juldays starting with 0 */</span>
00950   time = gmtime( &amp;ltime );
00951   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m60">nzyear</a> = (long)time-&gt;tm_year + 1900l; <span class="comment">/* calendar year of reference time */</span>
00952   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m61">nzjday</a> = (long)time-&gt;tm_yday + (long)1;  <span class="comment">/* julian day, 0 - 365 */</span>
00953   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m62">nzhour</a> = (long)time-&gt;tm_hour;
00954   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m63">nzmin</a>  = (long)time-&gt;tm_min;
00955   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m64">nzsec</a>  = (long)time-&gt;tm_sec;
00956   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m65">nzmsec</a> = (long)((<a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a> - (long)<a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>) * 1000.0);
00957 
00958   <span class="comment">/* set the origin time */</span>
00959   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m7">o</a>      = (float)(<a class="code" href="sacputaway_8c.html#a12">SAC_Origin</a>.<a class="code" href="struct__SAC__OriginStruct.html#m3">tOrigin</a> - <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>);
00960   
00961   <span class="keywordflow">if</span> (gap_count) 
00962     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"%d gaps; largest %ld for &lt;%s.%s.%s&gt;\n"</span>,
00963           gap_count, nfill_max, SAC_szSta, SAC_szChan, SAC_szNet);
00964 
00965   <span class="keywordflow">return</span>(EW_SUCCESS);
00966 }
00967 
<a name="l00968"></a><a class="code" href="sacputaway_8c.html#a48">00968</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a48">SACPABase_write_parametric</a>(<a class="code" href="struct__SAC__ArrivalStruct.html">SAC_ArrivalStruct</a> * pArrival, <span class="keywordtype">int</span> WaveType)
00969 {
00970   <span class="keywordtype">int</span> i;
00971 
00972   <span class="keywordflow">if</span> (pArrival == NULL)
00973   {
00974     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid parameters passed in\n"</span>);
00975     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00976   }
00977 
00978   <span class="keywordflow">if</span> (WaveType == <a class="code" href="sacputaway_8h.html#a11">PWAVE</a>)
00979   {
00980     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a10">K_LEN</a>; ++i)
00981       <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[i] = <span class="charliteral">' '</span>;
00982 
00983     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m8">a</a>    = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m0">tPhase</a> - <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>);
00984     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[0]= <span class="charliteral">'P'</span>;
00985     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[1]= pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m6">cFMotion</a>;
00986     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[2]= pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a> + <span class="charliteral">'0'</span>;
00987     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[3]= pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m7">cOnset</a>;
00988     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m20">f</a>    = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a> + <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m8">a</a>);
00989     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m50">dist</a> = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m3">dDist</a>);
00990     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m51">az</a>   = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m4">dAzm</a>);
00991   }
00992   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (WaveType == <a class="code" href="sacputaway_8h.html#a12">SWAVE</a>)
00993   {
00994 
00995     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a10">K_LEN</a>; ++i)
00996       <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[i] = <span class="charliteral">' '</span>;
00997 
00998     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m10">t0</a>    = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m0">tPhase</a> - <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>);
00999     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[0]= <span class="charliteral">'S'</span>;
01000     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[1]= pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m6">cFMotion</a>;
01001     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[2]= pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a> + <span class="charliteral">'0'</span>;
01002     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[3]= pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m7">cOnset</a>;
01003     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m20">f</a>    = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a> + <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m8">a</a>);
01004     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m50">dist</a> = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m3">dDist</a>);
01005     <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m51">az</a>   = (float)(pArrival-&gt;<a class="code" href="struct__SAC__ArrivalStruct.html#m4">dAzm</a>);
01006   }
01007   <span class="keywordflow">else</span>
01008   {
01009     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid WaveType %d.\n"</span>, WaveType);
01010     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01011   }
01012 
01013   <span class="keywordflow">return</span>(EW_SUCCESS);
01014 }
01015 
<a name="l01016"></a><a class="code" href="sacputaway_8c.html#a49">01016</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a49">SACPABase_write_amppicks</a>(<a class="code" href="struct__SAC__AmpPickStruct.html">SAC_AmpPickStruct</a> * pAmpPick)
01017 {
01018 
01019         <span class="keywordtype">double</span>  tmp1, tmp2;
01020 
01021         <span class="keywordflow">if</span> (pAmpPick == NULL)
01022         {
01023                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid arguments passed in.\n"</span>);
01024                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01025         }
01026 
01027         <span class="keywordflow">if</span> (pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m0">PickType</a> == 0)
01028         {
01029                 <span class="comment">/* zero-to-peak case */</span>
01030                 <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m10">t0</a> = (float ) (pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m1">ZP_time</a> - <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>);
01031                 <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m40">user0</a> = (float) (pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m2">ZP_amp</a>);
01032 
01033                 sprintf (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>, <span class="stringliteral">"0-P_max"</span>);
01034                 sprintf (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m105">kuser0</a>, <span class="stringliteral">"0-P_amp"</span>);
01035         }
01036         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m0">PickType</a> == 1)
01037         {
01038                 <span class="comment">/* peak-to-peak case */</span>
01039 
01040                 tmp1 = (pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m3">PPmin_time</a> - <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>);
01041                 tmp2 = (pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m4">PPmax_time</a> - <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>);
01042                 <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m11">t1</a> = (float) tmp1;
01043                 <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m12">t2</a> = (float) tmp2;
01044                 <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m41">user1</a> = (float) (pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m5">PP_amp</a>);
01045 
01046                 sprintf (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m95">kt1</a>, <span class="stringliteral">"P-P_min"</span>);
01047                 sprintf (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m96">kt2</a>, <span class="stringliteral">"P-P_max"</span>);
01048                 sprintf (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m106">kuser1</a>, <span class="stringliteral">"P-P_amp"</span>);
01049         }
01050         <span class="keywordflow">else</span>
01051         {
01052                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid PickType value: %d\n"</span>, pAmpPick-&gt;<a class="code" href="struct__SAC__AmpPickStruct.html#m0">PickType</a>);
01053                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01054         }
01055 
01056         sprintf (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m111">kinst</a>, <span class="stringliteral">"W_A_(mm)"</span>);
01057 
01058         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
01059 
01060 }
01061 
01062 
<a name="l01063"></a><a class="code" href="sacputaway_8c.html#a50">01063</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a50">SACPABase_write_stainfo</a>(<a class="code" href="struct__SAC__StationStruct.html">SAC_StationStruct</a> * pStation)
01064 {
01065   <span class="keywordtype">char</span> szPZFilename[256];
01066   FILE * fpPZ;
01067   <span class="keywordtype">int</span> i;
01068   <span class="keywordtype">double</span> <a class="code" href="geo__to__km_8c.html#a3">dist</a>, azm;
01069   <span class="comment">/*</span>
01070 <span class="comment">    SAMPLE POLES AND ZEROES FILE</span>
01071 <span class="comment">    ============================</span>
01072 <span class="comment"></span>
01073 <span class="comment">    ZEROS 4</span>
01074 <span class="comment">    -0.125  0.0</span>
01075 <span class="comment">    -50.0  0.0</span>
01076 <span class="comment">    POLES 4</span>
01077 <span class="comment">    -0.13 0.0</span>
01078 <span class="comment">    -6.02 0.0</span>
01079 <span class="comment">    -8.66 0.0</span>
01080 <span class="comment">    -35.2 0.0</span>
01081 <span class="comment">    CONSTANT -394.0     </span>
01082 <span class="comment">  */</span>
01083 
01084   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m31">stla</a>=pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m0">dLat</a>;
01085   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m32">stlo</a>=pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m1">dLon</a>;
01086   <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m33">stel</a>=pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m2">dElev</a>;
01087 
01088 
01089   <span class="comment">/* </span>
01090 <span class="comment">   * This is a good time to make sure that distance and azm get set. </span>
01091 <span class="comment">   * Story: dist and azm are properties of Arrivals in the DB schema. </span>
01092 <span class="comment">   * This means that they don't get set for SAC traces without picks.</span>
01093 <span class="comment">   * This is not good. So, here we cloodge it. LV 6/2001.</span>
01094 <span class="comment">   */</span>
01095 
01096   <span class="keywordflow">if</span> ((<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m35">evla</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)  &amp;&amp; (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m36">evlo</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)  &amp;&amp;
01097       (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m31">stla</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)  &amp;&amp; (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m32">stlo</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>))
01098   {
01099         <span class="keywordflow">if</span> (<a class="code" href="geo__to__km_8c.html#a6">geo_to_km</a> (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m35">evla</a>, <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m36">evlo</a>,
01100                         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m31">stla</a>, <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m32">stlo</a>, &amp;dist, &amp;azm) != 1)
01101         {
01102             <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to geo_to_km failed - ignoring.\n"</span>);
01103         }
01104         <span class="keywordflow">else</span> 
01105         {
01106           <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m50">dist</a> == (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
01107           {
01108              <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m50">dist</a> = (float) <a class="code" href="geo__to__km_8c.html#a3">dist</a>;
01109           }
01110           <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m51">az</a> == (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
01111           {
01112              <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m51">az</a> = (float) azm;
01113           }
01114         }
01115   }
01116 
01117   <span class="keywordflow">if</span> ((pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m3">bResponseIsValid</a>) &amp;&amp; 
01118                 ((pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m1">iNumPoles</a> &gt; 0) || 
01119                         (pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m2">iNumZeroes</a> &gt; 0)))
01120   {
01121     <span class="comment">/* create the full SAC file name for this SCN PZ file */</span>
01122     sprintf(szPZFilename,<span class="stringliteral">"%s/%s.%s.%s.pz"</span>,SacDir, SAC_szSta, SAC_szChan,
01123             SAC_szNet);
01124     fpPZ=fopen(szPZFilename,<span class="stringliteral">"w"</span>);
01125     <span class="keywordflow">if</span>(!fpPZ)
01126     {
01127       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SACPABase_write_stainfo():  Failed to open file: %s! Errno=%d\n"</span>,
01128             szPZFilename,errno);
01129       <span class="keywordflow">return</span>(SACPAB_FOPEN_FAILED);
01130     }
01131           
01132     fprintf(fpPZ,<span class="stringliteral">"POLES %d\n"</span>,pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m1">iNumPoles</a>);
01133     <span class="keywordflow">for</span>(i=0;i&lt;pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m1">iNumPoles</a>;i++)
01134     {
01135       fprintf(fpPZ,<span class="stringliteral">"%f %f\n"</span>,pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m3">Poles</a>[i].<a class="code" href="struct__SAC__PZNum.html#m0">dReal</a>,
01136               pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m3">Poles</a>[i].<a class="code" href="struct__SAC__PZNum.html#m1">dImag</a>);
01137     }
01138 
01139     fprintf(fpPZ,<span class="stringliteral">"ZEROS %d\n"</span>,pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m2">iNumZeroes</a>);
01140     <span class="keywordflow">for</span>(i=0;i&lt;pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m2">iNumZeroes</a>;i++)
01141     {
01142       fprintf(fpPZ,<span class="stringliteral">"%f %f\n"</span>,pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m4">Zeroes</a>[i].<a class="code" href="struct__SAC__PZNum.html#m0">dReal</a>,
01143               pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m4">Zeroes</a>[i].<a class="code" href="struct__SAC__PZNum.html#m1">dImag</a>);
01144     }
01145 
01146     fprintf(fpPZ,<span class="stringliteral">"CONSTANT %e\n"</span>,pStation-&gt;<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>-&gt;<a class="code" href="struct__SAC__ResponseStruct.html#m0">dGain</a>);
01147 
01148     fclose(fpPZ);
01149   }  <span class="comment">/* end if(bResponseIsValid) */</span>
01150           
01151   <span class="keywordflow">return</span>(EW_SUCCESS);
01152 }
01153 
01154 
01155 
01156 
<a name="l01157"></a><a class="code" href="sacputaway_8c.html#a51">01157</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a51">SACPABase_end_scn</a> (<span class="keywordtype">void</span>)
01158 {
01159   size_t towrite;           <span class="comment">/* bytes to write to SAC file */</span>
01160   <span class="keywordtype">char</span>   sacfile[2*<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a>]; <span class="comment">/* the name of the sac file */</span>
01161   FILE  *fp;                <span class="comment">/* sacfile file pointer */</span>
01162   <span class="keywordtype">long</span>   i, npts;           <span class="comment">/* number of SAC data points */</span>
01163   <span class="keywordtype">float</span> *sac_p;
01164 
01165   <span class="keywordflow">if</span>(!<a class="code" href="sacputaway_8c.html#a24">bSACPABase_scn_open</a>)
01166   {
01167     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SACPABase_end_scn(): ERROR! There is no open SCN record.\n"</span>);
01168     <span class="keywordflow">return</span>(SACPAB_SCN_NOT_OPEN);
01169   }
01170 
01171   npts = <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m69">npts</a>;
01172   sac_p = (<span class="keywordtype">float</span> *)(<a class="code" href="sacputaway_8c.html#a18">SacBuffer</a> + <a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a>);
01173   <span class="keywordflow">if</span> (strcmp (SAC_szOutputFormat, SAC_DIFFERENT_PLATFORM) == 0)
01174   {
01175     <a class="code" href="sacputaway_8c.html#a26">swapsac</a>(sacheadp);
01176     <span class="keywordflow">for</span> (i = 0; i &lt; npts; i++)
01177       <a class="code" href="swap_8c.html#a5">SwapFloat</a>(&amp;sac_p[i]);
01178   }
01179 
01180   <span class="comment">/* copy the (potentially byte-swapped) SAC header</span>
01181 <span class="comment">     into the SAC buffer and write it out.</span>
01182 <span class="comment">  ******************************************************/</span>
01183   memcpy ((<span class="keywordtype">void</span> *) SacBuffer, (<span class="keywordtype">void</span> *) sacheadp, SACHEADERSIZE);
01184 
01185   <span class="comment">/* Update SAC file list with file name and arrival time */</span>
01186   sprintf (FileList[FileIndex].filename, <span class="stringliteral">"%s.%s.%s"</span>,  SAC_szSta, SAC_szChan, 
01187            SAC_szNet);
01188   <a class="code" href="sacputaway_8c.html#a5">FileList</a>[<a class="code" href="sacputaway_8c.html#a6">FileIndex</a>].sort_param = <a class="code" href="sacputaway_8c.html#a11">SAC_starttime</a>;
01189 
01190   <span class="keywordflow">if</span> ((<a class="code" href="sacputaway_8c.html#a6">FileIndex</a> = <a class="code" href="sacputaway_8c.html#a6">FileIndex</a> + 1) &gt; <a class="code" href="earthworm__defs_8h.html#a14">DB_MAX_PHS_PER_EQ</a>)
01191   {
01192     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_end_scn: WARNING: Maximum number of phases per "</span>
01193            <span class="stringliteral">"event (%d) exceeded.\n"</span>, DB_MAX_PHS_PER_EQ);
01194 
01195     <a class="code" href="sacputaway_8c.html#a6">FileIndex</a> = <a class="code" href="sacputaway_8c.html#a6">FileIndex</a> - 1;
01196   } 
01197 
01198   <span class="comment">/* create the full SAC file name for this SCN */</span>
01199   sprintf(sacfile, <span class="stringliteral">"%s/%s"</span>, SacDir, FileList[FileIndex-1].filename);
01200 
01201 
01202   <span class="comment">/* Open the sacfile */</span>
01203   <span class="keywordflow">if</span> ((fp = fopen (sacfile, <span class="stringliteral">"wb"</span>)) == NULL) 
01204   {
01205     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_next_scn: cannot open %s\n"</span>, sacfile);
01206     <span class="keywordflow">return</span>(EW_FAILURE);
01207   }
01208 
01209   <span class="comment">/* Write the buffer to the sacfile */</span>
01210   towrite = <a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a> + <span class="keyword">sizeof</span>(float) * npts;
01211   <span class="keywordflow">if</span> (fwrite ((<span class="keyword">const</span> <span class="keywordtype">void</span> *) SacBuffer, towrite, 1, fp) != 1)
01212   {
01213     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_end_scn: cannot write %s\n"</span>, sacfile);
01214     (void) unlink(sacfile);
01215     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01216   }
01217   fclose (fp);
01218 
01219   <span class="comment">/* mark the SCN closed */</span>
01220   <a class="code" href="sacputaway_8c.html#a24">bSACPABase_scn_open</a>=<a class="code" href="earthworm__defs_8h.html#a9">FALSE</a>;
01221   <span class="keywordflow">return</span>(EW_SUCCESS);
01222 }
01223 
01224 
<a name="l01225"></a><a class="code" href="sacputaway_8c.html#a52">01225</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a52">SACPABase_end_scn_gm</a> (<span class="keywordtype">void</span>)
01226 {
01227   size_t towrite;           <span class="comment">/* bytes to write to SAC file */</span>
01228   <span class="keywordtype">char</span>   sacfile[2*<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a>]; <span class="comment">/* the name of the sac file */</span>
01229   FILE  *fp;                <span class="comment">/* sacfile file pointer */</span>
01230   <span class="keywordtype">long</span>   i, npts;           <span class="comment">/* number of SAC data points */</span>
01231   <span class="keywordtype">float</span> *sac_p;
01232 
01233   <span class="keywordflow">if</span>(!<a class="code" href="sacputaway_8c.html#a24">bSACPABase_scn_open</a>)
01234   {
01235     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SACPABase_end_scn(): ERROR! There is no open SCN record.\n"</span>);
01236     <span class="keywordflow">return</span>(SACPAB_SCN_NOT_OPEN);
01237   }
01238 
01239   npts = <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m69">npts</a>;
01240   sac_p = (<span class="keywordtype">float</span> *)(<a class="code" href="sacputaway_8c.html#a18">SacBuffer</a> + <a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a>);
01241   <span class="keywordflow">if</span> (strcmp (SAC_szOutputFormat, SAC_DIFFERENT_PLATFORM) == 0)
01242   {
01243     <a class="code" href="sacputaway_8c.html#a26">swapsac</a>(sacheadp);
01244     <span class="keywordflow">for</span> (i = 0; i &lt; npts; i++)
01245       <a class="code" href="swap_8c.html#a5">SwapFloat</a>(&amp;sac_p[i]);
01246   }
01247 
01248   <span class="comment">/* copy the (potentially byte-swapped) SAC header</span>
01249 <span class="comment">     into the SAC buffer and write it out.</span>
01250 <span class="comment">  ******************************************************/</span>
01251   memcpy ((<span class="keywordtype">void</span> *) SacBuffer, (<span class="keywordtype">void</span> *) sacheadp, SACHEADERSIZE);
01252 
01253 
01254   <span class="comment">/* create the full SAC file name for this SCN */</span>
01255   sprintf(sacfile, <span class="stringliteral">"%s/%s.gm"</span>, SacDir, FileList[FileIndex-1].filename);
01256 
01257 
01258   <span class="comment">/* Open the sacfile */</span>
01259   <span class="keywordflow">if</span> ((fp = fopen (sacfile, <span class="stringliteral">"wb"</span>)) == NULL) 
01260   {
01261     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_next_scn: cannot open %s\n"</span>, sacfile);
01262     <span class="keywordflow">return</span>(EW_FAILURE);
01263   }
01264 
01265   <span class="comment">/* Write the buffer to the sacfile */</span>
01266   towrite = <a class="code" href="sachead_8h.html#a0">SACHEADERSIZE</a> + <span class="keyword">sizeof</span>(float) * npts;
01267   <span class="keywordflow">if</span> (fwrite ((<span class="keyword">const</span> <span class="keywordtype">void</span> *) SacBuffer, towrite, 1, fp) != 1)
01268   {
01269     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_end_scn: cannot write %s\n"</span>, sacfile);
01270     (void) unlink(sacfile);
01271     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01272   }
01273   fclose (fp);
01274 
01275   <span class="comment">/* mark the SCN closed */</span>
01276   <a class="code" href="sacputaway_8c.html#a24">bSACPABase_scn_open</a>=<a class="code" href="earthworm__defs_8h.html#a9">FALSE</a>;
01277   <span class="keywordflow">return</span>(EW_SUCCESS);
01278 }
01279 
01280 
01281 <span class="comment">/************************************************************************</span>
01282 <span class="comment">*       This is the Put Away end event routine. It's called after we've     *</span>
01283 <span class="comment">*       finished processing one event.                                  *</span>
01284 <span class="comment">*************************************************************************/</span>
<a name="l01285"></a><a class="code" href="sacputaway_8c.html#a53">01285</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a53">SACPABase_end_ev</a> (<span class="keywordtype">void</span>)
01286 {
01287 
01288   <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a8">SACPAB_Debug</a> == 1)
01289     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"In SACPA_end_ev\n"</span>);
01290 
01291   qsort ((<span class="keywordtype">void</span> *) FileList, (size_t) FileIndex, 
01292          <span class="keyword">sizeof</span> (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a>), SAC_Compare);
01293 
01294   <span class="comment">/* We haven't processed an event - something's fishy! */</span>
01295   <span class="keywordflow">if</span> (!strcmp(szCurEventID,<span class="stringliteral">"-1"</span>))
01296   {
01297     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPA_end_ev: CurEventId is invalid - don't know how to proceed\n"</span>);
01298 
01299     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01300   }
01301 
01302 
01303   <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a28">CreateSACSupportFiles</a> (szCurEventID, FileList, FileIndex) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
01304   {
01305     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACPABase_write_trace: Call to CreateSACSupportFiles failed\n"</span>);
01306     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01307   }
01308 
01309   <span class="keywordflow">return</span>(EW_SUCCESS);
01310 }
01311 
01312 
01313 <span class="comment">/************************************************************************</span>
01314 <span class="comment">*       This is the Put Away close routine. It's called after when      *</span>
01315 <span class="comment">*       we're being shut down.                                          *</span>
01316 <span class="comment">*************************************************************************/</span>
<a name="l01317"></a><a class="code" href="sacputaway_8c.html#a54">01317</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a54">SACPABase_close</a> (<span class="keywordtype">void</span>)
01318 {
01319 
01320   free ((<span class="keywordtype">char</span> *) SacBuffer);
01321   <span class="keywordflow">if</span> (!<a class="code" href="sacputaway_8c.html#a23">bSACPABase_init</a>)
01322   {
01323     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_close():  Error, SACPABase is not initialized!\n"</span>);
01324     <span class="keywordflow">return</span>(SACPAB_NOT_INIT);
01325   }
01326   <a class="code" href="sacputaway_8c.html#a23">bSACPABase_init</a> = <a class="code" href="earthworm__defs_8h.html#a9">FALSE</a>;
01327   <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
01328 }
01329 
01330 
<a name="l01331"></a><a class="code" href="sacputaway_8c.html#a25">01331</a> <span class="keywordtype">void</span> <a class="code" href="sacputaway_8c.html#a25">sacinit</a>( <span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *head)
01332 {
01333   <span class="keywordtype">int</span> i;
01334   <span class="keyword">struct </span><a class="code" href="structSAChead2.html">SAChead2</a> *head2;   <span class="comment">/* use a simple structure here - we don't care what</span>
01335 <span class="comment">                             * the variables are - set them to 'undefined' */</span>
01336 
01337   <span class="comment">/* change to a simpler format */</span>
01338   head2 = (<span class="keyword">struct </span><a class="code" href="structSAChead2.html">SAChead2</a> *) head;
01339 
01340   <span class="comment">/*    set all of the floats to 'undefined'    */</span>
01341   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a19">NUM_FLOAT</a>; ++i) head2-&gt;<a class="code" href="structSAChead2.html#m0">SACfloat</a>[i] = <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>;
01342   <span class="comment">/*    set all of the ints to 'undefined'      */</span>
01343   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a20">MAXINT</a>-5; ++i) head2-&gt;SACint[i] = <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>;
01344   <span class="comment">/*    except for the logical integers - set them to 1 */</span>
01345   <span class="keywordflow">for</span> ( ; i &lt; <a class="code" href="sachead_8h.html#a20">MAXINT</a>; ++i) head2-&gt;SACint[i] = 1;
01346   <span class="comment">/*    set all of the strings to 'undefined'   */</span>
01347   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a21">MAXSTRING</a>; ++i) (void) strncpy(head2-&gt;SACstring[i],
01348                                                  SACSTRUNDEF,K_LEN);
01349 
01350   <span class="comment">/*    SAC I.D. number */</span>
01351   head2-&gt;SACfloat[9] = <a class="code" href="sachead_8h.html#a2">SAC_I_D</a>;
01352   <span class="comment">/*    header version number */</span>
01353   head2-&gt;SACint[6] = <a class="code" href="sachead_8h.html#a1">SACVERSION</a>;
01354 
01355   <span class="keywordflow">return</span>;       <span class="comment">/* done */</span>
01356 }
01357 
01358 <span class="comment">/*</span>
01359 <span class="comment"> * swapsac: swap all the numeric fields in the SAC header.</span>
01360 <span class="comment"> */</span>
<a name="l01361"></a><a class="code" href="sacputaway_8c.html#a26">01361</a> <span class="keywordtype">void</span> <a class="code" href="sacputaway_8c.html#a26">swapsac</a>(<span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *head)
01362 {
01363   <span class="keywordtype">int</span> i;
01364   <span class="keyword">struct </span><a class="code" href="structSAChead2.html">SAChead2</a> *head2; <span class="comment">/* use a simple structure here - we don't care what</span>
01365 <span class="comment">                           * the variables are - just swap their bytes! */</span>
01366 
01367   <span class="comment">/* change to a simpler format */</span>
01368   head2 = (<span class="keyword">struct </span><a class="code" href="structSAChead2.html">SAChead2</a> *) head;
01369 
01370   <span class="comment">/*    swap all of the floats  */</span>
01371   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a19">NUM_FLOAT</a>; ++i) 
01372     <a class="code" href="swap_8c.html#a5">SwapFloat</a>(&amp;head2-&gt;SACfloat[i]);
01373   
01374   <span class="comment">/*    swap all of the ints   */</span>
01375   <span class="keywordflow">for</span> ( i = 0; i &lt; <a class="code" href="sachead_8h.html#a20">MAXINT</a>; ++i) 
01376     <a class="code" href="swap_8c.html#a2">SwapLong</a>( &amp;(head2-&gt;SACint[i]));
01377 
01378   <span class="keywordflow">return</span>;
01379 }
01380 
01381 <span class="comment">/**************************************************</span>
01382 <span class="comment"> *  SAC_Compare()  compares 2 values              *</span>
01383 <span class="comment"> *  This function is passed to qsort()            *</span>
01384 <span class="comment"> **************************************************/</span>
<a name="l01385"></a><a class="code" href="sacputaway_8c.html#a27">01385</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a27">SAC_Compare</a> (<span class="keyword">const</span> <span class="keywordtype">void</span> *p1, <span class="keyword">const</span> <span class="keywordtype">void</span> *p2)
01386 {
01387   <a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *srt1 = (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *) p1;
01388   <a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *srt2 = (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *) p2;
01389 
01390   <span class="keywordflow">if</span> (srt1-&gt;<a class="code" href="struct__SACFileList.html#m1">sort_param</a> &lt; srt2-&gt;<a class="code" href="struct__SACFileList.html#m1">sort_param</a>)   
01391     <span class="keywordflow">return</span> (-1);
01392 
01393   <span class="keywordflow">if</span> (srt1-&gt;<a class="code" href="struct__SACFileList.html#m1">sort_param</a> &gt; srt2-&gt;<a class="code" href="struct__SACFileList.html#m1">sort_param</a>)
01394     <span class="keywordflow">return</span> (1);
01395 
01396   <span class="keywordflow">return</span> (0);
01397 }
01398 
01399 
01400 
01401 
01402 <span class="comment">/* SACSupportFiles </span>
01403 <span class="comment"> *</span>
01404 <span class="comment"> * Write simple SAC macros to disk files in current working directory, </span>
01405 <span class="comment"> * given a list of filenames sorted in some order.</span>
01406 <span class="comment"> *</span>
01407 <span class="comment"> * Also write other files necessary for relocating the event</span>
01408 <span class="comment"> * with hypoinverse and for updating database.</span>
01409 <span class="comment"> * July 1998, LDD</span>
01410 <span class="comment"> */</span>
01411 
01412 <span class="comment">/* how many traces do we want in the quicklook macro */</span>
<a name="l01413"></a><a class="code" href="sacputaway_8c.html#a0">01413</a> <span class="preprocessor">#define         NQUICKLOOK      10</span>
01414 <span class="preprocessor"></span>
01415 <span class="comment">/* Support file names */</span>
<a name="l01416"></a><a class="code" href="sacputaway_8c.html#a1">01416</a> <span class="preprocessor">#define         INIT_FNAME      "init"</span>
<a name="l01417"></a><a class="code" href="sacputaway_8c.html#a2">01417</a> <span class="preprocessor"></span><span class="preprocessor">#define         QUICKLOOK_FNAME "quicklook"</span>
<a name="l01418"></a><a class="code" href="sacputaway_8c.html#a3">01418</a> <span class="preprocessor"></span><span class="preprocessor">#define         REPICK_FNAME    "repick"</span>
<a name="l01419"></a><a class="code" href="sacputaway_8c.html#a4">01419</a> <span class="preprocessor"></span><span class="preprocessor">#define         SACLIST_FNAME   "saclist"</span>
01420 <span class="preprocessor"></span>
01421 <span class="comment">/*******************************************************</span>
01422 <span class="comment"> * CreateSACSupportFiles() writes all the desired SAC macros    </span>
01423 <span class="comment"> *  and Hypoinv files to the current working directory </span>
01424 <span class="comment"> *******************************************************/</span>
<a name="l01425"></a><a class="code" href="sacputaway_8c.html#a28">01425</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a28">CreateSACSupportFiles</a> (<span class="keywordtype">char</span> * szEventid, <a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *pfl, <span class="keywordtype">int</span> nfile)
01426 {
01427   <span class="keywordtype">int</span> nlook;
01428 
01429   <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a29">SACmac_init</a>() != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
01430   {
01431     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"Call to SACmac_init failed\n"</span>);
01432     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01433   }
01434 
01435   nlook = (nfile &lt; <a class="code" href="sacputaway_8c.html#a0">NQUICKLOOK</a>) ? nfile : <a class="code" href="sacputaway_8c.html#a0">NQUICKLOOK</a>;
01436   <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a30">SACmac_quicklook</a> (pfl, nlook) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
01437   {
01438     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"Call to SACmac_quicklook failed\n"</span>);
01439     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01440   }
01441 
01442 
01443   <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a31">SACmac_repick</a> (pfl, nfile) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
01444   {
01445     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"Call to SACmac_repick failed\n"</span>);
01446     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01447   }
01448 
01449   <span class="keywordflow">if</span> (<a class="code" href="sacputaway_8c.html#a32">SAC_filelist</a> (pfl, nfile, szEventid) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
01450   {
01451     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"Call to SAC_filelist failed\n"</span>);
01452     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
01453   }
01454 
01455   <span class="keywordflow">return</span> (EW_SUCCESS);
01456 
01457 }
01458 
01459 <span class="comment">/**************************************************</span>
01460 <span class="comment"> * SACmac_init() writes a simple initialization   *</span>
01461 <span class="comment"> *  macro to the current working directory in a   *</span>
01462 <span class="comment"> *  file named "init"                             *</span>
01463 <span class="comment"> **************************************************/</span>
<a name="l01464"></a><a class="code" href="sacputaway_8c.html#a29">01464</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a29">SACmac_init</a> (<span class="keywordtype">void</span>)
01465 {
01466   FILE *fp;
01467   <span class="keywordtype">char</span> filename[256];
01468 
01469   sprintf (filename, <span class="stringliteral">"%s/%s"</span>, SacDir, INIT_FNAME);
01470 
01471   <span class="keywordflow">if</span> ((fp = fopen (filename, <span class="stringliteral">"w+"</span>)) == NULL)
01472   {
01473     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACmac_init: cannot open macro file %s; %s\n"</span>,
01474            filename, strerror (errno));
01475     <span class="keywordflow">return</span> (EW_FAILURE);
01476   }
01477 
01478   fprintf (fp, <span class="stringliteral">"qdp 1000\n"</span>
01479            <span class="stringliteral">"window 1 x 0 1 y 0.35 0.97\n"</span>
01480            <span class="stringliteral">"bd X\n"</span>
01481            <span class="stringliteral">"bw 1\n"</span> );
01482   fclose (fp);
01483 
01484   <span class="keywordflow">return</span> (EW_SUCCESS);
01485 }
01486 
01487 
01488 <span class="comment">/**************************************************</span>
01489 <span class="comment"> * SACmac_quicklook() writes a macro to bring up  *</span>
01490 <span class="comment"> *  the first nlook files in the list.  The list  *</span>
01491 <span class="comment"> *  should be sorted before invoking this funtion *</span>
01492 <span class="comment"> **************************************************/</span>
<a name="l01493"></a><a class="code" href="sacputaway_8c.html#a30">01493</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a30">SACmac_quicklook</a> (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *pfl, <span class="keywordtype">int</span> nlook)
01494 {
01495   FILE *fp;
01496   <span class="keywordtype">int</span> i;
01497   <span class="keywordtype">char</span> filename[256];
01498 
01499   sprintf (filename, <span class="stringliteral">"%s/%s"</span>, SacDir, QUICKLOOK_FNAME);
01500 
01501   <span class="keywordflow">if</span> ((fp = fopen (filename, <span class="stringliteral">"w+"</span>)) == NULL)
01502   {
01503     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACmac_quicklook: cannot open macro file %s; %s\n"</span>,
01504           filename, strerror (errno));
01505     <span class="keywordflow">return</span> (EW_FAILURE);
01506   }
01507 
01508   fprintf (fp, <span class="stringliteral">"qdp 500\n"</span>
01509            <span class="stringliteral">"fileid type list kevnm kstcmp\n"</span>
01510            <span class="stringliteral">"r "</span>);
01511 
01512   <span class="keywordflow">for</span> (i = 0; i &lt; nlook; i++ ) 
01513     fprintf (fp, <span class="stringliteral">"%s "</span>, pfl[i].filename);
01514 
01515   fprintf (fp, <span class="stringliteral">"\n"</span>
01516            <span class="stringliteral">"p1\n"</span>);
01517 
01518   fclose (fp);
01519 
01520   <span class="keywordflow">return</span> (EW_SUCCESS);
01521 }
01522 
01523 
01524 <span class="comment">/**************************************************</span>
01525 <span class="comment"> * SACmac_repick() writes a macro to bring up     *</span>
01526 <span class="comment"> *  each trace for this event to repick it        *</span>
01527 <span class="comment"> **************************************************/</span>
<a name="l01528"></a><a class="code" href="sacputaway_8c.html#a31">01528</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a31">SACmac_repick</a> (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *pfl, <span class="keywordtype">int</span> nfile)
01529 {
01530   FILE *fp;
01531   <span class="keywordtype">int</span> i;
01532   <span class="keywordtype">char</span> filename[256];
01533 
01534   sprintf (filename, <span class="stringliteral">"%s/%s"</span>, SacDir, REPICK_FNAME);
01535 
01536   <span class="keywordflow">if</span> ((fp = fopen (filename, <span class="stringliteral">"w+"</span>)) == NULL)
01537   {
01538     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACmac_repick: cannot open macro file %s; %s\n"</span>,
01539            filename, strerror (errno));
01540     <span class="keywordflow">return</span> (EW_FAILURE);
01541   }
01542 
01543   fprintf (fp, <span class="stringliteral">"qdp 500\n"</span>
01544            <span class="stringliteral">"fileid type list kevnm kstcmp\n"</span>);
01545 
01546   fprintf (fp, <span class="stringliteral">"r %s\n"</span> 
01547            <span class="stringliteral">"ppk p off b off\n"</span>  
01548            <span class="stringliteral">"wh\n"</span>,
01549            pfl[0].filename);  <span class="comment">/* Turn off that darn bell! */</span>
01550   
01551   <span class="keywordflow">for</span> (i = 1; i &lt; nfile; i++) 
01552   {  
01553     fprintf (fp, <span class="stringliteral">"r %s\n"</span> 
01554              <span class="stringliteral">"ppk p off\n"</span>
01555              <span class="stringliteral">"wh\n"</span>,
01556              pfl[i].filename);
01557   }
01558   fclose (fp);
01559 
01560   <span class="keywordflow">return</span> (EW_SUCCESS);
01561 }
01562 
01563 
01564 <span class="comment">/**************************************************</span>
01565 <span class="comment"> * SAC_filelist() writes a file containing the    *</span>
01566 <span class="comment"> *  names of all the SAC files in the directory   *</span>
01567 <span class="comment"> **************************************************/</span>
<a name="l01568"></a><a class="code" href="sacputaway_8c.html#a32">01568</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a32">SAC_filelist</a> (<a class="code" href="struct__SACFileList.html">SACFileListStruct</a> *pfl, <span class="keywordtype">int</span> nfile, <span class="keywordtype">char</span> * szEventid)
01569 {
01570   FILE *fp;
01571   <span class="keywordtype">int</span> i;
01572   <span class="keywordtype">char</span> filename[256];
01573 
01574   sprintf (filename, <span class="stringliteral">"%s/%s"</span>, SacDir, SACLIST_FNAME);
01575 
01576   <span class="keywordflow">if</span> ((fp = fopen (filename, <span class="stringliteral">"w+"</span>)) == NULL)
01577   {
01578     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SACmac_filelist: cannot open file %s; %s\n"</span>,
01579            filename, strerror (errno));
01580     <span class="keywordflow">return</span> (EW_FAILURE);
01581   }
01582 
01583   fprintf (fp, <span class="stringliteral">"EVENTID:%s\n"</span>, szEventid);
01584 
01585   <span class="keywordflow">for</span> (i = 0; i &lt; nfile; i++) 
01586   {  
01587     fprintf (fp, <span class="stringliteral">"%s\n"</span>, pfl[i].filename);
01588   }
01589 
01590   fclose (fp);
01591 
01592   <span class="keywordflow">return</span> (EW_SUCCESS);
01593 }
01594 
<a name="l01595"></a><a class="code" href="sacputaway_8c.html#a34">01595</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a34">SAC_SwapLong</a>(<span class="keywordtype">long</span> * pValue, <span class="keywordtype">char</span> cDataType)
01596 {
01597 <span class="preprocessor">#if defined (_SPARC)</span>
01598 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( cDataType == <span class="charliteral">'i'</span> || cDataType == <span class="charliteral">'f'</span> )
01599     <a class="code" href="swap_8c.html#a2">SwapLong</a>(pValue);
01600   <span class="keywordflow">return</span>(EW_SUCCESS);
01601 <span class="preprocessor">#elif defined (_INTEL)</span>
01602 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( cDataType == <span class="charliteral">'s'</span> || cDataType == <span class="charliteral">'t'</span> )
01603     <a class="code" href="swap_8c.html#a2">SwapLong</a>(pValue);
01604   <span class="keywordflow">return</span>(EW_SUCCESS);
01605 <span class="preprocessor">#else</span>
01606 <span class="preprocessor"></span>  <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SAC_SwapLong():Error! Unable to determine platform! "</span>
01607         <span class="stringliteral">"Please compile w/ _INTEL or _SPARC!\n"</span>);
01608   <span class="keywordflow">return</span>(SACPAB_UNKNOWN_PLATFORM);
01609 <span class="preprocessor">#endif</span>
01610 <span class="preprocessor"></span>}
01611 
<a name="l01612"></a><a class="code" href="sacputaway_8c.html#a35">01612</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a35">SAC_SwapShort</a>(<span class="keywordtype">short</span> * pValue, <span class="keywordtype">char</span> cDataType)
01613 {
01614 <span class="preprocessor">#if defined (_SPARC)</span>
01615 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( cDataType == <span class="charliteral">'i'</span> || cDataType == <span class="charliteral">'f'</span> )
01616     <a class="code" href="swap_8c.html#a0">SwapShort</a>(pValue);
01617   <span class="keywordflow">return</span>(EW_SUCCESS);
01618 <span class="preprocessor">#elif defined (_INTEL)</span>
01619 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( cDataType == <span class="charliteral">'s'</span> || cDataType == <span class="charliteral">'t'</span> )
01620     <a class="code" href="swap_8c.html#a0">SwapShort</a>(pValue);
01621   <span class="keywordflow">return</span>(EW_SUCCESS);
01622 <span class="preprocessor">#else</span>
01623 <span class="preprocessor"></span>  <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SAC_SwapShort():Error! Unable to determine platform! "</span>
01624         <span class="stringliteral">"Please compile w/ _INTEL or _SPARC!\n"</span>);
01625   <span class="keywordflow">return</span>(SACPAB_UNKNOWN_PLATFORM);
01626 <span class="preprocessor">#endif</span>
01627 <span class="preprocessor"></span>}
01628 
<a name="l01629"></a><a class="code" href="sacputaway_8c.html#a33">01629</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a33">SAC_SwapDouble</a>(<span class="keywordtype">double</span> * pValue, <span class="keywordtype">char</span> cDataType)
01630 {
01631 <span class="preprocessor">#if defined (_SPARC)</span>
01632 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( cDataType == <span class="charliteral">'i'</span> || cDataType == <span class="charliteral">'f'</span> )
01633     <a class="code" href="swap_8c.html#a3">SwapDouble</a>(pValue);
01634   <span class="keywordflow">return</span>(EW_SUCCESS);
01635 <span class="preprocessor">#elif defined (_INTEL)</span>
01636 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( cDataType == <span class="charliteral">'s'</span> || cDataType == <span class="charliteral">'t'</span> )
01637     <a class="code" href="swap_8c.html#a3">SwapDouble</a>(pValue);
01638   <span class="keywordflow">return</span>(EW_SUCCESS);
01639 <span class="preprocessor">#else</span>
01640 <span class="preprocessor"></span>  <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>,<span class="stringliteral">"SAC_SwapDouble():Error! Unable to determine platform! "</span>
01641         <span class="stringliteral">"Please compile w/ _INTEL or _SPARC!\n"</span>);
01642   <span class="keywordflow">return</span>(SACPAB_UNKNOWN_PLATFORM);
01643 <span class="preprocessor">#endif</span>
01644 <span class="preprocessor"></span>}
01645 
01646 
01647 <span class="comment">/* Write urban hazards external info into the header */</span>
<a name="l01648"></a><a class="code" href="sacputaway_8c.html#a55">01648</a> <span class="keywordtype">int</span> <a class="code" href="sacputaway_8c.html#a55">SACPABase_write_extinfo</a> (<a class="code" href="struct__SAC__ExtChanStruct.html">SAC_ExtChanStruct</a> *pExtChan)
01649 {
01650 
01651         <span class="keywordflow">if</span> (pExtChan == NULL)
01652         {
01653                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"SACPABase_write_extinfo: Invalid arguments passed in\n"</span>);
01654                 <span class="keywordflow">return</span> (EW_FAILURE);
01655         }
01656 
01657 
01658         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m40">user0</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m0">iGain</a>;
01659         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m41">user1</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m1">dFullscale</a>;
01660         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m42">user2</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m2">dSensitivity</a>;
01661         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m43">user3</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m3">dDamping</a>;
01662         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m44">user4</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m4">dNaturalFrequency</a>;
01663         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m45">user5</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m5">iSensorType</a>;
01664 
01665         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m57">cmpaz</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m7">dAzm</a>;
01666         <a class="code" href="sacputaway_8c.html#a15">sacheadp</a>-&gt;<a class="code" href="structSAChead.html#m58">cmpinc</a> = (float) pExtChan-&gt;<a class="code" href="struct__SAC__ExtChanStruct.html#m8">dDip</a>;
01667 
01668         <span class="keywordflow">return</span>(EW_SUCCESS);
01669 
01670 }
01671 
01672 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:09 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
