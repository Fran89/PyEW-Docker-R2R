<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>server_template.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>server_template.cpp</h1><a href="server__template_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * server_template.h -- Template and server class deriving from</span>
00003 <span class="comment"> *                      the DBMutableServerBase class.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> *                      The base class handles communications, so this class</span>
00006 <span class="comment"> *                      primarily must only concern itself with the specific</span>
00007 <span class="comment"> *                      handling for this type of server (to include relevant</span>
00008 <span class="comment"> *                      configuration, passports and calculations).</span>
00009 <span class="comment"> * </span>
00010 <span class="comment"> */</span>
00011 <span class="comment">/*</span>
00012 <span class="comment"> * Variable which are available from the base classes:</span>
00013 <span class="comment"> * </span>
00014 <span class="comment"> *    bool Running;    true while running</span>
00015 <span class="comment"> *                    false when told to quit/shutdown</span>
00016 <span class="comment"> * </span>
00017 <span class="comment"> *    int LoggingOptions = various logging parameters (set in the base</span>
00018 <span class="comment"> *                         class, depending on the mode)</span>
00019 <span class="comment"> * </span>
00020 <span class="comment"> *    int LoggingLevel  =  Logging level assigned from the .d file.</span>
00021 <span class="comment"> *                         Values:</span>
00022 <span class="comment"> *                             WORM_LOG_ERRORS</span>
00023 <span class="comment"> *                             WORM_LOG_STATUS</span>
00024 <span class="comment"> *                             WORM_LOG_TRACKING</span>
00025 <span class="comment"> *                             WORM_LOG_DETAILS</span>
00026 <span class="comment"> *                             WORM_LOG_DEBUG</span>
00027 <span class="comment"> * </span>
00028 <span class="comment"> *    MUTABLE_MODE_TYPE  Mode = Current mode in which the program is operating</span>
00029 <span class="comment"> *               Values:</span>
00030 <span class="comment"> *                  MMT_STANDALONE = command from args/stdin, data access and calculations internally</span>
00031 <span class="comment"> *                  MMT_MODULE     = command from ring, data access and calculations internally [MT]</span>
00032 <span class="comment"> *                  MMT_SERVER     = command from socket, calculations internally [MT]</span>
00033 <span class="comment"> *                  MMT_CLIENT     = command from atgs/stdin, socket call to client for calculations</span>
00034 <span class="comment"> * </span>
00035 <span class="comment"> *</span>
00036 <span class="comment"> *  </span>
00037 <span class="comment"> * MODULE AND MESSAGE TYPE IDS:</span>
00038 <span class="comment"> * </span>
00039 <span class="comment"> *     WORM_INSTALLATION_ID  InstId  = TGlobalUtils::LookupInstallationId("INST_XXXX");</span>
00040 <span class="comment"> *     WORM_MODULE_ID        ModulId = TGlobalUtils::LookupModuleId("INST_XXXX");</span>
00041 <span class="comment"> *     WORM_MSGTYPE_ID       MsgId   = TGlobalUtils::LookupMessageTypeId("INST_XXXX");</span>
00042 <span class="comment"> * </span>
00043 <span class="comment"> * </span>
00044 <span class="comment"> * AVAILABLE FUNCTIONS:</span>
00045 <span class="comment"> * </span>
00046 <span class="comment"> *      // Put a status/error message onto the command ring</span>
00047 <span class="comment"> *      //     type must be TYPE_ERROR</span>
00048 <span class="comment"> *      void SendStatus( unsigned char type, short ierr, char *note );</span>
00049 <span class="comment"> * </span>
00050 <span class="comment"> *      void InitializeDB();  // called by DBMutableServer::PrepareToRun(),</span>
00051 <span class="comment"> *                            // but it might also need to be called elsewhere</span>
00052 <span class="comment"> *                            // for some modes</span>
00053 <span class="comment"> *         </span>
00054 <span class="comment"> *      void GetDefaultsFromDB(); </span>
00055 <span class="comment"> * </span>
00056 <span class="comment"> *      // Compare SCNLs with wildcards</span>
00057 <span class="comment"> *      // returns true or false</span>
00058 <span class="comment"> *      bool DoSCNLsMatch( const char * p_s1</span>
00059 <span class="comment"> *                       , const char * p_c1</span>
00060 <span class="comment"> *                       , const char * p_n1</span>
00061 <span class="comment"> *                       , const char * p_l1</span>
00062 <span class="comment"> *                       , const char * p_s2</span>
00063 <span class="comment"> *                       , const char * p_c2</span>
00064 <span class="comment"> *                       , const char * p_n2</span>
00065 <span class="comment"> *                       , const char * p_l2</span>
00066 <span class="comment"> *                       )                    </span>
00067 <span class="comment"> * </span>
00068 <span class="comment"> * LOGGING:</span>
00069 <span class="comment"> * </span>
00070 <span class="comment"> *    Based upon the value of LoggingLevel (value list above),</span>
00071 <span class="comment"> *    use the TLogger object to perform the logging functions:</span>
00072 <span class="comment"> * </span>
00073 <span class="comment"> *     if( WORM_LOG_ERRORS &lt;= LoggingLevel )</span>
00074 <span class="comment"> *     {</span>
00075 <span class="comment"> *        TLogger::Logit( LoggingOptions</span>
00076 <span class="comment"> *                     , "ServerTemplate::GetRequestFromInput(): %d\n"</span>
00077 <span class="comment"> *                     , some_int_value</span>
00078 <span class="comment"> *                     );</span>
00079 <span class="comment"> *     }</span>
00080 <span class="comment"> * </span>
00081 <span class="comment"> * ERROR HANDLING WITH EXCEPTIONS:</span>
00082 <span class="comment"> * </span>
00083 <span class="comment"> *     Through base class headers a class called worm_exception is</span>
00084 <span class="comment"> *     understood.</span>
00085 <span class="comment"> * </span>
00086 <span class="comment"> *     Often errors are handled in the methods using a try-catch pair:</span>
00087 <span class="comment"> * </span>
00088 <span class="comment"> *     try</span>
00089 <span class="comment"> *     {</span>
00090 <span class="comment"> *         // some code</span>
00091 <span class="comment"> * </span>
00092 <span class="comment"> *         if ( some_condition )</span>
00093 <span class="comment"> *         {</span>
00094 <span class="comment"> *            // an error was discovered</span>
00095 <span class="comment"> *            </span>
00096 <span class="comment"> *            throw worm_exception("My error message");</span>
00097 <span class="comment"> *         }</span>
00098 <span class="comment"> * </span>
00099 <span class="comment"> * </span>
00100 <span class="comment"> *         if ( some_int_value != 0 )</span>
00101 <span class="comment"> *         {</span>
00102 <span class="comment"> *            // an error was discovered</span>
00103 <span class="comment"> *            </span>
00104 <span class="comment"> *            worm_exception MyExcept("some_int_value not = 0: ");</span>
00105 <span class="comment"> *                           MyExcept += (int)some_int_value;</span>
00106 <span class="comment"> *                           MyExcept += ", Must quit";</span>
00107 <span class="comment"> *            throw MyExcept;</span>
00108 <span class="comment"> *         }</span>
00109 <span class="comment"> * </span>
00110 <span class="comment"> *     }</span>
00111 <span class="comment"> *     catch( worm_exception &amp; _we )</span>
00112 <span class="comment"> *     {</span>
00113 <span class="comment"> *        // Handle any worm exception thrown in the above try block</span>
00114 <span class="comment"> *        </span>
00115 <span class="comment"> *        // At this point, '_we' is a reference to a worm_exception object</span>
00116 <span class="comment"> *        // it has one method most useful here:</span>
00117 <span class="comment"> * </span>
00118 <span class="comment"> *        char * _errptr = _we.what();  // returns the error message as a pointer to char</span>
00119 <span class="comment"> * </span>
00120 <span class="comment"> *        // If desired, the exception may be re-thrown</span>
00121 <span class="comment"> *        // (uncommon, but can be done).</span>
00122 <span class="comment"> *        throw _we;</span>
00123 <span class="comment"> *     }</span>
00124 <span class="comment"> *     catch( ... )</span>
00125 <span class="comment"> *     {</span>
00126 <span class="comment"> *         // This second catch block is not needed, but it shown here to</span>
00127 <span class="comment"> *         // demonstrate how to catch any type of exception.</span>
00128 <span class="comment"> *         // Unfortunately, there is no available reference to the exception.</span>
00129 <span class="comment"> *     }</span>
00130 <span class="comment"> * </span>
00131 <span class="comment"> *     If a method/function includes a throw statement that is not surrounded</span>
00132 <span class="comment"> *     by at try block (with an applicable catch block), then execution</span>
00133 <span class="comment"> *     returns from the method immediately and then entire calling chain of</span>
00134 <span class="comment"> *     functions are returned from -- Until one of the function calls is</span>
00135 <span class="comment"> *     surrounded by a try block with an appropriate catch block.</span>
00136 <span class="comment"> *     </span>
00137 <span class="comment"> *     Memory allocations are NOT released, and file pointers may not be</span>
00138 <span class="comment"> *     closed, so they should be handled in a manner such as this:</span>
00139 <span class="comment"> * </span>
00140 <span class="comment"> *     char * MyBuffer = NULL;</span>
00141 <span class="comment"> * </span>
00142 <span class="comment"> *     try</span>
00143 <span class="comment"> *     {</span>
00144 <span class="comment"> *         // some code, part A</span>
00145 <span class="comment"> * </span>
00146 <span class="comment"> *         if ( (MyBuffer = new char[120]) == NULL )</span>
00147 <span class="comment"> *         {</span>
00148 <span class="comment"> *            throw worm_exception("failed allocation buffer");</span>
00149 <span class="comment"> *         }</span>
00150 <span class="comment"> * </span>
00151 <span class="comment"> *         // some other code, part B</span>
00152 <span class="comment"> * </span>
00153 <span class="comment"> *     }</span>
00154 <span class="comment"> *     catch( worm_exception &amp; _we )</span>
00155 <span class="comment"> *     {</span>
00156 <span class="comment"> *        // error handling for worm_exceptions</span>
00157 <span class="comment"> *     }</span>
00158 <span class="comment"> *     catch( ... )</span>
00159 <span class="comment"> *     {</span>
00160 <span class="comment"> *        // error handling for other exceptions</span>
00161 <span class="comment"> *     }</span>
00162 <span class="comment"> * </span>
00163 <span class="comment"> * </span>
00164 <span class="comment"> *     if ( MyBuffer != NULL )</span>
00165 <span class="comment"> *     {</span>
00166 <span class="comment"> *        // Ensure memory is released</span>
00167 <span class="comment"> *        // (we allocated an array of char, so we use "delete []"</span>
00168 <span class="comment"> *        // instead of just "delete")</span>
00169 <span class="comment"> *        //</span>
00170 <span class="comment"> *        delete [] MyBuffer;</span>
00171 <span class="comment"> *     }</span>
00172 <span class="comment"> */</span>
00173 
00174 
00175 <span class="comment">// STEP 1: Do a global replacement of the string "ServerTemplate"</span>
00176 <span class="comment">//         with the name of the new class</span>
00177 <span class="comment">//</span>
00178 
00179 <span class="comment">// STEP 2: Replace this include with the .h file for the new class</span>
00180 <span class="comment">//</span>
00181 <span class="preprocessor">#include "<a class="code" href="server__template_8h.html">server_template.h</a>"</span>
00182 
00183 
00184 <span class="comment">// STEP 3: Add includes for the appropriate type of message classes</span>
00185 <span class="preprocessor">#include "<a class="code" href="request__template_8h.html">request_template.h</a>"</span>
00186 <span class="preprocessor">#include "<a class="code" href="result__template_8h.html">result_template.h</a>"</span>
00187 
00188 
00189 
00190 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00191 
00192 <span class="comment">// STEP 4: Include any headers for C-style code</span>
00193 
00194 }
00195 
00196 
00197 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00198"></a><a class="code" href="classServerTemplate.html#a1">00198</a> <a class="code" href="classServerTemplate.html#a1">ServerTemplate::ServerTemplate</a>()
00199 {
00200 <span class="comment">// STEP 5 Perform any required variable initialization here</span>
00201 <span class="comment">//        Usually, that means initializing the default parameters:</span>
00202    <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleLongParam      = 0L;
00203    <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleStringParam[0] = <span class="charliteral">'\0'</span>; 
00204    <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleFlagParam      = <span class="keyword">false</span>;
00205    
00206    
00207 <span class="comment">//         (Any pointers that will refer to dynamically allocated memory</span>
00208 <span class="comment">//         must be NULLified here).</span>
00209 <span class="comment">//</span>
00210 <span class="comment">//     MyPointer = NULL;</span>
00211 }
00212 
00213 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00214"></a><a class="code" href="classServerTemplate.html#a2">00214</a> <a class="code" href="classServerTemplate.html#a2">ServerTemplate::~ServerTemplate</a>()
00215 {
00216 <span class="comment">// STEP 6 Perform any requisite clean-up for server termination here</span>
00217 
00218 <span class="comment">// (generally only needed to delete any dynamically-allocated memory)</span>
00219 
00220    <span class="comment">/*</span>
00221 <span class="comment">    * if ( MyPointer != NULL )</span>
00222 <span class="comment">    * {</span>
00223 <span class="comment">    *    delete [] MyPointer;</span>
00224 <span class="comment">    * }</span>
00225 <span class="comment">    */</span>
00226     
00227 }
00228 
00229 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00230"></a><a class="code" href="classServerTemplate.html#a0">00230</a> <a class="code" href="configurable_8h.html#a3">HANDLE_STATUS</a> <a class="code" href="classServerTemplate.html#a0">ServerTemplate::HandleConfigLine</a>( <a class="code" href="classConfigSource.html">ConfigSource</a> * p_parser )
00231 {
00232 <span class="comment">// STEP 7: Handle any Configuration parameter parsing here.</span>
00233 <span class="comment">//</span>
00234 <span class="comment">// THIS METHOD RECEIVES A SINGLE CONFIGURATION LINE AT A TIME; THUS, IT IS</span>
00235 <span class="comment">// CALLED REPEATEDLY.</span>
00236 <span class="comment">//</span>
00237 <span class="comment">// GENERALLY, ONLY THOSE CONFIGURATION ITEMS THAT MAY ONLY COME</span>
00238 <span class="comment">// FROM THE CONFIGURATION FILE (i.e. STARTUP CONFIGURATION) ARE</span>
00239 <span class="comment">// PROCESSED HERE.  THOSE ITEMS WHICH MAY ALSO BE CHANGED VIA A PASSPORT</span>
00240 <span class="comment">// ARE HANDED OFF TO THE METHOD HandleParameterLine() TOWARDS THE BOTTOM OF</span>
00241 <span class="comment">// THIS METHOD.</span>
00242 <span class="comment">//</span>
00243 <span class="comment">// THIS METHOD MUST RETURN ONE OF THESE VALUES: </span>
00244 <span class="comment">//</span>
00245 <span class="comment">//       HANDLE_INVALID --  line invalid</span>
00246 <span class="comment">//       HANDLE_UNUSED  --  line not used</span>
00247 <span class="comment">//       HANDLE_USED    --  line used okay</span>
00248 <span class="comment">//</span>
00249 
00250    <span class="comment">// BASE CLASSES MUST BE GIVEN THE CHANCE TO GET CONFIG VARIABLES:</span>
00251    <a class="code" href="configurable_8h.html#a3">HANDLE_STATUS</a> r_status = DBMutableServerBase::HandleConfigLine( p_parser );
00252    
00253    
00254    <span class="keywordflow">if</span> ( r_status == HANDLE_UNUSED )
00255    {
00256       <span class="comment">// Base class didn't use it, then it must belong to this</span>
00257       <span class="comment">// derivative class</span>
00258     
00259       <span class="keywordflow">try</span>
00260       {
00261          <span class="comment">// this do-while is solely to allow a single return point,</span>
00262          <span class="comment">// thus simplifying the code.</span>
00263          
00264          <span class="keywordflow">do</span>
00265          {
00266             <span class="keywordtype">char</span> * _token;
00267             
00268             <span class="comment">// WHEN ARRIVING HERE, p_parser HAS THE FIRST TOKEN ON </span>
00269             <span class="comment">// THE [COMMAND] LINE LOADED INTO THE CURRENT TOKEN.</span>
00270             <span class="comment">// THUS WE MAY PERFORM A TEST FOR THE LINE TYPE USING Its("")</span>
00271             <span class="comment">//</span>
00272             <span class="comment">// Among others, a ConfigSource object has these  methods:</span>
00273             <span class="comment">//</span>
00274             <span class="comment">//          bool   Its("");           // compare current token to a string</span>
00275             <span class="comment">//    const char * GetCurrentToken();</span>
00276             <span class="comment">//    const char * GetCurrentLine();  </span>
00277             <span class="comment">//          char * String();          // next token as a string</span>
00278             <span class="comment">//          int    Int();             // next tokan as an int</span>
00279             <span class="comment">//          int    Long();            // next tokan as a long</span>
00280             <span class="comment">//          int    Double();          // next tokan as a double</span>
00281             <span class="comment">//</span>
00282             <span class="comment">// And these member values:</span>
00283             <span class="comment">//</span>
00284             <span class="comment">//        INVALID_INT</span>
00285             <span class="comment">//        INVALID_LONG</span>
00286             <span class="comment">//        INVALID_DOUBLE</span>
00287             <span class="comment">//</span>
00288             
00289             
00290             
00291             <span class="comment">// EXAMPLE LINE:</span>
00292             <span class="comment">//</span>
00293             <span class="comment">//    ExampleFlagParam true</span>
00294             <span class="comment">//    ExampleFlagParam false</span>
00295             <span class="comment">// </span>
00296             <span class="keywordflow">if</span> ( p_parser-&gt;<a class="code" href="classConfigSource.html#a22">Its</a>(<span class="stringliteral">"ExampleFlagParam"</span>) )
00297             {
00298                _token = p_parser-&gt;<a class="code" href="classConfigSource.html#a12">String</a>();
00299                
00300                <span class="comment">// The ConfigSource::String() method will return an empty string</span>
00301                <span class="comment">// if no token is found, must perform a specific check for </span>
00302                <span class="comment">// that condition.</span>
00303                
00304                <span class="keywordflow">if</span> ( p_parser-&gt;<a class="code" href="classConfigSource.html#a11">IsTokenNull</a>() )
00305                {
00306                   <span class="comment">// Didn't find an expected value on the line</span>
00307                   <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Incomplete &lt;ExampleFlagParam&gt; line"</span>);
00308                }
00309                
00310                <span class="comment">// Grab the value</span>
00311                <span class="keywordflow">if</span> ( strcmp( _token, <span class="stringliteral">"true"</span> ) == 0 )
00312                {
00313                   <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleFlagParam = <span class="keyword">true</span>;
00314                }
00315                <span class="keywordflow">else</span>
00316                {
00317                   <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleFlagParam = <span class="keyword">false</span>;
00318                }
00319                
00320                <span class="comment">// Set the return status to indicate that the line was handled</span>
00321                <span class="comment">// okay.</span>
00322                r_status = HANDLE_USED;
00323                
00324                <span class="comment">// Skip past any other line checking</span>
00325                <span class="keywordflow">continue</span>;
00326             }
00327             
00328             
00329             <span class="comment">// Additional Its() and handling</span>
00330             
00331             
00332             
00333             <span class="comment">// Pass any config-file only lines to the</span>
00334             <span class="comment">// shared config/passport handler</span>
00335             <span class="comment">//</span>
00336             r_status = <a class="code" href="classServerTemplate.html#b9">HandleParameterLine</a>( p_parser, &amp;DefaultParameters );
00337             
00338          } <span class="keywordflow">while</span>( false );
00339       }
00340       <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00341       {
00342          <span class="comment">// Do all of our logging [including for HandleParameterLine()] here</span>
00343          
00344          <span class="keywordflow">if</span> ( <a class="code" href="worm__defs_8h.html#a14a9">WORM_LOG_ERRORS</a> &lt;= <a class="code" href="classWormServerBase.html#n6">LoggingLevel</a> )
00345          {
00346             <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00347                           , <span class="stringliteral">"ServerTemplate::HandleConfigLine() Error:\n%s"</span>
00348                           , _we.what()
00349                           );
00350          }
00351                
00352          r_status = HANDLE_INVALID;
00353       }  
00354    }
00355    
00356    <span class="keywordflow">return</span> r_status;
00357 }
00358 
00359 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00360"></a><a class="code" href="classServerTemplate.html#b9">00360</a> <a class="code" href="configurable_8h.html#a3">HANDLE_STATUS</a> <a class="code" href="classServerTemplate.html#b9">ServerTemplate::HandleParameterLine</a>( <a class="code" href="classConfigSource.html">ConfigSource</a> * p_parser
00361                                                  , <span class="keywordtype">void</span>         * p_params
00362                                                  )
00363 {
00364 <span class="comment">// STEP 8: Handle processing parameters here.</span>
00365 <span class="comment">//</span>
00366 <span class="comment">// GENERALLY, THIS METHOD IS USED TO HANDLE PROCESSING-RELATED PARAMETERS THAT</span>
00367 <span class="comment">// MIGHT ORIGINATE FROM EITHER THE CONFIGURATION FILE, OR THE PASSPORT.</span>
00368 <span class="comment">//</span>
00369 <span class="comment">// THIS METHOD RECEIVES A SINGLE CONFIGURATION LINE AT A TIME; THUS, IT IS</span>
00370 <span class="comment">// CALLED REPEATEDLY.</span>
00371 <span class="comment">//</span>
00372 <span class="comment">// THIS METHOD MUST RETURN ONE OF THESE VALUES: </span>
00373 <span class="comment">//</span>
00374 <span class="comment">//       HANDLE_INVALID --  line invalid</span>
00375 <span class="comment">//       HANDLE_UNUSED  --  line not used</span>
00376 <span class="comment">//       HANDLE_USED    --  line used okay</span>
00377 <span class="comment">// </span>
00378 <span class="comment">// OR THROW worm_exception() FOR ERRORS.</span>
00379 <span class="comment">//</span>
00380 <span class="comment">// Any errors that are encountered are not logged here, but are throw as an</span>
00381 <span class="comment">// worm_exception for the caller to handle and report. </span>
00382 
00383    <a class="code" href="configurable_8h.html#a3">HANDLE_STATUS</a> r_status = HANDLE_UNUSED;
00384    
00385    <span class="comment">// Cast the arriving pointer to a parameters struct to the correct type for</span>
00386    <span class="comment">// this server</span>
00387    <span class="comment">//</span>
00388    ServerTemplate_PARAMS * CurrentParameters = (ServerTemplate_PARAMS *)p_params;
00389    
00390    
00391    <span class="keywordflow">do</span>
00392    {
00393       <span class="keywordtype">char</span> * _token;
00394             
00395       <span class="comment">// WHEN ARRIVING HERE, p_parser HAS THE FIRST TOKEN ON </span>
00396       <span class="comment">// THE [COMMAND] LINE LOADED INTO THE CURRENT TOKEN.</span>
00397       <span class="comment">// THUS WE MAY PERFORM A TEST FOR THE LINE TYPE.</span>
00398             
00399             
00400       <span class="comment">// EXAMPLE PARAMETER/PASSPORT LINE:</span>
00401       <span class="comment">//</span>
00402       <span class="comment">//    ExampleDualValue  some_string_without_whitespace  some_integer</span>
00403       <span class="comment">// </span>
00404       <span class="keywordflow">if</span> ( p_parser-&gt;<a class="code" href="classConfigSource.html#a22">Its</a>(<span class="stringliteral">"ExampleDualValue"</span>) )
00405       {
00406          _token = p_parser-&gt;<a class="code" href="classConfigSource.html#a12">String</a>();
00407          
00408          <span class="keywordflow">if</span> ( p_parser-&gt;<a class="code" href="classConfigSource.html#a11">IsTokenNull</a>() )
00409          {
00410             <span class="comment">// Didn't find an expected value on the line</span>
00411             <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Incomplete &lt;ExampleDualValue&gt; line"</span>);
00412          }
00413          
00414          <span class="keywordflow">if</span> ( 30 &lt;  strlen( _token ) )
00415          {
00416             <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Invalid &lt;ExampleDualValue&gt; line: string too long"</span>);
00417          }
00418          
00419          <span class="comment">// Grab the string value</span>
00420          strcpy( CurrentParameters-&gt;ExampleStringParam, _token );
00421          
00422          <span class="comment">// Now get the int</span>
00423                   
00424          <span class="keywordflow">if</span> ( (CurrentParameters-&gt;ExampleLongParam = p_parser-&gt;<a class="code" href="classConfigSource.html#a13">Int</a>()) == p_parser-&gt;<a class="code" href="classConfigSource.html#p0">INVALID_INT</a> )
00425          {
00426             <span class="comment">// Didn't find an expected value on the line</span>
00427             CurrentParameters-&gt;ExampleLongParam = 0;
00428             <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Incomplete &lt;ExampleDualValue&gt; line: missing int"</span>);
00429          }
00430                
00431          <span class="comment">// Set the return status to indicate that the line was handled</span>
00432          <span class="comment">// okay.</span>
00433          r_status = HANDLE_USED;
00434              
00435          <span class="comment">// Skip past any other line checking</span>
00436          <span class="keywordflow">continue</span>;
00437       }
00438       
00439       
00440       <span class="comment">// Additional Its() and handling</span>
00441       
00442             
00443    } <span class="keywordflow">while</span>( false );
00444 
00445    <span class="keywordflow">return</span> r_status;
00446 }
00447 
00448 
00449 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00450"></a><a class="code" href="classServerTemplate.html#b0">00450</a> <span class="keywordtype">void</span> <a class="code" href="classServerTemplate.html#b0">ServerTemplate::CheckConfig</a>()
00451 {
00452    <span class="comment">// MUST ALWAYS ALLOW BASE CLASSES A CHANCE TO CHECK THEIR OWN</span>
00453    <span class="comment">// CONFIGURATION STATE.</span>
00454    <span class="comment">//</span>
00455    <span class="comment">// If the Mode is required for testing, then this statement must</span>
00456    <span class="comment">// come first.</span>
00457    <span class="comment">//</span>
00458    DBMutableServerBase::CheckConfig();
00459    
00460    
00461    <span class="comment">// CHECK THIS CLASS'S CONFIGURATION VARIABLES,</span>
00462    <span class="comment">//</span>
00463    <span class="comment">// There may be need to perform testing based upon the mode in which the</span>
00464    <span class="comment">// program is to run.  For example, a client won't likely need to know</span>
00465    <span class="comment">// about any waveservers, so it won't check the values of any waveserver</span>
00466    <span class="comment">// variables despite their existence in support of the server.</span>
00467    <span class="comment">// The operating mode is kept in variable 'Mode' (see top of file).</span>
00468    <span class="comment">//</span>
00469    <span class="comment">// IF A PROBLEM IS FOUND, LOG IT, AND DO:</span>
00470    <span class="comment">//</span>
00471    <span class="comment">//       ConfigStatus = WORM_STAT_BADSTATE;</span>
00472    <span class="comment">//</span>
00473    <span class="comment">// BUT DON'T RETURN, THUS ALL CONFIGURATION ERRORS CAN BE REPORTED</span>
00474    <span class="comment">// FROM ONE ATTEMPTED RUN.</span>
00475    
00476 <span class="comment">// STEP 9: Perform any configuration checking here</span>
00477 
00478    <span class="keywordflow">if</span> ( <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleLongParam == 0 )
00479    {
00480       <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00481                     , <span class="stringliteral">"ServerTemplate::CheckConfig(): Did not find a valid &lt;ExampleDualValue&gt; line"</span>
00482                     );
00483       ConfigStatus = <a class="code" href="statuscode_8h.html#a16a6">WORM_STAT_BADSTATE</a>;
00484    }
00485    
00486    
00487 }
00488 
00489 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00490"></a><a class="code" href="classServerTemplate.html#b1">00490</a> <span class="keywordtype">bool</span> <a class="code" href="classServerTemplate.html#b1">ServerTemplate::PrepareToRun</a>()
00491 {
00492    <span class="keywordtype">bool</span> r_status = <span class="keyword">false</span>;
00493 
00494    <span class="keywordflow">try</span>
00495    {
00496       <span class="keywordflow">if</span> ( DBMutableServerBase::PrepareToRun() )
00497       {   
00498          <span class="comment">// Get any default parameters from the database</span>
00499          <span class="comment">//</span>
00500          <span class="comment">// (this will ultimately end up calling the HandleParameterLine() method) </span>
00501          <span class="comment">//</span>
00502          <span class="keywordflow">if</span> ( <a class="code" href="classDBMutableServer.html#b3">GetDefaultsFromDB</a>( &amp;DefaultParameters ) )
00503          {
00504    
00505 <span class="comment">// STEP 10: If the new class needs to perform any activities after configuration,</span>
00506 <span class="comment">//         but before starting the main processing, add that here.</span>
00507 <span class="comment">//       </span>
00508 <span class="comment">//         RETURN false IF AN ERROR PREVENTS CONTINUING.</span>
00509    
00510    
00511             <span class="comment">// indicate preparations completed successfully</span>
00512             r_status = <span class="keyword">true</span>;
00513          }
00514       }
00515    }
00516    <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00517    {
00518       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a9">WORM_LOG_ERRORS</a> &lt;= <a class="code" href="classWormServerBase.html#n6">LoggingLevel</a> )
00519       {
00520          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00521                        , <span class="stringliteral">"ServerTemplate::PrepareToRun() Error: %s\n"</span>
00522                        , _we.what()
00523                        );
00524       }
00525       
00526       r_status = <span class="keyword">false</span>;
00527    }
00528    <span class="keywordflow">return</span> r_status;
00529 }
00530 
00531 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00532"></a><a class="code" href="classServerTemplate.html#b4">00532</a> <a class="code" href="classMutableServerRequest.html">MutableServerRequest</a> * <a class="code" href="classServerTemplate.html#b4">ServerTemplate::GetRequestContainer</a>()
00533 {
00534 <span class="comment">// STEP 11: Change "RequestTemplate" to the appropriate type of request container</span>
00535 <span class="comment">//          (2 times)</span>
00536    <a class="code" href="classRequestTemplate.html">RequestTemplate</a> * r_object = NULL;
00537 
00538    <span class="keywordflow">try</span>
00539    {
00540       <span class="keywordflow">if</span> ( (r_object = <span class="keyword">new</span> <a class="code" href="classRequestTemplate.html">RequestTemplate</a>()) == NULL )
00541       {
00542          <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Failed to create Request container"</span>);
00543       }
00544    }
00545    <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00546    {
00547       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a9">WORM_LOG_ERRORS</a> &lt;= <a class="code" href="classWormServerBase.html#n6">LoggingLevel</a> )
00548       {
00549          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00550                       , <span class="stringliteral">"ServerTemplate::GetRequestContainer(): %s\n"</span>
00551                       , _we.what()
00552                       );
00553       }
00554    }
00555 
00556    <span class="keywordflow">return</span> r_object;
00557 }
00558 
00559 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00560"></a><a class="code" href="classServerTemplate.html#b5">00560</a> <a class="code" href="classMutableServerResult.html">MutableServerResult</a> * <a class="code" href="classServerTemplate.html#b5">ServerTemplate::GetResultContainer</a>()
00561 {
00562 <span class="comment">// STEP 12: Change "ResultTemplate" to the appropriate type of request container</span>
00563 <span class="comment">//          (2 times)</span>
00564 
00565    <a class="code" href="classResultTemplate.html">ResultTemplate</a> * r_object = NULL;
00566 
00567    <span class="keywordflow">try</span>
00568    {
00569       <span class="keywordflow">if</span> ( (r_object = <span class="keyword">new</span> <a class="code" href="classResultTemplate.html">ResultTemplate</a>()) == NULL )
00570       {
00571          <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Failed to create Result container"</span>);
00572       }
00573    }
00574    <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00575    {
00576       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a9">WORM_LOG_ERRORS</a> &lt;= <a class="code" href="classTGlobalUtils.html#d11">TGlobalUtils::GetLoggingLevel</a>() )
00577       {
00578          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00579                       , <span class="stringliteral">"ServerTemplate::GetResultContainer(): %s\n"</span>
00580                       , _we.what()
00581                       );
00582       }
00583    }
00584 
00585    <span class="keywordflow">return</span> r_object;
00586 }
00587 
00588 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00589"></a><a class="code" href="classServerTemplate.html#b6">00589</a> <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> <a class="code" href="classServerTemplate.html#b6">ServerTemplate::GetRequestFromInput</a>( <span class="keywordtype">int</span>    p_argc
00590                                                     , <span class="keywordtype">char</span> * p_argv[]
00591                                                     , <span class="keywordtype">void</span> * r_container
00592                                                     )
00593 {
00594    <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> r_status = <a class="code" href="statuscode_8h.html#a16a7">WORM_STAT_SUCCESS</a>;
00595 
00596    <span class="keywordflow">try</span>
00597    {
00598       <span class="keywordflow">if</span> ( r_container == NULL )
00599       {
00600          <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"NULL request container parameter"</span>);
00601       }
00602 
00603       <span class="keywordflow">if</span> ( p_argc &lt; 2 )
00604       {
00605          <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Too few parameters from program command line"</span>);
00606       }
00607 
00608       <span class="keywordflow">if</span> ( <a class="code" href="worm__defs_8h.html#a14a13">WORM_LOG_DEBUG</a> &lt; <a class="code" href="classWormServerBase.html#n6">LoggingLevel</a> )
00609       {
00610          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00611                        , <span class="stringliteral">"ServerTemplate::GetRequestFromInput() argc: %d  [1] = %s\n"</span>
00612                        , p_argc
00613                        , p_argv[1]
00614                        );
00615       }
00616       
00617 
00618 <span class="comment">// STEP 13: Cast the arriving container to the request class appropriate to</span>
00619 <span class="comment">//          this server class.</span>
00620 <span class="comment">//</span>
00621       <a class="code" href="classRequestTemplate.html">RequestTemplate</a> * ThisRequest = (<a class="code" href="classRequestTemplate.html">RequestTemplate</a> *)r_container;
00622 
00623 
00624 <span class="comment">// STEP 14: Perform whatever actions are needed, based upon the command line</span>
00625 <span class="comment">//          input.  Commonly this might include getting event info from the</span>
00626 <span class="comment">//          database.</span>
00627 <span class="comment">//</span>
00628 <span class="comment">//          Since this is for client and standalone modes only, these should</span>
00629 <span class="comment">//          generally be activities needed to perform the processing request.</span>
00630 <span class="comment">//</span>
00631 <span class="comment">//          Throw worm_exception for errors.</span>
00632 <span class="comment">//</span>
00633 <span class="comment">//          For example, if the request class tracks origin id there might</span>
00634 <span class="comment">//          be code that looks something like:</span>
00635 <span class="comment">//</span>
00636 <span class="comment">//          ThisRequest-&gt;SetEventId( atoi(argv[1]) );</span>
00637 
00638 
00639    }
00640    <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00641    {
00642       r_status = <a class="code" href="statuscode_8h.html#a16a5">WORM_STAT_FAILURE</a>;
00643 
00644       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a9">WORM_LOG_ERRORS</a> &lt;= <a class="code" href="classTGlobalUtils.html#d11">TGlobalUtils::GetLoggingLevel</a>() )
00645       {
00646          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00647                       , <span class="stringliteral">"ServerTemplate::GetRequestFromInput(): %s\n"</span>
00648                       , _we.what()
00649                       );
00650       }
00651    }
00652 
00653    <span class="keywordflow">return</span> r_status;
00654 }
00655 
00656 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00657"></a><a class="code" href="classServerTemplate.html#b7">00657</a> <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> <a class="code" href="classServerTemplate.html#b7">ServerTemplate::ProcessRequest</a>( <span class="keywordtype">void</span> * p_requestcontainer
00658                                                , <span class="keywordtype">void</span> * r_resultcontainer
00659                                                )
00660 {
00661    <span class="comment">// on algorithm failure (but not error) set r_status = WORM_STAT_BADSTATE</span>
00662    <span class="comment">// before throwing a worm_exception</span>
00663    <span class="comment">// </span>
00664    <span class="comment">// (r_status is set to WORM_STAT_SUCCESS at bottom of method)</span>
00665    <span class="comment">//</span>
00666    <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> r_status = <a class="code" href="statuscode_8h.html#a16a5">WORM_STAT_FAILURE</a>;
00667 
00668    <span class="comment">// Passport for this processing run</span>
00669    ServerTemplate_PARAMS    LocalParameters;
00670    
00671    <a class="code" href="classResultTemplate.html">ResultTemplate</a>  * ThisResult  = NULL;
00672    
00673    <span class="keywordflow">try</span>
00674    {
00675       <span class="keywordflow">if</span> ( p_request == NULL || r_result == NULL )
00676       {
00677          <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"NULL container parameter"</span>);
00678       }
00679       
00680 <span class="comment">// STEP 15:</span>
00681       <span class="comment">// Cast request and result containers to the appropriate types for</span>
00682       <span class="comment">// this server</span>
00683       <a class="code" href="classRequestTemplate.html">RequestTemplate</a> * ThisRequest = (<a class="code" href="classRequestTemplate.html">RequestTemplate</a> *)p_requestcontainer;
00684                         ThisResult  = (<a class="code" href="classResultTemplate.html">ResultTemplate</a> *)r_resultcontainer;
00685       
00686       
00687 
00688 <span class="comment">// STEP 16: </span>
00689       <span class="comment">// Copy default parameters into the local parameters for this calculation</span>
00690       
00691               LocalParameters.ExampleLongParam   = <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleLongParam;
00692       strcpy( LocalParameters.ExampleStringParam , <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleStringParam );
00693               LocalParameters.ExampleFlagParam   = <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>.ExampleFlagParam;
00694       
00695 
00696 <span class="comment">// STEP 17:</span>
00697 <span class="comment">//</span>
00698 <span class="comment">// THIS IS EXAMPLE CODE THAT CAN BE USED IF THE REQUEST CONTAINER IS DERIVED</span>
00699 <span class="comment">// FROM MutableServerRequest CLASS (WHICH KNOWS ABOUT PASSPORTS.</span>
00700 <span class="comment">// IT CAN BE INCLUDED EVEN IF NO PASSPORT DATA IS BEING PASSED AT THIS TIME.</span>
00701 <span class="comment">//</span>
00702 <span class="comment">// IF THE REQUEST CONTAINER DOES NOT DERIVE FROM MutableServerRequest CLASS,</span>
00703 <span class="comment">// THIS PROBABLY MUST BE REMOVED.</span>
00704 
00705       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a13">WORM_LOG_DEBUG</a> &lt;= <a class="code" href="classWormServerBase.html#n6">LoggingLevel</a> )
00706       {
00707          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( WORM_LOG_TOFILE
00708                        , <span class="stringliteral">"ServerTemplate::ProcessRequest() Getting Passport:\n"</span>
00709                        );
00710       }
00711 
00712       
00713       <span class="comment">// Process any passport lines that arrive</span>
00714       <span class="comment">//</span>
00715       <span class="keywordflow">if</span> ( 0 &lt; ThisRequest-&gt;<a class="code" href="classMutableServerRequest.html#a4">GetPassportLineCount</a>() )
00716       {
00717          <span class="comment">// basic command line parser object</span>
00718          <a class="code" href="classConfigSource.html">ConfigSource</a> _parser;
00719    
00720          <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> _p = 0, _sz = ThisRequest-&gt;<a class="code" href="classMutableServerRequest.html#a4">GetPassportLineCount</a>() ; _p &lt; _sz ; _p++ )
00721          {
00722             <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a13">WORM_LOG_DEBUG</a> &lt;= <a class="code" href="classWormServerBase.html#n6">LoggingLevel</a> )
00723             {
00724                <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( WORM_LOG_TOFILE
00725                              , <span class="stringliteral">"   &gt;%s\n"</span>
00726                              , _request-&gt;GetPassportLine( _p )
00727                             );
00728             }
00729 
00730             _parser.<a class="code" href="classConfigSource.html#a9">Load</a>( ThisRequest-&gt;<a class="code" href="classMutableServerRequest.html#a5">GetPassportLine</a>( _p ) );
00731 
00732             <span class="comment">// HandleParameterLine() will throw worm_exception</span>
00733             <span class="comment">// which will be caught by the catch block at the end</span>
00734             <span class="comment">// of this method.  To continue processing on parameter line</span>
00735             <span class="comment">// errors, this statement must be wrapped in at try block</span>
00736             <span class="comment">//</span>
00737             <a class="code" href="classServerTemplate.html#b9">HandleParameterLine</a>( &amp;_parser, &amp;LocalParameters );
00738          }
00739       }
00740       
00741       
00742       
00743 <span class="comment">// STEP 18: Perform the actual seimological processing here.</span>
00744 <span class="comment">//</span>
00745 <span class="comment">//          Any parameters needed should be in LocalParameters (which should be</span>
00746 <span class="comment">//          passed to any other methods instead of DefaultParameters.</span>
00747 <span class="comment">//</span>
00748 <span class="comment">//          Any event data needed should be in the ThisRequest object,</span>
00749 <span class="comment">//          something like:   ThisRequest-&gt;GetEventId()</span>
00750 <span class="comment">//</span>
00751 <span class="comment">//          On algorithmic incompletion/failure:</span>
00752 <span class="comment">//               r_status = WORM_STAT_BADSTATE;</span>
00753 <span class="comment">//               ThisResult-&gt;SetStatus( MSB_RESULT_FAIL );</span>
00754 <span class="comment">//               throw worm_exception("error description");</span>
00755 <span class="comment">//</span>
00756 <span class="comment">//          On system failure:</span>
00757 <span class="comment">//               r_status = WORM_STAT_FAILURE;</span>
00758 <span class="comment">//               ThisResult-&gt;SetStatus( MSB_RESULT_ERROR );</span>
00759 <span class="comment">//               throw worm_exception("error description");</span>
00760 
00761 
00762 
00763       <span class="comment">// Put the appropriate result status into the Result object</span>
00764       <span class="comment">// (alternatives above)</span>
00765       ThisResult-&gt;<a class="code" href="classMutableServerResult.html#a1">SetStatus</a>( MSB_RESULT_GOOD );
00766       
00767       <span class="comment">// Set the return state </span>
00768       <span class="comment">//</span>
00769       r_status = <a class="code" href="statuscode_8h.html#a16a7">WORM_STAT_SUCCESS</a>;
00770    }
00771    <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00772    {
00773       <span class="comment">// r_status should have been set above</span>
00774 
00775       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a9">WORM_LOG_ERRORS</a> &lt;= <a class="code" href="classTGlobalUtils.html#d11">TGlobalUtils::GetLoggingLevel</a>() )
00776       {
00777          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00778                       , <span class="stringliteral">"ServerTemplate::ProcessRequest(): %s\n"</span>
00779                       , _we.what()
00780                       );
00781       }
00782    }
00783 }
00784 
00785 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00786"></a><a class="code" href="classServerTemplate.html#b8">00786</a> <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> <a class="code" href="classServerTemplate.html#b8">ServerTemplate::HandleResult</a>( <span class="keywordtype">void</span> * p_resultcontainer )
00787 {
00788    <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> r_status = <a class="code" href="statuscode_8h.html#a16a7">WORM_STAT_SUCCESS</a>;
00789 
00790    <span class="keywordflow">try</span>
00791    {
00792 <span class="comment">// STEP 19: Cast the result container to the appropriate type</span>
00793 <span class="comment">//</span>
00794       <a class="code" href="classResultTemplate.html">ResultTemplate</a>  * ThisResult  = (<a class="code" href="classResultTemplate.html">ResultTemplate</a> *)p_resultcontainer;
00795 
00796 
00797       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a13">WORM_LOG_DEBUG</a> &lt;= <a class="code" href="classWormServerBase.html#n6">LoggingLevel</a> )
00798       {
00799          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00800                        , <span class="stringliteral">"ServerTemplate::HandleResult(): DEBUG result of processing: %d\n"</span>
00801                        , _result-&gt;GetStatus()
00802                        );
00803       }
00804       
00805 
00806       <span class="keywordflow">if</span> ( ThisResult-&gt;<a class="code" href="classMutableServerResult.html#a2">GetStatus</a>() == <a class="code" href="result__status_8h.html#a2">MSB_RESULT_GOOD</a> )
00807       {
00808          
00809 <span class="comment">// STEP 20: Perform activities for a good result (i.e.: database storage)</span>
00810 <span class="comment">//</span>
00811 <span class="comment">//       throw worm_exception for errors</span>
00812 
00813          
00814       } <span class="comment">// received good magnitude result</span>
00815       <span class="keywordflow">else</span>
00816       {
00817          <span class="keywordflow">switch</span>( _result-&gt;GetStatus() )
00818          {
00819            <span class="keywordflow">case</span> <a class="code" href="result__status_8h.html#a3">MSB_RESULT_FAIL</a>:
00820                 r_status = <a class="code" href="statuscode_8h.html#a16a6">WORM_STAT_BADSTATE</a>;
00821                 <span class="keywordflow">break</span>;
00822            <span class="keywordflow">case</span> <a class="code" href="result__status_8h.html#a1">MSB_RESULT_ERROR</a>:
00823                 r_status = <a class="code" href="statuscode_8h.html#a16a5">WORM_STAT_FAILURE</a>;
00824                 <span class="keywordflow">break</span>;
00825          }
00826       } <span class="comment">// calculations not good</span>
00827    }
00828    <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00829    {
00830       r_status = <a class="code" href="statuscode_8h.html#a16a5">WORM_STAT_FAILURE</a>;
00831 
00832       <span class="keywordflow">if</span>( <a class="code" href="worm__defs_8h.html#a14a9">WORM_LOG_ERRORS</a> &lt;= <a class="code" href="classTGlobalUtils.html#d11">TGlobalUtils::GetLoggingLevel</a>() )
00833       {
00834          <a class="code" href="classTLogger.html#d1">TLogger::Logit</a>( LoggingOptions
00835                       , <span class="stringliteral">"ServerTemplate::HandleResult(): %s\n"</span>
00836                       , _we.what()
00837                       );
00838       }
00839    }
00840 
00841    <span class="keywordflow">return</span> r_status;
00842 }
00843 <span class="comment">//------------------------------------------------------------------------------</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:09 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
