<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ahputaway.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ahputaway.c</h1><a href="ahputaway_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: ahputaway_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:01  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.4  2001/04/17 17:21:18  davidk</span>
00011 <span class="comment"> *     Added a _STDIO_H_ conditional definition in order to get a function</span>
00012 <span class="comment"> *     prototype declared in an includeded header file.  See comment in code</span>
00013 <span class="comment"> *     for more detail.</span>
00014 <span class="comment"> *</span>
00015 <span class="comment"> *     Revision 1.3  2001/04/12 03:47:36  lombard</span>
00016 <span class="comment"> *     Major reorganization of AHPA_next to improve efficiency</span>
00017 <span class="comment"> *     Reformatted code; cleaned up lots of comments and logit calls</span>
00018 <span class="comment"> *     Removed mapping of NC component codes (only needed at UW)</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> *     moved mallocs to AHPA_init instead of in AHPA_next_evt.</span>
00021 <span class="comment"> *     Removed different path delimiters; '/' works for both NT and Unix.</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> *     Revision 1.2  2000/03/10 23:25:51  davidk</span>
00024 <span class="comment"> *     changed the ahputaway routines to match the new PA_XXX routines</span>
00025 <span class="comment"> *     in putaway.c.  Moved the AHPA_XXX function prototypes to the ah header file.</span>
00026 <span class="comment"> *</span>
00027 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00028 <span class="comment"> *     Initial revision</span>
00029 <span class="comment"> *</span>
00030 <span class="comment"> *</span>
00031 <span class="comment"> */</span>
00032 
00033 <span class="comment">/* ah.c </span>
00034 <span class="comment">These are the five routines which plug into xxtrace_save, and cause the trace</span>
00035 <span class="comment">data snippets to be put away into a AH format trace files.  These are the</span>
00036 <span class="comment">model for other put away routines, such as flat files of various formats.</span>
00037 <span class="comment"></span>
00038 <span class="comment"></span>
00039 <span class="comment">  Thu Jul 22 14:56:37 MDT 1999 Lucky Vidmar</span>
00040 <span class="comment">    Major structural changes to accomodate making all putaway routines</span>
00041 <span class="comment">    into library calls so that they can be shared between trig2disk</span>
00042 <span class="comment">    and wave2disk. Eliminated global variables set and allocated outside</span>
00043 <span class="comment">    of this file. We should only have static globals from now on, with</span>
00044 <span class="comment">    everything else being passed in via the putaway.c calls.</span>
00045 <span class="comment">   */</span>
00046 
00047 
00048 <span class="preprocessor">#include &lt;math.h&gt;</span>
00049 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00050 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00051 <span class="preprocessor">#include &lt;string.h&gt;</span>
00052 <span class="preprocessor">#include &lt;<a class="code" href="earthworm_8h.html">earthworm.h</a>&gt;</span>
00053 <span class="preprocessor">#include &lt;time.h&gt;</span>
00054 <span class="preprocessor">#include &lt;<a class="code" href="trace__buf_8h.html">trace_buf.h</a>&gt;</span>
00055 <span class="preprocessor">#include &lt;<a class="code" href="swap_8h.html">swap.h</a>&gt;</span>
00056 <span class="preprocessor">#include &lt;<a class="code" href="ws__clientII_8h.html">ws_clientII.h</a>&gt;</span>
00057 <span class="preprocessor">#include &lt;<a class="code" href="ahhead_8h.html">ahhead.h</a>&gt;</span>
00058 <span class="preprocessor">#include &lt;<a class="code" href="pa__subs_8h.html">pa_subs.h</a>&gt;</span>
00059 <span class="preprocessor">#ifdef _WINNT</span>
00060 <span class="preprocessor"></span><span class="preprocessor"># ifdef _INC_STDIO</span>
00061 <span class="preprocessor"></span><span class="comment">/* DavidK: the version of Microsoft compiler I have defines _INC_STDIO </span>
00062 <span class="comment">   in stdio.h, instead of _STDIO_H_ which is defined in the sun stdio.h </span>
00063 <span class="comment">   There is an ifdef in rpc_nt/xdr.h that checks for _STDIO_H_ before</span>
00064 <span class="comment">   declaring a prototype for xdrstdio_create() */</span>
00065 <span class="preprocessor">#  define _STDIO_H_</span>
00066 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#include &lt;rpc_nt/types.h&gt;</span>
00068 <span class="preprocessor">#include &lt;rpc_nt/xdr.h&gt;</span>
00069 <span class="preprocessor">#else</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#include &lt;rpc/types.h&gt;</span>
00071 <span class="preprocessor">#include &lt;rpc/xdr.h&gt;</span>
00072 <span class="preprocessor">#endif</span>
00073 <span class="preprocessor"></span>
<a name="l00074"></a><a class="code" href="ahputaway_8c.html#a0">00074</a> <span class="preprocessor">#define MAXTXT           150</span>
00075 <span class="preprocessor"></span>
<a name="l00076"></a><a class="code" href="ahputaway_8c.html#a12">00076</a> <span class="keyword">static</span>  <span class="keywordtype">char</span>    <a class="code" href="ahputaway_8c.html#a12">AHDir</a>[2*<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a> + 4];
<a name="l00077"></a><a class="code" href="ahputaway_8c.html#a13">00077</a> <span class="keyword">static</span>  <a class="code" href="structahhed.html">ahhed</a> *<a class="code" href="ahputaway_8c.html#a13">AhHead</a>;                  <span class="comment">/* from ahhead.h */</span>
<a name="l00078"></a><a class="code" href="ahputaway_8c.html#a14">00078</a> <span class="keyword">static</span>  <span class="keywordtype">float</span> *<a class="code" href="ahputaway_8c.html#a14">mydata</a>;                  <span class="comment">/* output data */</span>
00079 
00080 <span class="comment">/* static functions */</span>
00081 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a18">gethead</a>(<a class="code" href="structahhed.html">ahhed</a> *, FILE *);
00082 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a19">puthead</a> (<a class="code" href="structahhed.html">ahhed</a> *, FILE *);
00083 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a20">size</a> (<a class="code" href="structahhed.html">ahhed</a> *);
00084 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a21">tohead</a> (<span class="keywordtype">int</span>, FILE *);
00085 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a22">getdata</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, FILE *);
00086 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a23">putdata</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, FILE *);
00087 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a24">putrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, FILE *);
00088 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a25">getrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, FILE *);
00089 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a26">getrecord2</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> **, FILE *);
00090 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a27">gogethead</a> (<span class="keywordtype">int</span>, <a class="code" href="structahhed.html">ahhed</a> *, FILE *);
00091 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a28">gogetrecord</a> (<span class="keywordtype">int</span>, <a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, FILE *);
00092 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a29">logger</a> (<span class="keywordtype">char</span> *, <a class="code" href="structahhed.html">ahhed</a> *);
00093 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a30">out_is_tty</a> (<span class="keywordtype">void</span>);
00094 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a31">in_is_tty</a> (<span class="keywordtype">void</span>);
00095 <span class="keyword">static</span>  <span class="keywordtype">char</span> *<a class="code" href="ahputaway_8c.html#a32">mkdatspace</a>(<a class="code" href="structahhed.html">ahhed</a> *);
00096 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a33">get_null_head</a> (<a class="code" href="structahhed.html">ahhed</a> *);
00097 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a34">acpy</a> (<span class="keywordtype">char</span> *, <span class="keywordtype">char</span> *, <span class="keywordtype">unsigned</span>);
00098 <span class="keyword">static</span>  <span class="keywordtype">void</span> <a class="code" href="ahputaway_8c.html#a35">ah_error</a> (<span class="keywordtype">char</span> *, <span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
00099 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a36">maxamp</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *);
00100 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a37">xdr_gethead</a> (<a class="code" href="structahhed.html">ahhed</a> *, XDR *);
00101 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a38">xdr_puthead</a> (<a class="code" href="structahhed.html">ahhed</a> *, XDR *);
00102 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a39">xdr_tohead</a> (<span class="keywordtype">int</span>, XDR *);
00103 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a40">xdr_getdata</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, XDR *);
00104 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a41">xdr_putdata</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, XDR *);
00105 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a42">xdr_putrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, XDR *);
00106 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a43">xdr_getrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, XDR *);
00107 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a44">xdr_getrecord2</a> (<a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> **, XDR *);
00108 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a45">xdr_gogethead</a> (<span class="keywordtype">int</span>, <a class="code" href="structahhed.html">ahhed</a> *, XDR *);
00109 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a46">xdr_gogetrecord</a> (<span class="keywordtype">int</span>, <a class="code" href="structahhed.html">ahhed</a> *, <span class="keywordtype">char</span> *, XDR *);
00110 <span class="keyword">static</span>  <span class="keywordtype">int</span>  <a class="code" href="ahputaway_8c.html#a47">xdr_ahhead</a> (XDR *, <a class="code" href="structahhed.html">ahhed</a> *);
00111 
00112 
00113 
00114 <span class="comment">/* Initialization function, </span>
00115 <span class="comment">*       This is the Put Away startup intializer. This is called when    *</span>
00116 <span class="comment">*       the system first comes up. Here is a chance to look around      *</span>
00117 <span class="comment">*       and see if it's possible to do business, and to complain        *</span>
00118 <span class="comment">*       if not ,BEFORE an event has to be processed.                    *</span>
00119 <span class="comment"> */</span>
<a name="l00120"></a><a class="code" href="ahputaway_8c.html#a48">00120</a> <span class="keywordtype">int</span> <a class="code" href="ahputaway_8c.html#a48">AHPA_init</a> (<span class="keywordtype">long</span> *OutBufferLen, <span class="keywordtype">char</span> *OutDir, <span class="keywordtype">int</span> debug)
00121 {
00122     
00123   <span class="keywordflow">if</span> ( (<a class="code" href="ahputaway_8c.html#a13">AhHead</a> = (<a class="code" href="structahhed.html">ahhed</a> *)calloc(<span class="keyword">sizeof</span>(<a class="code" href="structahhed.html">ahhed</a>), 1)) == (ahhed *)NULL)
00124   {
00125     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_init: out of memory for ahhed\n"</span>);
00126     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00127   }
00128       
00129   <span class="keywordflow">if</span> ( (<a class="code" href="ahputaway_8c.html#a14">mydata</a> = (<span class="keywordtype">float</span> *)calloc(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 
00130                                  (size_t)(*OutBufferLen/<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)))) 
00131        == (<span class="keywordtype">float</span> *)NULL)
00132   {
00133     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_init: out of memory for data buffer\n"</span>);
00134     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00135   }
00136 
00137   <span class="comment">/* Make sure that the top level output directory exists */</span>
00138   <span class="keywordflow">if</span> (<a class="code" href="dirops__ew_8c.html#a1">CreateDir</a> (OutDir) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00139   {
00140     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_init: Call to CreateDir failed\n"</span>);
00141     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00142   }
00143 
00144   <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>; <span class="comment">/* how could we do less? */</span>
00145 }
00146 
00147 <span class="comment">/****************************************************************************</span>
00148 <span class="comment">*       This is the Put Away event initializer. It's called when a snippet  *</span>
00149 <span class="comment">*       has been received, and is about to be processed.                    *</span>
00150 <span class="comment">*       It gets to see the pointer to the TraceRequest array,               *</span>
00151 <span class="comment">*       and the number of loaded trace structures.                          *</span>
00152 <span class="comment">*****************************************************************************/</span>
<a name="l00153"></a><a class="code" href="ahputaway_8c.html#a49">00153</a> <span class="keywordtype">int</span> <a class="code" href="ahputaway_8c.html#a49">AHPA_next_ev</a> (<a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> *ptrReq, <span class="keywordtype">int</span> nReq, <span class="keywordtype">char</span> *OutDir,
00154                   <span class="keywordtype">char</span> *EventDate, <span class="keywordtype">char</span> *EventTime, <span class="keywordtype">int</span> debug)
00155 {
00156   <span class="comment">/* create directory for this event */</span>
00157   sprintf (AHDir, <span class="stringliteral">"%s/%s%s"</span>, OutDir, EventDate, EventTime);
00158   <span class="keywordflow">if</span> (<a class="code" href="dirops__ew_8c.html#a1">CreateDir</a> (AHDir) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00159   {
00160     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_init: Call to CreateDir failed\n"</span>);
00161     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00162   }
00163 
00164   <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00165 }
00166 
00167 <span class="comment">/*****************************************************************************</span>
00168 <span class="comment"> *   This is the working entry point into the disposal system. This routine  *</span>
00169 <span class="comment"> *   gets called for each trace snippet which has been recovered. It gets    *</span>
00170 <span class="comment"> *   to see the corresponding SNIPPET structure, and the event id            *</span>
00171 <span class="comment"> *****************************************************************************/</span>
00172 <span class="comment">/* Process one channel of data */</span>
<a name="l00173"></a><a class="code" href="ahputaway_8c.html#a50">00173</a> <span class="keywordtype">int</span> <a class="code" href="ahputaway_8c.html#a50">AHPA_next</a> (<a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> *getThis, <span class="keywordtype">double</span> GapThresh, 
00174                <span class="keywordtype">long</span> OutBufferLen, <span class="keywordtype">int</span> debug)
00175 {
00176   FILE *fid;                      <span class="comment">/* xdr routines don't like creat */</span>
00177   XDR xdr;
00178   <a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *wf;
00179   <span class="keywordtype">char</span>        *msg_p;        <span class="comment">/* pointer into tracebuf data */</span>
00180   <span class="keywordtype">short</span>       *s_data;
00181   <span class="keywordtype">long</span>        *l_data;
00182   <span class="keywordtype">float</span>       *f_data;
00183   <span class="keywordtype">float</span>        fill = 0.0;
00184   <span class="keywordtype">int</span>          j;
00185   <span class="keywordtype">int</span>          gap_count = 0;
00186   <span class="keywordtype">long</span>         nsamp, nfill;
00187   <span class="keywordtype">long</span>         nfill_max = 0l;
00188   <span class="keywordtype">long</span>         nsamp_this_scn = 0l;
00189   <span class="keywordtype">long</span>         this_size;
00190   <span class="keywordtype">double</span>       starttime, endtime; <span class="comment">/* times for current scn         */</span>
00191   <span class="keywordtype">double</span>       samprate;
00192   <span class="keywordtype">double</span>       AH_starttime;
00193   <span class="keyword">struct </span>tm    *time;
00194   time_t       ltime;
00195   <span class="keywordtype">char</span>         datatype; <span class="comment">/* 's' for short, 'l' for long */</span>
00196   <span class="keywordtype">char</span>         ahfile[<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a>];    <span class="comment">/* the name of the ah file */</span>
00197   
00198   <span class="keywordflow">if</span> ( (msg_p = getThis-&gt;<a class="code" href="structTRACE__REQ.html#m7">pBuf</a>) == NULL)   <span class="comment">/* pointer to first message */</span>
00199   {
00200     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_next: message buffer is NULL\n"</span>);
00201     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00202   }
00203   
00204   wf = (<a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *) msg_p;
00205   
00206   sprintf (ahfile, <span class="stringliteral">"%s/%s.%s.%s"</span>, AHDir, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00207 
00208   <span class="keywordflow">if</span> ( (fid = fopen(ahfile,<span class="stringliteral">"w+"</span>)) == NULL)
00209   {
00210     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_next: cannot create %s\n"</span>, ahfile);
00211     <span class="keywordflow">return</span>(EW_FAILURE);
00212   }
00213 
00214   <span class="keywordflow">if</span> (<a class="code" href="swap_8c.html#a4">WaveMsgMakeLocal</a>(wf) &lt; 0)
00215   {
00216     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_next: unknown trace data type: %s\n"</span>,
00217           wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>);
00218     <span class="keywordflow">return</span>( EW_FAILURE );
00219   }
00220 
00221   nsamp = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m1">nsamp</a>;
00222   starttime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m2">starttime</a>;
00223   endtime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m3">endtime</a>;
00224   samprate = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m4">samprate</a>;
00225   <span class="keywordflow">if</span> (samprate &lt; 0.01)
00226   {
00227     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"unreasonable samplerate (%f) for &lt;%s.%s.%s&gt;\n"</span>,
00228           samprate, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00229     <span class="keywordflow">return</span>( EW_FAILURE );
00230   }
00231   AH_starttime = starttime;
00232   datatype = <span class="charliteral">'n'</span>;
00233   <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'s'</span> || wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'i'</span>)
00234   {
00235     <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'2'</span>) datatype = <span class="charliteral">'s'</span>;
00236     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'4'</span>) datatype = <span class="charliteral">'l'</span>;
00237   }
00238   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'t'</span> || wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'f'</span>)
00239   {
00240     <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'4'</span>) datatype = <span class="charliteral">'f'</span>;
00241   }
00242   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'n'</span>)
00243   {
00244     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"AHPA_next: unsupported datatype: %s\n"</span>, datatype);
00245     <span class="keywordflow">return</span>( EW_FAILURE );
00246   }
00247 
00248   <span class="comment">/* loop through all the messages for this s-c-n */</span>
00249   <span class="keywordflow">while</span> (1) 
00250   {
00251     <span class="comment">/* advance message pointer to the data */</span>
00252     msg_p += <span class="keyword">sizeof</span>(TRACE_HEADER);
00253 
00254     <span class="comment">/* check for sufficient memory in output buffer */</span>
00255     this_size = (nsamp_this_scn + nsamp ) * <span class="keyword">sizeof</span>(float);
00256     <span class="keywordflow">if</span> ( OutBufferLen &lt; (this_size + (long)<span class="keyword">sizeof</span>(ahhed) ))
00257     {
00258       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"e"</span>, <span class="stringliteral">"out of space for &lt;%s.%s.%s&gt;; saving short trace.\n"</span>,
00259              wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00260       <span class="keywordflow">break</span>;
00261     }
00262   
00263     <span class="keywordflow">switch</span>( datatype )
00264     {
00265     <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
00266       s_data = (<span class="keywordtype">short</span> *)msg_p;
00267       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp ; j++, nsamp_this_scn++ )
00268         <a class="code" href="ahputaway_8c.html#a14">mydata</a>[nsamp_this_scn] = (float) s_data[j];
00269       msg_p += <span class="keyword">sizeof</span>(short) * nsamp;
00270       <span class="keywordflow">break</span>;
00271     <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00272       l_data = (<span class="keywordtype">long</span> *)msg_p;
00273       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp; j++, nsamp_this_scn++ )
00274         <a class="code" href="ahputaway_8c.html#a14">mydata</a>[nsamp_this_scn] = (float) l_data[j];
00275       msg_p += <span class="keyword">sizeof</span>(long) * nsamp;
00276       <span class="keywordflow">break</span>;
00277     <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00278       f_data = (<span class="keywordtype">float</span> *)msg_p;
00279       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp; j++, nsamp_this_scn++ )
00280         <a class="code" href="ahputaway_8c.html#a14">mydata</a>[nsamp_this_scn] = f_data[j];
00281       msg_p += <span class="keyword">sizeof</span>(float) * nsamp;
00282       <span class="keywordflow">break</span>;
00283     }
00284   
00285     <span class="comment">/* End-check based on length of snippet buffer */</span>
00286     <span class="keywordflow">if</span> ((long) msg_p &gt;= ((long) getThis-&gt;<a class="code" href="structTRACE__REQ.html#m15">actLen</a> + (long) getThis-&gt;<a class="code" href="structTRACE__REQ.html#m7">pBuf</a>)) 
00287     {
00288       <span class="keywordflow">if</span> (debug == 1)
00289         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Setting done for &lt;%s.%s.%s&gt;\n"</span>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, 
00290                wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00291       <span class="keywordflow">break</span>; <span class="comment">/* Break out of the while(1) loop 'cuz we're done */</span>
00292     }
00293   
00294     <span class="comment">/* msg_p has been advanced to the next TRACE_BUF; localize bytes *</span>
00295 <span class="comment">     * and check for gaps.                                           */</span>
00296     wf = (<a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *) msg_p;
00297     <span class="keywordflow">if</span> (<a class="code" href="swap_8c.html#a4">WaveMsgMakeLocal</a>(wf) &lt; 0)
00298     {
00299       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_next: unknown trace data type: %s\n"</span>,
00300             wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>);
00301       <span class="keywordflow">return</span>( EW_FAILURE );
00302     }
00303     nsamp = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m1">nsamp</a>;
00304     starttime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m2">starttime</a>; 
00305     <span class="comment">/* starttime is set for new packet; endtime is still set for old packet */</span>
00306     <span class="keywordflow">if</span> ( endtime + ( 1.0/samprate ) * GapThresh &lt; starttime ) 
00307     {
00308       <span class="comment">/* there's a gap, so fill it */</span>
00309       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"gap in %s.%s.%s: %lf: %lf\n"</span>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>,
00310             endtime, starttime - endtime);
00311       nfill = (long) (samprate * (starttime - endtime) - 1);
00312       <span class="keywordflow">if</span> ( (nsamp_this_scn + nfill) * (long)<span class="keyword">sizeof</span>(float) &gt; OutBufferLen ) 
00313       {
00314         <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, 
00315               <span class="stringliteral">"bogus gap (%d); skipping\n"</span>, nfill);
00316         <span class="keywordflow">return</span>(EW_FAILURE);
00317       }
00318       <span class="comment">/* do the filling */</span>
00319       <span class="keywordflow">for</span> ( j = 0; j &lt; nfill; j++, nsamp_this_scn ++ ) 
00320         <a class="code" href="ahputaway_8c.html#a14">mydata</a>[nsamp_this_scn] = fill;
00321       <span class="comment">/* keep track of how many gaps and the largest one */</span>
00322       gap_count++;
00323       <span class="keywordflow">if</span> (nfill_max &lt; nfill) 
00324         nfill_max = nfill;
00325     }
00326     <span class="comment">/* Advance endtime to the new packet;        *</span>
00327 <span class="comment">     * process this packet in the next iteration */</span>
00328     endtime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m3">endtime</a>;
00329   } <span class="comment">/* while(1) */</span>
00330 
00331   <span class="comment">/*  All data read.  Now fill in header and write AH file */</span>
00332   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a> = (long)nsamp_this_scn;  <span class="comment">/* samples in trace */</span>
00333   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m2">delta</a> = (float) (1.0/samprate);   <span class="comment">/* sample period */</span>
00334   ltime = (time_t)AH_starttime;
00335   <span class="comment">/* gmt time makes months from 0 - 11 */</span>
00336   time = gmtime( &amp;ltime );
00337   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m0">yr</a> = (short) (time-&gt;tm_year + 1900l);
00338   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m1">mo</a> = (short)(time-&gt;tm_mon + 1);  
00339   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m2">day</a> = (short)time-&gt;tm_mday;
00340   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m3">hr</a> = (short)time-&gt;tm_hour;
00341   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m4">mn</a> = (short)time-&gt;tm_min;
00342   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m5">sec</a> = (float)time-&gt;tm_sec + 
00343     (float)(starttime - (long)starttime);
00344   <a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a> = <a class="code" href="ahhead_8h.html#a12">FLOAT</a>;
00345 
00346   <span class="comment">/* set the maxamp value */</span>
00347   <span class="keywordflow">if</span> (<a class="code" href="ahputaway_8c.html#a36">maxamp</a>(AhHead, (<span class="keywordtype">char</span> *)mydata) &lt; 0)
00348   {
00349     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_next: bad data type for maxamp\n"</span>);
00350     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00351   }
00352 
00353   strcpy(<a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m0">code</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>);   <span class="comment">/* station name */</span>
00354   strcpy(<a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m1">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>);
00355 
00356   <span class="comment">/* here's a kludge using sensor type for network */</span>
00357   strcpy(<a class="code" href="ahputaway_8c.html#a13">AhHead</a>-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m2">stype</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00358   
00359   <span class="comment">/* Write an AH file */</span>
00360   xdrstdio_create(&amp;xdr, fid, XDR_ENCODE);
00361   <a class="code" href="ahputaway_8c.html#a42">xdr_putrecord</a>(AhHead, (<span class="keywordtype">char</span> *) mydata, &amp;xdr);
00362   fclose(fid);
00363   XDR_DESTROY(&amp;xdr);
00364   
00365   <span class="keywordflow">if</span> (gap_count) 
00366     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"AHPA_next: %d gaps; largest %ld for &lt;%s&gt;&lt;%s&gt;&lt;%s&gt;\n"</span>,
00367           gap_count, nfill_max, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00368 
00369   <span class="keywordflow">return</span>(EW_SUCCESS);
00370 }
00371 
00372 <span class="comment">/************************************************************************</span>
00373 <span class="comment">*       This is the Put Away end event routine. It's called after we've     *</span>
00374 <span class="comment">*       finished processing one event.                                  *</span>
00375 <span class="comment">*************************************************************************/</span>
<a name="l00376"></a><a class="code" href="ahputaway_8c.html#a51">00376</a> <span class="keywordtype">int</span> <a class="code" href="ahputaway_8c.html#a51">AHPA_end_ev</a> (<span class="keywordtype">int</span> debug)
00377 {
00378   <span class="comment">/* what else is there to do? */</span>
00379   <span class="keywordflow">return</span>( EW_SUCCESS );
00380 }
00381 
00382 
00383 <span class="comment">/************************************************************************</span>
00384 <span class="comment">*       This is the Put Away close routine. It's called after when      *</span>
00385 <span class="comment">*       we're being shut down.                                          *</span>
00386 <span class="comment">*************************************************************************/</span>
<a name="l00387"></a><a class="code" href="ahputaway_8c.html#a52">00387</a> <span class="keywordtype">int</span> <a class="code" href="ahputaway_8c.html#a52">AHPA_close</a> (<span class="keywordtype">int</span> debug)
00388 {
00389   free(AhHead);
00390   free(mydata);
00391 
00392   <span class="keywordflow">return</span>( EW_SUCCESS );
00393 }
00394 
00395 
00396 <span class="comment">/*      low level i/o routines for ah format records</span>
00397 <span class="comment"></span>
00398 <span class="comment"> *              -- witte        6 june 85</span>
00399 <span class="comment"> *</span>
00400 <span class="comment"> *      gethead routine was altered so it can read the ah structure </span>
00401 <span class="comment"> *      on a sun4 machine  - Mahdad Parsi June 4 1992.</span>
00402 <span class="comment"> */</span>
00403 
00404 <span class="comment">/* Function prototypes */</span>
00405 <span class="keywordtype">int</span>             <a class="code" href="ahputaway_8c.html#a33">get_null_head</a> (<a class="code" href="structahhed.html">ahhed</a> *);
00406 <span class="keywordtype">int</span>             <a class="code" href="ahputaway_8c.html#a47">xdr_ahhead</a>(XDR *, <a class="code" href="structahhed.html">ahhed</a> *);
00407 <span class="keyword">extern</span>  <span class="keywordtype">int</span>             <a class="code" href="ahputaway_8c.html#a53">isatty</a> (<span class="keywordtype">int</span>);
00408 
00409 <span class="comment">/* ah error processing */</span>
00410 
<a name="l00411"></a><a class="code" href="ahputaway_8c.html#a15">00411</a> <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a> = 0;
<a name="l00412"></a><a class="code" href="ahputaway_8c.html#a16">00412</a> <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a16">ah_nerr</a> = 10;
00413 
00414 <span class="comment">/* ah error numbers */</span>
<a name="l00415"></a><a class="code" href="ahputaway_8c.html#a1">00415</a> <span class="preprocessor">#define AE_RHED         1       </span><span class="comment">/* error reading header */</span>
<a name="l00416"></a><a class="code" href="ahputaway_8c.html#a2">00416</a> <span class="preprocessor">#define AE_DTYPE        2       </span><span class="comment">/* bad data type        */</span>
<a name="l00417"></a><a class="code" href="ahputaway_8c.html#a3">00417</a> <span class="preprocessor">#define AE_WHED         3       </span><span class="comment">/* error writing header */</span>
<a name="l00418"></a><a class="code" href="ahputaway_8c.html#a4">00418</a> <span class="preprocessor">#define AE_RDATA        4       </span><span class="comment">/* error reading data   */</span>
<a name="l00419"></a><a class="code" href="ahputaway_8c.html#a5">00419</a> <span class="preprocessor">#define AE_WDATA        5       </span><span class="comment">/* error writing data   */</span>
<a name="l00420"></a><a class="code" href="ahputaway_8c.html#a6">00420</a> <span class="preprocessor">#define AE_WRECORD      6       </span><span class="comment">/* error writing record */</span>
<a name="l00421"></a><a class="code" href="ahputaway_8c.html#a7">00421</a> <span class="preprocessor">#define AE_RRECORD      7       </span><span class="comment">/* error reading record */</span>
<a name="l00422"></a><a class="code" href="ahputaway_8c.html#a8">00422</a> <span class="preprocessor">#define AE_TTYOUT       8       </span><span class="comment">/* binary going to tty  */</span>
<a name="l00423"></a><a class="code" href="ahputaway_8c.html#a9">00423</a> <span class="preprocessor">#define AE_TTYIN        9       </span><span class="comment">/* binary coming from tty       */</span>
00424 
00425 <span class="comment">/* ah errlist */</span>
00426 
<a name="l00427"></a><a class="code" href="ahputaway_8c.html#a17">00427</a> <span class="keywordtype">char</span>    *<a class="code" href="ahputaway_8c.html#a17">ah_errlist</a>[] = {
00428   <span class="stringliteral">"no error"</span>,           <span class="comment">/* 0    no error        */</span>
00429   <span class="stringliteral">"read header error"</span>,  <span class="comment">/* 1    AE_RHED         */</span>
00430   <span class="stringliteral">"bad data type"</span>,      <span class="comment">/* 2    AE_DTYPE        */</span>
00431   <span class="stringliteral">"write header error"</span>, <span class="comment">/* 3    AE_WHED         */</span>
00432   <span class="stringliteral">"read data error"</span>,    <span class="comment">/* 4    AE_RDATA        */</span>
00433   <span class="stringliteral">"write data error"</span>,   <span class="comment">/* 5    AE_WDATA        */</span>
00434   <span class="stringliteral">"write record error"</span>, <span class="comment">/* 6    AE_WRECORD      */</span>
00435   <span class="stringliteral">"read record error"</span>,  <span class="comment">/* 7    AE_RRECORD      */</span>
00436   <span class="stringliteral">"tty can't get binary"</span>,       <span class="comment">/* 8    AE_TTYOUT       */</span>
00437   <span class="stringliteral">"tty can't send binary"</span>       <span class="comment">/* 9    AE_TTYIN        */</span>
00438 };
00439 
00440 <span class="comment">/*      gethead</span>
00441 <span class="comment"> *              gets the next header from the stream pointed to by</span>
00442 <span class="comment"> *              file_pt and returns this header in the structure head.</span>
00443 <span class="comment"> *              file_pt is assumed to be positioned at the next header,</span>
00444 <span class="comment"> *              and does not search.</span>
00445 <span class="comment"> *</span>
00446 <span class="comment"> *      added:  Reads the input fiule byte by byte and sets the appropriate</span>
00447 <span class="comment"> *              structure fields in the ah header. June 4 1992.</span>
00448 <span class="comment"> *</span>
00449 <span class="comment"> *      returns:</span>
00450 <span class="comment"> *                      1               -&gt;      no error</span>
00451 <span class="comment"> *                      -1              -&gt;      not enough head to read</span>
00452 <span class="comment"> *                      -2              -&gt;      bad data type</span>
00453 <span class="comment"> */</span>
<a name="l00454"></a><a class="code" href="ahputaway_8c.html#a18">00454</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a18">gethead</a>(<a class="code" href="structahhed.html">ahhed</a> *head, FILE *file_pt)
00455 {
00456   <span class="keywordtype">int</span>   ierr=0,    <span class="comment">/* error indicator */</span>
00457     i;         <span class="comment">/* counter variable */</span>
00458   <span class="keywordtype">int</span>     sizefloat,  <span class="comment">/* sizeofloat()  */</span>
00459     sizedouble,  <span class="comment">/* sizeodouble()  */</span>
00460     sizelong,  <span class="comment">/* sizeolong()  */</span>
00461     sizeshort;  <span class="comment">/* sizeoshort()  */</span>
00462 
00463   sizedouble = <span class="keyword">sizeof</span>(double) ;
00464   sizelong = <span class="keyword">sizeof</span>(long) ;
00465   sizefloat = <span class="keyword">sizeof</span>(float) ;
00466   sizeshort = <span class="keyword">sizeof</span>(short) ;
00467         
00468   <span class="comment">/* station info */</span>
00469   <span class="keywordflow">if</span> ((ierr = fread(head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m0">code</a>, CODESIZE, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00470   <span class="keywordflow">if</span> ((ierr = fread(head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m1">chan</a>, CHANSIZE, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00471   <span class="keywordflow">if</span> ((ierr = fread(head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m2">stype</a>, STYPESIZE, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00472   <span class="keywordflow">if</span> ((ierr = fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m3">slat</a>, sizefloat, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00473   <span class="keywordflow">if</span> ((ierr = fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m4">slon</a>, sizefloat, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00474   <span class="keywordflow">if</span> ((ierr = fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m5">elev</a>, sizefloat, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00475   <span class="keywordflow">if</span> ((ierr = fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m6">DS</a>, sizefloat, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00476   <span class="keywordflow">if</span> ((ierr = fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m7">A0</a>, sizefloat, 1, file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00477   <span class="keywordflow">for</span> (i=0; i&lt; <a class="code" href="ahhead_8h.html#a11">NOCALPTS</a> ; i++) {
00478     <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m0">pole</a>.<a class="code" href="structcomplex.html#m0">r</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00479     <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m0">pole</a>.<a class="code" href="structcomplex.html#m1">i</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00480     <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m1">zero</a>.<a class="code" href="structcomplex.html#m0">r</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00481     <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m1">zero</a>.<a class="code" href="structcomplex.html#m1">i</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00482   } <span class="comment">/* for */</span>
00483 
00484   <span class="comment">/* event info */</span>
00485   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m0">lat</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00486   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m1">lon</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00487   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m2">dep</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00488   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m0">yr</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00489   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m1">mo</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00490   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m2">day</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00491   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m3">hr</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00492   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m4">mn</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00493   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m5">sec</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00494   <span class="keywordflow">if</span> ((ierr=fread(head-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m4">ecomment</a>,COMSIZE,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00495 
00496 
00497   <span class="comment">/* record info */</span>
00498   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00499   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>,sizelong,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00500   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m2">delta</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00501   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m3">maxamp</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00502   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m0">yr</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00503   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m1">mo</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00504   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m2">day</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00505   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m3">hr</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00506   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m4">mn</a>,sizeshort,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00507   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m5">sec</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00508   <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m5">rmin</a>,sizefloat,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00509   <span class="keywordflow">if</span> ((ierr=fread(head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m6">rcomment</a>,COMSIZE,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00510   <span class="keywordflow">if</span> ((ierr=fread(head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m7">log</a>,LOGSIZE,1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00511 
00512 
00513   <span class="comment">/* extra */</span>
00514   <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="ahhead_8h.html#a10">NEXTRAS</a> ; i++) {
00515     <span class="keywordflow">if</span> ((ierr=fread(&amp;head-&gt;<a class="code" href="structahhed.html#m3">extra</a>[i],sizefloat, 1,file_pt)) == -1) <span class="keywordflow">goto</span> CH4ERROR;
00516   }
00517 
00518 
00519   <span class="keywordflow">if</span>((head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a> &lt; <a class="code" href="ahhead_8h.html#a6">TYPEMIN</a>) || (head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a> &gt; <a class="code" href="ahhead_8h.html#a7">TYPEMAX</a>))
00520   {
00521     <a class="code" href="ahputaway_8c.html#a33">get_null_head</a>(head);
00522     ierr = -2;  
00523     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a2">AE_DTYPE</a>;
00524   }
00525 
00526  CH4ERROR:  <span class="keywordflow">if</span> (ierr == -1)
00527  {
00528    <a class="code" href="ahputaway_8c.html#a33">get_null_head</a>(head);
00529    ierr = -1;
00530    <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
00531  }
00532   <span class="keywordflow">return</span>(ierr);
00533 
00534 }
00535 
00536 
00537 
00538 <span class="comment">/*      puthead</span>
00539 <span class="comment"> *              writes the header head onto the stream pointed to by</span>
00540 <span class="comment"> *              file_pt.</span>
00541 <span class="comment"> *      returns:</span>
00542 <span class="comment"> *                      1               -&gt;      no error</span>
00543 <span class="comment"> *                      -1              -&gt;      error writing header</span>
00544 <span class="comment"> */</span>
<a name="l00545"></a><a class="code" href="ahputaway_8c.html#a19">00545</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a19">puthead</a> (<a class="code" href="structahhed.html">ahhed</a> *head, FILE *file_pt)
00546 {
00547   <span class="keywordtype">int</span>   ierr = 0;
00548 
00549   <span class="keywordflow">if</span>((ierr= fwrite((<span class="keywordtype">char</span> *)head,<span class="keyword">sizeof</span>(<a class="code" href="structahhed.html">ahhed</a>),1,file_pt)) != 1)
00550   {
00551     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a3">AE_WHED</a>;
00552     ierr= -1;
00553   }
00554   <span class="keywordflow">return</span>(ierr);
00555 }
00556 
00557 
00558 
00559 <span class="comment">/*      size</span>
00560 <span class="comment"> *              returns the size (in bytes) of the data type given by</span>
00561 <span class="comment"> *              head-&gt;record.type.</span>
00562 <span class="comment"> *      returns:</span>
00563 <span class="comment"> *                      size of data type       -&gt;      no error</span>
00564 <span class="comment"> *                      -1                      -&gt;      unknown data type</span>
00565 <span class="comment"> */</span>
<a name="l00566"></a><a class="code" href="ahputaway_8c.html#a20">00566</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a20">size</a> (<a class="code" href="structahhed.html">ahhed</a> *head)
00567 {
00568   <span class="keywordtype">int</span>   type_size = 0;
00569 
00570   <span class="keywordflow">switch</span>(head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>)
00571   {
00572   <span class="keywordflow">case</span> 1:               <span class="comment">/* real time series */</span>
00573     type_size= <span class="keyword">sizeof</span>(float);
00574     <span class="keywordflow">break</span>;
00575   <span class="keywordflow">case</span> 2:               <span class="comment">/* complex time series */</span>
00576     type_size= <span class="keyword">sizeof</span>(complex);
00577     <span class="keywordflow">break</span>;
00578   <span class="keywordflow">case</span> 3:               <span class="comment">/* real x,y pairs */</span>
00579     type_size= <span class="keyword">sizeof</span>(vector);
00580     <span class="keywordflow">break</span>;
00581   <span class="keywordflow">case</span> 4:               <span class="comment">/* x real, y complex, or real x,y,z */</span>
00582     type_size= <span class="keyword">sizeof</span>(tensor);
00583     <span class="keywordflow">break</span>;
00584   <span class="keywordflow">case</span> 5:               <span class="comment">/* complex x,y pairs */</span>
00585     type_size= 2*<span class="keyword">sizeof</span>(complex);
00586     <span class="keywordflow">break</span>;
00587   <span class="keywordflow">case</span> 6:               <span class="comment">/* double */</span>
00588     type_size=<span class="keyword">sizeof</span>(double);
00589     <span class="keywordflow">break</span>;
00590   <span class="keywordflow">default</span>:      <span class="comment">/* unknown data type */</span>
00591     type_size= -1;
00592     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a2">AE_DTYPE</a>;
00593     <span class="keywordflow">break</span>;
00594   }
00595   <span class="keywordflow">return</span>(type_size);
00596 }
00597 
00598 
00599 <span class="comment">/*      tohead</span>
00600 <span class="comment"> *              positions the read/write head to the beginning of the</span>
00601 <span class="comment"> *              n-th header in the file pointed to by file_pt.</span>
00602 <span class="comment"> *      returns:</span>
00603 <span class="comment"> *                      n       -&gt;      no error</span>
00604 <span class="comment"> *                      -1      -&gt;      not enough heads</span>
00605 <span class="comment"> *                      -2      -&gt;      bad seek</span>
00606 <span class="comment"> */</span>
<a name="l00607"></a><a class="code" href="ahputaway_8c.html#a21">00607</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a21">tohead</a> (<span class="keywordtype">int</span> n, FILE *file_pt)
00608 {
00609   <a class="code" href="structahhed.html">ahhed</a> head;
00610   <span class="keywordtype">int</span>   i,ierr;
00611 
00612   rewind(file_pt);
00613   <span class="keywordflow">for</span>(i=1; i&lt;n; ++i)
00614   {
00615     <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a18">gethead</a>(&amp;head,file_pt) == 1)
00616     {
00617       <span class="keywordflow">if</span>(fseek(file_pt,(<span class="keywordtype">long</span>)(head.<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>)*(<a class="code" href="ahputaway_8c.html#a20">size</a>(&amp;head)),1) == -1)
00618       {
00619         ierr = -2;      <span class="comment">/* bad seek */</span>
00620         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
00621         <span class="keywordflow">return</span>(ierr);
00622       }
00623     }
00624     <span class="keywordflow">else</span>
00625     {
00626       ierr = -1;        <span class="comment">/* not enough head */</span>
00627       <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
00628       <span class="keywordflow">return</span>(ierr);
00629     }
00630   }
00631   <span class="keywordflow">return</span>(i);    <span class="comment">/* success */</span>
00632 }
00633 
00634 
00635 
00636 <span class="comment">/*      getdata</span>
00637 <span class="comment"> *              reads from the file pointed to by file_pt into</span>
00638 <span class="comment"> *              the array pointed to by array.  It assumes that</span>
00639 <span class="comment"> *              the read/write head is positioned correctly </span>
00640 <span class="comment"> *              (i.e., right after the header), and does not</span>
00641 <span class="comment"> *              search.  Works for any allowed data type.</span>
00642 <span class="comment"> *      returns:</span>
00643 <span class="comment"> *                      number of elements read -&gt;      OK</span>
00644 <span class="comment"> *                      -1                      -&gt;      error</span>
00645 <span class="comment"> */</span>
<a name="l00646"></a><a class="code" href="ahputaway_8c.html#a22">00646</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a22">getdata</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, FILE *file_pt)
00647 {
00648   <span class="keywordtype">int</span> ierr = 0;
00649 
00650   <span class="keywordflow">if</span>((ierr = fread(array,<a class="code" href="ahputaway_8c.html#a20">size</a>(head),(<span class="keywordtype">int</span>)head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>,file_pt)) != (int)head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>)
00651   {
00652     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
00653     ierr = -1;
00654   }
00655 
00656   <span class="keywordflow">return</span>(ierr);
00657 }
00658 
00659 
00660 <span class="comment">/*      putdata</span>
00661 <span class="comment"> *              writes array to the file pointed to by</span>
00662 <span class="comment"> *              file_pt.  Works for any allowed data type.</span>
00663 <span class="comment"> *      returns:</span>
00664 <span class="comment"> *                      number of elements written      -&gt;      OK</span>
00665 <span class="comment"> *                      -1                      -&gt;      error</span>
00666 <span class="comment"> */</span>
<a name="l00667"></a><a class="code" href="ahputaway_8c.html#a23">00667</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a23">putdata</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, FILE *file_pt)
00668 {
00669   <span class="keywordtype">int</span>   ierr = 0;
00670 
00671   <span class="keywordflow">if</span>((ierr = fwrite(array,<a class="code" href="ahputaway_8c.html#a20">size</a>(head),(<span class="keywordtype">int</span>)head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>,file_pt)) != (int)head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>)
00672   {
00673     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a5">AE_WDATA</a>;
00674     ierr = -1;
00675   }
00676   <span class="keywordflow">return</span>(ierr);
00677 }
00678 
00679 
00680 <span class="comment">/*      putrecord</span>
00681 <span class="comment"> *              writes head and array to the file pointed to by</span>
00682 <span class="comment"> *              file_pt.  Works for any allowed data type.</span>
00683 <span class="comment"> *      returns:</span>
00684 <span class="comment"> *                      0       -&gt;      OK</span>
00685 <span class="comment"> *                      -1      -&gt;      error writing header</span>
00686 <span class="comment"> *                      -2      -&gt;      error writing data</span>
00687 <span class="comment"> */</span>
<a name="l00688"></a><a class="code" href="ahputaway_8c.html#a24">00688</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a24">putrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, FILE *file_pt)
00689 {
00690   <span class="keywordtype">int</span>   ierr = 0;
00691 
00692   (<a class="code" href="ahputaway_8c.html#a19">puthead</a>(head,file_pt) == 1) ? ((<a class="code" href="ahputaway_8c.html#a23">putdata</a>(head,array,file_pt) &lt; 0) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
00693   <span class="keywordflow">if</span>(ierr)
00694     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a6">AE_WRECORD</a>;
00695 
00696   <span class="keywordflow">return</span>(ierr);
00697 }
00698 
00699 
00700 <span class="comment">/*      getrecord</span>
00701 <span class="comment"> *              gets header and data from the file pointed to by</span>
00702 <span class="comment"> *              file_pt and puts them in head and array.  It assumes</span>
00703 <span class="comment"> *              that the read/write head is positioned at the beginning</span>
00704 <span class="comment"> *              of the header, and does not search.  Obviously, calling</span>
00705 <span class="comment"> *              routine must have allocated enough space.</span>
00706 <span class="comment"> *      returns:</span>
00707 <span class="comment"> *                      0       -&gt;      OK</span>
00708 <span class="comment"> *                      -1      -&gt;      error reading header</span>
00709 <span class="comment"> *                      -2      -&gt;      error reading data</span>
00710 <span class="comment"> */</span>
<a name="l00711"></a><a class="code" href="ahputaway_8c.html#a25">00711</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a25">getrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, FILE *file_pt)
00712 {
00713   <span class="keywordtype">int</span>   ierr = 0;
00714 
00715   (<a class="code" href="ahputaway_8c.html#a18">gethead</a>(head,file_pt) == 1) ? ((<a class="code" href="ahputaway_8c.html#a22">getdata</a>(head,array,file_pt) &lt; 0) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
00716   <span class="keywordflow">if</span>(ierr)
00717     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a7">AE_RRECORD</a>;
00718   <span class="keywordflow">return</span>(ierr);
00719 }
00720 
00721 <span class="comment">/*</span>
00722 <span class="comment"> *      getrecord2</span>
00723 <span class="comment"> *              gets header and data from the file pointed to by</span>
00724 <span class="comment"> *              file_pt and puts them in head and array.  It assumes</span>
00725 <span class="comment"> *              that the read/write head is positioned at the beginning</span>
00726 <span class="comment"> *              of the header, and does not search (although it does</span>
00727 <span class="comment"> *              some error checking).  Space for array is allocated, so</span>
00728 <span class="comment"> *              be sure to pass a pointer to the data pointer. Got it?</span>
00729 <span class="comment"> *      returns:</span>
00730 <span class="comment"> *                      0       -&gt;      ok</span>
00731 <span class="comment"> *                      -1      -&gt;      error reading record</span>
00732 <span class="comment"> *                      -2      -&gt;      error allocating space for data</span>
00733 <span class="comment"> */</span>
<a name="l00734"></a><a class="code" href="ahputaway_8c.html#a26">00734</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a26">getrecord2</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> **array, FILE *file_pt)
00735 {
00736   <span class="keywordtype">int</span>   ierr = 0;
00737   <span class="keywordtype">int</span>   <a class="code" href="ahputaway_8c.html#a18">gethead</a>();
00738   <span class="keywordtype">char</span>  *<a class="code" href="ahputaway_8c.html#a32">mkdatspace</a>();
00739 
00740   <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a18">gethead</a>(head, file_pt) != 1) {
00741     ierr = -1;
00742     <span class="keywordflow">return</span>(ierr);
00743   }
00744 
00745   *array= <a class="code" href="ahputaway_8c.html#a32">mkdatspace</a>(head);
00746   <span class="keywordflow">if</span>(*array == NULL) {
00747     ierr= -2;
00748     <span class="keywordflow">return</span>(ierr);
00749   }
00750 
00751   <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a22">getdata</a>(head,*array,file_pt) &lt; 0)
00752     ierr= -1;
00753 
00754   <span class="keywordflow">return</span>(ierr);
00755 }
00756 
00757 
00758 <span class="comment">/*      gogethead</span>
00759 <span class="comment"> *              gets n-th header from the stream pointed to by</span>
00760 <span class="comment"> *              file_pt and returns this header in the structure</span>
00761 <span class="comment"> *              head.</span>
00762 <span class="comment"> *      returns:</span>
00763 <span class="comment"> *                      0       -&gt;      OK</span>
00764 <span class="comment"> *                      -1      -&gt;      stream not long enough</span>
00765 <span class="comment"> *                      -2      -&gt;      error reading header</span>
00766 <span class="comment"> */</span>
<a name="l00767"></a><a class="code" href="ahputaway_8c.html#a27">00767</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a27">gogethead</a> (<span class="keywordtype">int</span> n, <a class="code" href="structahhed.html">ahhed</a> *head, FILE *file_pt)
00768 {
00769   <span class="keywordtype">int</span>   ierr = 0;
00770 
00771   (<a class="code" href="ahputaway_8c.html#a21">tohead</a>(n,file_pt) == n) ? ((<a class="code" href="ahputaway_8c.html#a18">gethead</a>(head,file_pt) &lt; 1) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
00772   <span class="keywordflow">return</span>(ierr);
00773 }
00774 
00775 
00776 <span class="comment">/*      gogetrecord</span>
00777 <span class="comment"> *              gets n-th record (header and data) from the stream</span>
00778 <span class="comment"> *              pointed to by file_pt and places it in head and array.</span>
00779 <span class="comment"> *              Calling routine must allocate enough space.</span>
00780 <span class="comment"> *      returns:</span>
00781 <span class="comment"> *                      0       -&gt;      OK</span>
00782 <span class="comment"> *                      -1      -&gt;      stream not long enough</span>
00783 <span class="comment"> *                      -2      -&gt;      error reading record</span>
00784 <span class="comment"> */</span>
<a name="l00785"></a><a class="code" href="ahputaway_8c.html#a28">00785</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a28">gogetrecord</a> (<span class="keywordtype">int</span> n, <a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, FILE *file_pt)
00786 {
00787   <span class="keywordtype">int</span>   ierr = 0;
00788 
00789   (<a class="code" href="ahputaway_8c.html#a21">tohead</a>(n,file_pt) == n) ? ((<a class="code" href="ahputaway_8c.html#a25">getrecord</a>(head,array,file_pt) &lt; 0) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
00790   <span class="keywordflow">return</span>(ierr);
00791 }
00792 
00793 <span class="comment">/* logger adds a 10 character comment to the log section of the header</span>
00794 <span class="comment"> * comment should be passed as a character pointer must be terminated</span>
00795 <span class="comment"> * by a ';' and a `/0`</span>
00796 <span class="comment"> * returns:</span>
00797 <span class="comment"> *      logger =  0  -&gt; log info added to header structure</span>
00798 <span class="comment"> *      logger = -1  -&gt; no ';', added</span>
00799 <span class="comment"> *      logger = -2  -&gt; input string greater than LOGENT</span>
00800 <span class="comment"> *                      input truncated to allowable limit</span>
00801 <span class="comment"> *      logger = -3  -&gt; attempt to make log string greater than LOGSIZE</span>
00802 <span class="comment"> *                      input comment truncated to fit </span>
00803 <span class="comment"> *</span>
00804 <span class="comment"> *                      written by Tom Boyd   6/10/85</span>
00805 <span class="comment"> */</span>
00806 
<a name="l00807"></a><a class="code" href="ahputaway_8c.html#a29">00807</a> <span class="keyword">static</span>  <span class="keywordtype">int</span> <a class="code" href="ahputaway_8c.html#a29">logger</a> (<span class="keywordtype">char</span> *char_pt, <a class="code" href="structahhed.html">ahhed</a> *head_pt)
00808 {
00809   <span class="keywordtype">int</span> org,in,err,diff;
00810   <span class="keywordtype">char</span> *strncat();
00811 
00812   err=0;
00813 
00814   <span class="comment">/* find length of log array and input array  */</span>
00815 
00816   org=strlen(head_pt-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m7">log</a>);  <span class="comment">/*log array*/</span>
00817   in=strlen(char_pt);  <span class="comment">/*input array*/</span>
00818 
00819   <span class="comment">/* check for a terminating ':' in the input array */</span>
00820 
00821   <span class="keywordflow">if</span>(*(char_pt+in-1) != <span class="charliteral">';'</span>)
00822   {                   <span class="comment">/* no semicolon----add it*/</span>
00823     err=(-1);
00824     *(char_pt+in)=<span class="charliteral">';'</span>;
00825     *(char_pt+in+1)=<span class="charliteral">'\0'</span>;
00826     in+=1;
00827   }
00828 
00829   <span class="comment">/* check the length of the input array */</span>
00830 
00831   <span class="keywordflow">if</span>(in &gt; <a class="code" href="ahhead_8h.html#a9">LOGENT</a>)
00832   {                  <span class="comment">/* entry length too long-----truncate it*/</span>
00833     err=(-2);
00834     *(char_pt+<a class="code" href="ahhead_8h.html#a9">LOGENT</a>-1)=<span class="charliteral">';'</span>;
00835     *(char_pt+<a class="code" href="ahhead_8h.html#a9">LOGENT</a>)=<span class="charliteral">'\0'</span>;
00836     in=<a class="code" href="ahhead_8h.html#a9">LOGENT</a>;
00837   }
00838 
00839   <span class="comment">/* check combined length of array and new input and add it */</span>
00840 
00841   diff=<a class="code" href="ahhead_8h.html#a8">LOGSIZE</a>-(org+in);
00842   <span class="keywordflow">if</span>(diff == -in) <span class="keywordflow">return</span>(-3);  <span class="comment">/* no room left in log array */</span>
00843   <span class="keywordflow">if</span>(diff &lt; 0)diff*=(-1),err=(-3);  <span class="comment">/*partial room left----use it */</span>    
00844   strncat(head_pt-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m7">log</a>,char_pt,diff); <span class="comment">/* cat two strings */</span>
00845 
00846   <span class="keywordflow">return</span>(err);
00847 }
00848 
00849 
00850 
00851 <span class="comment">/*      out_is_tty</span>
00852 <span class="comment"> *              determines whether stdout is being sent to screen.</span>
00853 <span class="comment"> *      returns:</span>
00854 <span class="comment"> *                      0       -&gt;      stdout is not tty</span>
00855 <span class="comment"> *                      1       -&gt;      stdout is tty</span>
00856 <span class="comment"> */</span>
<a name="l00857"></a><a class="code" href="ahputaway_8c.html#a30">00857</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a30">out_is_tty</a> (<span class="keywordtype">void</span>)
00858 {
00859 
00860   <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a53">isatty</a>(1)) <span class="comment">/* sun specific --- stdout */</span>
00861   {
00862     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a8">AE_TTYOUT</a>;
00863     <span class="keywordflow">return</span>(1);
00864   }
00865   <span class="keywordflow">return</span>(0);
00866 }
00867 
00868 
00869 <span class="comment">/*      in_is_tty</span>
00870 <span class="comment"> *              determines whether stdin is tty</span>
00871 <span class="comment"> *      returns:</span>
00872 <span class="comment"> *                      0       -&gt;      stdin is not tty</span>
00873 <span class="comment"> *                      1       -&gt;      stdin is tty</span>
00874 <span class="comment"> */</span>
<a name="l00875"></a><a class="code" href="ahputaway_8c.html#a31">00875</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a31">in_is_tty</a> (<span class="keywordtype">void</span>)
00876 {
00877 
00878   <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a53">isatty</a>(0)) <span class="comment">/* sun specific --- stdin */</span>
00879   {
00880     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a9">AE_TTYIN</a>;
00881     <span class="keywordflow">return</span>(1);
00882   }
00883   <span class="keywordflow">return</span>(0);
00884 }
00885 
00886 
00887 <span class="comment">/*      mkdatspace</span>
00888 <span class="comment"> *              allocates enough space for the data array, and</span>
00889 <span class="comment"> *              returns a pointer to the memory location, or</span>
00890 <span class="comment"> *              NULL if failure.</span>
00891 <span class="comment"> *      returns:</span>
00892 <span class="comment"> *                      character pointer       -&gt;      success</span>
00893 <span class="comment"> *                      NULL                    -&gt;      failure</span>
00894 <span class="comment"> */</span>
<a name="l00895"></a><a class="code" href="ahputaway_8c.html#a32">00895</a> <span class="keyword">static</span>  <span class="keywordtype">char</span> *<a class="code" href="ahputaway_8c.html#a32">mkdatspace</a>(<a class="code" href="structahhed.html">ahhed</a> *head)
00896 {
00897   <span class="comment">/*      dont redefine calloc (NT doesn't like it), return the type expected</span>
00898 <span class="comment">          withers 9/98</span>
00899 <span class="comment"></span>
00900 <span class="comment">          char  *calloc();</span>
00901 <span class="comment">        </span>
00902 <span class="comment">          return(calloc((unsigned)head-&gt;record.ndata,(unsigned)size(head)));</span>
00903 <span class="comment">  */</span>
00904   <span class="keywordflow">return</span>((<span class="keywordtype">char</span> *)calloc((<span class="keywordtype">unsigned</span>)head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>,(<span class="keywordtype">unsigned</span>)<a class="code" href="ahputaway_8c.html#a20">size</a>(head)));
00905 }
00906 
00907 
00908 
<a name="l00909"></a><a class="code" href="ahputaway_8c.html#a33">00909</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="ahputaway_8c.html#a33">get_null_head</a> (<a class="code" href="structahhed.html">ahhed</a> *hed)
00910 {
00911   <span class="keywordtype">int</span>   i;
00912   <span class="keywordtype">char</span>  *strcpy();
00913 
00914   strcpy(hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m0">code</a>,<span class="stringliteral">"null"</span>);
00915   strcpy(hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m1">chan</a>,<span class="stringliteral">"null"</span>);
00916   strcpy(hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m2">stype</a>,<span class="stringliteral">"null"</span>);
00917   hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m3">slat</a>= 0.0;
00918   hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m4">slon</a>= 0.0;
00919   hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m5">elev</a>= 0.0;
00920   hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m6">DS</a>= 0.0;
00921   hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m7">A0</a>= 0.0;
00922   <span class="keywordflow">for</span>(i=0; i&lt; <a class="code" href="ahhead_8h.html#a11">NOCALPTS</a>; ++i)
00923   {
00924     hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m0">pole</a>.<a class="code" href="structcomplex.html#m0">r</a>= 0.0;
00925     hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m0">pole</a>.<a class="code" href="structcomplex.html#m1">i</a>= 0.0;
00926     hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m1">zero</a>.<a class="code" href="structcomplex.html#m0">r</a>= 0.0;
00927     hed-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[i].<a class="code" href="structcalib.html#m1">zero</a>.<a class="code" href="structcomplex.html#m1">i</a>= 0.0;
00928   }
00929 
00930   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m0">lat</a>= 0.0;
00931   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m1">lon</a>= 0.0;
00932   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m2">dep</a>= 0.0;
00933   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m0">yr</a>= (short)0;
00934   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m1">mo</a>= (short)0;
00935   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m2">day</a>= (short)0;
00936   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m3">hr</a>= (short)0;
00937   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m4">mn</a>= (short)0;
00938   hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m5">sec</a>= 0.0;
00939   strcpy(hed-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m4">ecomment</a>,<span class="stringliteral">"null"</span>);
00940 
00941   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>= (short)0;
00942   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>= 0L;
00943   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m2">delta</a>= 0.0;
00944   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m3">maxamp</a>= 0.0;
00945   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m0">yr</a>= (short)0;
00946   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m1">mo</a>= (short)0;
00947   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m2">day</a>= (short)0;
00948   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m3">hr</a>= (short)0;
00949   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m4">mn</a>= (short)0;
00950   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m5">sec</a>= 0.0;
00951   hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m5">rmin</a>= 0.0;
00952   strcpy(hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m6">rcomment</a>,<span class="stringliteral">"null"</span>);
00953   strcpy(hed-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m7">log</a>,<span class="stringliteral">"null"</span>);
00954 
00955   <span class="keywordflow">for</span>(i=0; i&lt; <a class="code" href="ahhead_8h.html#a10">NEXTRAS</a>; ++i)
00956     hed-&gt;<a class="code" href="structahhed.html#m3">extra</a>[i]= 0.0;
00957 
00958   <span class="keywordflow">return</span> 0;
00959 }
00960 
00961 <span class="comment">/* acpy(from,to,nbytes) copies nbytes from the array "from" to the</span>
00962 <span class="comment"> *      array "to".</span>
00963 <span class="comment"> */</span>
<a name="l00964"></a><a class="code" href="ahputaway_8c.html#a34">00964</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="ahputaway_8c.html#a34">acpy</a> (<span class="keywordtype">char</span> *from, <span class="keywordtype">char</span> *to, <span class="keywordtype">unsigned</span> nbytes)
00965 {
00966   <span class="keywordflow">while</span>(nbytes--)
00967     *from++ = *to++;
00968   <span class="keywordflow">return</span> 0;
00969 }
00970 
00971 
00972 <span class="comment">/* print ah format error message and die */</span>
<a name="l00973"></a><a class="code" href="ahputaway_8c.html#a35">00973</a> <span class="keyword">static</span>  <span class="keywordtype">void</span> <a class="code" href="ahputaway_8c.html#a35">ah_error</a> (<span class="keywordtype">char</span> *s1, <span class="keywordtype">char</span> *s2, <span class="keywordtype">int</span> status)
00974 {
00975   fprintf(stderr,s1,s2);
00976   <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a15">ah_errno</a> &gt; 0 &amp;&amp; <a class="code" href="ahputaway_8c.html#a15">ah_errno</a> &lt; <a class="code" href="ahputaway_8c.html#a16">ah_nerr</a>)
00977     fprintf(stderr,<span class="stringliteral">" (%s)"</span>,ah_errlist[ah_errno]);
00978   fprintf(stderr,<span class="stringliteral">"\n"</span>);
00979   exit(status);
00980 }
00981 
00982 <span class="preprocessor">#ifndef MAX</span>
<a name="l00983"></a><a class="code" href="ahputaway_8c.html#a10">00983</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX(a,b)        (((a) &gt; (b)) ? (a) : (b))</span>
00984 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00985 <span class="preprocessor"></span><span class="preprocessor">#ifndef MIN</span>
<a name="l00986"></a><a class="code" href="ahputaway_8c.html#a11">00986</a> <span class="preprocessor"></span><span class="preprocessor">#define MIN(a,b)        (((a) &lt; (b)) ? (a) : (b))</span>
00987 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00988 <span class="preprocessor"></span>
00989 <span class="comment">/*</span>
00990 <span class="comment"> *      maxamp</span>
00991 <span class="comment"> *              determines the maximum absolute amplitude of the data array, and</span>
00992 <span class="comment"> *              places that number in head.record.maxamp.</span>
00993 <span class="comment"> *      returns:</span>
00994 <span class="comment"> *                      0       -&gt;      ok</span>
00995 <span class="comment"> *                      -1      -&gt;      error</span>
00996 <span class="comment"> */</span>
<a name="l00997"></a><a class="code" href="ahputaway_8c.html#a36">00997</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a36">maxamp</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *data)
00998 {
00999   <span class="keywordtype">float</span> *fpt;
01000   <span class="keywordtype">double</span> *dpt, dmin, dmax;
01001   <span class="keywordtype">float</span> max,<a class="code" href="socket__ew_8h.html#a3">min</a>;
01002   <span class="keywordtype">long</span>  n_data_pts;
01003 
01004   <span class="keywordflow">switch</span>(head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>)
01005   {
01006   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a12">FLOAT</a>:
01007     n_data_pts= head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>;
01008     <span class="keywordflow">break</span>;
01009   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a13">COMPLEX</a>:
01010   <span class="keywordflow">case</span> <a class="code" href="structVECTOR.html">VECTOR</a>:
01011     n_data_pts= 2 * head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>;
01012     <span class="keywordflow">break</span>;
01013   <span class="keywordflow">case</span> <a class="code" href="structTENSOR.html">TENSOR</a>:
01014     n_data_pts= 3 * head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>;
01015     <span class="keywordflow">break</span>;
01016   <span class="keywordflow">case</span> 5:
01017     n_data_pts= 4 * head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>;
01018     <span class="keywordflow">break</span>;
01019   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a16">DOUBLE</a>:
01020     n_data_pts= head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>;
01021     <span class="keywordflow">break</span>;
01022   <span class="keywordflow">default</span>:
01023     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a2">AE_DTYPE</a>;
01024     <span class="keywordflow">return</span>(-1);
01025     <span class="keywordflow">break</span>;
01026   }
01027 
01028   <span class="keywordflow">if</span> (head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a> == <a class="code" href="ahhead_8h.html#a16">DOUBLE</a>) {
01029     dpt= (<span class="keywordtype">double</span> *)data;
01030     dmax= dmin= *dpt;
01031     <span class="keywordflow">while</span>(n_data_pts--)
01032     {
01033       dmax= <a class="code" href="ahputaway_8c.html#a10">MAX</a>(dmax,*dpt);
01034       dmin= <a class="code" href="ahputaway_8c.html#a11">MIN</a>(dmin,*dpt);
01035       ++dpt;
01036     }
01037     ((fabs(dmax) &gt; fabs(dmin)) ? (head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m3">maxamp</a>= (float) dmax) : (head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m3">maxamp</a>= (float) -dmin));
01038   }
01039   <span class="keywordflow">else</span> {
01040     fpt= (<span class="keywordtype">float</span> *)data;
01041     max= <a class="code" href="socket__ew_8h.html#a3">min</a>= *fpt;
01042     <span class="keywordflow">while</span>(n_data_pts--)
01043     {
01044       max= <a class="code" href="ahputaway_8c.html#a10">MAX</a>(max,*fpt);
01045       <a class="code" href="socket__ew_8h.html#a3">min</a>= <a class="code" href="ahputaway_8c.html#a11">MIN</a>(min,*fpt);
01046       ++fpt;
01047     }
01048     ((fabs((<span class="keywordtype">double</span>)max) &gt; fabs((<span class="keywordtype">double</span>)min)) ? (head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m3">maxamp</a>= max) : (head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m3">maxamp</a>= -<a class="code" href="socket__ew_8h.html#a3">min</a>));
01049   }
01050 
01051   <span class="keywordflow">return</span>(0);
01052 }
01053 <span class="comment">/*      xdr_gethead</span>
01054 <span class="comment"> *              gets the next header from the xdr stream pointed to by</span>
01055 <span class="comment"> *              xdrs and returns this header in the structure head.</span>
01056 <span class="comment"> *              xdrs is assumed to be positioned at the next header,</span>
01057 <span class="comment"> *              and does not search.</span>
01058 <span class="comment"> *      returns:</span>
01059 <span class="comment"> *                      1               -&gt;      no error</span>
01060 <span class="comment"> *                      -1              -&gt;      not enough head to read</span>
01061 <span class="comment"> *                      -2              -&gt;      bad data type</span>
01062 <span class="comment"> */</span>
<a name="l01063"></a><a class="code" href="ahputaway_8c.html#a37">01063</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a37">xdr_gethead</a> (<a class="code" href="structahhed.html">ahhed</a> *head, XDR *xdrs)
01064 {
01065   <span class="keywordtype">int</span>   ierr = 0;
01066 
01067   <span class="keywordflow">if</span>((ierr = <a class="code" href="ahputaway_8c.html#a47">xdr_ahhead</a>(xdrs, head)) == 1)
01068   {
01069     <span class="keywordflow">if</span>((head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a> &lt; <a class="code" href="ahhead_8h.html#a6">TYPEMIN</a>) || (head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a> &gt; <a class="code" href="ahhead_8h.html#a7">TYPEMAX</a>))
01070     {
01071       <a class="code" href="ahputaway_8c.html#a33">get_null_head</a>(head);
01072       ierr = -2;        <span class="comment">/* bad data type */</span>
01073       <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a2">AE_DTYPE</a>;
01074     }
01075   }
01076   <span class="keywordflow">else</span>          <span class="comment">/* not enough head */</span>
01077   {
01078     <a class="code" href="ahputaway_8c.html#a33">get_null_head</a>(head);
01079     ierr = -1;
01080     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
01081   }
01082   <span class="keywordflow">return</span>(ierr);
01083 }
01084 
01085 
01086 
01087 <span class="comment">/*      xdr_puthead</span>
01088 <span class="comment"> *              writes the header head onto the xdr stream pointed to by</span>
01089 <span class="comment"> *              xdrs.</span>
01090 <span class="comment"> *      returns:</span>
01091 <span class="comment"> *                      1               -&gt;      no error</span>
01092 <span class="comment"> *                      -1              -&gt;      error writing header</span>
01093 <span class="comment"> */</span>
<a name="l01094"></a><a class="code" href="ahputaway_8c.html#a38">01094</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a38">xdr_puthead</a> (<a class="code" href="structahhed.html">ahhed</a> *head, XDR *xdrs)
01095 {
01096   <span class="keywordtype">int</span>   ierr = 0;
01097 
01098   <span class="keywordflow">if</span>((ierr= <a class="code" href="ahputaway_8c.html#a47">xdr_ahhead</a>(xdrs, head)) != 1)
01099   {
01100     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a3">AE_WHED</a>;
01101     ierr= -1;
01102   }
01103   <span class="keywordflow">return</span>(ierr);
01104 }
01105 
01106 
01107 
01108 <span class="comment">/*      xdr_tohead</span>
01109 <span class="comment"> *              positions the read/write head to the beginning of the</span>
01110 <span class="comment"> *              n-th header in the xdr stream pointed to by xdrs.</span>
01111 <span class="comment"> *      returns:</span>
01112 <span class="comment"> *                      n       -&gt;      no error</span>
01113 <span class="comment"> *                      -1      -&gt;      not enough heads</span>
01114 <span class="comment"> *                      -2      -&gt;      bad seek</span>
01115 <span class="comment"> */</span>
<a name="l01116"></a><a class="code" href="ahputaway_8c.html#a39">01116</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a39">xdr_tohead</a> (<span class="keywordtype">int</span> n, XDR *xdrs)
01117 {
01118   <a class="code" href="structahhed.html">ahhed</a> head;
01119   <span class="keywordtype">int</span>   i,ierr,j;
01120   <span class="keywordtype">float</span> float_dum;
01121   <span class="keywordtype">double</span>        double_dum;
01122   <a class="code" href="structcomplex.html">complex</a> complex_dum;
01123   <a class="code" href="structtensor.html">tensor</a>        tensor_dum;
01124 
01125   <span class="comment">/* be warned: the following xdr_setpos call may not work at all       */</span>
01126   <span class="comment">/* depending on the stream.  The use of 0 to get to the beginning     */</span>
01127   <span class="comment">/* works empirically, but is not documented  ... sigh - dws           */</span>
01128   xdr_setpos(xdrs, (u_int) 0);
01129 
01130   <span class="keywordflow">for</span>(i=1; i&lt;n; ++i)
01131   {
01132     <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a37">xdr_gethead</a>(&amp;head,xdrs) == 1)
01133     {
01134       <span class="keywordflow">switch</span> (head.<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>) {
01135       <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a12">FLOAT</a>:
01136         <span class="keywordflow">for</span> (j = 0; j &lt; head.<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; j++) {
01137           <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;float_dum)) {
01138             ierr = -2;  <span class="comment">/* bad seek */</span>
01139             <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
01140             <span class="keywordflow">return</span>(ierr);
01141           }
01142         }
01143 
01144         <span class="keywordflow">break</span>;
01145       <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a13">COMPLEX</a>:
01146       <span class="keywordflow">case</span> <a class="code" href="structVECTOR.html">VECTOR</a>:
01147         <span class="keywordflow">for</span> (j = 0; j &lt; head.<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; j++) {
01148           <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;complex_dum.<a class="code" href="structcomplex.html#m1">i</a>) ||
01149               !xdr_float(xdrs, &amp;complex_dum.<a class="code" href="structcomplex.html#m0">r</a>)) {
01150             ierr = -2;  <span class="comment">/* bad seek */</span>
01151             <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
01152             <span class="keywordflow">return</span>(ierr);
01153           }
01154         }
01155 
01156         <span class="keywordflow">break</span>;
01157       <span class="keywordflow">case</span> <a class="code" href="structTENSOR.html">TENSOR</a>:
01158         <span class="keywordflow">for</span> (j = 0; j &lt; head.<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; j++) {
01159           <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;tensor_dum.<a class="code" href="structtensor.html#m0">xx</a>) ||
01160               !xdr_float(xdrs, &amp;tensor_dum.<a class="code" href="structtensor.html#m1">yy</a>) ||
01161               !xdr_float(xdrs, &amp;tensor_dum.<a class="code" href="structtensor.html#m2">xy</a>)) {
01162             ierr = -2;  <span class="comment">/* bad seek */</span>
01163             <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
01164             <span class="keywordflow">return</span>(ierr);
01165           }
01166         }
01167         <span class="keywordflow">break</span>;
01168       <span class="keywordflow">case</span> 5:
01169         <span class="keywordflow">for</span> (j = 0; j &lt; 4 * head.<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; j++) {
01170           <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;float_dum)) {
01171             ierr = -2;  <span class="comment">/* bad seek */</span>
01172             <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
01173             <span class="keywordflow">return</span>(ierr);
01174           }
01175         }
01176         <span class="keywordflow">break</span>;
01177       <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a16">DOUBLE</a>:
01178         <span class="keywordflow">for</span> (j = 0; j &lt; head.<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; j++) {
01179           <span class="keywordflow">if</span> (!xdr_double(xdrs, &amp;double_dum)) {
01180             ierr = -2;  <span class="comment">/* bad seek */</span>
01181             <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
01182             <span class="keywordflow">return</span>(ierr);
01183           }
01184         }
01185         <span class="keywordflow">break</span>;
01186       <span class="keywordflow">default</span>:
01187         ierr = -2;      <span class="comment">/* bad seek */</span>
01188         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a2">AE_DTYPE</a>;
01189         <span class="keywordflow">return</span>(ierr);
01190       }
01191     }
01192     <span class="keywordflow">else</span>
01193     {
01194       ierr = -1;        <span class="comment">/* not enough head */</span>
01195       <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a1">AE_RHED</a>;
01196       <span class="keywordflow">return</span>(ierr);
01197     }
01198   }
01199   <span class="keywordflow">return</span>(i);    <span class="comment">/* success */</span>
01200 }
01201 
01202 
01203 
01204 <span class="comment">/*      xdr_getdata</span>
01205 <span class="comment"> *              reads from the xdr stream pointed to by xdrs into</span>
01206 <span class="comment"> *              the array pointed to by array.  It assumes that</span>
01207 <span class="comment"> *              the read/write head is positioned correctly </span>
01208 <span class="comment"> *              (i.e., right after the header), and does not</span>
01209 <span class="comment"> *              search.  Works for any allowed data type.</span>
01210 <span class="comment"> *      returns:</span>
01211 <span class="comment"> *                      number of elements read -&gt;      OK</span>
01212 <span class="comment"> *                      -1                      -&gt;      error</span>
01213 <span class="comment"> */</span>
<a name="l01214"></a><a class="code" href="ahputaway_8c.html#a40">01214</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a40">xdr_getdata</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, XDR *xdrs)
01215 {
01216   <span class="keywordtype">int</span> ierr = 0;
01217   <span class="keywordtype">float</span> *pfloat;
01218   <span class="keywordtype">double</span>        *pdouble;
01219   <a class="code" href="structcomplex.html">complex</a> *pcomplex;
01220   <a class="code" href="structtensor.html">tensor</a>        *ptensor;
01221   <span class="keywordtype">int</span> i;
01222 
01223   <span class="keywordflow">switch</span>(head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>) {
01224   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a12">FLOAT</a>:
01225     pfloat = (<span class="keywordtype">float</span> *) array;
01226     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01227       <span class="keywordflow">if</span> (! xdr_float(xdrs, pfloat++) ) {
01228         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01229         ierr = -1;
01230         <span class="keywordflow">return</span>(ierr);
01231       }
01232       ++ierr;
01233     }
01234     <span class="keywordflow">break</span>;
01235   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a13">COMPLEX</a>:
01236   <span class="keywordflow">case</span> <a class="code" href="structVECTOR.html">VECTOR</a>:
01237     pcomplex = (<a class="code" href="structcomplex.html">complex</a> *) array;
01238     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01239       <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;(pcomplex-&gt;<a class="code" href="structcomplex.html#m0">r</a>)) ||
01240           !xdr_float(xdrs, &amp;(pcomplex++-&gt;i))) {
01241         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01242         ierr = -1;
01243         <span class="keywordflow">return</span>(ierr);
01244       }
01245       ++ierr;
01246     }
01247     <span class="keywordflow">break</span>;
01248   <span class="keywordflow">case</span> <a class="code" href="structTENSOR.html">TENSOR</a>:
01249     ptensor = (<a class="code" href="structtensor.html">tensor</a> *) array;
01250     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01251       <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;(ptensor-&gt;<a class="code" href="structtensor.html#m0">xx</a>)) ||
01252           !xdr_float(xdrs, &amp;(ptensor-&gt;<a class="code" href="structtensor.html#m1">yy</a>)) ||
01253           !xdr_float(xdrs, &amp;(ptensor++-&gt;xy))) {
01254         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01255         ierr = -1;
01256         <span class="keywordflow">return</span>(ierr);
01257       }
01258       ++ierr;
01259     }
01260     <span class="keywordflow">break</span>;
01261   <span class="keywordflow">case</span> 5:
01262     pfloat = (<span class="keywordtype">float</span> *) array;
01263     <span class="keywordflow">for</span> (i = 0; i &lt; 4 * head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01264       <span class="keywordflow">if</span> (! xdr_float(xdrs, pfloat++) ) {
01265         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01266         ierr = -1;
01267         <span class="keywordflow">return</span>(ierr);
01268       }
01269       ++ierr;
01270     }
01271     <span class="keywordflow">break</span>;
01272   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a16">DOUBLE</a>:
01273     pdouble = (<span class="keywordtype">double</span> *) array;
01274     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01275       <span class="keywordflow">if</span> (! xdr_double(xdrs, pdouble++) ) {
01276         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01277         ierr = -1;
01278         <span class="keywordflow">return</span>(ierr);
01279       }
01280       ++ierr;
01281     }
01282     <span class="keywordflow">break</span>;
01283   <span class="keywordflow">default</span>:
01284     ierr = -1;
01285     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a2">AE_DTYPE</a>;
01286     <span class="keywordflow">return</span>(ierr);
01287   }
01288   <span class="keywordflow">return</span>(ierr);
01289 }
01290 
01291 
01292 <span class="comment">/*      xdr_putdata</span>
01293 <span class="comment"> *              writes array to the xdr stream pointed to by xdrs.</span>
01294 <span class="comment"> *              Works for any allowed data type.</span>
01295 <span class="comment"> *      returns:</span>
01296 <span class="comment"> *                      number of elements written      -&gt;      OK</span>
01297 <span class="comment"> *                      -1                      -&gt;      error</span>
01298 <span class="comment"> */</span>
<a name="l01299"></a><a class="code" href="ahputaway_8c.html#a41">01299</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a41">xdr_putdata</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, XDR *xdrs)
01300 {
01301   <span class="keywordtype">int</span>   ierr = 0;
01302   <span class="keywordtype">float</span> *pfloat;
01303   <span class="keywordtype">double</span>        *pdouble;
01304   <a class="code" href="structcomplex.html">complex</a> *pcomplex;
01305   <a class="code" href="structtensor.html">tensor</a>        *ptensor;
01306   <span class="keywordtype">int</span> i;
01307 
01308   <span class="keywordflow">switch</span>(head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>) {
01309   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a12">FLOAT</a>:
01310     pfloat = (<span class="keywordtype">float</span> *) array;
01311     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01312       <span class="keywordflow">if</span> (! xdr_float(xdrs, pfloat++) ) {
01313         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01314         ierr = -1;
01315         <span class="keywordflow">return</span>(ierr);
01316       }
01317       ++ierr;
01318     }
01319     <span class="keywordflow">break</span>;
01320   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a13">COMPLEX</a>:
01321   <span class="keywordflow">case</span> <a class="code" href="structVECTOR.html">VECTOR</a>:
01322     pcomplex = (<a class="code" href="structcomplex.html">complex</a> *) array;
01323     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01324       <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;(pcomplex-&gt;<a class="code" href="structcomplex.html#m0">r</a>)) ||
01325           !xdr_float(xdrs, &amp;(pcomplex++-&gt;i))) {
01326         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01327         ierr = -1;
01328         <span class="keywordflow">return</span>(ierr);
01329       }
01330       ++ierr;
01331     }
01332     <span class="keywordflow">break</span>;
01333   <span class="keywordflow">case</span> <a class="code" href="structTENSOR.html">TENSOR</a>:
01334     ptensor = (<a class="code" href="structtensor.html">tensor</a> *) array;
01335     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01336       <span class="keywordflow">if</span> (!xdr_float(xdrs, &amp;(ptensor-&gt;<a class="code" href="structtensor.html#m0">xx</a>)) ||
01337           !xdr_float(xdrs, &amp;(ptensor-&gt;<a class="code" href="structtensor.html#m1">yy</a>)) ||
01338           !xdr_float(xdrs, &amp;(ptensor++-&gt;xy))) {
01339         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01340         ierr = -1;
01341         <span class="keywordflow">return</span>(ierr);
01342       }
01343       ++ierr;
01344     }
01345     <span class="keywordflow">break</span>;
01346   <span class="keywordflow">case</span> 5:
01347     pfloat = (<span class="keywordtype">float</span> *) array;
01348     <span class="keywordflow">for</span> (i = 0; i &lt; 4 * head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01349       <span class="keywordflow">if</span> (! xdr_float(xdrs, pfloat++) ) {
01350         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01351         ierr = -1;
01352         <span class="keywordflow">return</span>(ierr);
01353       }
01354       ++ierr;
01355     }
01356     <span class="keywordflow">break</span>;
01357   <span class="keywordflow">case</span> <a class="code" href="ahhead_8h.html#a16">DOUBLE</a>:
01358     pdouble = (<span class="keywordtype">double</span> *) array;
01359     <span class="keywordflow">for</span> (i = 0; i &lt; head-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>; i++) {
01360       <span class="keywordflow">if</span> (! xdr_double(xdrs, pdouble++) ) {
01361         <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a4">AE_RDATA</a>;
01362         ierr = -1;
01363         <span class="keywordflow">return</span>(ierr);
01364       }
01365       ++ierr;
01366     }
01367     <span class="keywordflow">break</span>;
01368 
01369   <span class="keywordflow">default</span>:
01370     ierr = -1;
01371     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a2">AE_DTYPE</a>;
01372     <span class="keywordflow">return</span>(ierr);
01373   }
01374   <span class="keywordflow">return</span>(ierr);
01375 }
01376 
01377 
01378 <span class="comment">/*      xdr_putrecord</span>
01379 <span class="comment"> *              writes head and array to the xdr stream pointed to by xdrs.</span>
01380 <span class="comment"> *              Works for any allowed data type.</span>
01381 <span class="comment"> *      returns:</span>
01382 <span class="comment"> *                      0       -&gt;      OK</span>
01383 <span class="comment"> *                      -1      -&gt;      error writing header</span>
01384 <span class="comment"> *                      -2      -&gt;      error writing data</span>
01385 <span class="comment"> */</span>
<a name="l01386"></a><a class="code" href="ahputaway_8c.html#a42">01386</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a42">xdr_putrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, XDR *xdrs)
01387 {
01388   <span class="keywordtype">int</span>   ierr = 0;
01389 
01390   (<a class="code" href="ahputaway_8c.html#a38">xdr_puthead</a>(head,xdrs) == 1) ? ((<a class="code" href="ahputaway_8c.html#a41">xdr_putdata</a>(head,array,xdrs) &lt; 0) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
01391   <span class="keywordflow">if</span>(ierr)
01392     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a6">AE_WRECORD</a>;
01393 
01394   <span class="keywordflow">return</span>(ierr);
01395 }
01396 
01397 
01398 <span class="comment">/*      xdr_getrecord</span>
01399 <span class="comment"> *              gets header and data from the xdr stream pointed to by</span>
01400 <span class="comment"> *              xdrs and puts them in head and array.  It assumes</span>
01401 <span class="comment"> *              that the read/write head is positioned at the beginning</span>
01402 <span class="comment"> *              of the header, and does not search.  Obviously, calling</span>
01403 <span class="comment"> *              routine must have allocated enough space.</span>
01404 <span class="comment"> *      returns:</span>
01405 <span class="comment"> *                      0       -&gt;      OK</span>
01406 <span class="comment"> *                      -1      -&gt;      error reading header</span>
01407 <span class="comment"> *                      -2      -&gt;      error reading data</span>
01408 <span class="comment"> */</span>
<a name="l01409"></a><a class="code" href="ahputaway_8c.html#a43">01409</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a43">xdr_getrecord</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, XDR *xdrs)
01410 {
01411   <span class="keywordtype">int</span>   ierr = 0;
01412 
01413   (<a class="code" href="ahputaway_8c.html#a37">xdr_gethead</a>(head,xdrs) == 1) ? ((<a class="code" href="ahputaway_8c.html#a40">xdr_getdata</a>(head,array,xdrs) &lt; 0) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
01414   <span class="keywordflow">if</span>(ierr)
01415     <a class="code" href="ahputaway_8c.html#a15">ah_errno</a>= <a class="code" href="ahputaway_8c.html#a7">AE_RRECORD</a>;
01416   <span class="keywordflow">return</span>(ierr);
01417 }
01418 
01419 <span class="comment">/*</span>
01420 <span class="comment"> *      xdr_getrecord2</span>
01421 <span class="comment"> *              gets header and data from the xdr stream pointed to by</span>
01422 <span class="comment"> *              xdrs and puts them in head and array.  It assumes</span>
01423 <span class="comment"> *              that the read/write head is positioned at the beginning</span>
01424 <span class="comment"> *              of the header, and does not search (although it does</span>
01425 <span class="comment"> *              some error checking).  Space for array is allocated, so</span>
01426 <span class="comment"> *              be sure to pass a pointer to the data pointer. Got it?</span>
01427 <span class="comment"> *      returns:</span>
01428 <span class="comment"> *                      0       -&gt;      ok</span>
01429 <span class="comment"> *                      -1      -&gt;      error reading record</span>
01430 <span class="comment"> *                      -2      -&gt;      error allocating space for data</span>
01431 <span class="comment"> */</span>
<a name="l01432"></a><a class="code" href="ahputaway_8c.html#a44">01432</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a44">xdr_getrecord2</a> (<a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> **array, XDR *xdrs)
01433 {
01434   <span class="keywordtype">int</span>   ierr = 0;
01435   <span class="keywordtype">int</span>   <a class="code" href="ahputaway_8c.html#a37">xdr_gethead</a>();
01436   <span class="keywordtype">char</span>  *<a class="code" href="ahputaway_8c.html#a32">mkdatspace</a>();
01437 
01438   <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a37">xdr_gethead</a>(head, xdrs) != 1) {
01439     ierr = -1;
01440     <span class="keywordflow">return</span>(ierr);
01441   }
01442 
01443   *array= <a class="code" href="ahputaway_8c.html#a32">mkdatspace</a>(head);
01444   <span class="keywordflow">if</span>(*array == NULL)
01445   {
01446     ierr= -2;
01447     <span class="keywordflow">return</span>(ierr);
01448   }
01449 
01450   <span class="keywordflow">if</span>(<a class="code" href="ahputaway_8c.html#a40">xdr_getdata</a>(head,*array,xdrs) &lt; 0)
01451     ierr= -1;
01452 
01453   <span class="keywordflow">return</span>(ierr);
01454 }
01455 
01456 
01457 <span class="comment">/*      xdr_gogethead</span>
01458 <span class="comment"> *              gets n-th header from the xdr stream pointed to by</span>
01459 <span class="comment"> *              xdrs and returns this header in the structure</span>
01460 <span class="comment"> *              head.</span>
01461 <span class="comment"> *      returns:</span>
01462 <span class="comment"> *                      0       -&gt;      OK</span>
01463 <span class="comment"> *                      -1      -&gt;      stream not long enough</span>
01464 <span class="comment"> *                      -2      -&gt;      error reading header</span>
01465 <span class="comment"> */</span>
<a name="l01466"></a><a class="code" href="ahputaway_8c.html#a45">01466</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a45">xdr_gogethead</a> (<span class="keywordtype">int</span> n, <a class="code" href="structahhed.html">ahhed</a> *head, XDR *xdrs)
01467 {
01468   <span class="keywordtype">int</span>   ierr = 0;
01469 
01470   (<a class="code" href="ahputaway_8c.html#a39">xdr_tohead</a>(n,xdrs) == n) ? ((<a class="code" href="ahputaway_8c.html#a37">xdr_gethead</a>(head,xdrs) &lt; 1) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
01471   <span class="keywordflow">return</span>(ierr);
01472 }
01473 
01474 
01475 <span class="comment">/*      xdr_gogetrecord</span>
01476 <span class="comment"> *              gets n-th record (header and data) from the xdr stream</span>
01477 <span class="comment"> *              pointed to by xdrs and places it in head and array.</span>
01478 <span class="comment"> *              Calling routine must allocate enough space.</span>
01479 <span class="comment"> *      returns:</span>
01480 <span class="comment"> *                      0       -&gt;      OK</span>
01481 <span class="comment"> *                      -1      -&gt;      stream not long enough</span>
01482 <span class="comment"> *                      -2      -&gt;      error reading record</span>
01483 <span class="comment"> */</span>
<a name="l01484"></a><a class="code" href="ahputaway_8c.html#a46">01484</a> <span class="keyword">static</span>  <span class="keywordtype">int</span>     <a class="code" href="ahputaway_8c.html#a46">xdr_gogetrecord</a> (<span class="keywordtype">int</span> n, <a class="code" href="structahhed.html">ahhed</a> *head, <span class="keywordtype">char</span> *array, XDR *xdrs)
01485 {
01486   <span class="keywordtype">int</span>   ierr = 0;
01487 
01488   (<a class="code" href="ahputaway_8c.html#a39">xdr_tohead</a>(n,xdrs) == n) ? ((<a class="code" href="ahputaway_8c.html#a43">xdr_getrecord</a>(head,array,xdrs) &lt; 0) ? (ierr = -2) : (ierr = 0)) : (ierr = -1);
01489   <span class="keywordflow">return</span>(ierr);
01490 }
01491 
01492 
01493 
01494 
01495 
01496 
<a name="l01497"></a><a class="code" href="ahputaway_8c.html#a47">01497</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ahputaway_8c.html#a47">xdr_ahhead</a> (XDR *xdrsp, <a class="code" href="structahhed.html">ahhed</a> *ahheadp)
01498 {
01499   u_int l;
01500   <span class="keywordtype">char</span> **pp, *p;
01501   <span class="keywordtype">float</span> **ppf, *pf;
01502 
01503   l = <a class="code" href="ahhead_8h.html#a2">CODESIZE</a>;
01504   p = ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m0">code</a>;
01505   pp = &amp;p;
01506   <span class="keywordflow">if</span> (!xdr_bytes(xdrsp, pp, &amp;l, (u_int) CODESIZE))
01507     <span class="keywordflow">return</span>(0);
01508   l = <a class="code" href="ahhead_8h.html#a3">CHANSIZE</a>;
01509   p = ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m1">chan</a>;
01510   pp = &amp;p;
01511   <span class="keywordflow">if</span> (!xdr_bytes(xdrsp, pp, &amp;l, CHANSIZE))
01512     <span class="keywordflow">return</span>(0);
01513   l = <a class="code" href="ahhead_8h.html#a4">STYPESIZE</a>;
01514   p = ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m2">stype</a>;
01515   pp = &amp;p;
01516   <span class="keywordflow">if</span> (!xdr_bytes(xdrsp, pp, &amp;l, STYPESIZE))
01517     <span class="keywordflow">return</span>(0);
01518   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m3">slat</a>))
01519     <span class="keywordflow">return</span>(0);
01520   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m4">slon</a>))
01521     <span class="keywordflow">return</span>(0);
01522   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m5">elev</a>))
01523     <span class="keywordflow">return</span>(0);
01524   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m6">DS</a>))
01525     <span class="keywordflow">return</span>(0);
01526   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m7">A0</a>))
01527     <span class="keywordflow">return</span>(0);
01528   <span class="keywordflow">for</span> (l = 0; l &lt; <a class="code" href="ahhead_8h.html#a11">NOCALPTS</a>; l++) {
01529     <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[l].<a class="code" href="structcalib.html#m0">pole</a>.<a class="code" href="structcomplex.html#m0">r</a>))
01530       <span class="keywordflow">return</span>(0);
01531     <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[l].<a class="code" href="structcalib.html#m0">pole</a>.<a class="code" href="structcomplex.html#m1">i</a>))
01532       <span class="keywordflow">return</span>(0);
01533     <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[l].<a class="code" href="structcalib.html#m1">zero</a>.<a class="code" href="structcomplex.html#m0">r</a>))
01534       <span class="keywordflow">return</span>(0);
01535     <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m0">station</a>.<a class="code" href="structstation__info.html#m8">cal</a>[l].<a class="code" href="structcalib.html#m1">zero</a>.<a class="code" href="structcomplex.html#m1">i</a>))
01536       <span class="keywordflow">return</span>(0);
01537   }
01538   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m0">lat</a>))
01539     <span class="keywordflow">return</span>(0);
01540   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m1">lon</a>))
01541     <span class="keywordflow">return</span>(0);
01542   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m2">dep</a>))
01543     <span class="keywordflow">return</span>(0);
01544   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m0">yr</a>))
01545     <span class="keywordflow">return</span>(0);
01546   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m1">mo</a>))
01547     <span class="keywordflow">return</span>(0);
01548   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m2">day</a>))
01549     <span class="keywordflow">return</span>(0);
01550   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m3">hr</a>))
01551     <span class="keywordflow">return</span>(0);
01552   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m4">mn</a>))
01553     <span class="keywordflow">return</span>(0);
01554   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m3">ot</a>.<a class="code" href="structah__time.html#m5">sec</a>))
01555     <span class="keywordflow">return</span>(0);
01556   l = <a class="code" href="ahhead_8h.html#a5">COMSIZE</a>;
01557   p = ahheadp-&gt;<a class="code" href="structahhed.html#m1">event</a>.<a class="code" href="structevent__info.html#m4">ecomment</a>;
01558   pp = &amp;p;
01559   <span class="keywordflow">if</span> (!xdr_bytes(xdrsp, pp, &amp;l, COMSIZE))
01560     <span class="keywordflow">return</span>(0);
01561   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m0">type</a>))
01562     <span class="keywordflow">return</span>(0);
01563   <span class="keywordflow">if</span> (!xdr_long(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m1">ndata</a>))
01564     <span class="keywordflow">return</span>(0);
01565   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m2">delta</a>))
01566     <span class="keywordflow">return</span>(0);
01567   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m3">maxamp</a>))
01568     <span class="keywordflow">return</span>(0);
01569   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m0">yr</a>))
01570     <span class="keywordflow">return</span>(0);
01571   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m1">mo</a>))
01572     <span class="keywordflow">return</span>(0);
01573   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m2">day</a>))
01574     <span class="keywordflow">return</span>(0);
01575   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m3">hr</a>))
01576     <span class="keywordflow">return</span>(0);
01577   <span class="keywordflow">if</span> (!xdr_short(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m4">mn</a>))
01578     <span class="keywordflow">return</span>(0);
01579   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m4">abstime</a>.<a class="code" href="structah__time.html#m5">sec</a>))
01580     <span class="keywordflow">return</span>(0);
01581   <span class="keywordflow">if</span> (!xdr_float(xdrsp, &amp;ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m5">rmin</a>))
01582     <span class="keywordflow">return</span>(0);
01583   l = <a class="code" href="ahhead_8h.html#a5">COMSIZE</a>;
01584   p = ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m6">rcomment</a>;
01585   pp = &amp;p;
01586   <span class="keywordflow">if</span> (!xdr_bytes(xdrsp, pp, &amp;l, COMSIZE))
01587     <span class="keywordflow">return</span>(0);
01588   l = <a class="code" href="ahhead_8h.html#a8">LOGSIZE</a>;
01589   p = ahheadp-&gt;<a class="code" href="structahhed.html#m2">record</a>.<a class="code" href="structrecord__info.html#m7">log</a>;
01590   pp = &amp;p;
01591   <span class="keywordflow">if</span> (!xdr_bytes(xdrsp, pp, &amp;l, LOGSIZE))
01592     <span class="keywordflow">return</span>(0);
01593   l = <a class="code" href="ahhead_8h.html#a10">NEXTRAS</a>;
01594   pf = ahheadp-&gt;<a class="code" href="structahhed.html#m3">extra</a>;
01595   ppf = &amp;pf;
01596   <span class="keywordflow">if</span> (!xdr_array(xdrsp, (<span class="keywordtype">char</span> **)ppf, &amp;l, NEXTRAS, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),
01597                  (xdrproc_t)xdr_float))
01598     <span class="keywordflow">return</span>(0);
01599         
01600 
01601   <span class="keywordflow">return</span>(1);
01602 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:15:59 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
