<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>rw_strongmotion.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>rw_strongmotion.c</h1><a href="rw__strongmotion_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: rw__strongmotion_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.2  2000/02/25 18:07:56  dietz</span>
00011 <span class="comment"> *     kludged to ensure that vendor an serialnumber are never null strings</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00014 <span class="comment"> *     Initial revision</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> */</span>
00018 
00019 <span class="comment">/* rw_strongmotion.c</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * Contains functions in that convert from a</span>
00022 <span class="comment"> * TYPE_STRONGMOTION message to a structure and visa versa.</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> * written by Lynn Dietz   October, 1999</span>
00025 <span class="comment"> */</span>
00026 
00027 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00028 <span class="preprocessor">#include &lt;string.h&gt;</span>
00029 <span class="preprocessor">#include &lt;time.h&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="chron3_8h.html">chron3.h</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="time__ew_8h.html">time_ew.h</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="rw__strongmotion_8h.html">rw_strongmotion.h</a>&gt;</span>
00033 
00034 <span class="keywordtype">void</span> <a class="code" href="logit_8c.html#a18">logit</a>( <span class="keywordtype">char</span> *, <span class="keywordtype">char</span> *, ... );   <span class="comment">/* logit.c      sys-independent  */</span>
00035 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( <span class="keywordtype">char</span> *s1, <span class="keywordtype">int</span> s1max, <span class="keywordtype">char</span> *s2 );
00036 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( <span class="keywordtype">char</span> *begtok, <span class="keywordtype">char</span> c );
00037 
<a name="l00038"></a><a class="code" href="rw__strongmotion_8c.html#a0">00038</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="rw__strongmotion_8c.html#a0">sNullDate</a> = <span class="stringliteral">"0000/00/00 00:00:00.00"</span>;
00039 
00040 <span class="comment">/********************************************************************</span>
00041 <span class="comment"> * rd_strongmotion()                                                *</span>
00042 <span class="comment"> * Reads an ascii TYPE_STRONGMOTION message and fills in a SM_DATA  *</span>
00043 <span class="comment"> * structure.                                                       *</span>
00044 <span class="comment"> * Returns 0 on success, -1 on failure                              *</span>
00045 <span class="comment"> ********************************************************************/</span>
<a name="l00046"></a><a class="code" href="rw__strongmotion_8c.html#a4">00046</a> <span class="keywordtype">int</span> <a class="code" href="rw__strongmotion_8c.html#a4">rd_strongmotion</a>( <span class="keywordtype">char</span> *msg, <span class="keywordtype">int</span> msglen, <a class="code" href="struct__SM__DATA.html">SM_DATA</a> *sm )
00047 {
00048    <span class="keywordtype">char</span>      line[256];
00049    <span class="keywordtype">char</span>     *nextline;  <span class="comment">/* working pointer into msg */</span>
00050    <span class="keywordtype">char</span>     *begtok;    <span class="comment">/* points to the beginning of this token */</span>
00051    <span class="keywordtype">char</span>     *endtok;    <span class="comment">/* points to the end of this token */</span>
00052    <span class="keywordtype">char</span>     *endline;   <span class="comment">/* points at end of line */</span>
00053    <span class="keywordtype">int</span>       len;       <span class="comment">/* length (bytes) of the next token */</span>
00054    <span class="keywordtype">int</span>       nline;     <span class="comment">/* number of lines read from msg so far */</span>
00055    <span class="keywordtype">int</span>       nchan;
00056    <span class="keywordtype">int</span>       nfreq;
00057    <span class="keywordtype">int</span>       i,j;
00058    <span class="keyword">struct </span>tm stm;       <span class="comment">/* time structure for timestamp */</span>
00059    time_t    tsec;      <span class="comment">/* timestamp in whole sec since 1970 */</span>    
00060    <span class="keywordtype">int</span>       hsec;      <span class="comment">/* hundredths of seconds field of timestamp */</span>
00061 
00062 
00063    memset( sm, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__SM__DATA.html">SM_DATA</a>) );     <span class="comment">/* zero output structure */</span>
00064    nextline = msg;
00065    nline = 0;
00066    nfreq = 0;
00067 
00068 
00069 <span class="comment">/* Read next line from the message into working buffer */</span>
00070    <span class="keywordflow">while</span>( nextline &lt; (msg+msglen-1) )
00071    {
00072      len = <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( nextline, <span class="charliteral">'\n'</span> ); 
00073      <span class="keywordflow">if</span>( len &gt;= 256 ) <span class="keywordflow">return</span>( -1 );
00074      strncpy( line, nextline, len ); 
00075      line[len] = 0; <span class="comment">/* null terminate the line */</span>
00076      endline = line + strlen(line);
00077      nline++;
00078      nextline += len + 1;
00079 
00080   <span class="comment">/* First line = Vendor */</span> 
00081      <span class="keywordflow">if</span>( nline == 1 )
00082      {
00083        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"Vendor:"</span>, 7) != 0 ) <span class="keywordflow">return</span>( -1 );
00084        begtok = line + 7;
00085        <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;    <span class="comment">/* go to 1st non-blank char */</span>
00086        len = strlen(begtok); 
00087        <span class="keywordflow">if</span>( len &gt; <a class="code" href="rw__strongmotion_8h.html#a1">SM_VENDOR_LEN</a> ) <span class="keywordflow">return</span>( -1 );
00088        strncpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m0">vendor</a>, begtok, len );
00089      }
00090 
00091   <span class="comment">/* Second line = Serial number */</span> 
00092      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 2 )
00093      {
00094        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"SerialNo:"</span>, 9) != 0 ) <span class="keywordflow">return</span>( -1 );
00095        begtok = line + 9;
00096        <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;    <span class="comment">/* go to 1st non-blank char */</span>
00097        len = strlen(begtok); 
00098        <span class="keywordflow">if</span>( len &gt; <a class="code" href="rw__strongmotion_8h.html#a1">SM_VENDOR_LEN</a> ) <span class="keywordflow">return</span>( -1 );
00099        strncpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m1">sn</a>, begtok, len );
00100      }
00101 
00102   <span class="comment">/* Third line = number of channels */</span> 
00103      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 3 )
00104      {
00105        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"nchan:"</span>, 5) != 0 ) <span class="keywordflow">return</span>( -1 );
00106        <span class="keywordflow">if</span>( sscanf( line, <span class="stringliteral">"nchan: %d"</span>, &amp;(sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>) ) != 1 ) <span class="keywordflow">return</span>( -1 );
00107      }
00108 
00109   <span class="comment">/* Fourth line = timestamp from field unit */</span>
00110      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 4 )
00111      {
00112        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"Field Time:"</span>, 11) != 0 ) <span class="keywordflow">return</span>( -1 );
00113        memset( &amp;stm, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm) ); <span class="comment">/* zero the time structure */</span>
00114        <span class="keywordflow">if</span>( sscanf( line, <span class="stringliteral">"Field Time: %d/%d/%d %d:%d:%d.%d"</span>, 
00115                   &amp;stm.tm_year, &amp;stm.tm_mon, &amp;stm.tm_mday, &amp;stm.tm_hour,
00116                   &amp;stm.tm_min, &amp;stm.tm_sec, &amp;hsec ) != 7 ) <span class="keywordflow">return</span>( -1 );
00117        stm.tm_year -= 1900;  <span class="comment">/* to convert to definition of struct tm */</span>
00118        stm.tm_mon  -= 1;     <span class="comment">/* to convert to definition of struct tm */</span>
00119        tsec  = <a class="code" href="chron3_8c.html#a12">timegm</a>( &amp;stm );
00120        sm-&gt;<a class="code" href="struct__SM__DATA.html#m2">tfield</a> = (double)tsec + 0.01*(double)hsec;
00121      }
00122 
00123   <span class="comment">/* Fifth line = alternate timestamp and its code */</span>
00124      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 5 )
00125      {
00126        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"Alternate Time:"</span>, 15) != 0 ) <span class="keywordflow">return</span>( -1 );
00127        memset( &amp;stm, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm) ); <span class="comment">/* zero the time structure */</span>
00128        <span class="keywordflow">if</span>( sscanf( line, <span class="stringliteral">"Alternate Time: %d/%d/%d %d:%d:%d.%d code: %d"</span>, 
00129                   &amp;stm.tm_year, &amp;stm.tm_mon, &amp;stm.tm_mday, &amp;stm.tm_hour,
00130                   &amp;stm.tm_min, &amp;stm.tm_sec, &amp;hsec, &amp;(sm-&gt;<a class="code" href="struct__SM__DATA.html#m4">altcode</a>) ) != 8 ) 
00131                   <span class="keywordflow">return</span>( -1 );
00132        <span class="keywordflow">if</span>( stm.tm_year == 0 ) {
00133          sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a> = 0.0;
00134        } <span class="keywordflow">else</span> {
00135          stm.tm_year -= 1900;  <span class="comment">/* to convert to definition of struct tm */</span>
00136          stm.tm_mon  -= 1;     <span class="comment">/* to convert to definition of struct tm */</span>
00137          tsec  = <a class="code" href="chron3_8c.html#a12">timegm</a>( &amp;stm );
00138          sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a> = (double)tsec + 0.01*(double)hsec;
00139        }
00140      }
00141 
00142    <span class="comment">/* Sixth line = timestamp from DBMS (or other system) */</span>
00143      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 6 )
00144      {
00145        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"DBMS Load Time:"</span>, 15) != 0 ) <span class="keywordflow">return</span>( -1 );
00146        memset( &amp;stm, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm) ); <span class="comment">/* zero the time structure */</span>
00147        <span class="keywordflow">if</span>( sscanf( line, <span class="stringliteral">"DBMS Load Time: %d/%d/%d %d:%d:%d.%d"</span>, 
00148                   &amp;stm.tm_year, &amp;stm.tm_mon, &amp;stm.tm_mday, &amp;stm.tm_hour,
00149                   &amp;stm.tm_min, &amp;stm.tm_sec, &amp;hsec ) != 7 ) <span class="keywordflow">return</span>( -1 );
00150        <span class="keywordflow">if</span>( stm.tm_year == 0 ) {
00151          sm-&gt;<a class="code" href="struct__SM__DATA.html#m5">tload</a> = 0.0;
00152        } <span class="keywordflow">else</span> {
00153          stm.tm_year -= 1900;  <span class="comment">/* to convert to definition of struct tm */</span>
00154          stm.tm_mon  -= 1;     <span class="comment">/* to convert to definition of struct tm */</span>
00155          tsec  = <a class="code" href="chron3_8c.html#a12">timegm</a>( &amp;stm );
00156          sm-&gt;<a class="code" href="struct__SM__DATA.html#m5">tload</a> = (double)tsec + 0.01*(double)hsec;
00157        }
00158      }
00159 
00160  <span class="comment">/* Seventh line = SCNL names */</span>
00161      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 7 )
00162      {
00163        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"SCNL:"</span>, 5) != 0 ) <span class="keywordflow">return</span>( -1 );
00164        begtok = line + 5;
00165        <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00166        {
00167          <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;    <span class="comment">/* go to 1st non-blank char */</span>
00168          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00169          len = <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">'.'</span> );
00170          <span class="keywordflow">if</span>( len &gt; <a class="code" href="rw__strongmotion_8h.html#a2">SM_STA_LEN</a> ) <span class="keywordflow">return</span>( -1 );
00171          strncpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m0">sta</a>, begtok, len ); 
00172          begtok += len + 1;
00173 
00174          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00175          len = <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">'.'</span> );
00176          <span class="keywordflow">if</span>( len &gt; <a class="code" href="rw__strongmotion_8h.html#a3">SM_COMP_LEN</a> ) <span class="keywordflow">return</span>( -1 );
00177          strncpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m1">comp</a>, begtok, len ); 
00178          begtok += len + 1;
00179 
00180          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00181          len = <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">'.'</span> );
00182          <span class="keywordflow">if</span>( len &gt; <a class="code" href="rw__strongmotion_8h.html#a4">SM_NET_LEN</a> ) <span class="keywordflow">return</span>( -1 );
00183          strncpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m2">net</a>, begtok, len ); 
00184          begtok += len + 1;
00185 
00186          <span class="keywordflow">if</span>( begtok &gt; endline ) <span class="keywordflow">return</span>( -1 );
00187          len = <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">' '</span> );
00188          <span class="keywordflow">if</span>( len &gt; <a class="code" href="rw__strongmotion_8h.html#a5">SM_LOC_LEN</a> ) <span class="keywordflow">return</span>( -1 );
00189          strncpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m3">loc</a>, begtok, len ); 
00190          begtok += len + 1;
00191        }
00192      }
00193 
00194   <span class="comment">/* Eighth line = peak acceleration values */</span>
00195      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 8 )
00196      {
00197        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"Acc:"</span>, 4) != 0 ) <span class="keywordflow">return</span>( -1 );
00198        begtok = line + 4;
00199        <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00200        {
00201          <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;  <span class="comment">/* go to 1st non-blank char */</span>
00202          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00203          <span class="keywordflow">if</span>( sscanf( begtok, <span class="stringliteral">"%lf"</span>, &amp;(sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m4">acc</a>) ) != 1 ) <span class="keywordflow">return</span>( -1 );
00204          begtok += <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">' '</span> ) + 1;
00205        } 
00206      }
00207 
00208   <span class="comment">/* Ninth line = peak velocity values */</span>
00209      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 9 )
00210      {
00211        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"Vel:"</span>, 4) != 0 ) <span class="keywordflow">return</span>( -1 );
00212        begtok = line + 4;
00213        <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00214        {
00215          <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;  <span class="comment">/* go to 1st non-blank char */</span>
00216          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00217          <span class="keywordflow">if</span>( sscanf( begtok, <span class="stringliteral">"%lf"</span>, &amp;(sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m5">vel</a>) ) != 1 ) <span class="keywordflow">return</span>( -1 );
00218          begtok += <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">' '</span> ) + 1;
00219        } 
00220      }
00221 
00222   <span class="comment">/* Tenth line = peak displacement values */</span>
00223      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 10 )
00224      {
00225        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"Disp:"</span>, 5) != 0 ) <span class="keywordflow">return</span>( -1 );
00226        begtok = line + 5;
00227        <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00228        {
00229          <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;  <span class="comment">/* go to 1st non-blank char */</span>
00230          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00231          <span class="keywordflow">if</span>( sscanf( begtok, <span class="stringliteral">"%lf"</span>, &amp;(sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m6">disp</a>) ) != 1 ) <span class="keywordflow">return</span>( -1 );
00232          begtok += <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">' '</span> ) + 1;
00233        } 
00234      }
00235 
00236   <span class="comment">/* Eleventh line = number of points in the response spectrum */</span>
00237      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline == 11 )
00238      {
00239        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"nRSA:"</span>, 5) != 0 ) <span class="keywordflow">return</span>( -1 );
00240        begtok = line + 5;
00241        <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00242        {
00243          <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;  <span class="comment">/* go to 1st non-blank char */</span>
00244          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00245          <span class="keywordflow">if</span>( sscanf( begtok, <span class="stringliteral">"%d"</span>, &amp;(sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a>) ) != 1 ) <span class="keywordflow">return</span>( -1 );
00246          begtok += <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">' '</span> ) + 1;
00247          <span class="keywordflow">if</span>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> &gt; <a class="code" href="rw__strongmotion_8h.html#a7">SM_MAX_RSA</a> ) <span class="keywordflow">return</span>( -1 );
00248        } 
00249      }
00250 
00251   <span class="comment">/* Remaining lines = response spectrum */</span>
00252      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nline &gt; 11 )
00253      {
00254        <span class="keywordtype">double</span> tmp1, tmp2;
00255        <span class="keywordflow">if</span>( strncmp(line,<span class="stringliteral">"frq/RSA:"</span>, 8) != 0 ) <span class="keywordflow">return</span>( -1 );
00256        begtok = line + 8;
00257        <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00258        {
00259          <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;  <span class="comment">/* go to 1st non-blank char */</span>
00260          <span class="keywordflow">if</span>( begtok &gt;= endline ) <span class="keywordflow">return</span>( -1 );
00261          <span class="keywordflow">if</span>( sscanf( begtok, <span class="stringliteral">"%lf/%lf"</span>, &amp;tmp1, &amp;tmp2 ) != 2 ) <span class="keywordflow">return</span>( -1 );
00262          <span class="keywordflow">if</span>( nfreq &lt; sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> )
00263          {
00264            sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m8">freq</a>[nfreq] = tmp1;
00265            sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m9">RSA</a>[nfreq]  = tmp2;
00266          } 
00267          begtok += <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">'/'</span> ) + 1; <span class="comment">/* skip over freq field */</span>
00268          <span class="keywordflow">while</span>( begtok[0] == <span class="charliteral">' '</span> ) begtok++;       <span class="comment">/* go to 1st non-blank char */</span>
00269          begtok += <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( begtok, <span class="charliteral">' '</span> ) + 1; <span class="comment">/* skip over RSA field */</span>
00270        } 
00271        nfreq++;
00272      }
00273 
00274    } <span class="comment">/*end while*/</span>
00275 
00276 
00277    <span class="keywordflow">return</span>( 0 );
00278 }
00279 
00280 <span class="comment">/********************************************************************</span>
00281 <span class="comment"> * wr_strongmotion()                                                *</span>
00282 <span class="comment"> * Reads a SM_DATA structure and writes an ascii TYPE_STRONGMOTION  *</span>
00283 <span class="comment"> * message (null terminated)                                        *</span>
00284 <span class="comment"> * Returns 0 on success, -1 on failure (buffer overflow)            *</span>
00285 <span class="comment"> ********************************************************************/</span>
<a name="l00286"></a><a class="code" href="rw__strongmotion_8c.html#a5">00286</a> <span class="keywordtype">int</span> <a class="code" href="rw__strongmotion_8c.html#a5">wr_strongmotion</a>( <a class="code" href="struct__SM__DATA.html">SM_DATA</a> *sm, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> buflen )
00287 {
00288    <span class="keywordtype">char</span>     tmp[256]; <span class="comment">/* working buffer */</span>
00289    <span class="keywordtype">int</span>      nchan;
00290    <span class="keywordtype">int</span>      nRSA;
00291    <span class="keywordtype">int</span>      i,j;
00292 
00293    memset( buf, 0, (size_t)buflen );    <span class="comment">/* zero output buffer */</span>
00294    nchan = ( sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a> &gt; <a class="code" href="k2evt2ew_8h.html#a4">SM_MAX_CHAN</a> ) ? <a class="code" href="k2evt2ew_8h.html#a4">SM_MAX_CHAN</a> : sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a> ;
00295 
00296 <span class="comment">/* Print 3 header lines: vendor, serial number, nchan */</span>
00297    <span class="keywordflow">if</span>( strlen(sm-&gt;<a class="code" href="struct__SM__DATA.html#m0">vendor</a>)==0 ) strcpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m0">vendor</a>, <span class="stringliteral">"unknown"</span> ); <span class="comment">/*KLUDGE*/</span>
00298    <span class="keywordflow">if</span>( strlen(sm-&gt;<a class="code" href="struct__SM__DATA.html#m1">sn</a>)==0     ) strcpy( sm-&gt;<a class="code" href="struct__SM__DATA.html#m1">sn</a>,     <span class="stringliteral">"unknown"</span> ); <span class="comment">/*KLUDGE*/</span>
00299     sprintf( tmp, <span class="stringliteral">"Vendor: %s\nSerialNo: %s\nnchan: %d\nField Time:     "</span>, 
00300             sm-&gt;<a class="code" href="struct__SM__DATA.html#m0">vendor</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m1">sn</a>, nchan );
00301    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00302 
00303 <span class="comment">/* field time */</span>
00304    <a class="code" href="time__ew_8c.html#a6">datestr23</a>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m2">tfield</a>, tmp, 256 );  
00305    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00306 
00307 <span class="comment">/* alternate time &amp; its code */</span>
00308    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nAlternate Time: "</span> ) ) <span class="keywordflow">return</span> ( -1 );
00309    <span class="keywordflow">if</span>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a> == 0.0 )
00310    {
00311      <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, sNullDate ) ) <span class="keywordflow">return</span>( -1 );
00312    } <span class="keywordflow">else</span> {
00313      <a class="code" href="time__ew_8c.html#a6">datestr23</a>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a>, tmp, 256 );  
00314      <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00315    }
00316    sprintf( tmp, <span class="stringliteral">" code: %d"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m4">altcode</a> );
00317    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00318 
00319 <span class="comment">/* load time */</span>
00320    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nDBMS Load Time: "</span> ) ) <span class="keywordflow">return</span> ( -1 );
00321    <span class="keywordflow">if</span>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m5">tload</a> == 0.0 )
00322    {
00323      <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, sNullDate ) ) <span class="keywordflow">return</span>( -1 );
00324    } <span class="keywordflow">else</span> {
00325      <a class="code" href="time__ew_8c.html#a6">datestr23</a>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m5">tload</a>, tmp, 256 );  
00326      <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00327    }
00328 
00329 <span class="comment">/* Print the SCNL names */</span>
00330    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nSCNL:    "</span> ) ) <span class="keywordflow">return</span>( -1 );
00331    <span class="keywordflow">for</span>( i=0; i&lt;nchan; i++ )
00332    {
00333       sprintf( tmp, <span class="stringliteral">"   %s.%s.%s.%s"</span>, 
00334                sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m0">sta</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m1">comp</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m2">net</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m3">loc</a> );
00335       <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00336    }
00337    
00338 <span class="comment">/* Print peak acceleration values */</span>
00339    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nAcc:     "</span> ) ) <span class="keywordflow">return</span>( -1 );
00340    <span class="keywordflow">for</span>( i=0; i&lt;nchan; i++ )
00341    {
00342       sprintf( tmp, <span class="stringliteral">" %15.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m4">acc</a> );
00343       <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00344    }
00345       
00346 <span class="comment">/* Print peak velocity values */</span>
00347    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nVel:     "</span> ) ) <span class="keywordflow">return</span>( -1 );
00348    <span class="keywordflow">for</span>( i=0; i&lt;nchan; i++ )
00349    {
00350       sprintf( tmp, <span class="stringliteral">" %15.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m5">vel</a> );
00351       <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00352    }   
00353       
00354 <span class="comment">/* Print peak displacement values */</span>
00355    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nDisp:    "</span> ) ) <span class="keywordflow">return</span>( -1 );
00356    <span class="keywordflow">for</span>( i=0; i&lt;nchan; i++ )
00357    {
00358       sprintf( tmp, <span class="stringliteral">" %15.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m6">disp</a> );
00359       <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00360    }   
00361 
00362 <span class="comment">/* Print number of points in the response spectrum */</span>
00363    nRSA = 0;
00364    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nnRSA:    "</span> ) ) <span class="keywordflow">return</span>( -1 );
00365    <span class="keywordflow">for</span>( i=0; i&lt;nchan; i++ )
00366    {
00367       <span class="keywordflow">if</span>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> &lt; <a class="code" href="rw__strongmotion_8h.html#a7">SM_MAX_RSA</a> ) sprintf( tmp, <span class="stringliteral">" %15d"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> );
00368       <span class="keywordflow">else</span>                              sprintf( tmp, <span class="stringliteral">" %15d"</span>, SM_MAX_RSA );
00369       <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00370       <span class="keywordflow">if</span>( nRSA &lt; sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> ) nRSA = sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a>;
00371    }   
00372 
00373 <span class="comment">/* Print the response spectrum (frequency/acceleration pairs) */</span>
00374    <span class="keywordflow">if</span>( nRSA &gt; <a class="code" href="rw__strongmotion_8h.html#a7">SM_MAX_RSA</a> ) nRSA = <a class="code" href="rw__strongmotion_8h.html#a7">SM_MAX_RSA</a>;
00375    <span class="keywordflow">for</span>( j=0; j&lt;nRSA; j++ )
00376    {
00377       <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\nfrq/RSA: "</span> ) ) <span class="keywordflow">return</span>( -1 );
00378       <span class="keywordflow">for</span>( i=0; i&lt;nchan; i++ )
00379       {
00380         <span class="keywordflow">if</span>( j &lt; sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> )  <span class="comment">/* print real values for this channel */</span>
00381         {
00382           sprintf( tmp, <span class="stringliteral">" %6.2lf/%.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m8">freq</a>[j], sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m9">RSA</a>[j] );
00383         }
00384         <span class="keywordflow">else</span>                      <span class="comment">/* print null values for this channel */</span>
00385         {
00386           sprintf( tmp, <span class="stringliteral">" %6.2lf/%.6lf"</span>, SM_NULL, SM_NULL );
00387         } 
00388         <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, tmp ) ) <span class="keywordflow">return</span>( -1 );
00389       }
00390    }
00391    <span class="keywordflow">if</span>( <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( buf, buflen, <span class="stringliteral">"\n"</span> ) ) <span class="keywordflow">return</span>( -1 );
00392 
00393    <span class="keywordflow">return</span>( 0 );
00394 }
00395 
00396 
00397 <span class="comment">/********************************************************************</span>
00398 <span class="comment"> * log_strongmotion()                                               *</span>
00399 <span class="comment"> * Writes the contents of a SM_DATA structure to an Earthworm       *</span>
00400 <span class="comment"> * log file                                                         *</span>
00401 <span class="comment"> ********************************************************************/</span>
<a name="l00402"></a><a class="code" href="rw__strongmotion_8c.html#a6">00402</a> <span class="keywordtype">void</span> <a class="code" href="rw__strongmotion_8c.html#a6">log_strongmotion</a>( <a class="code" href="struct__SM__DATA.html">SM_DATA</a> *sm )
00403 {
00404    <span class="keywordtype">char</span> date[30];
00405    <span class="keywordtype">int</span> nRSA, i, j;
00406 
00407    <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"Vendor:%s sn:%s nch:%d\n"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m0">vendor</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m1">sn</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a> );
00408    
00409 <span class="comment">/* Log time values */</span>
00410    <a class="code" href="time__ew_8c.html#a6">datestr23</a>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m2">tfield</a>, date, 30 );
00411    <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"Field Time:     %s  (%.2lf)\n"</span>, date, sm-&gt;<a class="code" href="struct__SM__DATA.html#m2">tfield</a> );
00412    <span class="keywordflow">if</span>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a> != 0.0 ) {
00413      <a class="code" href="time__ew_8c.html#a6">datestr23</a>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a>, date, 30 );
00414      <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"Alternate Time: %s  (%.2lf)  code: %d\n"</span>, 
00415            date, sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m4">altcode</a> );
00416    } <span class="keywordflow">else</span> {
00417      <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"Alternate Time: %s  (%.2lf)  code: %d\n"</span>, 
00418            sNullDate, sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m4">altcode</a> );
00419    }
00420 
00421    <span class="keywordflow">if</span>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m3">talt</a> != 0.0 ) {
00422      <a class="code" href="time__ew_8c.html#a6">datestr23</a>( sm-&gt;<a class="code" href="struct__SM__DATA.html#m5">tload</a>, date, 30 );
00423      <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"DBMS Load Time: %s  (%.2lf)\nSCNL:"</span>, date, sm-&gt;<a class="code" href="struct__SM__DATA.html#m5">tload</a> );
00424    } <span class="keywordflow">else</span> {
00425      <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"DBMS Load Time: %s  (%.2lf)\nSCNL:"</span>, sNullDate, sm-&gt;<a class="code" href="struct__SM__DATA.html#m5">tload</a> );
00426    }
00427 
00428 <span class="comment">/* Log station codes */</span>
00429    <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00430    {
00431      <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"   %s.%s.%s.%s"</span>, 
00432              sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m0">sta</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m1">comp</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m2">net</a>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m3">loc</a> );
00433    }
00434 
00435 <span class="comment">/* Log peak acceleration values */</span>
00436    <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"\nAcc:     "</span>);
00437    <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00438    {
00439       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">" %15.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m4">acc</a> );
00440    }
00441       
00442 <span class="comment">/* Log peak velocity values */</span>
00443    <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"\nVel:     "</span>);
00444    <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00445    {
00446       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">" %15.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m5">vel</a> );
00447    }   
00448       
00449 <span class="comment">/* Log peak displacement values */</span>
00450    <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"\nDisp:    "</span>);
00451    <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00452    {
00453       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">" %15.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m6">disp</a> );
00454    }   
00455 
00456 <span class="comment">/* Log number of points in the response spectrum */</span>
00457    nRSA = 0;
00458    <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"\nnRSA:    "</span>);
00459    <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00460    {
00461       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">" %15d"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> );
00462       <span class="keywordflow">if</span>( nRSA &lt; sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> ) nRSA = sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a>;
00463    }   
00464 
00465 <span class="comment">/* Log the response spectrum (frequency/acceleration pairs) */</span>
00466    <span class="keywordflow">for</span>( j=0; j&lt;nRSA; j++ )
00467    {
00468       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"\nfrq/RSA: "</span> );
00469       <span class="keywordflow">for</span>( i=0; i&lt;sm-&gt;<a class="code" href="struct__SM__DATA.html#m6">nch</a>; i++ )
00470       {
00471         <span class="keywordflow">if</span>( j &lt; sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m7">nRSA</a> )  <span class="comment">/* print real values for this channel */</span>
00472         {
00473           <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">" %6.2lf/%8.6lf"</span>, sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m8">freq</a>[j], sm-&gt;<a class="code" href="struct__SM__DATA.html#m7">ch</a>[i].<a class="code" href="struct__SM__CHAN.html#m9">RSA</a>[j] );
00474         }
00475         <span class="keywordflow">else</span>                      <span class="comment">/* print null values for this channel */</span>
00476         {
00477           <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>, <span class="stringliteral">" %6.2lf/%8.6lf"</span>, SM_NULL, SM_NULL );
00478         } 
00479       }
00480    }
00481    <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"\n"</span>);
00482 
00483    <span class="keywordflow">return</span>;
00484 }
00485 
00486 <span class="comment">/********************************************************************</span>
00487 <span class="comment"> * strappend() append second null-terminated character string to    *</span>
00488 <span class="comment"> * the first as long as there's enough room in the target buffer    * </span>
00489 <span class="comment"> * for both strings an the null-byte                                *</span>
00490 <span class="comment"> ********************************************************************/</span>
<a name="l00491"></a><a class="code" href="rw__strongmotion_8c.html#a2">00491</a> <span class="keywordtype">int</span> <a class="code" href="rw__strongmotionII_8c.html#a4">strappend</a>( <span class="keywordtype">char</span> *s1, <span class="keywordtype">int</span> s1max, <span class="keywordtype">char</span> *s2 )
00492 {
00493    <span class="keywordflow">if</span>( (int)strlen(s1)+(int)strlen(s2)+1 &gt; s1max ) <span class="keywordflow">return</span>( -1 );
00494    strcat( s1, s2 );
00495    <span class="keywordflow">return</span>( 0 );
00496 }
00497 
00498 <span class="comment">/********************************************************************</span>
00499 <span class="comment"> * tokenlength() given a null-terminated character string and a     *</span>
00500 <span class="comment"> * character that delimits the end of a token, tokenlength returns  * </span>
00501 <span class="comment"> * the length (in bytes) of the next token. If the character wasn't * </span>
00502 <span class="comment"> * found, tokenlength returns the length of the string.             *</span>
00503 <span class="comment"> ********************************************************************/</span>
<a name="l00504"></a><a class="code" href="rw__strongmotion_8c.html#a3">00504</a> <span class="keywordtype">int</span> <a class="code" href="rw__strongmotionII_8c.html#a5">tokenlength</a>( <span class="keywordtype">char</span> *begtok, <span class="keywordtype">char</span> c )
00505 {
00506    <span class="keywordtype">char</span>    *endtok;   <span class="comment">/* points to the end of this token */</span>
00507 
00508    endtok = strchr( begtok, c );
00509    <span class="keywordflow">if</span>( endtok == NULL ) <span class="keywordflow">return</span>( (int)strlen(begtok) );
00510    <span class="keywordflow">return</span>( (int)(endtok-begtok) );
00511 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:08 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
