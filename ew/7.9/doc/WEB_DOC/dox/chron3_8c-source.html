<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>chron3.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>chron3.c</h1><a href="chron3_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: chron3_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:01  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00011 <span class="comment"> *     Initial revision</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> */</span>
00015 
00016 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00017 <span class="preprocessor">#include &lt;time.h&gt;</span>
00018 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="chron3_8h.html">chron3.h</a>&gt;</span>
00020 <span class="comment">/*</span>
00021 <span class="comment">   chron3.c : Time/date conversion routines.</span>
00022 <span class="comment"></span>
00023 <span class="comment">   91May07 CEJ Version 1.0 - chron.c, chron.h</span>
00024 <span class="comment"></span>
00025 <span class="comment">   Modified by W. Kohler, March 8, 1993.</span>
00026 <span class="comment">   Source file name changed from chron.c to chron2.c.</span>
00027 <span class="comment">   Include file name changed from chron.h to chron2.h.</span>
00028 <span class="comment">   Routine datime added to calculate gregorian date and time from</span>
00029 <span class="comment">   julian seconds.  Seconds added to structure Greg in file chron2.h.</span>
00030 <span class="comment"></span>
00031 <span class="comment">   Modified by L. Dietz,  March 30, 1995.</span>
00032 <span class="comment">   Source file name changed from chron2.c to chron3.c.</span>
00033 <span class="comment">   Include file name changed from chron2.h to chron3.h.</span>
00034 <span class="comment">   Routines date15 and julsec15 added to convert between time in</span>
00035 <span class="comment">   julian seconds and character strings.</span>
00036 <span class="comment">   Added a define statement to set the century (#define CENTURY 1900)</span>
00037 <span class="comment"></span>
00038 <span class="comment">   Modified by L. Dietz, January 30, 1995.</span>
00039 <span class="comment">   Added routine epochsec15 to convert from time given in a</span>
00040 <span class="comment">   15-character string and seconds since 1970-01-01 00:00:00.0 GMT.</span>
00041 <span class="comment"></span>
00042 <span class="comment">   Modified by L. Dietz, October, 1998.</span>
00043 <span class="comment">   Changed make the library Y2K-compliant. </span>
00044 <span class="comment">   + Removed the CENTURY definition from chron3.h! </span>
00045 <span class="comment">   + Removed all functions that dealt with 2-digit-year date strings </span>
00046 <span class="comment">     and replaced them with 4-digit-year counterparts.</span>
00047 <span class="comment">        date15     -&gt; date17</span>
00048 <span class="comment">        date18     -&gt; date20</span>
00049 <span class="comment">        julsec15   -&gt; julsec17</span>
00050 <span class="comment">        epochsec15 -&gt; epochsec17</span>
00051 <span class="comment">        timegm     -&gt; timegm (fixed to call epochsec17)</span>
00052 <span class="comment"></span>
00053 <span class="comment">   Modified by L. Dietz, November, 1998.</span>
00054 <span class="comment">   Changed to make function MT-safe.  </span>
00055 <span class="comment">   Eliminated the file-global "struct Greg G" workspace and had each function </span>
00056 <span class="comment">   declare its own "struct Greg" variable, if needed.  Changed function</span>
00057 <span class="comment">   arguments for grg(), gregor(), and datime() to include a pointer to </span>
00058 <span class="comment">   struct Greg for returning information to calling function.</span>
00059 <span class="comment"></span>
00060 <span class="comment">*/</span>
00061 
00062 <span class="comment">/*********************C O P Y R I G H T   N O T I C E ***********************/</span>
00063 <span class="comment">/* Copyright 1991 by Carl Johnson.  All rights are reserved. Permission     */</span>
00064 <span class="comment">/* is hereby granted for the use of this product for nonprofit, commercial, */</span>
00065 <span class="comment">/* or noncommercial publications that contain appropriate acknowledgement   */</span>
00066 <span class="comment">/* of the author. Modification of this code is permitted as long as this    */</span>
00067 <span class="comment">/* notice is included in each resulting source module.                      */</span>
00068 <span class="comment">/****************************************************************************/</span>
00069 
<a name="l00070"></a><a class="code" href="chron3_8c.html#a0">00070</a> <span class="keywordtype">int</span> <a class="code" href="chron3_8c.html#a0">mo</a>[] = {   0,  31,  59,  90, 120, 151, 181, 212, 243, 273, 304, 334,
00071                0,  31,  60,  91, 121, 152, 182, 213, 244, 274, 305, 335};
<a name="l00072"></a><a class="code" href="chron3_8c.html#a1">00072</a> <span class="keywordtype">char</span> *<a class="code" href="chron3_8c.html#a1">cmo</a>[] = {<span class="stringliteral">"Jan"</span>, <span class="stringliteral">"Feb"</span>, <span class="stringliteral">"Mar"</span>, <span class="stringliteral">"Apr"</span>, <span class="stringliteral">"May"</span>, <span class="stringliteral">"Jun"</span>,
00073                <span class="stringliteral">"Jul"</span>, <span class="stringliteral">"Aug"</span>, <span class="stringliteral">"Sep"</span>, <span class="stringliteral">"Oct"</span>, <span class="stringliteral">"Nov"</span>, <span class="stringliteral">"Dec"</span> };
00074 
00075 <span class="comment">/*</span>
00076 <span class="comment"> * Calculate julian minute from gregorian date and time.</span>
00077 <span class="comment"> */</span>
<a name="l00078"></a><a class="code" href="chron3_8c.html#a2">00078</a> <span class="keywordtype">long</span> <a class="code" href="chron3_8c.html#a2">julmin</a>( <span class="keyword">struct</span> <a class="code" href="structGreg.html">Greg</a> *pg )
00079 {
00080         <span class="keywordflow">return</span>(1440L * (<a class="code" href="chron3_8c.html#a4">julian</a>(pg) - 2305448L) + 60L * pg-&gt;<a class="code" href="structGreg.html#m3">hour</a> + pg-&gt;<a class="code" href="structGreg.html#m4">minute</a>);
00081 }
00082 
00083 <span class="comment">/*</span>
00084 <span class="comment"> * Calculate gregorian date and time from julian minutes.</span>
00085 <span class="comment"> */</span>
<a name="l00086"></a><a class="code" href="chron3_8c.html#a3">00086</a> <span class="keyword">struct </span><a class="code" href="structGreg.html">Greg</a> *<a class="code" href="chron3_8c.html#a3">grg</a>( long <a class="code" href="socket__ew_8h.html#a3">min</a>, struct Greg *pg )
00087 {
00088         <span class="keywordtype">long</span> j;
00089         <span class="keywordtype">long</span> m;
00090 
00091         j = <a class="code" href="socket__ew_8h.html#a3">min</a>/1440L;
00092         m = <a class="code" href="socket__ew_8h.html#a3">min</a>-1440L*j;
00093         j += 2305448L;
00094         <a class="code" href="chron3_8c.html#a5">gregor</a>(j,pg);
00095         pg-&gt;<a class="code" href="structGreg.html#m3">hour</a> = m/60;
00096         pg-&gt;<a class="code" href="structGreg.html#m4">minute</a> = m - 60 * pg-&gt;<a class="code" href="structGreg.html#m3">hour</a>;
00097         <span class="keywordflow">return</span>(pg);
00098 }
00099 
00100 <span class="comment">/*</span>
00101 <span class="comment"> * julian : Calculate julian date from gregorian date.</span>
00102 <span class="comment"> */</span>
<a name="l00103"></a><a class="code" href="chron3_8c.html#a4">00103</a> <span class="keywordtype">long</span> <a class="code" href="chron3_8c.html#a4">julian</a>( <span class="keyword">struct</span> Greg *pg )
00104 {
00105         <span class="keywordtype">long</span> jul;
00106         <span class="keywordtype">int</span> leap;
00107         <span class="keywordtype">int</span> year;
00108         <span class="keywordtype">int</span> n;
00109 
00110         jul = 0;
00111         year = pg-&gt;<a class="code" href="structGreg.html#m0">year</a>;
00112         <span class="keywordflow">if</span>(year &lt; 1) <span class="keywordflow">goto</span> x110;
00113         year--;
00114         jul = 365;
00115 
00116 <span class="comment">/* four hundred year rule */</span>
00117         n = year / 400;
00118         jul += n * 146097L;
00119         year -= n * 400;
00120 
00121 <span class="comment">/* hundred year rule */</span>
00122         n = year / 100;
00123         jul += n * 36524L;
00124         year -= n * 100;
00125 
00126 <span class="comment">/* four year rule */</span>
00127         n = year / 4;
00128         jul += n * 1461L;
00129         year -= n * 4;
00130 
00131 <span class="comment">/* one year rule */</span>
00132         jul += year * 365L;
00133 
00134 <span class="comment">/* Handle days in current year */</span>
00135 x110:
00136         leap = 0;
00137         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> % 4   == 0) leap = 12;
00138         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> % 100 == 0) leap = 0;
00139         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> % 400 == 0) leap = 12;
00140         jul += <a class="code" href="chron3_8c.html#a0">mo</a>[pg-&gt;<a class="code" href="structGreg.html#m1">month</a> + leap - 1] + pg-&gt;<a class="code" href="structGreg.html#m2">day</a> + 1721060L;
00141         <span class="keywordflow">return</span>(jul);
00142 }
00143 
00144 <span class="comment">/*</span>
00145 <span class="comment"> * gregor : Calculate gregorian date from julian date.</span>
00146 <span class="comment"> */</span>
<a name="l00147"></a><a class="code" href="chron3_8c.html#a5">00147</a> <span class="keyword">struct </span>Greg *<a class="code" href="chron3_8c.html#a5">gregor</a>( long <a class="code" href="socket__ew_8h.html#a3">min</a>, struct Greg *pg )
00148 {
00149         <span class="keywordtype">long</span> test;
00150         <span class="keywordtype">long</span> check;
00151         <span class="keywordtype">int</span> leap;
00152         <span class="keywordtype">int</span> left;
00153         <span class="keywordtype">int</span> imo;
00154 
00155         pg-&gt;<a class="code" href="structGreg.html#m0">year</a> = (<a class="code" href="socket__ew_8h.html#a3">min</a> - 1721061L) / 365L;
00156         pg-&gt;<a class="code" href="structGreg.html#m1">month</a> = 1;
00157         pg-&gt;<a class="code" href="structGreg.html#m2">day</a> = 1;
00158         test = <a class="code" href="chron3_8c.html#a4">julian</a>(pg);
00159         <span class="keywordflow">if</span>(test &lt;= <a class="code" href="socket__ew_8h.html#a3">min</a>) <span class="keywordflow">goto</span> x110;
00160 
00161 x20:
00162         pg-&gt;<a class="code" href="structGreg.html#m0">year</a>--;
00163         test = <a class="code" href="chron3_8c.html#a4">julian</a>(pg);
00164         <span class="keywordflow">if</span>(test &gt; <a class="code" href="socket__ew_8h.html#a3">min</a>) <span class="keywordflow">goto</span> x20;
00165         <span class="keywordflow">goto</span> x210;
00166 
00167 x105:
00168         pg-&gt;<a class="code" href="structGreg.html#m0">year</a>++;
00169         test = <a class="code" href="chron3_8c.html#a4">julian</a>(pg);
00170 
00171 x110:
00172         check = test - <a class="code" href="socket__ew_8h.html#a3">min</a> - 366L;
00173         <span class="keywordflow">if</span>(check &lt; 0) <span class="keywordflow">goto</span> x210;
00174         <span class="keywordflow">if</span>(check &gt; 0) <span class="keywordflow">goto</span> x105;
00175 
00176         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> % 400 == 0) <span class="keywordflow">goto</span> x210;
00177         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> % 100 == 0) <span class="keywordflow">goto</span> x105;
00178         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> %   4 == 0) <span class="keywordflow">goto</span> x210;
00179         <span class="keywordflow">goto</span> x105;
00180 
00181 x210:
00182         left = <a class="code" href="socket__ew_8h.html#a3">min</a> - test;
00183         leap = 0;
00184         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> %   4 == 0) leap = 12;
00185         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> % 100 == 0) leap = 0;
00186         <span class="keywordflow">if</span>(pg-&gt;<a class="code" href="structGreg.html#m0">year</a> % 400 == 0) leap = 12;
00187         <span class="keywordflow">for</span>(imo=1; imo&lt;12; imo++) {
00188                 <span class="keywordflow">if</span>(<a class="code" href="chron3_8c.html#a0">mo</a>[imo+leap] &lt;= left)
00189                         <span class="keywordflow">continue</span>;
00190                 pg-&gt;<a class="code" href="structGreg.html#m1">month</a> = imo;
00191                 pg-&gt;<a class="code" href="structGreg.html#m2">day</a> = left - <a class="code" href="chron3_8c.html#a0">mo</a>[imo+leap-1] + 1;
00192                 <span class="keywordflow">return</span>(pg);
00193         }
00194         pg-&gt;<a class="code" href="structGreg.html#m1">month</a> = 12;
00195         pg-&gt;<a class="code" href="structGreg.html#m2">day</a> = left - <a class="code" href="chron3_8c.html#a0">mo</a>[11+leap] + 1;
00196         <span class="keywordflow">return</span>(pg);
00197 }
00198 
00199 <span class="comment">/*</span>
00200 <span class="comment"> * date20 : Create 20 char date string in the form 1988Jan23 1234 12.21</span>
00201 <span class="comment"> *          from the julian seconds.  Remember to leave space for the</span>
00202 <span class="comment"> *          string termination (NULL).</span>
00203 <span class="comment"> *          Replaces non-Y2K-compliant date18() function</span>
00204 <span class="comment"> *          Added to chron3.c 10/28/98 by LDD.</span>
00205 <span class="comment"> */</span>
<a name="l00206"></a><a class="code" href="chron3_8c.html#a6">00206</a> <span class="keywordtype">void</span> <a class="code" href="chron3_8c.html#a6">date20</a>( <span class="keywordtype">double</span> secs, <span class="keywordtype">char</span> *c20)
00207 {
00208         <span class="keyword">struct </span>Greg g;
00209         <span class="keywordtype">long</span> minute;
00210         <span class="keywordtype">double</span> sex;
00211         <span class="keywordtype">int</span> hrmn;
00212 
00213         minute = (long) (secs / 60.0);
00214         sex = secs - 60.0 * minute;
00215         <a class="code" href="chron3_8c.html#a3">grg</a>(minute, &amp;g);
00216         hrmn = 100 * g.<a class="code" href="structGreg.html#m3">hour</a> + g.<a class="code" href="structGreg.html#m4">minute</a>;
00217         sprintf(c20, <span class="stringliteral">"%04d%3s%2d %4d%6.2f"</span>,
00218                 g.<a class="code" href="structGreg.html#m0">year</a>, cmo[g.<a class="code" href="structGreg.html#m1">month</a>-1], g.<a class="code" href="structGreg.html#m2">day</a>, hrmn, sex);
00219 }
00220 
00221 <span class="comment">/*</span>
00222 <span class="comment"> * tnow : Returns current system time for time stamping</span>
00223 <span class="comment"> */</span>
<a name="l00224"></a><a class="code" href="chron3_8c.html#a7">00224</a> <span class="keywordtype">double</span> <a class="code" href="chron3_8c.html#a7">tnow</a>( <span class="keywordtype">void</span> )
00225 {
00226         <span class="keyword">struct </span>Greg g;
00227 <span class="comment">/*      struct timeb q; */</span>
00228         time_t tsecs;
00229         <span class="keywordtype">double</span> secs;
00230 
00231         g.<a class="code" href="structGreg.html#m0">year</a>   = 1970;
00232         g.<a class="code" href="structGreg.html#m1">month</a>  = 1;
00233         g.<a class="code" href="structGreg.html#m2">day</a>    = 1;
00234         g.<a class="code" href="structGreg.html#m3">hour</a>   = 0;
00235         g.<a class="code" href="structGreg.html#m4">minute</a> = 0;
00236 <span class="comment">/* original code by Carl; ftime() not supported on Sparc C compiler 3.0.1 */</span>
00237 <span class="comment">/*      ftime(&amp;q);                                              */</span>
00238 <span class="comment">/*      secs = 60.0 * julmin(&amp;g) + q.time +  0.001 * q.millitm; */</span>
00239         time(&amp;tsecs);                                   <span class="comment">/*950501:ldd.*/</span>
00240         secs = 60.0 * <a class="code" href="chron3_8c.html#a2">julmin</a>(&amp;g) + (double) tsecs;      <span class="comment">/*950501:ldd.*/</span>
00241         <span class="keywordflow">return</span> secs;
00242 }
00243 
00244 <span class="comment">/*</span>
00245 <span class="comment"> * Calculate gregorian date and time from julian seconds.</span>
00246 <span class="comment"> */</span>
<a name="l00247"></a><a class="code" href="chron3_8c.html#a8">00247</a> <span class="keyword">struct </span>Greg *<a class="code" href="chron3_8c.html#a8">datime</a>( double secs, struct Greg *pg )
00248 {
00249         <span class="keywordtype">long</span> j, m, <a class="code" href="socket__ew_8h.html#a3">min</a>;
00250 
00251         <a class="code" href="socket__ew_8h.html#a3">min</a> = (long) (secs / 60.0);
00252         j = <a class="code" href="socket__ew_8h.html#a3">min</a>/1440L;
00253         m = <a class="code" href="socket__ew_8h.html#a3">min</a>-1440L*j;
00254         j += 2305448L;
00255         <a class="code" href="chron3_8c.html#a5">gregor</a>(j,pg);
00256         pg-&gt;<a class="code" href="structGreg.html#m3">hour</a> = m/60;
00257         pg-&gt;<a class="code" href="structGreg.html#m4">minute</a> = m - 60 * pg-&gt;<a class="code" href="structGreg.html#m3">hour</a>;
00258         pg-&gt;<a class="code" href="structGreg.html#m5">second</a> = (float) (secs - 60.0 * <a class="code" href="socket__ew_8h.html#a3">min</a>);
00259         <span class="keywordflow">return</span>(pg);
00260 }
00261 
00262 <span class="comment">/*</span>
00263 <span class="comment"> * date17 : Build a 17 char date string in the form 19880123123412.21</span>
00264 <span class="comment"> *          from the julian seconds.  Remember to leave space for the</span>
00265 <span class="comment"> *          string termination (NULL).</span>
00266 <span class="comment"> *          Replaces the non-Y2K-compliant date15() function.</span>
00267 <span class="comment"> *          Added to chron3.c on 10/28/98 by LDD</span>
00268 <span class="comment"> */</span>
<a name="l00269"></a><a class="code" href="chron3_8c.html#a9">00269</a> <span class="keywordtype">void</span> <a class="code" href="chron3_8c.html#a9">date17</a>( <span class="keywordtype">double</span> secs, <span class="keywordtype">char</span> *c17 )
00270 {
00271         <span class="keyword">struct </span>Greg g;
00272         <span class="keywordtype">long</span> minute;
00273         <span class="keywordtype">double</span> sex;
00274 
00275         minute = (long) (secs / 60.0);
00276         sex = secs - 60.0 * (double) minute;
00277         <a class="code" href="chron3_8c.html#a3">grg</a>(minute,&amp;g);
00278         sprintf(c17, <span class="stringliteral">"%04d%02d%02d%02d%02d%05.2f\0"</span>,
00279                 g.<a class="code" href="structGreg.html#m0">year</a>, g.<a class="code" href="structGreg.html#m1">month</a>, g.<a class="code" href="structGreg.html#m2">day</a>, g.<a class="code" href="structGreg.html#m3">hour</a>, g.<a class="code" href="structGreg.html#m4">minute</a>, sex);
00280 }
00281 
00282 <span class="comment">/*</span>
00283 <span class="comment"> * julsec17 : Calculate time in julian seconds from a character string</span>
00284 <span class="comment"> *            of the form 19880123123412.21</span>
00285 <span class="comment"> *            Replaces the non-Y2K-compliant julsec15() function.</span>
00286 <span class="comment"> *            Added to chron3.c on 10/28/98 by LDD</span>
00287 <span class="comment"> */</span>
<a name="l00288"></a><a class="code" href="chron3_8c.html#a10">00288</a> <span class="keywordtype">double</span> <a class="code" href="chron3_8c.html#a10">julsec17</a>( <span class="keywordtype">char</span> *c17 )
00289 {
00290         <span class="keyword">struct </span>Greg  g;
00291         <span class="keywordtype">double</span>       jsecs;
00292         <span class="keywordtype">int</span>          narg, i;
00293         <span class="keywordtype">int</span>          isec, hsec;
00294 
00295 <span class="comment">/*** Make sure there are no blanks in the time part of the pick ***/</span>
00296         <span class="keywordflow">for</span>(i=0; i&lt;17; i++)
00297         {
00298                 <span class="keywordflow">if</span>( c17[i] == <span class="charliteral">' '</span> )  c17[i] = <span class="charliteral">'0'</span>;
00299         }
00300 
00301 <span class="comment">/***  Read character string  ***/</span>
00302         narg = sscanf( c17, <span class="stringliteral">"%4d%2d%2d%2d%2d%2d.%2d"</span>,
00303                         &amp;g.<a class="code" href="structGreg.html#m0">year</a>, &amp;g.<a class="code" href="structGreg.html#m1">month</a>, &amp;g.<a class="code" href="structGreg.html#m2">day</a>,
00304                         &amp;g.<a class="code" href="structGreg.html#m3">hour</a>, &amp;g.<a class="code" href="structGreg.html#m4">minute</a>, &amp;isec, &amp;hsec);
00305 
00306         <span class="keywordflow">if</span> ( narg &lt; 7 )  <span class="keywordflow">return</span>( 0.0 );
00307 
00308 
00309 <span class="comment">/***  Calculate julian seconds ***/</span>
00310         jsecs   = 60.0 * (double) <a class="code" href="chron3_8c.html#a2">julmin</a>(&amp;g) +
00311                          (double) isec +
00312                          (double) hsec / 100.0;
00313 
00314         <span class="keywordflow">return</span>( jsecs );
00315 }
00316 
00317 <span class="comment">/*</span>
00318 <span class="comment"> * epochsec17 :  Convert time in a character string form of</span>
00319 <span class="comment"> *               ccyymmddhhmmss.ff (19880231010155.23) to</span>
00320 <span class="comment"> *               seconds since 1970-01-01 00:00:00.0</span>
00321 <span class="comment"> *               Replaces the non-Y2K-compliant epochsec15() function.</span>
00322 <span class="comment"> *               Added to chron3.c on 10/28/98 by LDD</span>
00323 <span class="comment"> */</span>
<a name="l00324"></a><a class="code" href="chron3_8c.html#a11">00324</a> <span class="keywordtype">int</span> <a class="code" href="chron3_8c.html#a11">epochsec17</a>( <span class="keywordtype">double</span> *sec, <span class="keywordtype">char</span> *tstr )
00325 {
00326    <span class="keywordtype">double</span> jsec;
00327 
00328    jsec = <a class="code" href="chron3_8c.html#a10">julsec17</a>( tstr );
00329    <span class="keywordflow">if</span>( jsec==0.0 )
00330    {
00331       *sec=0.0;
00332       <span class="keywordflow">return</span> ( -1 );
00333    }
00334 
00335    *sec = jsec-<a class="code" href="chron3_8h.html#a0">GSEC1970</a>;
00336    <span class="keywordflow">return</span> ( 0 );
00337 }
00338 
00339 <span class="comment">/*</span>
00340 <span class="comment"> * timegm :  Convert time as a struct tm to seconds since 1970-01-01 00:00:00.0</span>
00341 <span class="comment"> *           This function is equivalent to timegm() in SunOS 4.x.</span>
00342 <span class="comment"> *           Added to chron3.c on 2/27/98 by WMK</span>
00343 <span class="comment"> *           Modified to be Y2K compliant 10/28/98 by LDD</span>
00344 <span class="comment"> */</span>
<a name="l00345"></a><a class="code" href="chron3_8c.html#a12">00345</a> time_t <a class="code" href="chron3_8c.html#a12">timegm</a>( <span class="keyword">struct</span> tm *tm )
00346 {
00347    <span class="keywordtype">char</span>   tstr[18];
00348    <span class="keywordtype">double</span> dsec;
00349 
00350    sprintf( tstr, <span class="stringliteral">"%04d%02d%02d%02d%02d%02d.00"</span>,
00351             tm-&gt;tm_year + 1900,
00352             tm-&gt;tm_mon + 1,
00353             tm-&gt;tm_mday,
00354             tm-&gt;tm_hour,
00355             tm-&gt;tm_min,
00356             tm-&gt;tm_sec );
00357 
00358    <a class="code" href="chron3_8c.html#a11">epochsec17</a>( &amp;dsec, tstr );
00359    <span class="keywordflow">return</span>( (time_t)dsec );
00360 }
00361 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:00 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
