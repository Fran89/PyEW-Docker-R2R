<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>kom.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>kom.c</h1><a href="kom_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: kom_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.2  2001/10/05 20:42:15  dietz</span>
00011 <span class="comment"> *     Increased MAXCRD to 1024 (was 512)</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00014 <span class="comment"> *     Initial revision</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> */</span>
00018 
00019 <span class="comment">/*</span>
00020 <span class="comment"> * kom.c : Simple positional command parser.</span>
00021 <span class="comment"> *</span>
00022 <span class="comment"> *$ 91May07 CEJ Version 1.0</span>
00023 <span class="comment"> *$ 93Oct03 CEJ Added k_put routine.</span>
00024 <span class="comment"> *$ 95Oct18 LDD Created kom.h to house function prototypes.</span>
00025 <span class="comment"> *              Explicitly declared return types for all functions.</span>
00026 <span class="comment"> */</span>
00027 <span class="comment">/*********************C O P Y R I G H T   N O T I C E ***********************/</span>
00028 <span class="comment">/* Copyright 1991 by Carl Johnson.  All rights are reserved. Permission     */</span>
00029 <span class="comment">/* is hereby granted for the use of this product for nonprofit, commercial, */</span>
00030 <span class="comment">/* or noncommercial publications that contain appropriate acknowledgement   */</span>
00031 <span class="comment">/* of the author. Modification of this code is permitted as long as this    */</span>
00032 <span class="comment">/* notice is included in each resulting source module.                      */</span>
00033 <span class="comment">/****************************************************************************/</span>
00034 
00035 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00036 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00037 <span class="preprocessor">#include &lt;string.h&gt;</span>
00038 <span class="preprocessor">#include &lt;<a class="code" href="kom_8h.html">kom.h</a>&gt;</span>
00039 
<a name="l00040"></a><a class="code" href="kom_8c.html#a0">00040</a> <span class="preprocessor">#define MAXCRD 1024</span>
<a name="l00041"></a><a class="code" href="structk__buf.html">00041</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structk__buf.html">k_buf</a> {
<a name="l00042"></a><a class="code" href="structk__buf.html#m0">00042</a>         FILE *<a class="code" href="structk__buf.html#m0">fid</a>;
<a name="l00043"></a><a class="code" href="structk__buf.html#m1">00043</a>         <span class="keywordtype">int</span> <a class="code" href="structk__buf.html#m1">ncrd</a>;               <span class="comment">/* bytes in command             */</span>
<a name="l00044"></a><a class="code" href="structk__buf.html#m2">00044</a>         <span class="keywordtype">int</span> <a class="code" href="structk__buf.html#m2">istr</a>;               <span class="comment">/* index of current string      */</span>
<a name="l00045"></a><a class="code" href="structk__buf.html#m3">00045</a>         <span class="keywordtype">int</span> <a class="code" href="structk__buf.html#m3">icrd</a>;               <span class="comment">/* scan pointer                 */</span>
<a name="l00046"></a><a class="code" href="structk__buf.html#m4">00046</a>         <span class="keywordtype">int</span> <a class="code" href="structk__buf.html#m4">ierr</a>;               <span class="comment">/* error if non-zero            */</span>
<a name="l00047"></a><a class="code" href="structk__buf.html#m5">00047</a>         <span class="keywordtype">char</span> <a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a0">MAXCRD</a>];       <span class="comment">/* command buffer               */</span>
<a name="l00048"></a><a class="code" href="structk__buf.html#m6">00048</a>         <span class="keywordtype">char</span> <a class="code" href="structk__buf.html#m6">csav</a>[<a class="code" href="kom_8c.html#a0">MAXCRD</a>];      <span class="comment">/* last command read            */</span>
00049 } ;
00050 
<a name="l00051"></a><a class="code" href="kom_8c.html#a1">00051</a> <span class="preprocessor">#define MAXBUF 4</span>
<a name="l00052"></a><a class="code" href="kom_8c.html#a2">00052</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structk__buf.html">k_buf</a> <a class="code" href="kom_8c.html#a2">com</a> = {0L, 0, 0, 0, 0, <span class="stringliteral">"Virgin"</span>, <span class="stringliteral">"Virgin"</span>};
<a name="l00053"></a><a class="code" href="kom_8c.html#a3">00053</a> <span class="keyword">struct </span><a class="code" href="structk__buf.html">k_buf</a> <a class="code" href="kom_8c.html#a3">Kbuf</a>[<a class="code" href="kom_8c.html#a1">MAXBUF</a>];
<a name="l00054"></a><a class="code" href="kom_8c.html#a4">00054</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a4">Nbuf</a> = 0;
00055 
00056 
00057 <span class="comment">/*</span>
00058 <span class="comment"> **** k_open : open new file for k-system input.  For now only one file</span>
00059 <span class="comment"> *              can be open at a time, but it should be straight foward to add</span>
00060 <span class="comment"> *              recursion capabitity using a stack in the com area.</span>
00061 <span class="comment"> */</span>
<a name="l00062"></a><a class="code" href="kom_8c.html#a5">00062</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a5">k_open</a>( <span class="keywordtype">char</span> *name )
00063 {
00064         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a4">Nbuf</a> &lt; <a class="code" href="kom_8c.html#a1">MAXBUF</a> &amp;&amp; <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a>) {
00065                 <a class="code" href="kom_8c.html#a3">Kbuf</a>[<a class="code" href="kom_8c.html#a4">Nbuf</a>++] = <a class="code" href="kom_8c.html#a2">com</a>;
00066                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a> = 0;
00067         }
00068         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a>)
00069                 <span class="keywordflow">return</span>(0);
00070 <span class="comment">/*      if(!strcmp(name, "term"))</span>
00071 <span class="comment">                com.fid = stdin;</span>
00072 <span class="comment">        else                                                    */</span>
00073                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a> = fopen(name, <span class="stringliteral">"r"</span>);
00074         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a>)
00075                 <span class="keywordflow">return</span>(<a class="code" href="kom_8c.html#a4">Nbuf</a>+1);
00076         <span class="keywordflow">return</span>(0);
00077 
00078 }
00079 <span class="comment">/*</span>
00080 <span class="comment"> **** k_close : close current file</span>
00081 <span class="comment"> */</span>
<a name="l00082"></a><a class="code" href="kom_8c.html#a6">00082</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a6">k_close</a>( <span class="keywordtype">void</span> )
00083 {
00084         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a>){
00085                 <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a> != stdin)
00086                         fclose(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a>);
00087                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a> = 0L;
00088         }
00089         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a4">Nbuf</a> &gt; 0) {
00090                 <a class="code" href="kom_8c.html#a2">com</a> = <a class="code" href="kom_8c.html#a3">Kbuf</a>[--<a class="code" href="kom_8c.html#a4">Nbuf</a>];
00091                 <span class="keywordflow">return</span> <a class="code" href="kom_8c.html#a4">Nbuf</a>+1;
00092         }
00093         <span class="keywordflow">return</span>(0);
00094 
00095 }
00096 
00097 <span class="comment">/*</span>
00098 <span class="comment"> **** k_get : Return pointer to current card.</span>
00099 <span class="comment"> */</span>
<a name="l00100"></a><a class="code" href="kom_8c.html#a7">00100</a> <span class="keywordtype">char</span> *<a class="code" href="kom_8c.html#a7">k_get</a>( <span class="keywordtype">void</span> )
00101 {
00102         <span class="keywordflow">return</span> <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>;
00103 }
00104 
00105 <span class="comment">/*</span>
00106 <span class="comment"> **** k_dump : Print last card read.</span>
00107 <span class="comment"> */</span>
<a name="l00108"></a><a class="code" href="kom_8c.html#a8">00108</a> <span class="keywordtype">void</span> <a class="code" href="kom_8c.html#a8">k_dump</a>( <span class="keywordtype">void</span> )
00109 {
00110         printf(<span class="stringliteral">"%s\n"</span>, <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>);
00111 }
00112 
00113 <span class="comment">/*</span>
00114 <span class="comment"> **** k_err : return last error code and clear</span>
00115 <span class="comment"> */</span>
<a name="l00116"></a><a class="code" href="kom_8c.html#a9">00116</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a9">k_err</a>( <span class="keywordtype">void</span> )
00117 {
00118         <span class="keywordtype">int</span> jerr;
00119 
00120         jerr = <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a>;
00121         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = 0;
00122         <span class="keywordflow">return</span>(jerr);
00123 }
00124 
00125 <span class="comment">/*</span>
00126 <span class="comment"> * k_int : Parce next token as integer.</span>
00127 <span class="comment"> */</span>
<a name="l00128"></a><a class="code" href="kom_8c.html#a10">00128</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a10">k_int</a>( <span class="keywordtype">void</span> )
00129 {
00130         <span class="keywordtype">int</span> ival;
00131         <span class="keywordtype">char</span> *s;
00132 
00133         s = <a class="code" href="kom_8c.html#a16">k_str</a>();
00134         <span class="keywordflow">if</span>(!s) {
00135                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = -1;
00136                 <span class="keywordflow">return</span>(0);
00137         }
00138         ival = atoi(s);
00139         <span class="keywordflow">if</span>(ival == 0 &amp;&amp; *s != <span class="charliteral">'0'</span>) {
00140                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = -2;
00141                 <span class="keywordflow">return</span>(0);
00142         }
00143         <span class="keywordflow">return</span>(ival);
00144 }
00145 
00146 <span class="comment">/*</span>
00147 <span class="comment"> * k_its : Compare string from last token to given command.</span>
00148 <span class="comment"> */</span>
<a name="l00149"></a><a class="code" href="kom_8c.html#a11">00149</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a11">k_its</a>(<span class="keywordtype">char</span> *c)
00150 {
00151         <span class="keywordtype">char</span> *s;
00152 
00153         s = &amp;<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a>];
00154         <span class="keywordflow">while</span>(*c == *s) {
00155                 <span class="keywordflow">if</span>(*s == <span class="charliteral">'\0'</span>)
00156                         <span class="keywordflow">return</span>(1);
00157                 c++;
00158                 s++;
00159         }
00160         <span class="keywordflow">return</span>(0);
00161 }
00162 
00163 <span class="comment">/*</span>
00164 <span class="comment"> * k_long : Return next token as a long integer.</span>
00165 <span class="comment"> */</span>
<a name="l00166"></a><a class="code" href="kom_8c.html#a12">00166</a> <span class="keywordtype">long</span> <a class="code" href="kom_8c.html#a12">k_long</a>( <span class="keywordtype">void</span> )
00167 {
00168         <span class="keywordtype">long</span> lval;
00169         <span class="keywordtype">char</span> *s;
00170 
00171         s = <a class="code" href="kom_8c.html#a16">k_str</a>();
00172         <span class="keywordflow">if</span>(!s) {
00173                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = -1;
00174                 <span class="keywordflow">return</span>(0L);
00175         }
00176         lval = atol(s);
00177         <span class="keywordflow">if</span>(lval == 0 &amp;&amp; *s != <span class="charliteral">'0'</span>) {
00178                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = -2;
00179                <span class="keywordflow">return</span>(0L);
00180         }
00181         <span class="keywordflow">return</span>(lval);
00182 }
00183 
00184 <span class="comment">/*</span>
00185 <span class="comment"> **** k_put : insert command line into buffer</span>
00186 <span class="comment"> */</span>
<a name="l00187"></a><a class="code" href="kom_8c.html#a13">00187</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a13">k_put</a>(<span class="keywordtype">char</span> *crd)
00188  {
00189         <span class="keywordtype">int</span> i, n;
00190 
00191         strcpy(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>, crd);
00192         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> = strlen(crd);
00193         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> &amp;&amp; <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>-1] == <span class="charliteral">'\n'</span>)
00194                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[--<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>] = 0;
00195         <span class="keywordflow">if</span>(!<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>) {
00196                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> = 1;
00197                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[0] = <span class="charliteral">' '</span>;
00198                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[1] = 0;
00199         }
00200         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a> = 0;
00201         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m3">icrd</a> = 0;
00202         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = 0;
00203         n = 1;
00204         <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>; i++) {
00205                 <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">'\t'</span>)
00206                         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] = <span class="charliteral">' '</span>;
00207                 <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] != <span class="charliteral">' '</span>)
00208                         n = i + 1;
00209         }
00210         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> = n;
00211         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[n] = 0;
00212         strcpy(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m6">csav</a>, <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>);
00213         <span class="keywordflow">return</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>);
00214 }
00215 
00216 <span class="comment">/*</span>
00217 <span class="comment"> **** k_rd : read command line into buffer</span>
00218 <span class="comment"> */</span>
<a name="l00219"></a><a class="code" href="kom_8c.html#a14">00219</a> <span class="keywordtype">int</span> <a class="code" href="kom_8c.html#a14">k_rd</a>( <span class="keywordtype">void</span> )
00220 {
00221         FILE *fid;
00222         <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structk__buf.html">k_buf</a> <a class="code" href="kom_8c.html#a2">com</a>;
00223         <span class="keywordtype">int</span> n;
00224         <span class="keywordtype">int</span> i;
00225 
00226         fid = <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a>;
00227         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m0">fid</a>) {
00228                 <span class="keywordflow">if</span>(!fgets(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>, MAXCRD-1, fid))
00229                         <span class="keywordflow">if</span>(feof(fid))
00230                                 <span class="keywordflow">return</span>(0);
00231         } <span class="comment">/*else {</span>
00232 <span class="comment">                if(!gets(com.crd))</span>
00233 <span class="comment">                        return(0);</span>
00234 <span class="comment">        }                                 */</span>
00235         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> = strlen(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>);
00236         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> &amp;&amp; <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>-1] == <span class="charliteral">'\n'</span>)
00237                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[--<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>] = 0;
00238         <span class="keywordflow">if</span>(!<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>) {
00239                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> = 1;
00240                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[0] = <span class="charliteral">' '</span>;
00241                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[1] = 0;
00242         }
00243         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a> = 0;
00244         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m3">icrd</a> = 0;
00245         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = 0;
00246         n = 1;
00247         <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>; i++) {
00248                 <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">'\t'</span>)
00249                         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] = <span class="charliteral">' '</span>;
00250                 <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] != <span class="charliteral">' '</span>)
00251                         n = i + 1;
00252         }
00253         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a> = n;
00254         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[n] = 0;
00255         strcpy(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m6">csav</a>, <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>);
00256         <span class="keywordflow">return</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>);
00257 }
00258 
00259 <span class="comment">/*</span>
00260 <span class="comment"> **** k_com : returns last command line read</span>
00261 <span class="comment"> */</span>
<a name="l00262"></a><a class="code" href="kom_8c.html#a15">00262</a> <span class="keywordtype">char</span> *<a class="code" href="kom_8c.html#a15">k_com</a>( <span class="keywordtype">void</span> )
00263 {
00264         <span class="keywordflow">return</span> <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m6">csav</a>;
00265 }
00266 
00267 <span class="comment">/*</span>
00268 <span class="comment"> **** k_str() : Return next token as a pointer to string.</span>
00269 <span class="comment"> */</span>
<a name="l00270"></a><a class="code" href="kom_8c.html#a16">00270</a> <span class="keywordtype">char</span> *<a class="code" href="kom_8c.html#a16">k_str</a>( <span class="keywordtype">void</span> )
00271 {
00272         <span class="keywordtype">int</span> state;
00273         <span class="keywordtype">int</span> i;
00274 
00275         state = 1;
00276         <span class="keywordflow">for</span>(i=<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m3">icrd</a>; i&lt;<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>; i++) {
00277                 <span class="keywordflow">switch</span>(state) {
00278                 <span class="keywordflow">case</span> 1: <span class="comment">/* Looking for first non-blank          */</span>
00279                         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">' '</span> || <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">'\t'</span>)
00280                                 <span class="keywordflow">break</span>;
00281                         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">'"'</span>) {
00282                                 state = 3;
00283                                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a> = i + 1;
00284                                 <span class="keywordflow">break</span>;
00285                         }
00286                         state = 2;
00287                         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a> = i;
00288                         <span class="keywordflow">break</span>;
00289                 <span class="keywordflow">case</span> 2: <span class="comment">/* Looking for end of normal string */</span>
00290                         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">' '</span> || <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">'\t'</span>) {
00291                                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] = 0;
00292                                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m3">icrd</a> = i + 1;
00293                                 <span class="keywordflow">return</span>(&amp;<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a>]);
00294                         }
00295                         <span class="keywordflow">break</span>;
00296                 <span class="keywordflow">case</span> 3: <span class="comment">/* Quoted string */</span>
00297                         <span class="keywordflow">if</span>(<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] == <span class="charliteral">'"'</span>) {
00298                                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[i] = 0;
00299                                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m3">icrd</a> = i + 1;
00300                                 <span class="keywordflow">return</span>(&amp;<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a>]);
00301                         }
00302                         <span class="keywordflow">break</span>;
00303                 }
00304         }
00305         <span class="keywordflow">if</span>(state == 2) {
00306                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>] = 0;
00307                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m3">icrd</a> = <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m1">ncrd</a>;
00308                 <span class="keywordflow">return</span>(&amp;<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m5">crd</a>[<a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m2">istr</a>]);
00309         }
00310         <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = -17;
00311         <span class="keywordflow">return</span>( (<span class="keywordtype">char</span> *) 0 );
00312 }
00313 
00314 <span class="comment">/*</span>
00315 <span class="comment"> **** k_val() Return next token as a double real</span>
00316 <span class="comment"> */</span>
<a name="l00317"></a><a class="code" href="kom_8c.html#a17">00317</a> <span class="keywordtype">double</span> <a class="code" href="kom_8c.html#a17">k_val</a>( <span class="keywordtype">void</span> )
00318 {
00319         <span class="keywordtype">double</span> val;
00320         <span class="keywordtype">char</span> *s;
00321 
00322         s = <a class="code" href="kom_8c.html#a16">k_str</a>();
00323         <span class="keywordflow">if</span>(!s) {
00324                 <a class="code" href="kom_8c.html#a2">com</a>.<a class="code" href="structk__buf.html#m4">ierr</a> = -1;
00325                 <span class="keywordflow">return</span>(0.0);
00326         }
00327         val = atof(s);
00328         <span class="keywordflow">return</span>(val);
00329 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:03 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
