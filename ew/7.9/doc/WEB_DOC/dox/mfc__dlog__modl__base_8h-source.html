<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mfc_dlog_modl_base.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>mfc_dlog_modl_base.h</h1><a href="mfc__dlog__modl__base_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// mfc_dlog_modl_base.h: interface for the CMFCDialogModuleBase class.</span>
00002 <span class="comment">//</span>
00004 <span class="comment"></span>
00005 <span class="preprocessor">#if !defined(AFX_MFC_DLOG_MODL_BASE_H__5F18DF8E_C017_46E1_8328_7C2D2BBAA0C1__INCLUDED_)</span>
<a name="l00006"></a><a class="code" href="mfc__dlog__modl__base_8h.html#a0">00006</a> <span class="preprocessor"></span><span class="preprocessor">#define AFX_MFC_DLOG_MODL_BASE_H__5F18DF8E_C017_46E1_8328_7C2D2BBAA0C1__INCLUDED_</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#if _MSC_VER &gt; 1000</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#pragma once</span>
00010 <span class="preprocessor"></span><span class="preprocessor">#endif // _MSC_VER &gt; 1000</span>
00011 <span class="preprocessor"></span>
<a name="l00012"></a><a class="code" href="mfc__dlog__modl__base_8h.html#a1">00012</a> <span class="preprocessor">#define _USING_EW_XPORT 1 // avoid earthworm&lt;--&gt;magworm conflict</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "<a class="code" href="mfc__dlog__app__base_8h.html">mfc_dlog_app_base.h</a>"</span>
00015 
00016 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00017 <span class="preprocessor">#include &lt;<a class="code" href="transport_8h.html">transport.h</a>&gt;</span>
00018 }
00019 
00020 <span class="comment">// sacred definitions for message types to report to heartbeat/status ring</span>
00021 <span class="comment">//</span>
<a name="l00022"></a><a class="code" href="mfc__dlog__modl__base_8h.html#a2">00022</a> <span class="preprocessor">#define  ERR_MISSMSG  0 </span><span class="comment">/* message missed in transport ring   */</span>
<a name="l00023"></a><a class="code" href="mfc__dlog__modl__base_8h.html#a3">00023</a> <span class="preprocessor">#define  ERR_TOOBIG   1 </span><span class="comment">/* retreived msg too large for buffer */</span>
<a name="l00024"></a><a class="code" href="mfc__dlog__modl__base_8h.html#a4">00024</a> <span class="preprocessor">#define  ERR_NOTRACK  2 </span><span class="comment">/* severe weirdness in the cellar     */</span>
<a name="l00025"></a><a class="code" href="mfc__dlog__modl__base_8h.html#a5">00025</a> <span class="preprocessor">#define  ERR_QUEUE    3 </span><span class="comment">/* error queueing message for sending */</span>
00026 
00027 
<a name="l00028"></a><a class="code" href="mfc__dlog__modl__base_8h.html#a6">00028</a> <span class="preprocessor">#define SERVE_MAX_LOGOS  20 // maximum incoming logo ids</span>
00029 <span class="preprocessor"></span>
00031 
<a name="l00032"></a><a class="code" href="classCMFCDialogModuleBase.html">00032</a> <span class="keyword">class </span><a class="code" href="classCMFCDialogModuleBase.html">CMFCDialogModuleBase</a> : <span class="keyword">public</span> <a class="code" href="classCMFCDialogAppBase.html">CMFCDialogAppBase</a>  
00033 {
00034 <span class="keyword">public</span>:
00035    <span class="comment">// ------------------------  FOR  CMFCDialogAppBase  ---------------------</span>
00036    <span class="comment">//</span>
00037    <span class="comment">/*</span>
00038 <span class="comment">   ** StartWorkerThread -- The point at which worker threads reenter</span>
00039 <span class="comment">   **                      derived classes.</span>
00040 <span class="comment">   **                      The derived class should have class/instance</span>
00041 <span class="comment">   **                      variable(s) which are set (to indicate work</span>
00042 <span class="comment">   **                      to be done) prior to calling AfxBeginThread()</span>
00043 <span class="comment">   **                      and a sleep should imposed between such a</span>
00044 <span class="comment">   **                      call and any subsequent changes to the variables</span>
00045 <span class="comment">   **                      (to give the spawned thread a chance to read them). </span>
00046 <span class="comment">   **</span>
00047 <span class="comment">   **</span>
00048 <span class="comment">   ** OVERRIDE This method in derived classes as needed.</span>
00049 <span class="comment">   */</span>
00050         UINT <a class="code" href="classCMFCDialogModuleBase.html#a0">StartWorkerThread</a>();
00051 
00052    <span class="comment">// ------------------------  FOR  CMFCDialogModuleBase  ---------------------</span>
00053    <span class="comment">//</span>
00054 
00055    <a class="code" href="classCMFCDialogModuleBase.html#a1">CMFCDialogModuleBase</a>();
00056 
00057         <span class="keyword">virtual</span> <a class="code" href="classCMFCDialogModuleBase.html#a2">~CMFCDialogModuleBase</a>();
00058 
00059 <span class="keyword">protected</span>:
00060 
00061    <span class="comment">// ------------------------  FOR  TConfigurable  ---------------------</span>
00062    <span class="comment">//</span>
00063    <span class="comment">/*</span>
00064 <span class="comment">   **  HandleConfigLine()</span>
00065 <span class="comment">   **</span>
00066 <span class="comment">   **  PARMS:</span>
00067 <span class="comment">   **          p_parser -- the parser being used, command string already</span>
00068 <span class="comment">   **                      in the current token for comparison with Its()</span>
00069 <span class="comment">   **</span>
00070 <span class="comment">   ** RETURN:</span>
00071 <span class="comment">   **          HANDLE_INVALID --  line invalid</span>
00072 <span class="comment">   **          HANDLE_UNUSED  --  line not used</span>
00073 <span class="comment">   **          HANDLE_USED    --  line used okay</span>
00074 <span class="comment">   **</span>
00075 <span class="comment">   **  OVERRIDE for child classes to handle command (.d) lines</span>
00076 <span class="comment">   **          always call &lt;super_class&gt;::HandleConfigLine() when overridden</span>
00077 <span class="comment">   **          (except when super class is CMFCDialogAppBase).</span>
00078 <span class="comment">   **</span>
00079 <span class="comment">   */</span>
00080    <a class="code" href="configurable_8h.html#a3">HANDLE_STATUS</a> <a class="code" href="classCMFCDialogModuleBase.html#b0">HandleConfigLine</a>( <a class="code" href="classConfigSource.html">ConfigSource</a> * p_parser );
00081 
00082    <span class="comment">/* CheckConfig() -- allows derivative classes to report the status of their</span>
00083 <span class="comment">   **                  the lookup values.</span>
00084 <span class="comment">   **</span>
00085 <span class="comment">   ** From within any deriving class, or further derivation, ALWAYS contain a call to</span>
00086 <span class="comment">   ** &lt;super_class&gt;::CheckConfig() in their own CheckConfig() method...</span>
00087 <span class="comment">   ** this ensures that all classes in the heirarchy get their chance to report status.</span>
00088 <span class="comment">   **</span>
00089 <span class="comment">   ** All implementations should set ConfigStatus value to WORM_STAT_BADSTATE if there</span>
00090 <span class="comment">   ** is a configuration problem, otherwise leave it alone.</span>
00091 <span class="comment">   */</span>
00092    <span class="keywordtype">void</span> <a class="code" href="classCMFCDialogModuleBase.html#b1">CheckConfig</a>();
00093 
00094    <span class="comment">// ------------------------  FOR  CMFCDialogAppBase  ---------------------</span>
00095    <span class="comment">//</span>
00096 
00097    <span class="comment">/*</span>
00098 <span class="comment">   ** PrepApp -- actions to be taken to prepare a specific application</span>
00099 <span class="comment">   **            for parsing the command file.</span>
00100 <span class="comment">   **</span>
00101 <span class="comment">   ** OVERRIDE in deriving classes as needed,</span>
00102 <span class="comment">   **          MUST always call &lt;super_class&gt;::PrepApp() when overridden</span>
00103 <span class="comment">   **          (Except when parent is CMFCDialogAppBase).</span>
00104 <span class="comment">   **</span>
00105 <span class="comment">   **  For CMFCDialogAppBase, this: instantiates MyGlobalUtils,</span>
00106 <span class="comment">   **                               sets the logging level</span>
00107 <span class="comment">   **                               changes the working directory</span>
00108 <span class="comment">   */</span>
00109    <span class="keywordtype">bool</span> <a class="code" href="classCMFCDialogModuleBase.html#b2">PrepApp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_configfilename);
00110 
00111 
00112    <span class="comment">/*</span>
00113 <span class="comment">   ** InitApp -- actions to be taken to initialize a specific application</span>
00114 <span class="comment">   **            including the creation of the main form</span>
00115 <span class="comment">   **</span>
00116 <span class="comment">   **  For CMFCDialogAppBase: starts the worker thread that loops in</span>
00117 <span class="comment">   **                         StatusAndReadLoop() to:</span>
00118 <span class="comment">   **                         1. check for shutdown flag in command ring</span>
00119 <span class="comment">   **                         2. call CheckForFatal()</span>
00120 <span class="comment">   **                         3. if input ring specified, checks for message</span>
00121 <span class="comment">   **                            and passes any with accepted logo</span>
00122 <span class="comment">   **                            to HandleMessage()</span>
00123 <span class="comment">   **</span>
00124 <span class="comment">   ** OVERRIDE in deriving classes as needed,</span>
00125 <span class="comment">   **          always call &lt;super_class&gt;::InitApp() when overridden.</span>
00126 <span class="comment">   **          IT IS GENERALLY APPROPRIATE TO call &lt;super_class&gt;::InitApp()</span>
00127 <span class="comment">   **          at end of deriviative classe's implementation.</span>
00128 <span class="comment">   ** </span>
00129 <span class="comment">   */</span>
00130         <span class="keywordtype">bool</span> <a class="code" href="classCMFCDialogModuleBase.html#b3">InitApp</a>();
00131 
00132    <span class="comment">/*</span>
00133 <span class="comment">   ** BeforeMessage -- actions before the first message is handled</span>
00134 <span class="comment">   */</span>
00135    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCMFCDialogModuleBase.html#b4">BeforeMessage</a>();
00136 
00137 
00138 
00139    <span class="comment">// ------------------------  FOR  CMFCDialogModuleBase  ---------------------</span>
00140    <span class="comment">//</span>
00141 
<a name="l00142"></a><a class="code" href="classCMFCDialogModuleBase.html#n0">00142</a>    <a class="code" href="classTGlobalUtils.html">TGlobalUtils</a> * <a class="code" href="classCMFCDialogModuleBase.html#n0">MyGlobalUtils</a>;
00143 
00144    <a class="code" href="worm__types_8h.html#a27">WORM_MSGTYPE_ID</a>  <a class="code" href="classCMFCDialogModuleBase.html#n1">TYPE_ERROR</a>
<a name="l00145"></a><a class="code" href="classCMFCDialogModuleBase.html#n2">00145</a>                  ,  <a class="code" href="classCMFCDialogModuleBase.html#n2">TYPE_HEARTBEAT</a>
00146                  ;
00147 
00148 <span class="keyword">private</span>:
<a name="l00149"></a><a class="code" href="classCMFCDialogModuleBase.html#o0">00149</a>    <span class="keywordtype">int</span>           <a class="code" href="classCMFCDialogModuleBase.html#o0">MaxMessageLength</a>;
<a name="l00150"></a><a class="code" href="classCMFCDialogModuleBase.html#o1">00150</a>    <span class="keywordtype">char</span> *        <a class="code" href="classCMFCDialogModuleBase.html#o1">MessageBuffer</a>;    <span class="comment">// buffer for arriving messages</span>
00151 
00152 <span class="keyword">protected</span>:
00153 
00154    <span class="comment">// Ring to check for shutdown flags, to post heartbeats, etc.</span>
<a name="l00155"></a><a class="code" href="classCMFCDialogModuleBase.html#n3">00155</a>    <a class="code" href="worm__types_8h.html#a34">WORM_RING_NAME</a> <a class="code" href="classCMFCDialogModuleBase.html#n3">CommandRingName</a>;      <span class="comment">// name of transport ring</span>
<a name="l00156"></a><a class="code" href="classCMFCDialogModuleBase.html#n4">00156</a>    <a class="code" href="worm__types_8h.html#a30">WORM_RING_ID</a>   <a class="code" href="classCMFCDialogModuleBase.html#n4">CommandRingKey</a>;   <span class="comment">// key to transport ring</span>
<a name="l00157"></a><a class="code" href="classCMFCDialogModuleBase.html#n5">00157</a>    <a class="code" href="structSHM__INFO.html">SHM_INFO</a>       <a class="code" href="classCMFCDialogModuleBase.html#n5">CommandRegion</a>;    <span class="comment">// Info structure for shared memory (command ring)</span>
00158 
00159    <span class="comment">// Ring for incoming messages (may be the same as command ring)</span>
<a name="l00160"></a><a class="code" href="classCMFCDialogModuleBase.html#n6">00160</a>    <a class="code" href="worm__types_8h.html#a34">WORM_RING_NAME</a> <a class="code" href="classCMFCDialogModuleBase.html#n6">InputRingName</a>;        <span class="comment">// name of transport ring</span>
<a name="l00161"></a><a class="code" href="classCMFCDialogModuleBase.html#n7">00161</a>    <a class="code" href="worm__types_8h.html#a30">WORM_RING_ID</a>   <a class="code" href="classCMFCDialogModuleBase.html#n7">InputRingKey</a>;  <span class="comment">// key to transport ring</span>
<a name="l00162"></a><a class="code" href="classCMFCDialogModuleBase.html#n8">00162</a>    <a class="code" href="structSHM__INFO.html">SHM_INFO</a>       <a class="code" href="classCMFCDialogModuleBase.html#n8">InputRegion</a>;   <span class="comment">// Info structure for shared memory (input ring)</span>
00163 
<a name="l00164"></a><a class="code" href="classCMFCDialogModuleBase.html#n9">00164</a>    <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>               <a class="code" href="classCMFCDialogModuleBase.html#n9">AcceptLogo</a>[<a class="code" href="mfc__dlog__modl__base_8h.html#a6">SERVE_MAX_LOGOS</a>];
<a name="l00165"></a><a class="code" href="classCMFCDialogModuleBase.html#n10">00165</a>    <span class="keywordtype">short</span>         <a class="code" href="classCMFCDialogModuleBase.html#n10">AcceptLogoCount</a>;
00166 
00167    <span class="comment">/*</span>
00168 <span class="comment">   **  HandleMessage() -- method for derivative classes to use to</span>
00169 <span class="comment">   **                     perform the actual handling of message</span>
00170 <span class="comment">   **                     as they arrive on the ring.</span>
00171 <span class="comment">   **</span>
00172 <span class="comment">   ** OVERRIDE in derivative classes to as needed.</span>
00173 <span class="comment">   */</span>
<a name="l00174"></a><a class="code" href="classCMFCDialogModuleBase.html#b5">00174</a>    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCMFCDialogModuleBase.html#b5">HandleMessage</a>( <span class="keyword">const</span> <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>   p_msglogo
00175                              , <span class="keyword">const</span> <span class="keywordtype">char</span>     * p_msg
00176                              ) { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
00177 
00178 
<a name="l00179"></a><a class="code" href="classCMFCDialogModuleBase.html#n11">00179</a>    CWinThread * <a class="code" href="classCMFCDialogModuleBase.html#n11">StatusThread</a>;
00180 
00181         <span class="keywordtype">void</span> <a class="code" href="classCMFCDialogModuleBase.html#b6">SendStatus</a>( WORM_MSGTYPE_ID   p_type
00182                   , <span class="keywordtype">short</span>             p_ierr = 0
00183                   , <span class="keyword">const</span> <span class="keywordtype">char</span>      * p_text = NULL
00184                   );
00185 
00186         <span class="keywordtype">void</span> <a class="code" href="classCMFCDialogModuleBase.html#b7">HeartBeat</a>();
00187 
00188    <span class="comment">/*</span>
00189 <span class="comment">   **  StatusAndReadLoop -- A worker thread enters this method to loop, looking</span>
00190 <span class="comment">   **                       for shutdown flag on the command ring, calling</span>
00191 <span class="comment">   **                       CheckForFatal() to check for fatal errors on other</span>
00192 <span class="comment">   **                       threads, and (if the input ring has been created)</span>
00193 <span class="comment">   **                       check for messages to pass to HandleMessage()</span>
00194 <span class="comment">   */</span>
00195         UINT <a class="code" href="classCMFCDialogModuleBase.html#b8">StatusAndReadLoop</a>();
00196 
00197 
00198    <span class="comment">/*</span>
00199 <span class="comment">   ** CheckForFatal -- check any other threads and states for fatal error</span>
00200 <span class="comment">   **</span>
00201 <span class="comment">   ** RETURN: true on fatal error, false otherwise.</span>
00202 <span class="comment">   **</span>
00203 <span class="comment">   ** OVERRIDE in deriving classes as needed.</span>
00204 <span class="comment">   */</span>
<a name="l00205"></a><a class="code" href="classCMFCDialogModuleBase.html#b9">00205</a>    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCMFCDialogModuleBase.html#b9">CheckForFatal</a>() { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00206 
00207 };
00208 
00209 <span class="preprocessor">#endif // !defined(AFX_MFC_DLOG_MODL_BASE_H__5F18DF8E_C017_46E1_8328_7C2D2BBAA0C1__INCLUDED_)</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:05 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
