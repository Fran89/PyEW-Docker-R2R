<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>read_arc.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>read_arc.c</h1><a href="read__arc_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: read__arc_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.6  2000/12/06 17:50:32  lucky</span>
00011 <span class="comment"> *     Make sure that the onset is read and stored</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *     Revision 1.5  2000/09/12 19:07:34  lucky</span>
00014 <span class="comment"> *     Defined separate FM fields for S and P picks</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> *     Revision 1.4  2000/08/21 19:49:39  lucky</span>
00017 <span class="comment"> *     Fixed read_phs so that the Hpck structure is filled with the information</span>
00018 <span class="comment"> *     for both the P and S wave picks.</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> *     Revision 1.3  2000/04/04 22:51:23  davidk</span>
00021 <span class="comment"> *     changed the starting column position for the read of sumP-&gt;e1dp</span>
00022 <span class="comment"> *     (the intermediate principal error) from 61 to 64.  Due to the error,</span>
00023 <span class="comment"> *     e1dp was being set to an excessively large value that caused an</span>
00024 <span class="comment"> *     error to occur in orareport as it inserted the bad value into the DB.</span>
00025 <span class="comment"> *</span>
00026 <span class="comment"> *     Revision 1.2  2000/03/30 15:43:39  davidk</span>
00027 <span class="comment"> *     added code to handle additional arc message fields in both</span>
00028 <span class="comment"> *     the summary and phase lines, that are used by orareport,</span>
00029 <span class="comment"> *     so that orareport can use the read_arc routines.</span>
00030 <span class="comment"> *</span>
00031 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00032 <span class="comment"> *     Initial revision</span>
00033 <span class="comment"> *</span>
00034 <span class="comment"> *</span>
00035 <span class="comment"> */</span>
00036 
00037 <span class="comment">/* Routines for reading HYP2000ARC summary lines and phase lines.</span>
00038 <span class="comment"> * These routines are provided for the use of arc2trig and two UW-spcific </span>
00039 <span class="comment"> * modules, uw_report and eqtee. They only read the fields that are</span>
00040 <span class="comment"> * required by these modules.</span>
00041 <span class="comment"> * If you need to read more info from the HYP2000ARC message, feel free to</span>
00042 <span class="comment"> * make additions here. You probably will need to add to the structures in</span>
00043 <span class="comment"> * read_arc.h as well.</span>
00044 <span class="comment"> * Completely rewritten by Pete Lombard, 12/03/1998</span>
00045 <span class="comment"> */</span>
00046 
00047 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00048 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>  <span class="comment">/* for atof() */</span>
00049 <span class="preprocessor">#include &lt;string.h&gt;</span>
00050 <span class="preprocessor">#include &lt;<a class="code" href="chron3_8h.html">chron3.h</a>&gt;</span>
00051 <span class="preprocessor">#include &lt;<a class="code" href="read__arc_8h.html">read_arc.h</a>&gt;</span>
00052 
00053 <span class="comment">/********************************</span>
00054 <span class="comment"> * Internal function prototypes *</span>
00055 <span class="comment"> ********************************/</span>
00056 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="read__arc_8c.html#a0">strib</a>( <span class="keywordtype">char</span>* );
00057 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( <span class="keywordtype">char</span>*, <span class="keywordtype">float</span>* );
00058 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="read__arc_8c.html#a2">read_fl1</a>( <span class="keywordtype">char</span>*, <span class="keywordtype">float</span>* );
00059 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="read__arc_8c.html#a3">read_i</a>(<span class="keywordtype">char</span>*, <span class="keywordtype">int</span>* );
00060 
00061 <span class="comment">/********************************</span>
00062 <span class="comment"> * External function prototypes *</span>
00063 <span class="comment"> ********************************/</span>
00064 <span class="keywordtype">void</span> <a class="code" href="logit_8c.html#a18">logit</a>( <span class="keywordtype">char</span> *, <span class="keywordtype">char</span> *, ... );          <span class="comment">/* logit.c      sys-independent  */</span>
00065 
00066 <span class="comment">/**************************************************************</span>
00067 <span class="comment"> * read_hyp() reads the hypocenter line from an archive msg into an </span>
00068 <span class="comment"> *            Hsum structure (defined in read_arch.h)</span>
00069 <span class="comment"> *</span>
00070 <span class="comment"> *      Inputs: sumLine - character string holding the summary line</span>
00071 <span class="comment"> *              shdw - character string holding the summary shadow line</span>
00072 <span class="comment"> *              sumP - pointer to Hsum structure provided by the caller</span>
00073 <span class="comment"> *      returns 0 on success, -1 on parsing errors</span>
00074 <span class="comment"> *</span>
00075 <span class="comment"> ****************************************************************/</span>
00076 
<a name="l00077"></a><a class="code" href="read__arc_8c.html#a5">00077</a> <span class="keywordtype">int</span> <a class="code" href="read__arc_8c.html#a5">read_hyp</a>( <span class="keywordtype">char</span> *sumLine, <span class="keywordtype">char</span> *shdw, <span class="keyword">struct</span> <a class="code" href="structHsum.html">Hsum</a> *sumP )
00078 {
00079   <span class="keywordtype">char</span>   str[200];
00080   <span class="keywordtype">float</span>  deg, <a class="code" href="socket__ew_8h.html#a3">min</a>;
00081   <span class="keywordtype">float</span>  sign;
00082   <span class="keywordtype">int</span>    len;
00083 
00084   <span class="comment">/* Initialize the output structure</span>
00085 <span class="comment">  **********************************/</span>
00086   memset( sumP, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structHsum.html">Hsum</a>) ); 
00087  
00088   <span class="comment">/* Copy incoming string to a local buffer so we can alter it.</span>
00089 <span class="comment">  ************************************************************/</span>
00090   strncpy ( str, sumLine, 165 ); <span class="comment">/* this should be enough chars for us */</span>
00091   len = strlen( sumLine );       <span class="comment">/* note length of original summary line */</span>
00092 
00093 <span class="comment">/*------------------------------------------------------------------------</span>
00094 <span class="comment">Sample HYP2000ARC archive summary line and its shadow.  The summary line</span>
00095 <span class="comment">may be up to 188 characters long.  Its full format is described in</span>
00096 <span class="comment">documentation (hyp2000.shadow.doc) by Fred Klein.</span>
00097 <span class="comment">199204290117039536 2577120 2407  475  0 18 98 17  16 5975 128175 6  58343COA  38    0  57 124 21   0 218  0  8COA WW D 24X   0  0L  0  0     10123D343 218Z  0   0  \n</span>
00098 <span class="comment">YYYYMMDDHHMMSSssLLsLLLLlllsllllDDDDDMMMpppGGGnnnRRRRAAADDEEEEAAADDMMMMCCCrrreeeerrssshhhhvvvvpppssssddddsssdddmmmapdacpppsaeeewwwmaaawwwIIIIIIIIIIlmmmwwwwammmwwwwVvN</span>
00099 <span class="comment">$1                                                                                0343   0   0\n</span>
00100 <span class="comment">0123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345</span>
00101 <span class="comment">0         1         2         3         4         5         6         7         8         9        10        11        12        13        14        15        16</span>
00102 <span class="comment">------------------------------------------------------------------------*/</span>
00103   
00104   <span class="comment">/* Read origin time</span>
00105 <span class="comment">  ******************/</span>
00106   strncpy( sumP-&gt;<a class="code" href="structHsum.html#m20">cdate</a>,    str,     14 ); <span class="comment">/* YYYYMMDDHHMMSS */</span>
00107   sumP-&gt;<a class="code" href="structHsum.html#m20">cdate</a>[14] = <span class="charliteral">'.'</span>;
00108   strncpy( sumP-&gt;<a class="code" href="structHsum.html#m20">cdate</a>+15, str+14,  2 );  <span class="comment">/* hundreths of seconds */</span>
00109   sumP-&gt;<a class="code" href="structHsum.html#m20">cdate</a>[17] = <span class="charliteral">'\0'</span>;
00110   sumP-&gt;<a class="code" href="structHsum.html#m1">ot</a> = <a class="code" href="chron3_8c.html#a10">julsec17</a>( sumP-&gt;<a class="code" href="structHsum.html#m20">cdate</a> );
00111   <span class="keywordflow">if</span> ( sumP-&gt;<a class="code" href="structHsum.html#m1">ot</a> == 0.0 ) 
00112   {
00113     <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"t"</span>, <span class="stringliteral">"read_hyp: Error decoding origin time: %s\n"</span>,
00114            sumP-&gt;<a class="code" href="structHsum.html#m20">cdate</a> );
00115     <span class="keywordflow">return</span>( -1 );
00116   }
00117   
00118   <span class="comment">/* Read the rest of the card, back to front</span>
00119 <span class="comment">  ******************************************/</span>
00120   <span class="keywordflow">if</span>( len &gt;= 154 )
00121   {
00122   <span class="comment">/* We're not reading fields beyond str[154] (Fortran column 155) */</span>
00123     str[154] = <span class="charliteral">'\0'</span>;
00124     <a class="code" href="read__arc_8c.html#a2">read_fl1</a>( str+150, &amp;sumP-&gt;<a class="code" href="structHsum.html#m23">wtpref</a> );
00125     str[150] = <span class="charliteral">'\0'</span>;
00126     <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+147, &amp;sumP-&gt;<a class="code" href="structHsum.html#m22">Mpref</a> );
00127     sumP-&gt;<a class="code" href="structHsum.html#m21">labelpref</a> = str[146];
00128   }
00129   str[146] = <span class="charliteral">'\0'</span>;  sumP-&gt;<a class="code" href="structHsum.html#m0">qid</a>  = atol( str+136 );
00130   
00131   <span class="comment">/* Added by davidk 20000317 for use by DB PutArc */</span>
00132   sumP-&gt;<a class="code" href="structHsum.html#m24">mdtype</a>=str[117]; <span class="comment">/* coda dur mag type */</span>
00133 
00134   str[107+3]  = <span class="charliteral">'\0'</span>;  
00135   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+107, &amp;sumP-&gt;<a class="code" href="structHsum.html#m25">mdmad</a> ); <span class="comment">/* Mag XX */</span>
00136 
00137   str[100+4]  = <span class="charliteral">'\0'</span>;  
00138   <a class="code" href="read__arc_8c.html#a2">read_fl1</a>( str+100, &amp;sumP-&gt;<a class="code" href="structHsum.html#m26">mdwt</a> ); <span class="comment">/* Mag Wt. */</span>
00139   <span class="comment">/* End: Added by davidk 20000317  */</span>
00140 
00141   str[93]  = <span class="charliteral">'\0'</span>;  
00142   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+89, &amp;sumP-&gt;<a class="code" href="structHsum.html#m17">erz</a> );
00143   str[89]  = <span class="charliteral">'\0'</span>;
00144   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+85, &amp;sumP-&gt;<a class="code" href="structHsum.html#m16">erh</a> );
00145   str[80]  = <span class="charliteral">'\0'</span>;  
00146   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+76, &amp;sumP-&gt;<a class="code" href="structHsum.html#m15">e2</a> );
00147   str[76]  = <span class="charliteral">'\0'</span>;
00148   strncpy( sumP-&gt;<a class="code" href="structHsum.html#m19">reg</a>, str+73, 4 );
00149   str[73]  = <span class="charliteral">'\0'</span>;
00150   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+70, &amp;sumP-&gt;<a class="code" href="structHsum.html#m18">Md</a> );
00151   str[70]  = <span class="charliteral">'\0'</span>;
00152   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+66, &amp;sumP-&gt;<a class="code" href="structHsum.html#m14">e1</a> );
00153   str[66]  = <span class="charliteral">'\0'</span>;  
00154   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+64, &amp;sumP-&gt;<a class="code" href="structHsum.html#m13">e1dp</a> );
00155   str[64]  = <span class="charliteral">'\0'</span>;
00156   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+61, &amp;sumP-&gt;<a class="code" href="structHsum.html#m12">e1az</a> );
00157   str[61]  = <span class="charliteral">'\0'</span>;
00158   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+57, &amp;sumP-&gt;<a class="code" href="structHsum.html#m11">e0</a> );
00159   str[57]  = <span class="charliteral">'\0'</span>;
00160   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+55, &amp;sumP-&gt;<a class="code" href="structHsum.html#m10">e0dp</a> );
00161   str[55]  = <span class="charliteral">'\0'</span>;
00162   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+52, &amp;sumP-&gt;<a class="code" href="structHsum.html#m9">e0az</a> );
00163   str[52]  = <span class="charliteral">'\0'</span>;
00164   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+48, &amp;sumP-&gt;<a class="code" href="structHsum.html#m8">rms</a> );
00165   str[48]  = <span class="charliteral">'\0'</span>;
00166   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+45, &amp;sumP-&gt;<a class="code" href="structHsum.html#m7">dmin</a> );
00167   str[45]  = <span class="charliteral">'\0'</span>;
00168   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+42, &amp;sumP-&gt;<a class="code" href="structHsum.html#m6">gap</a> );
00169   str[42]  = <span class="charliteral">'\0'</span>;
00170   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+39, &amp;sumP-&gt;<a class="code" href="structHsum.html#m5">nph</a> );
00171   str[36]  = <span class="charliteral">'\0'</span>;
00172   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+31, &amp;sumP-&gt;<a class="code" href="structHsum.html#m4">z</a> );
00173   
00174   <span class="comment">/* longitude */</span>
00175   str[31]  = <span class="charliteral">'\0'</span>;  <a class="code" href="socket__ew_8h.html#a3">min</a>        = (float)(atof( str+27 )/100.0);
00176   <span class="keywordflow">if</span> ( str[26] == <span class="charliteral">' '</span> || str[26] == <span class="charliteral">'W'</span> || str[26] == <span class="charliteral">'w'</span> ) 
00177     sign = -1.0;
00178   <span class="keywordflow">else</span>
00179     sign = 1.0;
00180   str[26]  = <span class="charliteral">'\0'</span>;  deg        = (float)atof( str+23 );
00181   sumP-&gt;<a class="code" href="structHsum.html#m3">lon</a> = (float)(sign * ( deg + <a class="code" href="socket__ew_8h.html#a3">min</a> / 60.0 ));
00182 
00183   <span class="comment">/* latitude */</span>
00184   str[23]  = <span class="charliteral">'\0'</span>;  <a class="code" href="socket__ew_8h.html#a3">min</a>        = (float)(atof( str+19 )/100.0);
00185   <span class="keywordflow">if</span> ( str[18] == <span class="charliteral">'S'</span> || str[18] == <span class="charliteral">'s'</span> )
00186     sign = -1.0;
00187   <span class="keywordflow">else</span>
00188     sign = 1.0;
00189   str[18]  = <span class="charliteral">'\0'</span>;  deg        = (float)atof( str+16 );
00190   sumP-&gt;<a class="code" href="structHsum.html#m2">lat</a> = (float)(sign * ( deg + <a class="code" href="socket__ew_8h.html#a3">min</a> / 60.0 ));
00191 
00192   <span class="keywordflow">return</span> ( 0 );
00193 }
00194 
00195 
00196 <span class="comment">/***************************************************************</span>
00197 <span class="comment"> * read_phs() reads a phase line &amp; its shadow from archive msg </span>
00198 <span class="comment"> *            into an Hpck structure (defined in read_arch.h)</span>
00199 <span class="comment"> *      Inputs: phs - character string holding one phase line</span>
00200 <span class="comment"> *              shdw - character string holding the phase shadow line</span>
00201 <span class="comment"> *              pckP - pointer to Hpck structure provided by the caller</span>
00202 <span class="comment"> *     </span>
00203 <span class="comment"> *      returns 0 on success, -1 on parsing errors</span>
00204 <span class="comment"> *</span>
00205 <span class="comment"> ***************************************************************/</span>
00206 
<a name="l00207"></a><a class="code" href="read__arc_8c.html#a6">00207</a> <span class="keywordtype">int</span> <a class="code" href="read__arc_8c.html#a6">read_phs</a>( <span class="keywordtype">char</span> *phs, <span class="keywordtype">char</span> *shdw, <span class="keyword">struct</span> <a class="code" href="structHpck.html">Hpck</a> *pckP )
00208 {
00209         <span class="keywordtype">char</span>    str[120];
00210         <span class="keywordtype">float</span>   Psec, Ssec;
00211         <span class="keywordtype">int</span>     i;
00212         <span class="keywordtype">double</span>  Cat; <span class="comment">/* common arrival time up to yyyymmddhhmm */</span>
00213 
00214    
00215 <span class="comment">/*------------------------------------------------------------------------</span>
00216 <span class="comment">Sample TYPE_HYP2000ARC station archive card (P-arrival) and a shadow card </span>
00217 <span class="comment">  (as output by hyp2000) (phase card is 112 chars; shadow is up to 104 chars):</span>
00218 <span class="comment">PWM  NC VVHZ  PD0199204290117  877  -8136    0   0   0      0 0  0  61   0 169 8400  0   77 88325  0 932   0WD \n</span>
00219 <span class="comment">SSSSSNNxcCCCxrrFWYYYYMMDDHHMMPPPPPRRRRWWWSSSSSrrxWRRRRAAAAAAAuuWWWDDDDddddEEEEAAAwwppprDDDDAAAMMMmmmppppssssSDA\</span>
00220 <span class="comment">$   6 5.49 1.80 7.91 3.30 0.10 PSN0   77 PHP3 1853 39 340 47 245 55 230 63  86 71  70 77  48           \n</span>
00221 <span class="comment">$xnnnAA.AAQQ.QQaa.aaqq.qqRR.RRxccccDDDDDxPHpwAAAAATTTAAAAtttaaaaTTTAAAAtttaaaaTTTAAAAtttaaaaMMMwwwnnnnp\</span>
00222 <span class="comment">0123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123</span>
00223 <span class="comment">--------------------------------------------------------------------------*/</span>
00224 
00225 
00226   <span class="comment">/* Copy phase string to a local buffer so we can alter it.</span>
00227 <span class="comment">  ************************************************************/</span>
00228   memset(str,0,120);
00229   strncpy ( str, phs, 120 );
00230 
00231   <span class="comment">/* Data source code */</span>
00232   pckP-&gt;<a class="code" href="structHpck.html#m18">datasrc</a> = str[108];
00233 
00234   <span class="comment">/* Duration magnitude */</span>
00235   str[94+3] = <span class="charliteral">'\0'</span>;
00236   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+94, &amp;pckP-&gt;<a class="code" href="structHpck.html#m19">Md</a>);
00237 
00238   <span class="comment">/* azimuth to station */</span>
00239   str[91+3] = <span class="charliteral">'\0'</span>;
00240   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+91, &amp;pckP-&gt;<a class="code" href="structHpck.html#m20">azm</a>);
00241 
00242   <span class="comment">/* Coda duration */</span>
00243   str[87+4] = <span class="charliteral">'\0'</span>;
00244   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+87, &amp;pckP-&gt;<a class="code" href="structHpck.html#m13">codalen</a> );
00245 
00246   <span class="comment">/* duration magnitude weight code */</span>
00247   str[82+1] = <span class="charliteral">'\0'</span>;
00248   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+82, &amp;pckP-&gt;<a class="code" href="structHpck.html#m14">codawt</a> );
00249 
00250   <span class="comment">/* emergence angle at source */</span>
00251   str[78+3] = <span class="charliteral">'\0'</span>;
00252   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+78, &amp;pckP-&gt;<a class="code" href="structHpck.html#m21">takeoff</a>);
00253 
00254   <span class="comment">/* epicentral distance */</span>
00255   str[74+4] = <span class="charliteral">'\0'</span>;
00256   <a class="code" href="read__arc_8c.html#a2">read_fl1</a>( str+74, &amp;pckP-&gt;<a class="code" href="structHpck.html#m22">dist</a>);
00257 
00258   <span class="comment">/* S weight actually used */</span>
00259   str[63+3]  = <span class="charliteral">'\0'</span>;
00260   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+63, &amp;pckP-&gt;<a class="code" href="structHpck.html#m24">Swt</a>);
00261 
00262   <span class="comment">/* S travel time residual */</span>
00263   str[50+4]  = <span class="charliteral">'\0'</span>;
00264   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+50, &amp;pckP-&gt;<a class="code" href="structHpck.html#m10">Sres</a> );
00265 
00266   <span class="comment">/* Assigned S weight code */</span>
00267   str[49+1]  = <span class="charliteral">'\0'</span>;
00268   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+49, &amp;pckP-&gt;<a class="code" href="structHpck.html#m12">Squal</a> );
00269 
00270   pckP-&gt;<a class="code" href="structHpck.html#m16">Sfm</a> = str[48];
00271 
00272   <span class="comment">/* S phase label */</span>
00273   pckP-&gt;<a class="code" href="structHpck.html#m4">Slabel</a> = str[47];
00274 
00275   <span class="comment">/* S phase onset */</span>
00276   pckP-&gt;<a class="code" href="structHpck.html#m6">Sonset</a> = str[46];
00277 
00278   <span class="comment">/* Second of S arrival */</span>
00279   str[41+5]  = <span class="charliteral">'\0'</span>;  
00280   Ssec = (float)(atof( str+41 )/100.0 );
00281 
00282   <span class="comment">/* P weight actually used */</span>
00283   str[38+3]  = <span class="charliteral">'\0'</span>;
00284   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+38, &amp;pckP-&gt;<a class="code" href="structHpck.html#m23">Pwt</a>);
00285 
00286   <span class="comment">/* P travel time residual */</span>
00287   str[34+4]  = <span class="charliteral">'\0'</span>;
00288   <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( str+34, &amp;pckP-&gt;<a class="code" href="structHpck.html#m9">Pres</a> );
00289 
00290   <span class="comment">/* Seconds of P arrival */</span>
00291   str[29+5]  = <span class="charliteral">'\0'</span>;  
00292   Psec = (float)(atof( str+29 )/100.0 );
00293 
00294   <span class="comment">/* Figure out the common time */</span>
00295   strncpy( pckP-&gt;<a class="code" href="structHpck.html#m17">cdate</a>, str+17, 12 ); <span class="comment">/* YYYYMMDDHHMM */</span>
00296   pckP-&gt;<a class="code" href="structHpck.html#m17">cdate</a>[12] = <span class="charliteral">'\0'</span>;
00297   strcat(pckP-&gt;<a class="code" href="structHpck.html#m17">cdate</a>, <span class="stringliteral">"00.00"</span> );
00298   Cat = <a class="code" href="chron3_8c.html#a10">julsec17</a>( pckP-&gt;<a class="code" href="structHpck.html#m17">cdate</a> );
00299   <span class="keywordflow">if</span> ( Cat == 0.0 ) 
00300   {
00301     <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"t"</span>, <span class="stringliteral">"read_phs: Error decoding arrival time: %s\n"</span>,
00302                     pckP-&gt;<a class="code" href="structHpck.html#m17">cdate</a> );
00303     <span class="keywordflow">return</span>( -1 );
00304   }
00305 
00306   <span class="comment">/* Calculate P and S arrival times */</span>
00307   pckP-&gt;<a class="code" href="structHpck.html#m7">Pat</a> = Cat + Psec;
00308   pckP-&gt;<a class="code" href="structHpck.html#m8">Sat</a> = Cat + Ssec;
00309 
00310   <span class="comment">/* Assigned P weight code */</span>
00311   str[16+1]  = <span class="charliteral">'\0'</span>;
00312   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+16, &amp;pckP-&gt;<a class="code" href="structHpck.html#m11">Pqual</a> );
00313 
00314   pckP-&gt;<a class="code" href="structHpck.html#m15">Pfm</a> = str[15];
00315 
00316   <span class="comment">/* P phase label */</span>
00317   pckP-&gt;<a class="code" href="structHpck.html#m3">Plabel</a> = str[14];
00318 
00319   <span class="comment">/* P phase onset */</span>
00320   pckP-&gt;<a class="code" href="structHpck.html#m5">Ponset</a> = str[13];
00321 
00322   <span class="comment">/* Component code */</span>
00323   str[9+3]  = <span class="charliteral">'\0'</span>;  
00324   strcpy(pckP-&gt;<a class="code" href="structHpck.html#m2">comp</a>, str+9); 
00325   <a class="code" href="read__arc_8c.html#a0">strib</a>(pckP-&gt;<a class="code" href="structHpck.html#m2">comp</a>);
00326 
00327   <span class="comment">/* network code */</span>
00328   str[5+2]   = <span class="charliteral">'\0'</span>;  
00329   strcpy(pckP-&gt;<a class="code" href="structHpck.html#m1">net</a>,  str +5); 
00330   <a class="code" href="read__arc_8c.html#a0">strib</a>(pckP-&gt;<a class="code" href="structHpck.html#m1">net</a>);
00331 
00332   <span class="comment">/* station site code */</span>
00333   str[5]   = <span class="charliteral">'\0'</span>;  
00334   strcpy(pckP-&gt;<a class="code" href="structHpck.html#m0">site</a>, str); 
00335   <a class="code" href="read__arc_8c.html#a0">strib</a>(pckP-&gt;<a class="code" href="structHpck.html#m0">site</a>);
00336 
00337 
00338   <span class="comment">/* Copy shadow string to a local buffer so we can alter it.</span>
00339 <span class="comment">  ************************************************************/</span>
00340   memset(str,0,120);
00341   strncpy ( str, shdw, 120 );
00342 
00343   str[88+4] = <span class="charliteral">'\0'</span>;
00344   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+88,  &amp;(pckP-&gt;<a class="code" href="structHpck.html#m28">caav</a>[5]) );
00345 
00346   str[85+3] = <span class="charliteral">'\0'</span>;
00347   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+85, &amp;(pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[5]) );
00348 
00349   str[81+4] = <span class="charliteral">'\0'</span>;
00350   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+81,  &amp;(pckP-&gt;<a class="code" href="structHpck.html#m28">caav</a>[4]) );
00351 
00352   str[78+3] = <span class="charliteral">'\0'</span>;
00353   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+78, &amp;(pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[4]) );
00354 
00355   str[74+4] = <span class="charliteral">'\0'</span>;
00356   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+74,  &amp;(pckP-&gt;<a class="code" href="structHpck.html#m28">caav</a>[3]) );
00357 
00358   str[71+3] = <span class="charliteral">'\0'</span>;
00359   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+71, &amp;(pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[3]) );
00360 
00361   str[67+4] = <span class="charliteral">'\0'</span>;
00362   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+67,  &amp;(pckP-&gt;<a class="code" href="structHpck.html#m28">caav</a>[2]) );
00363 
00364   str[64+3] = <span class="charliteral">'\0'</span>;
00365   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+64, &amp;(pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[2]) );
00366 
00367   str[60+4] = <span class="charliteral">'\0'</span>;
00368   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+60,  &amp;(pckP-&gt;<a class="code" href="structHpck.html#m28">caav</a>[1]) );
00369 
00370   str[57+3] = <span class="charliteral">'\0'</span>;
00371   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+57, &amp;(pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[1]) );
00372 
00373   str[53+4] = <span class="charliteral">'\0'</span>;
00374   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+53,  &amp;(pckP-&gt;<a class="code" href="structHpck.html#m28">caav</a>[0]) );
00375 
00376   str[50+3] = <span class="charliteral">'\0'</span>;
00377   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+50, &amp;(pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[0]) );
00378 
00379   <span class="keywordflow">for</span>( i=0; i&lt;6; i++ ) 
00380   {
00381     <span class="keywordflow">if</span>( pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[i]==0 ) 
00382     {
00383             pckP-&gt;<a class="code" href="structHpck.html#m27">ccntr</a>[i]    = (long)NULL;
00384       pckP-&gt;<a class="code" href="structHpck.html#m28">caav</a>[i]     = (long)NULL;
00385     }
00386   }
00387 
00388   str[45+5] = <span class="charliteral">'\0'</span>;
00389   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+45, &amp;pckP-&gt;<a class="code" href="structHpck.html#m25">pamp</a> );
00390 
00391   str[35+5] = <span class="charliteral">'\0'</span>;
00392   <a class="code" href="read__arc_8c.html#a3">read_i</a>( str+35, &amp;pckP-&gt;<a class="code" href="structHpck.html#m26">codalenObs</a>);
00393 
00394 
00395   <span class="keywordflow">return</span> ( 0 );
00396 }
00397 
00398 
00399 <span class="comment">/*</span>
00400 <span class="comment"> * Strip trailing blanks and newlines from string.</span>
00401 <span class="comment"> */</span>
<a name="l00402"></a><a class="code" href="read__arc_8c.html#a0">00402</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="read__arc_8c.html#a0">strib</a>( <span class="keywordtype">char</span> *string )
00403 {
00404   <span class="keywordtype">int</span> i, length;
00405   
00406   length = strlen( string );
00407   <span class="keywordflow">if</span> ( length )
00408   {
00409     <span class="keywordflow">for</span> ( i = length-1; i &gt;= 0; i-- )
00410     {
00411       <span class="keywordflow">if</span> ( string[i] == <span class="charliteral">' '</span> || string[i] == <span class="charliteral">'\n'</span> )
00412         string[i] = <span class="charliteral">'\0'</span>;
00413       <span class="keywordflow">else</span>
00414         <span class="keywordflow">return</span> ( i+1 );
00415     }
00416   } 
00417   <span class="keywordflow">else</span>
00418     <span class="keywordflow">return</span> length;
00419   <span class="keywordflow">return</span> ( i+1 );
00420 }
00421 
<a name="l00422"></a><a class="code" href="read__arc_8c.html#a1">00422</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="read__arc_8c.html#a1">read_fl2</a>( <span class="keywordtype">char</span>* str, <span class="keywordtype">float</span>* quant )
00423 {
00424   <span class="keywordflow">if</span> ( <a class="code" href="read__arc_8c.html#a0">strib</a>( str ) )
00425     *quant = (float)(atof( str)/100.0 );
00426   <span class="keywordflow">else</span>
00427     *quant = <a class="code" href="read__arc_8h.html#a0">NO_FLOAT_VAL</a>;
00428 }
00429 
<a name="l00430"></a><a class="code" href="read__arc_8c.html#a2">00430</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="read__arc_8c.html#a2">read_fl1</a>( <span class="keywordtype">char</span>* str, <span class="keywordtype">float</span>* quant )
00431 {
00432   <span class="keywordflow">if</span> ( <a class="code" href="read__arc_8c.html#a0">strib</a>( str ) )
00433     *quant = (float)(atof( str)/10.0 );
00434   <span class="keywordflow">else</span>
00435     *quant = <a class="code" href="read__arc_8h.html#a0">NO_FLOAT_VAL</a>;
00436 }
00437 
<a name="l00438"></a><a class="code" href="read__arc_8c.html#a3">00438</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="read__arc_8c.html#a3">read_i</a>( <span class="keywordtype">char</span>* str, <span class="keywordtype">int</span>* quant )
00439 {
00440   <span class="keywordflow">if</span> ( <a class="code" href="read__arc_8c.html#a0">strib</a>( str ) )
00441     *quant = atoi( str );
00442   <span class="keywordflow">else</span>
00443     *quant = <a class="code" href="read__arc_8h.html#a1">NO_INT_VAL</a>;
00444 }
00445 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:07 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
