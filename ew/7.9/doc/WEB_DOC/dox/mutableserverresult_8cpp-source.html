<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mutableserverresult.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>mutableserverresult.cpp</h1><a href="mutableserverresult_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// mutableserverresult.cpp: implementation of the MutableServerResult class.</span>
00002 <span class="comment">//</span>
00004 <span class="comment"></span>
00005 <span class="preprocessor">#include "<a class="code" href="mutableserverresult_8h.html">mutableserverresult.h</a>"</span>
00006 
00007 <span class="preprocessor">#include "<a class="code" href="logger_8h.html">logger.h</a>"</span>
00008 
00010 <span class="comment">// Construction/Destruction</span>
00012 <span class="comment"></span>
<a name="l00013"></a><a class="code" href="classMutableServerResult.html#a0">00013</a> <a class="code" href="classMutableServerResult.html#a0">MutableServerResult::MutableServerResult</a>()
00014 {
00015    <a class="code" href="classMutableServerResult.html#n0">Status</a> = <a class="code" href="result__status_8h.html#a1">MSB_RESULT_ERROR</a>;
00016 }
00017 <span class="comment">//</span>
00018 <span class="comment">// -----------------------------------------------------</span>
00019 <span class="comment">//</span>
<a name="l00020"></a><a class="code" href="classMutableServerResult.html#b0">00020</a> <span class="keywordtype">long</span> <a class="code" href="classMutableServerResult.html#b0">MutableServerResult::BufferInitAlloc</a>()
00021 {
00022    <span class="keywordflow">return</span> (long)(  <a class="code" href="classMutableServerMessage.html#b0">MutableServerMessage::BufferInitAlloc</a>()
00023                  + 3  <span class="comment">// longest result = "-1\n"</span>
00024                 );
00025 }
00026 <span class="comment">//</span>
00027 <span class="comment">// -----------------------------------------------------</span>
00028 <span class="comment">//</span>
<a name="l00029"></a><a class="code" href="classMutableServerResult.html#b1">00029</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerResult.html#b1">MutableServerResult::FormatDerivativeData</a>()
00030 {
00031    <a class="code" href="classMutableServerMessage.html#b1">MutableServerMessage::FormatDerivativeData</a>();
00032 
00033    <span class="keywordtype">char</span> _b[5];
00034 
00035    sprintf( _b, <span class="stringliteral">"%d\n"</span>, Status );
00036 
00037    <span class="comment">// append the result status</span>
00038 
00039    <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.append( _b );
00040 }
00041 <span class="comment">//</span>
00042 <span class="comment">// -----------------------------------------------------</span>
00043 <span class="comment">//</span>
<a name="l00044"></a><a class="code" href="classMutableServerResult.html#b2">00044</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerResult.html#b2">MutableServerResult::ParseDerivativeData</a>()
00045 {
00046    <a class="code" href="classMutableServerResult.html#n0">Status</a> = <a class="code" href="result__status_8h.html#a1">MSB_RESULT_ERROR</a>;
00047 
00048    <a class="code" href="classMutableServerMessage.html#b2">MutableServerMessage::ParseDerivativeData</a>();
00049 
00050    <span class="keywordtype">long</span> _index;
00051 
00052    <span class="keywordflow">if</span> ( (_index = <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.find(<span class="stringliteral">"\n"</span>)) == <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.npos )
00053    {
00054       <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Unterminated message while parsing result code"</span>);
00055    }
00056 
00057 
00058    std::string _status = <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.substr( 0 , _index );
00059 
00060    <span class="comment">// Remove this line from the buffer</span>
00061 
00062    <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.erase( 0 , _index + 1 );
00063 
00064    <a class="code" href="classMutableServerResult.html#n0">Status</a> = (short)atoi( _status.c_str() );
00065 }
00066 <span class="comment">//</span>
00067 <span class="comment">// -----------------------------------------------------</span>
00068 <span class="comment">//</span>
<a name="l00069"></a><a class="code" href="classMutableServerResult.html#a1">00069</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerResult.html#a1">MutableServerResult::SetStatus</a>( <span class="keywordtype">short</span> p_status )
00070 {
00071    <span class="keywordflow">if</span> (   p_status != <a class="code" href="result__status_8h.html#a2">MSB_RESULT_GOOD</a>
00072        &amp;&amp; p_status != <a class="code" href="result__status_8h.html#a4">MSB_RESULT_BUSY</a>
00073        &amp;&amp; p_status != <a class="code" href="result__status_8h.html#a3">MSB_RESULT_FAIL</a>
00074        &amp;&amp; p_status != <a class="code" href="result__status_8h.html#a1">MSB_RESULT_ERROR</a>
00075       )
00076    {
00077       <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"MutableServerResult::SetStatus(): invalid parameter"</span>);
00078    }
00079    <a class="code" href="classMutableServerResult.html#n0">Status</a> = p_status;
00080 }
00081 <span class="comment">//</span>
00082 <span class="comment">// -----------------------------------------------------</span>
00083 <span class="comment">//</span>
<a name="l00084"></a><a class="code" href="classMutableServerResult.html#a2">00084</a> <span class="keywordtype">short</span> <a class="code" href="classMutableServerResult.html#a2">MutableServerResult::GetStatus</a>() { <span class="keywordflow">return</span> <a class="code" href="classMutableServerResult.html#n0">Status</a>; }
00085 <span class="comment">//</span>
00086 <span class="comment">// -----------------------------------------------------</span>
00087 <span class="comment">//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:06 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
