<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>threads_ew.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>threads_ew.c</h1><a href="threads__ew_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: threads__ew_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.1  2000/02/14 18:53:30  lucky</span>
00011 <span class="comment"> *     Initial revision</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> */</span>
00015 
00016               <span class="comment">/********************************************</span>
00017 <span class="comment">              *               threads_ew.c                *</span>
00018 <span class="comment">              *            Windows NT version             *</span>
00019 <span class="comment">              * This file contains functions StartThread, *</span>
00020 <span class="comment">              * WaitThread, and KillThread                *</span>
00021 <span class="comment">              *********************************************/</span>
00022 
00023 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00024 <span class="preprocessor">#include &lt;process.h&gt;</span>
00025 
00026 
00027    <span class="comment">/********************************************************************</span>
00028 <span class="comment">    *                           StartThread                            *</span>
00029 <span class="comment">    *                                                                  *</span>
00030 <span class="comment">    *  Arguments:                                                      *</span>
00031 <span class="comment">    *     fun:        Name of thread function. Must take (void *)      *</span>
00032 <span class="comment">    *                 as an argument and return void                   *</span>
00033 <span class="comment">    *     stack_size: Stack size of new thread in bytes                *</span>
00034 <span class="comment">    *                 If 0, stack size is set to 8192.                 *</span>
00035 <span class="comment">    *                 In OS2, 4096 or 8192 is recommended.             *</span>
00036 <span class="comment">    *                 In SOLARIS, this argument is ignored             *</span>
00037 <span class="comment">    *                 In Windows NT, if stack_size=0, use the stack    *</span>
00038 <span class="comment">    *                 size of the calling thread.                      *</span>
00039 <span class="comment">    *     thread_id:  Thread identification number returned to         *</span>
00040 <span class="comment">    *                 calling program.                                 *</span>
00041 <span class="comment">    *                                                                  *</span>
00042 <span class="comment">    *  The function &lt;fun&gt; is not passed any arguments.                 *</span>
00043 <span class="comment">    *                                                                  *</span>
00044 <span class="comment">    *  Returns:                                                        *</span>
00045 <span class="comment">    *    -1 if error                                                   *</span>
00046 <span class="comment">    *     0 if ok                                                      *</span>
00047 <span class="comment">    ********************************************************************/</span>
00048 
<a name="l00049"></a><a class="code" href="threads__ew_8c.html#a0">00049</a> <span class="keywordtype">int</span> <a class="code" href="earthworm__complex__funcs_8h.html#a19">StartThread</a>( <span class="keywordtype">void</span> fun(<span class="keywordtype">void</span> *), <span class="keywordtype">unsigned</span> stack_size, <span class="keywordtype">unsigned</span> *thread_id )
00050 {
00051    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tid;
00052 
00053    tid = _beginthread( fun, stack_size, NULL );
00054 
00055    <span class="keywordflow">if</span> ( tid == -1 )                <span class="comment">/* Couldn't create thread */</span>
00056       <span class="keywordflow">return</span> -1;
00057 
00058    *thread_id = (unsigned)tid;     <span class="comment">/* Return the thread id */</span>
00059    <span class="keywordflow">return</span> 0;
00060 }
00061 
00062    <span class="comment">/********************************************************************</span>
00063 <span class="comment">    *                       StartThreadWithArg                         *</span>
00064 <span class="comment">    *                                                                  *</span>
00065 <span class="comment">    *  Arguments:                                                      *</span>
00066 <span class="comment">    *     fun:        Name of thread function. Must take (void *)      *</span>
00067 <span class="comment">    *                 as an argument and return void                   *</span>
00068 <span class="comment">    *     arg:        an unsigned long (void*) passed to the thread.   *</span>
00069 <span class="comment">    *     stack_size: Stack size of new thread in bytes                *</span>
00070 <span class="comment">    *                 If 0, stack size is set to 8192.                 *</span>
00071 <span class="comment">    *                 In OS2, 4096 or 8192 is recommended.             *</span>
00072 <span class="comment">    *                 In SOLARIS, this argument is ignored             *</span>
00073 <span class="comment">    *                 In Windows NT, if stack_size=0, use the stack    *</span>
00074 <span class="comment">    *                 size of the calling thread.                      *</span>
00075 <span class="comment">    *     thread_id:  Thread identification number returned to         *</span>
00076 <span class="comment">    *                 calling program.                                 *</span>
00077 <span class="comment">    *                                                                  *</span>
00078 <span class="comment">    *  Returns:                                                        *</span>
00079 <span class="comment">    *    -1 if error                                                   *</span>
00080 <span class="comment">    *     0 if ok                                                      *</span>
00081 <span class="comment">    ********************************************************************/</span>
00082 
<a name="l00083"></a><a class="code" href="threads__ew_8c.html#a1">00083</a> <span class="keywordtype">int</span> <a class="code" href="earthworm__complex__funcs_8h.html#a20">StartThreadWithArg</a>( <span class="keywordtype">void</span> fun(<span class="keywordtype">void</span> *), <span class="keywordtype">void</span>* arg, <span class="keywordtype">unsigned</span> stack_size, 
00084                         <span class="keywordtype">unsigned</span> *thread_id )
00085 {
00086    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tid;
00087 
00088    tid = _beginthread( fun, stack_size, (HANDLE)arg );
00089 
00090    <span class="keywordflow">if</span> ( tid == -1 )                <span class="comment">/* Couldn't create thread */</span>
00091       <span class="keywordflow">return</span> -1;
00092 
00093    *thread_id = (unsigned)tid;     <span class="comment">/* Return the thread id */</span>
00094    <span class="keywordflow">return</span> 0;
00095 }
00096 
00097 
00098    <span class="comment">/*************************************************************</span>
00099 <span class="comment">    *                        KillSelfThread                     *</span>
00100 <span class="comment">    *             For a thread exit without affecting           *</span>
00101 <span class="comment">    *                        other threads                      *</span>
00102 <span class="comment">    *************************************************************/</span>
00103 
<a name="l00104"></a><a class="code" href="threads__ew_8c.html#a2">00104</a> <span class="keywordtype">int</span> <a class="code" href="threads__ew_8c.html#a2">KillSelfThread</a>( <span class="keywordtype">void</span> )
00105 {
00106     _endthread();
00107     <span class="keywordflow">return</span> 0;
00108 }
00109 
00110 
00111   <span class="comment">/*************************************************************</span>
00112 <span class="comment">   *                          WaitThread                       *</span>
00113 <span class="comment">   *                   Wait for thread to die.                 *</span>
00114 <span class="comment">   *                                                           *</span>
00115 <span class="comment">   *  This function is used in coaxtoring.c                    *</span>
00116 <span class="comment">   *                                                           *</span>
00117 <span class="comment">   *    thread_id = Pointer to thread id                       *</span>
00118 <span class="comment">   *                                                           *</span>
00119 <span class="comment">   *  Returns:                                                 *</span>
00120 <span class="comment">   *    -1 if error                                            *</span>
00121 <span class="comment">   *     0 if ok                                               *</span>
00122 <span class="comment">   *************************************************************/</span>
00123 
<a name="l00124"></a><a class="code" href="threads__ew_8c.html#a3">00124</a> <span class="keywordtype">int</span> <a class="code" href="threads__ew_8c.html#a3">WaitThread</a>( <span class="keywordtype">unsigned</span> *thread_id )
00125 {
00126    <span class="keywordflow">if</span> ( WaitForSingleObject( (HANDLE)(*thread_id), INFINITE )
00127                                              == WAIT_FAILED )
00128       <span class="keywordflow">return</span> -1;
00129    <span class="keywordflow">return</span> 0;
00130 }
00131 
00132 
00133    <span class="comment">/************************************************************</span>
00134 <span class="comment">    *                         KillThread                       *</span>
00135 <span class="comment">    *                Force a thread to exit now!               *</span>
00136 <span class="comment">    *                                                          *</span>
00137 <span class="comment">    *  Windows NT documentation gives a strong warning against *</span>
00138 <span class="comment">    *  using TerminateThread(), since no stack cleanup, etc,   *</span>
00139 <span class="comment">    *  is done.                                                *</span>
00140 <span class="comment">    *                                                          *</span>
00141 <span class="comment">    * Argument:                                                *</span>
00142 <span class="comment">    *    tid = id of thread to kill                            *</span>
00143 <span class="comment">    *                                                          *</span>
00144 <span class="comment">    * Returns:                                                 *</span>
00145 <span class="comment">    *     0 if ok                                              *</span>
00146 <span class="comment">    *     non-zero value indicates an error                    *</span>
00147 <span class="comment">    ************************************************************/</span>
00148 
<a name="l00149"></a><a class="code" href="threads__ew_8c.html#a4">00149</a> <span class="keywordtype">int</span> <a class="code" href="threads__ew_8c.html#a4">KillThread</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tid )
00150 {
00151     <span class="keyword">const</span> DWORD exit_code = 0;
00152 
00153     <span class="keywordflow">if</span> ( TerminateThread( (HANDLE)tid, exit_code ) == 0 )
00154        <span class="keywordflow">return</span> -1;
00155 
00156     <span class="keywordflow">return</span> 0;
00157 }
00158 
00159 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:11 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
