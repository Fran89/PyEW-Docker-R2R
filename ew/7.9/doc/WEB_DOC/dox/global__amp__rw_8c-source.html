<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>global_amp_rw.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>global_amp_rw.c</h1><a href="global__amp__rw_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="preprocessor">#include &lt;<a class="code" href="global__amp__rw_8h.html">global_amp_rw.h</a>&gt;</span>
00003 
00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
00005 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00007 
00008 <span class="preprocessor">#include &lt;<a class="code" href="kom_8h.html">kom.h</a>&gt;</span>  <span class="comment">/* string parsing */</span>
00009 
00010 
00011 <span class="comment">/*</span>
00012 <span class="comment">** Version currently handled by this code</span>
00013 <span class="comment">*/</span>
<a name="l00014"></a><a class="code" href="global__amp__rw_8c.html#a0">00014</a> <span class="preprocessor">#define GLOBAL_AMP_VERSION (short)1</span>
00015 <span class="preprocessor"></span>
00016 
00017 <span class="comment">/* ------------------------------------------------------------------------- */</span>
00018 
<a name="l00019"></a><a class="code" href="global__amp__rw_8c.html#a1">00019</a> <a class="code" href="global__msg_8h.html#a1">GLOBAL_MSG_STATUS</a> <a class="code" href="global__amp__rw_8c.html#a1">InitGlobalAmp</a>( <a class="code" href="structGLOBAL__AMP__MSG.html">GLOBAL_AMP_STRUCT</a> * p_struct )
00020 {
00021    <span class="keywordflow">if</span> ( p_struct == NULL )
00022    {
00023      <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a4">GLOBAL_MSG_NULL</a>;
00024    }
00025    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m0">version</a> = <a class="code" href="global__amp__rw_8c.html#a0">GLOBAL_AMP_VERSION</a>;
00026    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m1">logo</a>.<a class="code" href="structMSG__LOGO.html#m2">instid</a> = 0;
00027    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m1">logo</a>.<a class="code" href="structMSG__LOGO.html#m1">mod</a> = 0;
00028    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m1">logo</a>.<a class="code" href="structMSG__LOGO.html#m0">type</a> = 0;
00029    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m2">sequence</a> = 0;
00030    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m3">station</a>, <span class="stringliteral">"?"</span> );
00031    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m4">channel</a>, <span class="stringliteral">"?"</span> );
00032    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m5">network</a>, <span class="stringliteral">"?"</span> );
00033    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m6">location</a>, <span class="stringliteral">"?"</span> );
00034    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m7">amp_time</a>, <span class="stringliteral">"?"</span> );
00035    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m8">amptype</a> = <a class="code" href="earthworm__defs_8h.html#a39">AMPTYPE_NONE</a>;
00036    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m9">adcounts</a> = 0.0;
00037    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m10">period</a> = 0.0;
00038 
00039    <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a>;
00040 }
00041 
00042 <span class="comment">/* ------------------------------------------------------------------------- */</span>
00043 
<a name="l00044"></a><a class="code" href="global__amp__rw_8c.html#a2">00044</a> <a class="code" href="global__msg_8h.html#a1">GLOBAL_MSG_STATUS</a> <a class="code" href="global__amp__rw_8c.html#a2">WriteAmpToBuffer</a>( <a class="code" href="structGLOBAL__AMP__MSG.html">GLOBAL_AMP_STRUCT</a> * p_struct
00045                                   , <span class="keywordtype">char</span>              * p_buffer
00046                                   , <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        p_length
00047                                   )
00048 {
00049    <span class="keywordtype">char</span> _author[10];
00050 
00051    <span class="keywordflow">if</span> ( p_struct == NULL )
00052    {
00053       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a4">GLOBAL_MSG_NULL</a>;
00054    }
00055 
00056    <span class="keywordflow">if</span> ( p_buffer == NULL )
00057    {
00058       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a8">GLOBAL_MSG_BADPARAM</a>;
00059    }
00060 
00061    <span class="keywordflow">if</span> ( p_length &lt; <a class="code" href="global__amp__rw_8h.html#a0">GLOBAL_AMP_MAXBUFSIZE</a> )
00062    {
00063       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a9">GLOBAL_MSG_TOOSMALL</a>;
00064    }
00065 
00066    <span class="keywordflow">if</span> ( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m0">version</a> != <a class="code" href="global__amp__rw_8c.html#a0">GLOBAL_AMP_VERSION</a> )
00067    {
00068       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a5">GLOBAL_MSG_VERSINVALID</a>;
00069    }
00070 
00071    <a class="code" href="global__msg_8c.html#a2">EncodeAuthor</a>( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m1">logo</a>, _author );
00072 
00073    sprintf( p_buffer
00074           , <span class="stringliteral">"%s %d %d %s %s %s %s %s %d %1.4f %1.4f\n"</span>
00075           ,  _author
00076           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m2">sequence</a>
00077           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m0">version</a>
00078           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m3">station</a>
00079           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m4">channel</a>
00080           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m5">network</a>
00081           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m6">location</a>
00082           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m7">amp_time</a>
00083           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m8">amptype</a>
00084           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m9">adcounts</a>
00085           , p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m10">period</a>
00086           );
00087 
00088    <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a>;
00089 }
00090 
00091 <span class="comment">/* ------------------------------------------------------------------------- */</span>
00092 
<a name="l00093"></a><a class="code" href="global__amp__rw_8c.html#a3">00093</a> <a class="code" href="global__msg_8h.html#a1">GLOBAL_MSG_STATUS</a> <a class="code" href="global__amp__rw_8c.html#a3">StringToAmp</a>( <a class="code" href="structGLOBAL__AMP__MSG.html">GLOBAL_AMP_STRUCT</a> * p_struct, <span class="keywordtype">char</span> * p_string )
00094 {
00095    <span class="keywordtype">char</span> _str[80];
00096 
00097    <span class="keywordflow">if</span> ( p_struct == NULL )
00098    {
00099       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a4">GLOBAL_MSG_NULL</a>;
00100    }
00101 
00102    <span class="keywordflow">if</span> ( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m0">version</a> != <a class="code" href="global__amp__rw_8c.html#a0">GLOBAL_AMP_VERSION</a> )
00103    {
00104       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a5">GLOBAL_MSG_VERSINVALID</a>;
00105    }
00106 
00107    <span class="keywordflow">if</span> ( p_string == NULL )
00108    {
00109       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a8">GLOBAL_MSG_BADPARAM</a>;
00110    }
00111 
00112    <a class="code" href="global__amp__rw_8c.html#a1">InitGlobalAmp</a>(p_struct);
00113 
00114    <a class="code" href="kom_8c.html#a13">k_put</a>(p_string);
00115 
00116    <span class="comment">/*  Author  */</span>
00117    strcpy( _str , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00118    <span class="keywordflow">if</span> ( strlen(_str) == 0 )
00119    {
00120       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00121    }
00122 
00123    <span class="keywordflow">if</span> ( <a class="code" href="global__msg_8c.html#a3">DecodeAuthor</a>( &amp;(p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m1">logo</a>), _str ) != <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a> )
00124    {
00125       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00126    }
00127 
00128    <span class="comment">/*  sequence number  */</span>
00129    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m2">sequence</a> = <a class="code" href="kom_8c.html#a12">k_long</a>();
00130    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00131    {
00132       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00133    }
00134 
00135    <span class="comment">/*  version number  */</span>
00136    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m0">version</a> = (short)<a class="code" href="kom_8c.html#a12">k_long</a>();
00137    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00138    {
00139       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00140    }
00141 
00142    <span class="keywordflow">if</span> ( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m0">version</a> != <a class="code" href="global__amp__rw_8c.html#a0">GLOBAL_AMP_VERSION</a> )
00143    {
00144       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a5">GLOBAL_MSG_VERSINVALID</a>;
00145    }
00146 
00147    <span class="comment">/*  Station  */</span>
00148    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m3">station</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00149    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m3">station</a>) == 0 )
00150    {
00151       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00152    }
00153 
00154    <span class="comment">/*  Channel  */</span>
00155    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m4">channel</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00156    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m4">channel</a>) == 0 )
00157    {
00158       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00159    }
00160 
00161    <span class="comment">/*  Network  */</span>
00162    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m5">network</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00163    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m5">network</a>) == 0 )
00164    {
00165       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00166    }
00167 
00168    <span class="comment">/*  Location  */</span>
00169    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m6">location</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00170    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m6">location</a>) == 0 )
00171    {
00172       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00173    }
00174 
00175    <span class="comment">/*  Amplitude Time  */</span>
00176    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m7">amp_time</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00177    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m7">amp_time</a>) == 0 )
00178    {
00179       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00180    }
00181 
00182    <span class="comment">/*  Amplitude Type  */</span>
00183    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m8">amptype</a> = (int)<a class="code" href="kom_8c.html#a12">k_long</a>();
00184    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00185    {
00186       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00187    }
00188 
00189    <span class="keywordflow">if</span> ( p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m8">amptype</a> &lt; 0 || <a class="code" href="earthworm__defs_8h.html#a45">AMPTYPE_COUNT</a> &lt;= p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m8">amptype</a> )
00190    {
00191       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00192    }
00193 
00194    <span class="comment">/*  A / D Counts  */</span>
00195    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m9">adcounts</a> = <a class="code" href="kom_8c.html#a17">k_val</a>();
00196    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00197    {
00198       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00199    }
00200 
00201    <span class="comment">/*  Period  */</span>
00202    p_struct-&gt;<a class="code" href="structGLOBAL__AMP__MSG.html#m10">period</a> = <a class="code" href="kom_8c.html#a17">k_val</a>();
00203    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00204    {
00205       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00206    }
00207 
00208    <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a>;
00209 }
00210 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:02 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
