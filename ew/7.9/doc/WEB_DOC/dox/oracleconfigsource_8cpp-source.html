<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>oracleconfigsource.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>oracleconfigsource.cpp</h1><a href="oracleconfigsource_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// oracleconfigsource.cpp: implementation of the OracleConfigSource class.</span>
00002 <span class="comment">//</span>
00004 <span class="comment"></span>
00005 <span class="preprocessor">#include "<a class="code" href="oracleconfigsource_8h.html">oracleconfigsource.h</a>"</span>
00006 
00008 <span class="comment">// Construction/Destruction</span>
00010 <span class="comment"></span>
<a name="l00011"></a><a class="code" href="classOracleConfigSource.html#a0">00011</a> <a class="code" href="classOracleConfigSource.html#a0">OracleConfigSource::OracleConfigSource</a>()
00012 {
00013    <a class="code" href="classOracleConfigSource.html#n1">CurrentLineIndex</a> = 0;
00014 }
00015 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00016"></a><a class="code" href="classOracleConfigSource.html#a1">00016</a> <span class="keywordtype">bool</span> <a class="code" href="classOracleConfigSource.html#a1">OracleConfigSource::LoadFromDB</a>( <span class="keywordtype">int</span>  p_servertype
00017                                    , <span class="keywordtype">int</span>  p_originId   <span class="comment">/* = -1 */</span>
00018                                    )
00019 {
00020    <span class="keywordtype">bool</span> r_status = <span class="keyword">false</span>;
00021 
00022 <span class="comment">//   EWDB_PASSPORT * _passports = NULL:</span>
00023 
00024 <span class="comment">//   try</span>
00025 <span class="comment">//   {</span>
00026 
00027 
00028       <span class="keywordtype">int</span> _arraysize = 50 
00029 <span class="comment">//        , _listsize</span>
00030         ;
00031 
00032       <a class="code" href="classConfigSource.html#n2">LastError</a> = 0;
00033       <a class="code" href="classConfigSource.html#n7">LastMessage</a>[0] = <span class="charliteral">'\0'</span>;
00034       <a class="code" href="classConfigSource.html#n3">LineParseIndex</a> = -1; <span class="comment">// start of line, no tokens yet</span>
00035       <a class="code" href="classConfigSource.html#n5">Token</a>[0] = <span class="charliteral">'\0'</span>;
00036 
00037       <a class="code" href="classOracleConfigSource.html#n0">CommandLines</a>.resize(0);
00038       <a class="code" href="classOracleConfigSource.html#n0">CommandLines</a>.reserve(15);
00039       <a class="code" href="classOracleConfigSource.html#n1">CurrentLineIndex</a> = 0;
00040 
00041 <span class="comment">/*</span>
00042 <span class="comment">      if ( (_passports = new EWDB_PASSPORT[_arraysize]) == NULL )</span>
00043 <span class="comment">      {</span>
00044 <span class="comment">         throw worm_exception("OracleConfigSource::LoadFromDB() Failed allocating passport list structure");</span>
00045 <span class="comment">      }</span>
00046 <span class="comment"></span>
00047 <span class="comment">      if ( ewdb_api_GetPassportList( p_servertype</span>
00048 <span class="comment">                                   , p_originId</span>
00049 <span class="comment">                                   , _passports</span>
00050 <span class="comment">                                   , &amp;_listsize</span>
00051 <span class="comment">                                   )</span>
00052 <span class="comment">           == EWDB_RETURN_FAILURE )</span>
00053 <span class="comment">      {</span>
00054 <span class="comment">         throw worm_exception("ewdb_api_GetPassport() failed");</span>
00055 <span class="comment">      }</span>
00056 <span class="comment"></span>
00057 <span class="comment">      // Check returned size, reallocate and recall if array too small</span>
00058 <span class="comment">      //</span>
00059 <span class="comment">      if ( _arraysize &lt; _listsize )</span>
00060 <span class="comment">      {</span>
00061 <span class="comment">         delete [] _passports;</span>
00062 <span class="comment"></span>
00063 <span class="comment">         if ( (_passports = new EWDB_PASSPORT[_arraysize+10]) == NULL )</span>
00064 <span class="comment">         {</span>
00065 <span class="comment">            throw worm_exception("OracleConfigSource::LoadFromDB() Failed allocating passport list structure");</span>
00066 <span class="comment">         }</span>
00067 <span class="comment"></span>
00068 <span class="comment">         if ( ewdb_api_GetPassportList( p_servertype</span>
00069 <span class="comment">                                      , p_originId</span>
00070 <span class="comment">                                      , _passports</span>
00071 <span class="comment">                                      , &amp;_listsize</span>
00072 <span class="comment">                                      )</span>
00073 <span class="comment">              == EWDB_RETURN_FAILURE )</span>
00074 <span class="comment">         {</span>
00075 <span class="comment">            throw worm_exception("ewdb_api_GetPassport() failed");</span>
00076 <span class="comment">         }</span>
00077 <span class="comment">      }</span>
00078 <span class="comment"></span>
00079 <span class="comment">      // copy the strings into the vector</span>
00080 <span class="comment">      //</span>
00081 <span class="comment">      std::string _cmd;</span>
00082 <span class="comment">      for ( int _p = 0 ; _p &lt; _listsize ; _p++ )</span>
00083 <span class="comment">      {</span>
00084 <span class="comment">         _cmd = _passports[_p].command;</span>
00085 <span class="comment"></span>
00086 <span class="comment">         CommandLines.push_back( _cmd );</span>
00087 <span class="comment">      }</span>
00088 <span class="comment">*/</span>
00089 
00090       r_status = <span class="keyword">true</span>;
00091 
00092 <span class="comment">//   }</span>
00093 <span class="comment">//   catch( worm_exception &amp; _we )</span>
00094 <span class="comment">//   {</span>
00095 <span class="comment">//   }</span>
00096 
00097 <span class="comment">//   if ( _passports != NULL )</span>
00098 <span class="comment">//   {</span>
00099 <span class="comment">//      delete [] _passports;</span>
00100 <span class="comment">//   }</span>
00101 
00102    <span class="keywordflow">return</span> r_status;
00103 }
00104 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00105"></a><a class="code" href="classOracleConfigSource.html#a2">00105</a> <span class="keywordtype">int</span> <a class="code" href="classOracleConfigSource.html#a2">OracleConfigSource::ReadLine</a>()
00106 {
00107    <span class="keywordtype">int</span> r_status;
00108        
00109    <span class="keywordflow">try</span>
00110    {
00111       <a class="code" href="classConfigSource.html#n2">LastError</a> = 0;
00112       <a class="code" href="classConfigSource.html#n7">LastMessage</a>[0] = <span class="charliteral">'\0'</span>;
00113       <a class="code" href="classConfigSource.html#n3">LineParseIndex</a> = -1; <span class="comment">// start of line, no tokens yet</span>
00114       <a class="code" href="classConfigSource.html#n5">Token</a>[0] = <span class="charliteral">'\0'</span>;
00115 
00116       <span class="keywordflow">if</span> ( <a class="code" href="classOracleConfigSource.html#n0">CommandLines</a>.size() &lt;= <a class="code" href="classOracleConfigSource.html#n1">CurrentLineIndex</a> )
00117       {
00118          r_status = <a class="code" href="configsource_8h.html#a7a5">COMFILE_EOF</a>;
00119       }
00120       <span class="keywordflow">else</span>
00121       {
00122          strcpy( CurrentLine, CommandLines[CurrentLineIndex].c_str() );
00123          <span class="comment">// return length of command line string</span>
00124          r_status = <a class="code" href="classOracleConfigSource.html#n0">CommandLines</a>[<a class="code" href="classOracleConfigSource.html#n1">CurrentLineIndex</a>].length();
00125       }
00126    }
00127    <span class="keywordflow">catch</span>( <a class="code" href="classworm__exception.html">worm_exception</a> &amp; _we )
00128    {
00129       r_status = <a class="code" href="configsource_8h.html#a7a4">COMFILE_ERROR</a>;
00130    }
00131 
00132    <span class="keywordflow">return</span> r_status;
00133 }
00134 <span class="comment">//--------------------------------------------------------------------------</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:06 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
