<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>getutil.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>getutil.c</h1><a href="getutil_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: getutil_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.3  2000/07/27 16:23:31  lucky</span>
00011 <span class="comment"> *     Implemented global limits, from earthworm.h, in the sizes of installation ids,</span>
00012 <span class="comment"> *     message types, ring names, and module names.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *     Revision 1.2  2000/07/08 19:49:11  lombard</span>
00015 <span class="comment"> *     fprintf statment had extra %s format</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00018 <span class="comment"> *     Initial revision</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> */</span>
00022 
00023 <span class="comment">/*</span>
00024 <span class="comment"> *  getutil.c  functions for looking up shared memory rings,</span>
00025 <span class="comment"> *             installations, modules, and message types in</span>
00026 <span class="comment"> *             Earthworm tables.  Given a character-string name,</span>
00027 <span class="comment"> *             these functions return a numerical value.</span>
00028 <span class="comment"> *</span>
00029 <span class="comment"> *             The installation table is set up in the include-file</span>
00030 <span class="comment"> *             earthworm.h; it is global to all Earthworm installations.</span>
00031 <span class="comment"> *             Changes to this table require a recompilation of the</span>
00032 <span class="comment"> *             whole Earthworm tree.</span>
00033 <span class="comment"> *  </span>
00034 <span class="comment"> *             The shared memory ring, module, and message type tables</span>
00035 <span class="comment"> *             are set up in the ascii table file (whose name is stored </span>
00036 <span class="comment"> *             in the global variable, TableFile) which resides in the </span>
00037 <span class="comment"> *             EW_PARAMS directory.  Changes to this file do not require</span>
00038 <span class="comment"> *             recompilation.</span>
00039 <span class="comment"> * </span>
00040 <span class="comment"> *  990603:LDD Modified GetUtil_LoadTable to read in installation ids</span>
00041 <span class="comment"> *             from an ascii file (instead of being defined in earthworm.h)</span>
00042 <span class="comment"> *             so that installations can be added without recompiling!  LDD</span>
00043 <span class="comment"> *             </span>
00044 <span class="comment"> */</span>
00045 
00046 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00047 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00048 <span class="preprocessor">#include &lt;string.h&gt;</span>
00049 <span class="preprocessor">#include &lt;<a class="code" href="earthworm_8h.html">earthworm.h</a>&gt;</span>
00050 <span class="preprocessor">#include &lt;<a class="code" href="kom_8h.html">kom.h</a>&gt;</span>
00051 
00052 <span class="comment">/* Table of shared memory ring names &amp; their keys</span>
00053 <span class="comment"> ************************************************/</span>
<a name="l00054"></a><a class="code" href="getutil_8c.html#a0">00054</a> <span class="preprocessor">#define MAXRING 20</span>
<a name="l00055"></a><a class="code" href="getutil_8c.html#a1">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define RINGLEN MAX_RING_STR</span>
00056 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">struct </span>{
<a name="l00057"></a><a class="code" href="getutil_8c.html#a9">00057</a>   <span class="keywordtype">long</span>   <a class="code" href="getutil_8c.html#a9">key</a>;
00058   <span class="keywordtype">char</span>   <a class="code" href="getutil_8c.html#a10">name</a>[<a class="code" href="getutil_8c.html#a1">RINGLEN</a>+1];
00059 } <a class="code" href="getutil_8c.html#a11">EW_Ring</a>[<a class="code" href="getutil_8c.html#a0">MAXRING</a>];
<a name="l00060"></a><a class="code" href="getutil_8c.html#a12">00060</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a12">Max_Ring</a> = 0;      <span class="comment">/* # ring/keys currently in table */</span>
00061 
00062 <span class="comment">/* Table of module names and their module_ids</span>
00063 <span class="comment"> ********************************************/</span>
<a name="l00064"></a><a class="code" href="getutil_8c.html#a2">00064</a> <span class="preprocessor">#define MAXMODID 256</span>
<a name="l00065"></a><a class="code" href="getutil_8c.html#a3">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define MODLEN  MAX_MOD_STR</span>
00066 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">struct </span>{
00067   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="getutil_8c.html#a13">id</a>;
00068   <span class="keywordtype">char</span>          <a class="code" href="getutil_8c.html#a10">name</a>[<a class="code" href="getutil_8c.html#a3">MODLEN</a>+1];
00069 } <a class="code" href="getutil_8c.html#a14">EW_Module</a>[<a class="code" href="getutil_8c.html#a2">MAXMODID</a>];
<a name="l00070"></a><a class="code" href="getutil_8c.html#a15">00070</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a15">Max_ModuleId</a> = 0;  <span class="comment">/* # modules currently in table */</span>
00071 
00072 <span class="comment">/* Table of message names and their type-values</span>
00073 <span class="comment"> **********************************************/</span>
<a name="l00074"></a><a class="code" href="getutil_8c.html#a4">00074</a> <span class="preprocessor">#define MAXMSGTYPE 256 </span>
<a name="l00075"></a><a class="code" href="getutil_8c.html#a5">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define MSGLEN     MAX_TYPE_STR </span>
00076 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">struct </span>{
<a name="l00077"></a><a class="code" href="getutil_8c.html#a16">00077</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="getutil_8c.html#a16">type</a>;
00078   <span class="keywordtype">char</span>          <a class="code" href="getutil_8c.html#a10">name</a>[<a class="code" href="getutil_8c.html#a5">MSGLEN</a>+1];
00079 } <a class="code" href="getutil_8c.html#a17">EW_Message</a>[<a class="code" href="getutil_8c.html#a4">MAXMSGTYPE</a>];
<a name="l00080"></a><a class="code" href="getutil_8c.html#a18">00080</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a18">Max_MessageType</a> = 0;  <span class="comment">/* # msg types currently in table */</span>
00081 
00082 <span class="comment">/* Table of Installation names and their instids</span>
00083 <span class="comment"> ***********************************************/</span>
<a name="l00084"></a><a class="code" href="getutil_8c.html#a6">00084</a> <span class="preprocessor">#define MAXINSTID 256</span>
<a name="l00085"></a><a class="code" href="getutil_8c.html#a7">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define INSTLEN   MAX_INST_STR </span>
00086 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">struct </span>{
<a name="l00087"></a><a class="code" href="getutil_8c.html#a13">00087</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="getutil_8c.html#a13">id</a>;
<a name="l00088"></a><a class="code" href="getutil_8c.html#a10">00088</a>   <span class="keywordtype">char</span>          <a class="code" href="getutil_8c.html#a10">name</a>[<a class="code" href="getutil_8c.html#a7">INSTLEN</a>+1];
00089 } <a class="code" href="getutil_8c.html#a19">EW_Installation</a>[<a class="code" href="getutil_8c.html#a6">MAXINSTID</a>];
<a name="l00090"></a><a class="code" href="getutil_8c.html#a20">00090</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a20">Max_Installation</a> = 0;  <span class="comment">/* # installations currently in table */</span>
00091 
<a name="l00092"></a><a class="code" href="getutil_8c.html#a8">00092</a> <span class="preprocessor">#define MAXLEN 255</span>
<a name="l00093"></a><a class="code" href="getutil_8c.html#a21">00093</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span>  <a class="code" href="getutil_8c.html#a21">FullTablePath</a>[<a class="code" href="getutil_8c.html#a8">MAXLEN</a>+1];
<a name="l00094"></a><a class="code" href="getutil_8c.html#a22">00094</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="getutil_8c.html#a22">TableFile</a>[] = {<span class="stringliteral">"earthworm_global.d"</span>,<span class="stringliteral">"earthworm.d"</span>}; 
<a name="l00095"></a><a class="code" href="getutil_8c.html#a23">00095</a> <span class="keyword">static</span> <span class="keywordtype">char</span>  <a class="code" href="getutil_8c.html#a23">nTableFile</a>  = 2;
<a name="l00096"></a><a class="code" href="getutil_8c.html#a24">00096</a> <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="getutil_8c.html#a24">LoadTables</a>  = 1;   <span class="comment">/* Do tables need to be loaded from */</span>
00097                                 <span class="comment">/* the TableFile?    1=yes 0=no     */</span>
00098  
00099          <span class="comment">/*******************************************************</span>
00100 <span class="comment">          *                      GetKey                         *</span>
00101 <span class="comment">          *                                                     *</span>
00102 <span class="comment">          *  Convert ring name to key number using table        *</span>
00103 <span class="comment">          *  in TableFile                                       *</span>
00104 <span class="comment">          *  Return &lt;key number&gt; on success;                    *</span>
00105 <span class="comment">          *          -1 if the specified ring name is unknown.  *</span>
00106 <span class="comment">          *******************************************************/</span>
<a name="l00107"></a><a class="code" href="getutil_8c.html#a25">00107</a> <span class="keywordtype">long</span> <a class="code" href="getutil_8c.html#a25">GetKey</a>( <span class="keywordtype">char</span> *ringName )
00108 {
00109    <span class="keywordtype">int</span> i;
00110 
00111    <span class="keywordflow">if</span>( LoadTables ) {
00112        <a class="code" href="getutil_8c.html#a30">GetUtil_LoadTable</a>();
00113        <a class="code" href="getutil_8c.html#a24">LoadTables</a> = 0;
00114    }
00115 
00116 <span class="comment">/* Find transport ring name in earthworm.d table</span>
00117 <span class="comment"> ***********************************************/</span>
00118    <span class="keywordflow">for</span> ( i = 0; i &lt; <a class="code" href="getutil_8c.html#a12">Max_Ring</a>; i++ )
00119       <span class="keywordflow">if</span> ( strcmp( EW_Ring[i].name, ringName ) == 0 )
00120          <span class="keywordflow">break</span>;
00121 
00122 <span class="comment">/* Didn't find ring name in table</span>
00123 <span class="comment"> ********************************/</span>
00124    <span class="keywordflow">if</span> ( i == <a class="code" href="getutil_8c.html#a12">Max_Ring</a> )
00125    {
00126       fprintf( stderr, <span class="stringliteral">"GetKey: Invalid ring name &lt;%s&gt;\n"</span>, ringName );
00127       <span class="keywordflow">return</span>( -1 );
00128    }
00129 
00130 <span class="comment">/* Found it!</span>
00131 <span class="comment"> ***********/</span>
00132    <span class="keywordflow">return</span>( <a class="code" href="getutil_8c.html#a11">EW_Ring</a>[i].key );
00133 }
00134 
00135 
00136          <span class="comment">/*******************************************************</span>
00137 <span class="comment">          *                   GetLocalInst                      *</span>
00138 <span class="comment">          *                                                     *</span>
00139 <span class="comment">          *  Convert the local installation name, set by the    *</span>
00140 <span class="comment">          *  environment variable EW_INSTALLATION, to a number  *</span>
00141 <span class="comment">          *  using the table in earthworm.h                     *</span>
00142 <span class="comment">          *  Return  0 on success;                              *</span>
00143 <span class="comment">          *         -1 if the environment variable is not       *</span>
00144 <span class="comment">          *            defined;                                 *</span>
00145 <span class="comment">          *         -2 if the env. variable has no value        *</span>
00146 <span class="comment">          *         -3 if the specified installation name is    *</span>
00147 <span class="comment">          *            not listed in earthworm.h                *</span>
00148 <span class="comment">          *******************************************************/</span>
<a name="l00149"></a><a class="code" href="getutil_8c.html#a26">00149</a> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a26">GetLocalInst</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *localId )
00150 {
00151    <span class="keywordtype">char</span> *envInst;
00152 
00153    *localId = 0;
00154 
00155 <span class="comment">/* Get the installation name from environment variable EW_INSTALLATION</span>
00156 <span class="comment">   *******************************************************************/</span>
00157    envInst = getenv( <span class="stringliteral">"EW_INSTALLATION"</span> );
00158 
00159    <span class="keywordflow">if</span> ( envInst == (<span class="keywordtype">char</span> *) NULL )
00160    {
00161       fprintf( stderr,
00162               <span class="stringliteral">"GetLocalInst: Environment variable EW_INSTALLATION not defined.\n"</span> );
00163       <span class="keywordflow">return</span>( -1 );
00164    }
00165 
00166    <span class="keywordflow">if</span> ( *envInst == <span class="charliteral">'\0'</span> )
00167    {
00168       fprintf( stderr, <span class="stringliteral">"GetLocalInst: Environment variable EW_INSTALLATION"</span> );
00169       fprintf( stderr, <span class="stringliteral">" defined, but has no value.\n"</span> );
00170       <span class="keywordflow">return</span>( -2 );
00171    }
00172 
00173    <span class="keywordflow">if</span>( LoadTables ) {
00174        <a class="code" href="getutil_8c.html#a30">GetUtil_LoadTable</a>();
00175        <a class="code" href="getutil_8c.html#a24">LoadTables</a> = 0;
00176    }
00177 
00178 <span class="comment">/* Find the id-value in the table</span>
00179 <span class="comment"> ********************************/</span>
00180    <span class="keywordflow">if</span> ( <a class="code" href="getutil_8c.html#a27">GetInst</a>( envInst, localId ) &lt; 0 )
00181    {
00182       fprintf( stderr,
00183               <span class="stringliteral">"GetLocalInst: Environment variable EW_INSTALLATION"</span> );
00184       fprintf( stderr, <span class="stringliteral">" has invalid value &lt;%s&gt;\n"</span>, envInst );
00185       <span class="keywordflow">return</span>( -3 );
00186    }
00187 
00188    <span class="keywordflow">return</span>( 0 );
00189 }
00190 
00191 
00192          <span class="comment">/*******************************************************</span>
00193 <span class="comment">          *                      GetInst                        *</span>
00194 <span class="comment">          *                                                     *</span>
00195 <span class="comment">          *  Convert installation name to number using table    *</span>
00196 <span class="comment">          *  in earthworm.h                                     *</span>
00197 <span class="comment">          *  Return  0 on success;                              *</span>
00198 <span class="comment">          *         -1 if the specified installation name is    *</span>
00199 <span class="comment">          *            unknown.                                 *</span>
00200 <span class="comment">          *******************************************************/</span>
<a name="l00201"></a><a class="code" href="getutil_8c.html#a27">00201</a> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a27">GetInst</a>( <span class="keywordtype">char</span> *instName, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *instId )
00202 {
00203    <span class="keywordtype">int</span> i;
00204 
00205    <span class="keywordflow">if</span>( LoadTables ) {
00206        <a class="code" href="getutil_8c.html#a30">GetUtil_LoadTable</a>();
00207        <a class="code" href="getutil_8c.html#a24">LoadTables</a> = 0;
00208    }
00209 
00210 <span class="comment">/* Find installation name in earthworm.h table</span>
00211 <span class="comment"> *********************************************/</span>
00212    <span class="keywordflow">for</span> ( i = 0; i &lt; <a class="code" href="getutil_8c.html#a20">Max_Installation</a>; i++ )
00213       <span class="keywordflow">if</span> ( strcmp( EW_Installation[i].name, instName ) == 0 )
00214          <span class="keywordflow">break</span>;
00215 
00216 <span class="comment">/* Didn't find installation name in table</span>
00217 <span class="comment"> ****************************************/</span>
00218    <span class="keywordflow">if</span> ( i == <a class="code" href="getutil_8c.html#a20">Max_Installation</a> )
00219    {
00220       fprintf( stderr,
00221               <span class="stringliteral">"GetInst: Invalid installation name &lt;%s&gt;\n"</span>, instName );
00222      *instId = 0;
00223       <span class="keywordflow">return</span>( -1 );
00224    }
00225 
00226 <span class="comment">/* Found it!</span>
00227 <span class="comment"> ***********/</span>
00228   *instId = <a class="code" href="getutil_8c.html#a19">EW_Installation</a>[i].id;
00229    <span class="keywordflow">return</span>( 0 );
00230 }
00231 
00232          <span class="comment">/*******************************************************</span>
00233 <span class="comment">          *                      GetModId                       *</span>
00234 <span class="comment">          *                                                     *</span>
00235 <span class="comment">          *  Convert module name to modid number using table    *</span>
00236 <span class="comment">          *  defined in TableFile                               *</span>
00237 <span class="comment">          *  Return  0 on success;                              *</span>
00238 <span class="comment">          *         -1 if the specified module name is unknown. *</span>
00239 <span class="comment">          *******************************************************/</span>
<a name="l00240"></a><a class="code" href="getutil_8c.html#a28">00240</a> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a28">GetModId</a>( <span class="keywordtype">char</span> *modName, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *modId )
00241 {
00242    <span class="keywordtype">int</span> i;
00243 
00244    <span class="keywordflow">if</span>( LoadTables ) {
00245        <a class="code" href="getutil_8c.html#a30">GetUtil_LoadTable</a>();
00246        <a class="code" href="getutil_8c.html#a24">LoadTables</a> = 0;
00247    }
00248 
00249 <span class="comment">/* Find module name in earthworm.h table</span>
00250 <span class="comment"> ***************************************/</span>
00251    <span class="keywordflow">for</span> ( i = 0; i &lt; <a class="code" href="getutil_8c.html#a15">Max_ModuleId</a>; i++ )
00252       <span class="keywordflow">if</span> ( strcmp( EW_Module[i].name, modName ) == 0 )
00253          <span class="keywordflow">break</span>;
00254 
00255 <span class="comment">/* Didn't find module name in table</span>
00256 <span class="comment"> **********************************/</span>
00257    <span class="keywordflow">if</span> ( i == <a class="code" href="getutil_8c.html#a15">Max_ModuleId</a> )
00258    {
00259       fprintf( stderr, <span class="stringliteral">"GetModId: Invalid module name &lt;%s&gt;\n"</span>, modName );
00260      *modId = 0;
00261       <span class="keywordflow">return</span>( -1 );
00262    }
00263 
00264 <span class="comment">/* Found it!</span>
00265 <span class="comment"> ***********/</span>
00266   *modId = <a class="code" href="getutil_8c.html#a14">EW_Module</a>[i].id;
00267    <span class="keywordflow">return</span>( 0 );
00268 }
00269 
00270          <span class="comment">/*******************************************************</span>
00271 <span class="comment">          *                      GetType                        *</span>
00272 <span class="comment">          *                                                     *</span>
00273 <span class="comment">          * Convert message-type name to number using table     *</span>
00274 <span class="comment">          * defined in TableFile                                *</span>
00275 <span class="comment">          * Return  0 on success;                               *</span>
00276 <span class="comment">          *        -1 if specified message-type name is unknown *</span>
00277 <span class="comment">          *******************************************************/</span>
<a name="l00278"></a><a class="code" href="getutil_8c.html#a29">00278</a> <span class="keywordtype">int</span> <a class="code" href="getutil_8c.html#a29">GetType</a>( <span class="keywordtype">char</span> *msgName, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *msgType )
00279 {
00280    <span class="keywordtype">int</span> i;
00281 
00282    <span class="keywordflow">if</span>( LoadTables ) {
00283        <a class="code" href="getutil_8c.html#a30">GetUtil_LoadTable</a>();
00284        <a class="code" href="getutil_8c.html#a24">LoadTables</a> = 0;
00285    }
00286 
00287 <span class="comment">/* Find message-type name in earthworm.h table</span>
00288 <span class="comment"> *********************************************/</span>
00289    <span class="keywordflow">for</span> ( i = 0; i &lt; <a class="code" href="getutil_8c.html#a18">Max_MessageType</a>; i++ )
00290       <span class="keywordflow">if</span> ( strcmp( EW_Message[i].name, msgName ) == 0 )
00291          <span class="keywordflow">break</span>;
00292 
00293 <span class="comment">/* Didn't find message-type name in table</span>
00294 <span class="comment"> ****************************************/</span>
00295    <span class="keywordflow">if</span> ( i == <a class="code" href="getutil_8c.html#a18">Max_MessageType</a> )
00296    {
00297       fprintf( stderr,
00298               <span class="stringliteral">"GetType: Invalid message-type name &lt;%s&gt;\n"</span>, msgName );
00299      *msgType = 0;
00300       <span class="keywordflow">return</span>( -1 );
00301    }
00302 
00303 <span class="comment">/* Found it!</span>
00304 <span class="comment"> ***********/</span>
00305   *msgType = <a class="code" href="getutil_8c.html#a17">EW_Message</a>[i].type;
00306    <span class="keywordflow">return</span>( 0 );
00307 }
00308 
00309   <span class="comment">/********************************************************************</span>
00310 <span class="comment">   * GetUtil_LoadTable  loads the ring, module, and message tables    *</span>
00311 <span class="comment">   *            from ascii files (TableFile) using kom.c functions.   *</span>
00312 <span class="comment">   *            Exits if any errors are encountered.                  *</span>
00313 <span class="comment">   ********************************************************************/</span>
<a name="l00314"></a><a class="code" href="getutil_8c.html#a30">00314</a> <span class="keywordtype">void</span> <a class="code" href="getutil_8c.html#a30">GetUtil_LoadTable</a>( <span class="keywordtype">void</span> )
00315 {
00316    <span class="keywordtype">int</span>      ncommand;     <span class="comment">/* # of required commands you expect to process   */</span>
00317    <span class="keywordtype">char</span>     init[10];     <span class="comment">/* init flags, one byte for each required command */</span>
00318    <span class="keywordtype">int</span>      nmiss;        <span class="comment">/* number of required commands that were missed   */</span>
00319    <span class="keywordtype">char</span>    *paramdir;    <span class="comment">/* points to environment variable, EW_PARAMS      */</span>
00320    <span class="keywordtype">char</span>    *<a class="code" href="kom_8c.html#a2">com</a>;
00321    <span class="keywordtype">char</span>    *str;
00322    <span class="keywordtype">int</span>      nfiles, nopen;
00323    <span class="keywordtype">int</span>      success;
00324    <span class="keywordtype">long</span>     tmpkey;
00325    <span class="keywordtype">int</span>      tmp;
00326    <span class="keywordtype">int</span>      conflict;
00327    <span class="keywordtype">int</span>      i,it;
00328    size_t   len;
00329 
00330 <span class="comment">/* Set to zero one init flag for each required command</span>
00331 <span class="comment"> *****************************************************/</span>
00332    ncommand = 4;
00333    <span class="keywordflow">for</span>( i=0; i&lt;ncommand; i++ )  init[i] = 0;
00334 
00335 <span class="comment">/* Get the environment variable, EW_PARAMS</span>
00336 <span class="comment"> *****************************************/</span>
00337    paramdir = getenv( <span class="stringliteral">"EW_PARAMS"</span> ); 
00338 
00339    <span class="keywordflow">if</span> ( paramdir == (<span class="keywordtype">char</span> *)NULL )   
00340    {
00341       printf( <span class="stringliteral">"GetUtil_LoadTable: Environment variable EW_PARAMS not defined!"</span> );
00342       printf( <span class="stringliteral">" exiting!\n"</span> );
00343       exit(-1);
00344    }
00345    <span class="keywordflow">if</span> ( *paramdir == <span class="charliteral">'\0'</span> )
00346    {
00347       printf( <span class="stringliteral">"GetUtil_LoadTable: Environment variable EW_PARAMS "</span> );
00348       printf( <span class="stringliteral">"defined, but has no value; exiting!\n"</span> );
00349       exit( -1 );
00350    }
00351 
00352 <span class="comment">/* Loop thru all interesting Table files</span>
00353 <span class="comment"> ***************************************/</span>
00354    <span class="keywordflow">for</span>( it=0; it&lt;<a class="code" href="getutil_8c.html#a23">nTableFile</a>; it++ )
00355    {
00356 
00357    <span class="comment">/* Build full path to table file</span>
00358 <span class="comment">    *******************************/</span>
00359       <span class="keywordflow">if</span>( strlen(paramdir)+strlen(TableFile[it])+1 &gt; (size_t)<a class="code" href="getutil_8c.html#a8">MAXLEN</a> )
00360       {
00361          printf(<span class="stringliteral">"GetUtil_LoadTable: length of EW_PARAMS+TableFile[%d] "</span>,it);
00362          printf(<span class="stringliteral">"exceeds FullTablePath, MAXLEN=%d; exiting!\n"</span>, MAXLEN );
00363          exit( -1 );
00364       }
00365       strcpy( FullTablePath, paramdir  );
00366       len = strlen( FullTablePath );
00367 <span class="preprocessor">   #ifdef _SOLARIS</span>
00368 <span class="preprocessor"></span>      <span class="keywordflow">if</span>( <a class="code" href="getutil_8c.html#a21">FullTablePath</a>[len-1] != <span class="charliteral">'/'</span> )   strcat( FullTablePath, <span class="stringliteral">"/"</span> );
00369 <span class="preprocessor">   #else  </span><span class="comment">/* OS/2 or NT */</span>
00370       <span class="keywordflow">if</span>( <a class="code" href="getutil_8c.html#a21">FullTablePath</a>[len-1] != <span class="charliteral">'\\'</span> )  strcat( FullTablePath, <span class="stringliteral">"\\"</span> );
00371 <span class="preprocessor">   #endif</span>
00372 <span class="preprocessor"></span>      strcat( FullTablePath, TableFile[it] );
00373       <span class="comment">/*printf( "path to modid/msgtype table: &lt;%s&gt;\n", FullTablePath );*/</span><span class="comment">/*DEBUG*/</span>
00374 
00375    <span class="comment">/* Open the main table file</span>
00376 <span class="comment">    **************************/</span>
00377       nfiles = <a class="code" href="kom_8c.html#a5">k_open</a>( FullTablePath );
00378       <span class="keywordflow">if</span>( nfiles == 0 ) {
00379            fprintf( stderr,
00380                    <span class="stringliteral">"GetUtil_LoadTable: Error opening file &lt;%s&gt;; exiting!\n"</span>,
00381                     FullTablePath );
00382            exit( -1 );
00383       }
00384       nopen = nfiles-1;  <span class="comment">/* keep track of # open files before TableFile */</span>
00385    
00386    <span class="comment">/* Process all command files</span>
00387 <span class="comment">    ***************************/</span>
00388       <span class="keywordflow">while</span>( nfiles &gt; nopen ) <span class="comment">/* While there are getutil-files open */</span>
00389       {
00390            <span class="keywordflow">while</span>(<a class="code" href="kom_8c.html#a14">k_rd</a>())        <span class="comment">/* Read next line from active file  */</span>
00391            {
00392                <a class="code" href="kom_8c.html#a2">com</a> = <a class="code" href="kom_8c.html#a16">k_str</a>();         <span class="comment">/* Get the first token from line */</span>
00393 
00394            <span class="comment">/* Ignore blank lines &amp; comments</span>
00395 <span class="comment">            *******************************/</span>
00396                <span class="keywordflow">if</span>( !<a class="code" href="kom_8c.html#a2">com</a> )           <span class="keywordflow">continue</span>;
00397                <span class="keywordflow">if</span>( <a class="code" href="kom_8c.html#a2">com</a>[0] == <span class="charliteral">'#'</span> )  <span class="keywordflow">continue</span>;
00398    
00399            <span class="comment">/* Open a nested configuration file</span>
00400 <span class="comment">            **********************************/</span>
00401                <span class="keywordflow">if</span>( <a class="code" href="kom_8c.html#a2">com</a>[0] == <span class="charliteral">'@'</span> ) {
00402                   success = nfiles+1;
00403                   nfiles  = <a class="code" href="kom_8c.html#a5">k_open</a>(&amp;com[1]);
00404                   <span class="keywordflow">if</span> ( nfiles != success ) {
00405                      fprintf( stderr,
00406                              <span class="stringliteral">"GetUtil_LoadTable: Error opening file &lt;%s&gt;; exiting!\n"</span>,
00407                               &amp;com[1] );
00408                      exit( -1 );
00409                   }
00410                   <span class="keywordflow">continue</span>;
00411                }
00412 
00413             <span class="comment">/* Process anything else as a command:</span>
00414 <span class="comment">             *************************************/</span>
00415    
00416             <span class="comment">/* Load shared memory ring name/key table</span>
00417 <span class="comment">             ****************************************/</span>
00418   <span class="comment">/*0*/</span>        <span class="keywordflow">if</span>( <a class="code" href="kom_8c.html#a11">k_its</a>(<span class="stringliteral">"Ring"</span>) ) 
00419                {
00420                 <span class="comment">/* see if there's more room in the table */</span>
00421                    <span class="keywordflow">if</span> ( <a class="code" href="getutil_8c.html#a12">Max_Ring</a>+1 &gt;= <a class="code" href="getutil_8c.html#a0">MAXRING</a> ) {
00422                        fprintf( stderr,
00423                                <span class="stringliteral">"GetUtil_LoadTable: Too many &lt;Ring&gt; lines in &lt;%s&gt;"</span>,
00424                                 FullTablePath );
00425                        fprintf( stderr, <span class="stringliteral">"; max=%d; exiting!\n"</span>, (<span class="keywordtype">int</span>) MAXRING );
00426                        exit( -1 );
00427                    }
00428                    str    = <a class="code" href="kom_8c.html#a16">k_str</a>();    <span class="comment">/* get ring name from line */</span>
00429                    tmpkey = <a class="code" href="kom_8c.html#a12">k_long</a>();   <span class="comment">/* get ring key from line  */</span>
00430 
00431                 <span class="comment">/* check the length of the ringname */</span>
00432                    <span class="keywordflow">if</span> ( strlen(str) &gt; <a class="code" href="getutil_8c.html#a1">RINGLEN</a> )
00433                    {
00434                        fprintf( stderr,
00435                                <span class="stringliteral">"GetUtil_LoadTable: Ring name &lt;%s&gt; too long in &lt;%s&gt;;"</span>
00436                                <span class="stringliteral">" max=%d chars; exiting!\n"</span>, str, FullTablePath, RINGLEN );
00437                        exit( -1 );
00438                    }
00439 
00440                 <span class="comment">/* look thru current table for duplicate key or name */</span>
00441                    conflict = 0;
00442                    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="getutil_8c.html#a12">Max_Ring</a>; i++ ) {
00443                         <span class="keywordflow">if</span>( tmpkey == <a class="code" href="getutil_8c.html#a11">EW_Ring</a>[i].key ) {
00444                            <span class="keywordflow">if</span>( strcmp( EW_Ring[i].name, str ) != 0 ) conflict=1;
00445                            <span class="keywordflow">break</span>;
00446                         }
00447                         <span class="keywordflow">if</span>( strcmp( EW_Ring[i].name, str ) == 0 ) {
00448                            <span class="keywordflow">if</span>( tmpkey != <a class="code" href="getutil_8c.html#a11">EW_Ring</a>[i].key ) conflict=1;
00449                            <span class="keywordflow">break</span>;
00450                         }
00451                    }
00452    
00453                 <span class="comment">/* complain if there was a conflict with a previous setting */</span>
00454                    <span class="keywordflow">if</span>( conflict ) {
00455                         fprintf( stderr, 
00456                                 <span class="stringliteral">"GetUtil_LoadTable: conflict in &lt;%s&gt;, new setting ignored\n"</span>, 
00457                                  FullTablePath );
00458                         fprintf( stderr, 
00459                                 <span class="stringliteral">"                   original: &lt;Ring %s %ld&gt;\n"</span>, 
00460                                  EW_Ring[i].name, EW_Ring[i].key );
00461                         fprintf( stderr, 
00462                                 <span class="stringliteral">"                        new: &lt;Ring %s %ld&gt;\n"</span>, 
00463                                  str, tmpkey);
00464                    }
00465 
00466                 <span class="comment">/* add new entry to table */</span>
00467                    <span class="keywordflow">if</span>( i==<a class="code" href="getutil_8c.html#a12">Max_Ring</a> ) {
00468                       strcpy( EW_Ring[Max_Ring].name, str );
00469                       <a class="code" href="getutil_8c.html#a11">EW_Ring</a>[<a class="code" href="getutil_8c.html#a12">Max_Ring</a>].key = tmpkey;
00470                       <a class="code" href="getutil_8c.html#a12">Max_Ring</a>++;
00471                    }
00472                    init[0] = 1;
00473                }
00474 
00475             <span class="comment">/* Enter module name/id table</span>
00476 <span class="comment">             ****************************/</span>
00477   <span class="comment">/*1*/</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="kom_8c.html#a11">k_its</a>(<span class="stringliteral">"Module"</span>) ) 
00478                {
00479                 <span class="comment">/* see if there's more room in the table */</span>
00480                    <span class="keywordflow">if</span> ( <a class="code" href="getutil_8c.html#a15">Max_ModuleId</a>+1 &gt;= <a class="code" href="getutil_8c.html#a2">MAXMODID</a> ) {
00481                        fprintf( stderr,
00482                                <span class="stringliteral">"GetUtil_LoadTable: Too many &lt;Module&gt; lines in &lt;%s&gt;"</span>,
00483                                 FullTablePath );
00484                        fprintf( stderr, <span class="stringliteral">"; max=%d; exiting!\n"</span>, (<span class="keywordtype">int</span>) MAXMODID );
00485                        exit( -1 );
00486                    }
00487                    str = <a class="code" href="kom_8c.html#a16">k_str</a>();    <span class="comment">/* get module name from line */</span>
00488                    tmp = <a class="code" href="kom_8c.html#a10">k_int</a>();    <span class="comment">/* get module id from line   */</span>
00489 
00490                 <span class="comment">/* check validity of module id */</span>
00491                    <span class="keywordflow">if</span>( tmp&lt;0 || tmp&gt;255 ) {
00492                         fprintf( stderr,
00493                                 <span class="stringliteral">"GetUtil_LoadTable: Invalid module id &lt;%d&gt; in &lt;%s&gt;"</span>,
00494                                  tmp, FullTablePath );
00495                         fprintf( stderr, <span class="stringliteral">" (0-255 are valid); exiting!\n"</span> );
00496                         exit( -1 );
00497                    }     
00498 
00499                 <span class="comment">/* check the length of the module name */</span>
00500                    <span class="keywordflow">if</span> ( strlen(str) &gt; <a class="code" href="getutil_8c.html#a3">MODLEN</a> )
00501                    {
00502                        fprintf( stderr,
00503                                <span class="stringliteral">"GetUtil_LoadTable: Module name &lt;%s&gt; too long in &lt;%s&gt;;"</span>
00504                                <span class="stringliteral">" max=%d chars; exiting!\n"</span>, str, FullTablePath, MODLEN );
00505                        exit( -1 );
00506                    }
00507 
00508                 <span class="comment">/* look thru current table for duplicate key or name */</span>
00509                    conflict = 0;
00510                    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="getutil_8c.html#a15">Max_ModuleId</a>; i++ ) {
00511                         <span class="keywordflow">if</span>( tmp == (int)<a class="code" href="getutil_8c.html#a14">EW_Module</a>[i].id ) {
00512                            <span class="keywordflow">if</span>( strcmp( EW_Module[i].name, str ) != 0 ) conflict=1;
00513                            <span class="keywordflow">break</span>;
00514                         }
00515                         <span class="keywordflow">if</span>( strcmp( EW_Module[i].name, str ) == 0 ) {
00516                            <span class="keywordflow">if</span>( tmp != (int)<a class="code" href="getutil_8c.html#a14">EW_Module</a>[i].id ) conflict=1;
00517                            <span class="keywordflow">break</span>;
00518                         }
00519                    }
00520    
00521                 <span class="comment">/* complain if there was a conflict with a previous setting */</span>
00522                    <span class="keywordflow">if</span>( conflict ) {
00523                         fprintf( stderr, 
00524                                 <span class="stringliteral">"GetUtil_LoadTable: conflict in &lt;%s&gt;, new setting ignored\n"</span>, 
00525                                  FullTablePath );
00526                         fprintf( stderr, 
00527                                 <span class="stringliteral">"                   original: &lt;Module %s %d&gt;\n"</span>, 
00528                                  EW_Module[i].name, (<span class="keywordtype">int</span>) EW_Module[i].id );
00529                         fprintf( stderr, 
00530                                 <span class="stringliteral">"                        new: &lt;Module %s %d&gt;\n"</span>, 
00531                                  str, tmp );
00532                    }
00533 
00534                 <span class="comment">/* add new entry to table */</span>
00535                    <span class="keywordflow">if</span>( i==<a class="code" href="getutil_8c.html#a15">Max_ModuleId</a> ) {
00536                        strcpy( EW_Module[Max_ModuleId].name, str );
00537                        <a class="code" href="getutil_8c.html#a14">EW_Module</a>[<a class="code" href="getutil_8c.html#a15">Max_ModuleId</a>].id = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) tmp;
00538                        <a class="code" href="getutil_8c.html#a15">Max_ModuleId</a>++;
00539                    }
00540                    init[1] = 1;
00541                }
00542 
00543             <span class="comment">/* Enter message name/type table</span>
00544 <span class="comment">             *******************************/</span>
00545   <span class="comment">/*2*/</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="kom_8c.html#a11">k_its</a>(<span class="stringliteral">"Message"</span>) ) 
00546                {
00547                 <span class="comment">/* see if there's more room in the table */</span>
00548                    <span class="keywordflow">if</span> ( <a class="code" href="getutil_8c.html#a18">Max_MessageType</a>+1 &gt;= <a class="code" href="getutil_8c.html#a4">MAXMSGTYPE</a> ) {
00549                        fprintf( stderr,
00550                                <span class="stringliteral">"GetUtil_LoadTable: Too many &lt;Message&gt; lines in &lt;%s&gt;"</span>,
00551                                 FullTablePath );
00552                        fprintf( stderr, <span class="stringliteral">"; max=%d; exiting!\n"</span>, (<span class="keywordtype">int</span>) MAXMSGTYPE );
00553                        exit( -1 );
00554                    }
00555                    str = <a class="code" href="kom_8c.html#a16">k_str</a>();    <span class="comment">/* get message name from line */</span>
00556                    tmp = <a class="code" href="kom_8c.html#a10">k_int</a>();    <span class="comment">/* get message type from line */</span>
00557    
00558                 <span class="comment">/* check validity of module id */</span>
00559                    <span class="keywordflow">if</span>( tmp&lt;0 || tmp&gt;255 ) {
00560                         fprintf( stderr,
00561                                 <span class="stringliteral">"GetUtil_LoadTable: Invalid message type &lt;%d&gt; in &lt;%s&gt;"</span>,
00562                                  tmp, FullTablePath );
00563                         fprintf( stderr, <span class="stringliteral">" (0-255 are valid); exiting!\n"</span> );
00564                         exit( -1 );
00565                    }     
00566                    
00567                 <span class="comment">/* check the length of the message */</span>
00568                    <span class="keywordflow">if</span> ( strlen(str) &gt; <a class="code" href="getutil_8c.html#a5">MSGLEN</a> )
00569                    {
00570                        fprintf( stderr,
00571                                <span class="stringliteral">"GetUtil_LoadTable: Message name &lt;%s&gt; too long in &lt;%s&gt;;"</span>
00572                                <span class="stringliteral">" max=%d chars; exiting!\n"</span>, str, FullTablePath, MSGLEN );
00573                        exit( -1 );
00574                    }
00575 
00576                 <span class="comment">/* look thru current table for duplicate type or name */</span>
00577                    conflict = 0;
00578                    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="getutil_8c.html#a18">Max_MessageType</a>; i++ ) {
00579                         <span class="keywordflow">if</span>( tmp == (int)<a class="code" href="getutil_8c.html#a17">EW_Message</a>[i].type ) {
00580                            <span class="keywordflow">if</span>( strcmp( EW_Message[i].name, str ) != 0 ) conflict=1;
00581                            <span class="keywordflow">break</span>;
00582                         }
00583                         <span class="keywordflow">if</span>( strcmp( EW_Message[i].name, str ) == 0 ) {
00584                            <span class="keywordflow">if</span>( tmp != (int)<a class="code" href="getutil_8c.html#a17">EW_Message</a>[i].type ) conflict=1;
00585                            <span class="keywordflow">break</span>;
00586                         }
00587                    }
00588    
00589                 <span class="comment">/* complain if there was a conflict with a previous setting */</span>
00590                    <span class="keywordflow">if</span>( conflict ) {
00591                         fprintf( stderr, 
00592                                 <span class="stringliteral">"GetUtil_LoadTable: conflict in &lt;%s&gt;, new setting ignored\n"</span>, 
00593                                  FullTablePath );
00594                         fprintf( stderr, 
00595                                 <span class="stringliteral">"                   original: &lt;Message %s %d&gt;\n"</span>, 
00596                                  EW_Message[i].name, (<span class="keywordtype">int</span>) EW_Message[i].type );
00597                         fprintf( stderr, 
00598                                 <span class="stringliteral">"                        new: &lt;Message %s %d&gt;\n"</span>, 
00599                                  str, tmp );
00600                    }
00601 
00602                 <span class="comment">/* add new entry to table */</span>
00603                    <span class="keywordflow">if</span>( i==<a class="code" href="getutil_8c.html#a18">Max_MessageType</a> ) {
00604                        strcpy( EW_Message[Max_MessageType].name, str );
00605                        <a class="code" href="getutil_8c.html#a17">EW_Message</a>[<a class="code" href="getutil_8c.html#a18">Max_MessageType</a>].type = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) tmp;
00606                        <a class="code" href="getutil_8c.html#a18">Max_MessageType</a>++;
00607                    }
00608                    init[2] = 1;
00609                }
00610 
00611             <span class="comment">/* Enter installation name/type table</span>
00612 <span class="comment">             ************************************/</span>
00613   <span class="comment">/*3*/</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="kom_8c.html#a11">k_its</a>(<span class="stringliteral">"Installation"</span>) ) 
00614                {
00615                 <span class="comment">/* see if there's more room in the table */</span>
00616                    <span class="keywordflow">if</span> ( <a class="code" href="getutil_8c.html#a20">Max_Installation</a>+1 &gt;= <a class="code" href="getutil_8c.html#a6">MAXINSTID</a> ) {
00617                        fprintf( stderr,
00618                                <span class="stringliteral">"GetUtil_LoadTable: Too many &lt;Installation&gt; lines in &lt;%s&gt;"</span>
00619                                <span class="stringliteral">"; max=%d; exiting!\n"</span>, FullTablePath, (<span class="keywordtype">int</span>) MAXINSTID );
00620                        exit( -1 );
00621                    }
00622                    str = <a class="code" href="kom_8c.html#a16">k_str</a>();    <span class="comment">/* get installation name from line */</span>
00623                    tmp = <a class="code" href="kom_8c.html#a10">k_int</a>();    <span class="comment">/* get instid from line */</span>
00624    
00625                 <span class="comment">/* check validity of instid */</span>
00626                    <span class="keywordflow">if</span>( tmp&lt;0 || tmp&gt;255 ) {
00627                         fprintf( stderr,
00628                                 <span class="stringliteral">"GetUtil_LoadTable: Invalid installation id &lt;%d&gt; in &lt;%s&gt;"</span>
00629                                 <span class="stringliteral">" (0-255 are valid); exiting!\n"</span>, tmp, FullTablePath );
00630                         exit( -1 );
00631                    }     
00632                    
00633                 <span class="comment">/* check the length of the installation name */</span>
00634                    <span class="keywordflow">if</span> ( strlen(str) &gt; <a class="code" href="getutil_8c.html#a7">INSTLEN</a> )
00635                    {
00636                        fprintf( stderr,
00637                                <span class="stringliteral">"GetUtil_LoadTable: Installation name &lt;%s&gt; too long in &lt;%s&gt;;"</span>
00638                                <span class="stringliteral">" max=%d chars; exiting!\n"</span>, str, FullTablePath, INSTLEN );
00639                        exit( -1 );
00640                    }
00641 
00642                 <span class="comment">/* look thru current table for duplicate instid or name */</span>
00643                    conflict = 0;
00644                    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="getutil_8c.html#a20">Max_Installation</a>; i++ ) {
00645                         <span class="keywordflow">if</span>( tmp == (int)<a class="code" href="getutil_8c.html#a19">EW_Installation</a>[i].id ) {
00646                            <span class="keywordflow">if</span>( strcmp( EW_Installation[i].name, str ) != 0 ) conflict=1;
00647                            <span class="keywordflow">break</span>;
00648                         }
00649                         <span class="keywordflow">if</span>( strcmp( EW_Installation[i].name, str ) == 0 ) {
00650                            <span class="keywordflow">if</span>( tmp != (int)<a class="code" href="getutil_8c.html#a19">EW_Installation</a>[i].id ) conflict=1;
00651                            <span class="keywordflow">break</span>;
00652                         }
00653                    }
00654    
00655                 <span class="comment">/* complain if there was a conflict with a previous setting */</span>
00656                    <span class="keywordflow">if</span>( conflict ) {
00657                         fprintf( stderr, 
00658                                 <span class="stringliteral">"GetUtil_LoadTable: conflict in &lt;%s&gt;, new setting ignored\n"</span>, 
00659                                  FullTablePath );
00660                         fprintf( stderr, 
00661                                 <span class="stringliteral">"                   original: &lt;Installation %s %d&gt;\n"</span>, 
00662                                  EW_Installation[i].name, (<span class="keywordtype">int</span>) EW_Installation[i].id );
00663                         fprintf( stderr, 
00664                                 <span class="stringliteral">"                        new: &lt;Installation %s %d&gt;\n"</span>, 
00665                                  str, tmp );
00666                    }
00667 
00668                 <span class="comment">/* add new entry to table */</span>
00669                    <span class="keywordflow">if</span>( i==<a class="code" href="getutil_8c.html#a20">Max_Installation</a> ) {
00670                        strcpy( EW_Installation[Max_Installation].name, str );
00671                        <a class="code" href="getutil_8c.html#a19">EW_Installation</a>[<a class="code" href="getutil_8c.html#a20">Max_Installation</a>].id = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) tmp;
00672                        <a class="code" href="getutil_8c.html#a20">Max_Installation</a>++;
00673                    }
00674                    init[3] = 1;
00675                }
00676 
00677             <span class="comment">/* Otherwise, it's unknown</span>
00678 <span class="comment">             *************************/</span>
00679                <span class="keywordflow">else</span>  
00680                {
00681                    fprintf( stderr, <span class="stringliteral">"GetUtil_LoadTable: &lt;%s&gt; Unknown command in &lt;%s&gt;.\n"</span>,
00682                             com, FullTablePath );
00683                    <span class="keywordflow">continue</span>;
00684                }
00685 
00686            <span class="comment">/* See if there were any errors processing the command</span>
00687 <span class="comment">            *****************************************************/</span>
00688                <span class="keywordflow">if</span>( <a class="code" href="kom_8c.html#a9">k_err</a>() ) 
00689                {
00690                   fprintf( stderr,
00691                           <span class="stringliteral">"GetUtil_LoadTable: Bad &lt;%s&gt; line in &lt;%s&gt;; exiting!\n"</span>,
00692                            com, FullTablePath );
00693                   exit( -1 );
00694                }
00695            }
00696            nfiles = <a class="code" href="kom_8c.html#a6">k_close</a>();
00697       }
00698    } <span class="comment">/* end-for over all table files */</span>
00699 
00700 <span class="comment">/* After all files are closed, check init flags for missed commands</span>
00701 <span class="comment"> ******************************************************************/</span>
00702    nmiss = 0;
00703    <span class="keywordflow">for</span> ( i=0; i&lt;ncommand; i++ )  <span class="keywordflow">if</span>( !init[i] ) nmiss++;
00704    <span class="keywordflow">if</span> ( nmiss ) {
00705        fprintf( stderr, <span class="stringliteral">"GetUtil_LoadTable: ERROR, no "</span>    );
00706        <span class="keywordflow">if</span> ( !init[0] )  fprintf( stderr, <span class="stringliteral">"&lt;Ring&gt; "</span>         );
00707        <span class="keywordflow">if</span> ( !init[1] )  fprintf( stderr, <span class="stringliteral">"&lt;Module&gt; "</span>       );
00708        <span class="keywordflow">if</span> ( !init[2] )  fprintf( stderr, <span class="stringliteral">"&lt;Message&gt; "</span>      );
00709        <span class="keywordflow">if</span> ( !init[3] )  fprintf( stderr, <span class="stringliteral">"&lt;Installation&gt; "</span> );
00710        fprintf( stderr, <span class="stringliteral">"line(s) in file(s) "</span> );
00711        <span class="keywordflow">for</span>( it=0; it&lt;<a class="code" href="getutil_8c.html#a23">nTableFile</a>; it++ ) fprintf( stderr, <span class="stringliteral">"&lt;%s&gt; "</span>, TableFile[it] );
00712        fprintf( stderr, <span class="stringliteral">"exiting!\n"</span> );
00713        exit( -1 );
00714    }
00715 
00716    <span class="keywordflow">return</span>;
00717 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:02 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
