<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>result_template.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>result_template.cpp</h1><a href="result__template_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * result_template.cpp -- Template of a result message class for use</span>
00003 <span class="comment"> *                        in the mutable server model.</span>
00004 <span class="comment"> * </span>
00005 <span class="comment"> * See request_template.cpp for example code and comments</span>
00006 <span class="comment"> * or magserverresult.cpp for a detailed implementation example.</span>
00007 <span class="comment"> */</span>
00008 
00009 <span class="comment">// START WITH THE CLASS DECLARATION IN THE .h FILE.</span>
00010 
00011 <span class="comment">//******************************************************************************</span>
00012 <span class="comment">// STEP 1: Do a global replacement of the string "ResultTemplate"</span>
00013 <span class="comment">//         with the name of the new class</span>
00014 <span class="comment">//******************************************************************************</span>
00015 
00016  
00017 <span class="comment">//******************************************************************************</span>
00018 <span class="comment">// STEP 2: Replace the name of the include file for the class declaration</span>
00019 <span class="comment">//</span>
00020 <span class="comment">//******************************************************************************</span>
00021 <span class="preprocessor">#include "<a class="code" href="result__template_8h.html">result_template.h</a>"</span>
00022 
00023 
00024 
00025 <span class="comment">//******************************************************************************</span>
00026 <span class="comment">// STEP 3: Update the constructor to initialize all variables that were</span>
00027 <span class="comment">//         declared in the .h (Base classes will initialize their own </span>
00028 <span class="comment">//         variables as needed).</span>
00029 <span class="comment">//</span>
00030 <span class="comment">//******************************************************************************</span>
00031 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00032"></a><a class="code" href="classResultTemplate.html#a0">00032</a> <a class="code" href="classResultTemplate.html#a0">ResultTemplate::ResultTemplate</a>()
00033 {
00034    <span class="comment">// INITIALIZE ANY CLASS VARIABLES</span>
00035    
00036    <span class="comment">// Any pointers that will reference memory allocated by this class</span>
00037    <span class="comment">// MUST be NULLified here.</span>
00038    
00039 }
00040 
00041 <span class="comment">//******************************************************************************</span>
00042 <span class="comment">// STEP 4: If the destructor declaration was included in the .h file,</span>
00043 <span class="comment">//         uncomment and implement it here, otherwise remove this method.</span>
00044 <span class="comment">//</span>
00045 <span class="comment">//******************************************************************************</span>
00046 <span class="comment">//------------------------------------------------------------------------------</span>
00047 <span class="comment">/*</span>
00048 <span class="comment">ResultTemplate::~ResultTemplate()</span>
00049 <span class="comment">{</span>
00050 <span class="comment">   // MEMORY ALLOCATED WITHIN THIS CLASS MUST BE DELETED HERE</span>
00051 <span class="comment">   // (IF NOT PREVIOUSLY)</span>
00052 <span class="comment">    </span>
00053 <span class="comment">   // EXAMPLE</span>
00054 <span class="comment">   // if ( MyCharPointer != NULL )</span>
00055 <span class="comment">   // {</span>
00056 <span class="comment">   //   delete [] MyCharPointer;</span>
00057 <span class="comment">   // }</span>
00058 <span class="comment">   // The class can't be used after destruction, so there is no need</span>
00059 <span class="comment">   // to set MyCharPointer back to NULL.</span>
00060 <span class="comment">}</span>
00061 <span class="comment">*/</span>
00062 
00063 <span class="comment">//******************************************************************************</span>
00064 <span class="comment">// STEP 5: Implement the accessor methods declared for this specific class:</span>
00065 <span class="comment">//         (these examples equate to those in the template .h file)</span>
00066 <span class="comment">//</span>
00067 <span class="comment">//******************************************************************************</span>
00068 
00069 <span class="comment">//------------------------------------------------------------------------------</span>
00070 <span class="comment">/*</span>
00071 <span class="comment">void ResultTemplate::SetMyInt( int parameterA )</span>
00072 <span class="comment">{</span>
00073 <span class="comment">   MyInt = parameterA;</span>
00074 <span class="comment">}</span>
00075 <span class="comment">*/</span>
00076 <span class="comment">//------------------------------------------------------------------------------</span>
00077 <span class="comment">/*</span>
00078 <span class="comment">int ResultTemplate::GetMyInt() { return MyInt; }</span>
00079 <span class="comment">*/</span>
00080 
00081 
00082 <span class="comment">//******************************************************************************</span>
00083 <span class="comment">// STEP 6: Implement the virtual methods that were declared but not defined</span>
00084 <span class="comment">//         in the Base classes from which this one is derived.</span>
00085 <span class="comment">//         (Deriving from MutableServerResult means there are three, there may</span>
00086 <span class="comment">//         be a different number for a different base class).</span>
00087 <span class="comment">//</span>
00088 <span class="comment">//******************************************************************************</span>
00089 
00090 
00091 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00092"></a><a class="code" href="classResultTemplate.html#b0">00092</a> <span class="keywordtype">long</span> <a class="code" href="classResultTemplate.html#b0">ResultTemplate::BufferInitAlloc</a>()
00093 {
00094    <span class="keywordtype">long</span> ExpectedBufferLength = 0;
00095    
00096    <span class="comment">// First, call the immediate base class's method to get the buffer length</span>
00097    <span class="comment">// required by all base classes.</span>
00098    <span class="comment">// </span>
00099    <span class="comment">// THIS CALL MUST BE INCLUDED IN THIS METHOD,</span>
00100    <span class="comment">// AND IT MUST BE CALLED FOR THE CLASS FROM WHICH THIS ONE IS DERIVED.</span>
00101    <span class="comment">//</span>
00102    ExpectedBufferLength = <a class="code" href="classMutableServerResult.html#b0">MutableServerResult::BufferInitAlloc</a>();
00103   
00104    <span class="comment">// ADD THE ADDITIONAL BUFFER LENGTH NEEDED BY THIS CLASS'S VARIABLES</span>
00105    <span class="comment">//</span>
00106    <span class="comment">// Assuming a single int value which will never be more than 15 digits,</span>
00107    <span class="comment">// it might be as simple as the line below.  For more complex results</span>
00108    <span class="comment">// (for example magnitude results that might have n channels included),</span>
00109    <span class="comment">// it could be much more complex.</span>
00110    
00111    ExpectedBufferLength += 15;
00112    
00113    <span class="keywordflow">return</span> ExpectedBufferLength;
00114 }
00115 <span class="comment">//------------------------------------------------------------------------------</span>
00116 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00117"></a><a class="code" href="classResultTemplate.html#b1">00117</a> <span class="keywordtype">void</span> <a class="code" href="classResultTemplate.html#b1">ResultTemplate::FormatDerivativeData</a>()
00118 {
00119    <span class="comment">// First, prepare the leading part of the buffer....that is, prepare</span>
00120    <span class="comment">// the buffer part used by the base class(es):</span>
00121    <span class="comment">//</span>
00122    <span class="comment">// THIS CALL MUST BE PERFORMED AT THE START OF THIS METHOD,</span>
00123    <span class="comment">// AND IT MUST BE CALLED FOR THE CLASS FROM WHICH THIS ONE IS DERIVED.</span>
00124    <span class="comment">//</span>
00125    <a class="code" href="classMutableServerResult.html#b1">MutableServerResult::FormatDerivativeData</a>();
00126    
00127    
00128    <span class="comment">// NOW FORMAT AND APPEND THE BUFFER CONTENTS FOR THIS CLASS.</span>
00129    
00130    <span class="comment">// THE ACTUAL BUFFER IS IMPLEMENTED WITH A C++ basic_string TYPE.</span>
00131    <span class="comment">// A CHAR VALUE MAY BE APPENDED TO THE BUFFER WITH +=</span>
00132    <span class="comment">//</span>
00133    <span class="comment">// MessageBuffer += "SOME STRING VALUE";</span>
00134 
00135    
00136    <span class="comment">// GENERALLY, THIS CLASS HEIRARCHY BREAKS MESSAGES INTO MULTIPLE LINES</span>
00137    <span class="comment">// WITH '\n'.  THE END OF THE MESSAGE IS MARKED WITH AN ADDITIONAL '\n'.</span>
00138    
00139    
00140    <span class="comment">/*</span>
00141 <span class="comment">   // Say that this class has some result value of type int, the code to</span>
00142 <span class="comment">   // include that value in the message buffer might look something like:</span>
00143 <span class="comment"></span>
00144 <span class="comment">   char _myint[18];  </span>
00145 <span class="comment">   </span>
00146 <span class="comment">   sprintf( _myint, "%d\n MyInt );</span>
00147 <span class="comment">   </span>
00148 <span class="comment">   MessageBuffer += _myint;</span>
00149 <span class="comment">   */</span>
00150 }
00151 <span class="comment">//------------------------------------------------------------------------------</span>
00152 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00153"></a><a class="code" href="classResultTemplate.html#b2">00153</a> <span class="keywordtype">void</span> <a class="code" href="classResultTemplate.html#b2">ResultTemplate::ParseDerivativeData</a>()
00154 {
00155    <span class="comment">// One of the first things done as part of the parse process is that the</span>
00156    <span class="comment">// message is put into the (base class's) variable MessageBuffer</span>
00157    <span class="comment">// </span>
00158    <span class="comment">// Lines are then snipped off the front of the buffer as they are processed.</span>
00159    <span class="comment">//</span>
00160    
00161    <span class="comment">// First, parse the leading part of the buffer....that is,</span>
00162    <span class="comment">// the buffer part used by the base class(es):</span>
00163    <span class="comment">//</span>
00164    <span class="comment">// THIS CALL MUST BE PERFORMED AT THE START OF THIS METHOD,</span>
00165    <span class="comment">// AND IT MUST BE CALLED FOR THE CLASS FROM WHICH THIS ONE IS DERIVED.</span>
00166    <span class="comment">//</span>
00167    <a class="code" href="classMutableServerResult.html#b2">MutableServerResult::ParseDerivativeData</a>();
00168 
00169 
00170    <span class="keywordtype">long</span> _index;            <span class="comment">// end of line index</span>
00171    std::string _readline;  <span class="comment">// work buffer</span>
00172    
00173    
00174    <span class="comment">// NOW PARSE THE PORTION OF THE BUFFER RELEVANT TO THIS MESSAGE CLASS</span>
00175 
00176    <span class="comment">// NOTE THAT ALL ERRORS ARE REPORTED BY THROWING A worm_exception OBJECT.</span>
00177    <span class="comment">// THERE ARE TWO WAYS TO FORMAT THE ERROR MESSAGE CONTAINED THEREIN, EITHER</span>
00178    <span class="comment">// WITH A SIMPLE STRING:</span>
00179    <span class="comment">//</span>
00180    <span class="comment">//    throw worm_exception("My error message");</span>
00181    <span class="comment">//</span>
00182    <span class="comment">// OR BUILT UP FROM STRINGS AND VARAIBLES</span>
00183    <span class="comment">//</span>
00184    <span class="comment">//    worm_exception my_exception("ResultTemplate::ParseDerivativeData() Error: ");</span>
00185    <span class="comment">//                   my_exception += SomeStringVariable;</span>
00186    <span class="comment">//                   my_exception += " ";</span>
00187    <span class="comment">//                   my_exception += SomeOtherStringVariable;</span>
00188    <span class="comment">//    throw my_exception;</span>
00189    <span class="comment">// </span>
00190    <span class="comment">// FYI, THE worm_exception IS CAUGHT AND REPORTED BY THE SERVER</span>
00191 
00192    
00193    <span class="comment">// MESSAGE LINES ARE GENERALLY HANDLED WITH ONE OR MORE REPETITIONS OF</span>
00194    <span class="comment">// THE FOLLOWING FOUR STEPS.</span>
00195    <span class="comment">// THE MESSAGE IS TERMINATED WITH AN EMPTY LINE ('\n' ALONE),</span>
00196    <span class="comment">// THUS, EITHER HAVE A FIXED NUMBER OF LINES FOR THE CLASS, OR BE</span>
00197    <span class="comment">// PREPARED FOR MESSAGE TERMINATION.</span>
00198 
00199 
00200    <span class="comment">// 1. Find the end of the next line in the buffer</span>
00201    <span class="comment">//</span>
00202    <span class="keywordflow">if</span> ( (_index = <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.find(<span class="stringliteral">"\n"</span>)) == <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.npos )
00203    {
00204       <span class="comment">// First way to throw a worm_exception object</span>
00205       <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Unterminated message while parsing ResultTemplate line"</span>);
00206    }   
00207    
00208    <span class="comment">// 2. Extract the line from the buffer</span>
00209    <span class="comment">//</span>
00210    _readline = <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.substr( 0 , _index );
00211    
00212    <span class="comment">// 3. Remove the line from the buffer</span>
00213    <span class="comment">//</span>
00214    <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.erase( 0 , _index + 1 );
00215    
00216    <span class="comment">// 4. Parse the message line</span>
00217    
00218    <span class="keywordflow">if</span> ( sscanf( _readline.c_str()
00219               , <span class="stringliteral">"%d %d %s"</span>
00220               , &amp;MyIntVariable
00221               , &amp;MySecondIntVariable
00222               ,  MyCharVariable
00223               ) != 3
00224       )
00225    {
00226       <a class="code" href="classworm__exception.html">worm_exception</a> my_exception(<span class="stringliteral">"ResultTemplate::ParseDerivativeData() Error: Invalid line\n"</span> );
00227                      my_exception += _readline.c_str();
00228       <span class="keywordflow">throw</span> my_exception;
00229    }
00230    
00231    <span class="comment">// NOTE THAT THE ABOVE 'MyXXXVariables' ARE EXPECTED TO BE CLASS VARIABLES,</span>
00232    <span class="comment">// THUS AFTER PARSING, THIS CLASS BECOMES A DATA CONTAINER ALONG WITH</span>
00233    <span class="comment">// MESSAGE FORMATTER/PARSER</span>
00234    
00235 }
00236 
00237 <span class="comment">//------------------------------------------------------------------------------</span>
00238 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:07 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
