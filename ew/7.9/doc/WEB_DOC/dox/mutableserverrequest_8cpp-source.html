<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mutableserverrequest.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>mutableserverrequest.cpp</h1><a href="mutableserverrequest_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// mutableserverrequest.cpp: implementation of the MutableServerRequest class.</span>
00002 <span class="comment">//</span>
00004 <span class="comment"></span>
00005 <span class="preprocessor">#include "<a class="code" href="mutableserverrequest_8h.html">mutableserverrequest.h</a>"</span>
00006 
00007 
00009 <span class="comment">// Construction/Destruction</span>
00011 <span class="comment"></span>
<a name="l00012"></a><a class="code" href="classMutableServerRequest.html#a0">00012</a> <a class="code" href="classMutableServerRequest.html#a0">MutableServerRequest::MutableServerRequest</a>()
00013 {
00014 
00015 }
00016 <span class="comment">//</span>
00017 <span class="comment">// --------------------------------------------------------------------</span>
00018 <span class="comment">//</span>
<a name="l00019"></a><a class="code" href="classMutableServerRequest.html#b0">00019</a> <span class="keywordtype">long</span> <a class="code" href="classMutableServerRequest.html#b0">MutableServerRequest::BufferInitAlloc</a>()
00020 {
00021    <span class="keywordtype">long</span> r_size = <a class="code" href="classMutableServerMessage.html#b0">MutableServerMessage::BufferInitAlloc</a>();
00022 
00023    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> _p = 0, _sz = <a class="code" href="classPassport.html">Passport</a>.size() ; _p &lt; _sz ; _p++ )
00024    {
00025       r_size += <a class="code" href="classPassport.html">Passport</a>[_p].length();
00026       r_size += 1;  <span class="comment">// line-terminating '\n'</span>
00027    }
00028    <span class="keywordflow">return</span> r_size;
00029 }
00030 <span class="comment">//</span>
00031 <span class="comment">// --------------------------------------------------------------------</span>
00032 <span class="comment">//</span>
<a name="l00033"></a><a class="code" href="classMutableServerRequest.html#b1">00033</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerRequest.html#b1">MutableServerRequest::FormatDerivativeData</a>()
00034 {
00035    <a class="code" href="classMutableServerMessage.html#b1">MutableServerMessage::FormatDerivativeData</a>();
00036 
00037    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> _p = 0, _sz = <a class="code" href="classPassport.html">Passport</a>.size() ; _p &lt; _sz ; _p++ )
00038    {
00039       <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.append( MSR_PASSPORT_TAG );
00040       <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.append( <a class="code" href="classPassport.html">Passport</a>[_p] );
00041       <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.append( <span class="stringliteral">"\n"</span> );
00042    }
00043    <span class="comment">// flag the start of the data</span>
00044    <span class="comment">//</span>
00045       <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.append( MSR_DATASTART_LINE );
00046       <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.append( <span class="stringliteral">"\n"</span> );
00047 }
00048 <span class="comment">//</span>
00049 <span class="comment">// --------------------------------------------------------------------</span>
00050 <span class="comment">//</span>
<a name="l00051"></a><a class="code" href="classMutableServerRequest.html#b2">00051</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerRequest.html#b2">MutableServerRequest::ParseDerivativeData</a>()
00052 {
00053    <a class="code" href="classMutableServerMessage.html#b2">MutableServerMessage::ParseDerivativeData</a>();
00054 
00055    <a class="code" href="classMutableServerRequest.html#a1">ClearPassport</a>();
00056 
00057    <span class="keywordtype">bool</span> _parsing = <span class="keyword">true</span>;
00058 
00059    <span class="keywordtype">long</span> _index;
00060 
00061    std::string _ppline; <span class="comment">// passport line</span>
00062 
00063    <span class="keywordflow">do</span>
00064    {
00065       <span class="keywordflow">if</span> ( (_index = <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.find(<span class="stringliteral">"\n"</span>)) == <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.npos )
00066       {
00067          <span class="keywordflow">throw</span> <a class="code" href="classworm__exception.html">worm_exception</a>(<span class="stringliteral">"Unterminated message while parsing passport"</span>);
00068       }
00069 
00070 <span class="comment">// DEBUG remove this?</span>
00071       <span class="comment">// - 1 to exclude '\n'</span>
00072 
00073       _ppline = <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.substr( 0 , _index );
00074 
00075 
00076       <span class="comment">// Remove this line from the buffer</span>
00077       <span class="comment">// + 1 to include '\n'</span>
00078 
00079       <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>.erase( 0 , _index + 1 );
00080 
00081       <span class="comment">// check for start of data</span>
00082 
00083       <span class="keywordflow">if</span> ( _ppline.compare( MSR_DATASTART_LINE ) == 0 )
00084       {
00085          _parsing = <span class="keyword">false</span>;
00086          <span class="keywordflow">continue</span>;
00087       }
00088 
00089       <span class="comment">// minimally validate the passport line format</span>
00090 
00091       
00092       <span class="keywordflow">if</span> ( _ppline.compare( 0, strlen(MSR_PASSPORT_TAG),  MSR_PASSPORT_TAG ) != 0 )
00093       {
00094          <a class="code" href="classworm__exception.html">worm_exception</a> _expt(<span class="stringliteral">"Invalid passport line: &gt;"</span>);
00095                         _expt += _ppline;
00096                         _expt += <span class="stringliteral">"&lt;"</span>;
00097          <span class="keywordflow">throw</span> _expt;
00098       }
00099 
00100       <span class="comment">// remove the tag from the line</span>
00101 
00102       _ppline.erase( 0 , strlen(MSR_PASSPORT_TAG) );
00103 
00104       <span class="comment">// Add the line to the passport</span>
00105 
00106       <a class="code" href="classMutableServerRequest.html#a2">AddPassportLine</a>( _ppline );
00107 
00108    } <span class="keywordflow">while</span>( _parsing );
00109    
00110 }
00111 <span class="comment">//</span>
00112 <span class="comment">// --------------------------------------------------------------------</span>
00113 <span class="comment">//</span>
<a name="l00114"></a><a class="code" href="classMutableServerRequest.html#a1">00114</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerRequest.html#a1">MutableServerRequest::ClearPassport</a>() { <a class="code" href="classPassport.html">Passport</a>.clear(); }
00115 <span class="comment">//</span>
00116 <span class="comment">// --------------------------------------------------------------------</span>
00117 <span class="comment">//</span>
<a name="l00118"></a><a class="code" href="classMutableServerRequest.html#a2">00118</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerRequest.html#a2">MutableServerRequest::AddPassportLine</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> * p_line )
00119 {
00120    <span class="keywordflow">if</span> ( p_line != NULL )
00121    {
00122       std::string _pp = p_line;
00123       <a class="code" href="classPassport.html">Passport</a>.push_back(_pp);
00124    }
00125 }
00126 <span class="comment">//</span>
00127 <span class="comment">// --------------------------------------------------------------------</span>
00128 <span class="comment">//</span>
<a name="l00129"></a><a class="code" href="classMutableServerRequest.html#a3">00129</a> <span class="keywordtype">void</span> <a class="code" href="classMutableServerRequest.html#a2">MutableServerRequest::AddPassportLine</a>( std::string p_line )
00130 {
00131    <a class="code" href="classPassport.html">Passport</a>.push_back(p_line);
00132 }
00133 <span class="comment">//</span>
00134 <span class="comment">// --------------------------------------------------------------------</span>
00135 <span class="comment">//</span>
<a name="l00136"></a><a class="code" href="classMutableServerRequest.html#a4">00136</a> <span class="keywordtype">int</span> <a class="code" href="classMutableServerRequest.html#a4">MutableServerRequest::GetPassportLineCount</a>() { <span class="keywordflow">return</span> <a class="code" href="classPassport.html">Passport</a>.size(); }
00137 <span class="comment">//</span>
00138 <span class="comment">// --------------------------------------------------------------------</span>
00139 <span class="comment">//</span>
<a name="l00140"></a><a class="code" href="classMutableServerRequest.html#a5">00140</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classMutableServerRequest.html#a5">MutableServerRequest::GetPassportLine</a>( <span class="keywordtype">int</span> p_index )
00141 {
00142    <span class="keywordflow">if</span> ( 0 &lt;= p_index &amp;&amp; p_index &lt; <a class="code" href="classPassport.html">Passport</a>.size() )
00143    {
00144       <span class="keywordflow">return</span> <a class="code" href="classPassport.html">Passport</a>[p_index].c_str();
00145    }
00146    <span class="keywordflow">else</span>
00147    {
00148       <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)NULL;
00149    }
00150 }
00151 <span class="comment">//</span>
00152 <span class="comment">// --------------------------------------------------------------------</span>
00153 <span class="comment">//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:06 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
