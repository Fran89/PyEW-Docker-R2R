<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>server_template.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>server_template.h</h1><a href="server__template_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * server_template.h -- Template and server class deriving from</span>
00003 <span class="comment"> *                      the MutableServerBase class.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> *                      The base class handles communications, so this class</span>
00006 <span class="comment"> *                      primarily must only concern itself with the specific</span>
00007 <span class="comment"> *                      handling for this type of server (to include relevant</span>
00008 <span class="comment"> *                      configuration, passports and calculations.</span>
00009 <span class="comment"> */</span>
00010  
00011 <span class="comment">// STEP 1: Do a global replacement of the string "ServerTemplate"</span>
00012 <span class="comment">//         with the name of your new class</span>
00013 <span class="comment">//</span>
00014 <span class="preprocessor">#if ! defined(_MSM_ServerTemplate_H)</span>
<a name="l00015"></a><a class="code" href="server__template_8h.html#a0">00015</a> <span class="preprocessor"></span><span class="preprocessor">#define _MSM_ServerTemplate_H</span>
00016 <span class="preprocessor"></span>
00017 
00018 <span class="comment">// IF THE NEW SERVER WILL NOT NEED DATABASE CONNECTIVITY, THIS MAY BE</span>
00019 <span class="comment">// CHANGED TO &lt;mutableserverbase.h&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="dbmutableserver_8h.html">dbmutableserver.h</a>&gt;</span>
00021 
00022 
00023 <span class="comment">// STEP 2: Declare a structure type to contain configuration parameters</span>
00024 <span class="comment">//         that may change due to arriving passport data.</span>
00025 <span class="comment">//</span>
00026 <span class="keyword">typedef</span> _ServerTemplate_PARAMS
00027 {
00028    <span class="comment">// These are just examples used in the source</span>
00029    <span class="keywordtype">long</span>      ExampleLongParam;
00030    <span class="keywordtype">char</span>      ExampleStringParam[31];
00031    <span class="keywordtype">bool</span>      ExampleFlagParam;
00032 } ServerTemplate_PARAMS;
00033 
00034 
00035 <span class="comment">// IF THE NEW SERVER WILL NOT NEED DATABASE CONNECTIVITY, THE PARENT CLASS</span>
00036 <span class="comment">// MAY BE CHANGE TO MutableServerBase</span>
<a name="l00037"></a><a class="code" href="classServerTemplate.html">00037</a> <span class="keyword">class </span><a class="code" href="classServerTemplate.html">ServerTemplate</a> : <span class="keyword">public</span> <a class="code" href="classDBMutableServer.html">DBMutableServer</a>
00038 {
00039 <span class="keyword">protected</span>:
00040 
00041    <span class="comment">// =======================================================================</span>
00042    <span class="comment">//                  from TConfigurable</span>
00043    <span class="comment">// =======================================================================</span>
00044 
00045    <span class="comment">/* CheckConfig() -- allows derivative classes to report the status of their</span>
00046 <span class="comment">   **                  the configuration state.</span>
00047 <span class="comment">   **</span>
00048 <span class="comment">   ** Set ConfigStatus = WORM_STAT_BADSTATE if there</span>
00049 <span class="comment">   ** is a configuration problem, otherwise take no action.</span>
00050 <span class="comment">   */</span>
00051    <span class="keywordtype">void</span> <a class="code" href="classServerTemplate.html#b0">CheckConfig</a>();
00052 
00053 
00054    <span class="comment">// =======================================================================</span>
00055    <span class="comment">//                  from WormServerBase</span>
00056    <span class="comment">// =======================================================================</span>
00057 
00058    <span class="comment">// PrepareToRun() -- actions to take prior to entering main loop</span>
00059    <span class="comment">// </span>
00060    <span class="comment">//   ALWAYS call base class's PrepareToRun() at the top</span>
00061    <span class="comment">//</span>
00062    <span class="comment">// RETURN:  true if ready</span>
00063    <span class="comment">//          false if some condition prevents proper execution</span>
00064    <span class="comment">//</span>
00065    <span class="keywordtype">bool</span> <a class="code" href="classServerTemplate.html#b1">PrepareToRun</a>();
00066 
00067 
00068    <span class="comment">// =======================================================================</span>
00069    <span class="comment">//                  from MutableServerBase</span>
00070    <span class="comment">// =======================================================================</span>
00071 
00072 <span class="comment">// STEP 3: Replace the TYPE_XXXXXXX with the appropriate Earthworm message type</span>
00073 <span class="comment">//         that will be returned if this server runs in module mode.</span>
00074 <span class="comment">//</span>
00075    <span class="comment">// OutputMessageTypeKey() -- Returns the string used to identify </span>
00076    <span class="comment">//                           result messages sent in Module mode</span>
00077    <span class="comment">//                           via the ring (e.g.:  TYPE_XXXXXXX).</span>
00078    <span class="comment">//                           This is intended to allow different</span>
00079    <span class="comment">//                           derivative servers to emit different</span>
00080    <span class="comment">//                           message types.</span>
00081    <span class="comment">//</span>
<a name="l00082"></a><a class="code" href="classServerTemplate.html#b2">00082</a>    <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classServerTemplate.html#b2">OutputMessageTypeKey</a>() { <span class="keywordflow">return</span> <span class="stringliteral">"TYPE_XXXXXXX"</span>; }
00083 
00084 <span class="comment">// STEP 4: Set an appropriate size for the socket buffer.</span>
00085 <span class="comment">//</span>
00086    <span class="comment">/*</span>
00087 <span class="comment">   ** GetMaxSocketBufferSize() -- Server mode uses this to allocate</span>
00088 <span class="comment">   **                             a buffer of sufficient size to</span>
00089 <span class="comment">   **                             parse the arriving and format</span>
00090 <span class="comment">   **                             the outgoing message</span>
00091 <span class="comment">   */</span>
<a name="l00092"></a><a class="code" href="classServerTemplate.html#b3">00092</a>    <span class="keywordtype">long</span> <a class="code" href="classServerTemplate.html#b3">GetMaxSocketBufferSize</a>() { <span class="keywordflow">return</span> 1024L; }
00093    
00094 
00095    <span class="comment">/*</span>
00096 <span class="comment">    * GetRequestContainer(), </span>
00097 <span class="comment">    *  GetResultContainer() -- gets a container to hold the request</span>
00098 <span class="comment">    *                          (e.g. passport &amp; event info) or result info.</span>
00099 <span class="comment">    *                          Since we don't know what all</span>
00100 <span class="comment">    *                          possible content that can be in a</span>
00101 <span class="comment">    *                          request or returned for the various derivative</span>
00102 <span class="comment">    *                          classes of servers, the container</span>
00103 <span class="comment">    *                          is returned as a base class pointer,</span>
00104 <span class="comment">    *                          This base class code does not need</span>
00105 <span class="comment">    *                          to know about the container, only</span>
00106 <span class="comment">    *                          the following virtual methods do.</span>
00107 <span class="comment">    *</span>
00108 <span class="comment">    * RETURNS:</span>
00109 <span class="comment">    *      a pointer to the container</span>
00110 <span class="comment">    *   or NULL on failure</span>
00111 <span class="comment">    */</span>
00112    <a class="code" href="classMutableServerRequest.html">MutableServerRequest</a> * <a class="code" href="classServerTemplate.html#b4">GetRequestContainer</a>();
00113 
00114    <a class="code" href="classMutableServerResult.html">MutableServerResult</a> * <a class="code" href="classServerTemplate.html#b5">GetResultContainer</a>();
00115 
00116 
00117    <span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - -</span>
00118    <span class="comment">// For Standalone or Client modes</span>
00119    <span class="comment">//</span>
00120    <span class="comment">// Gets request parameters/instructions from command line args</span>
00121    <span class="comment">// or stdin</span>
00122    <span class="comment">//</span>
00123    <span class="comment">// r_container = a pointer to the appropriate type of</span>
00124    <span class="comment">//               MutableServerRequest derivative class</span>
00125    <span class="comment">//               (cast to the specific type in the method).</span>
00126    <span class="comment">//</span>
00127    <span class="comment">// RETURN:</span>
00128    <span class="comment">//     WORM_STAT_SUCCESS</span>
00129    <span class="comment">//     WORM_STAT_FAILURE</span>
00130    <span class="comment">//</span>
00131    <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> <a class="code" href="classServerTemplate.html#b6">GetRequestFromInput</a>( <span class="keywordtype">int</span>    p_argc
00132                                        , <span class="keywordtype">char</span> * p_argv[]
00133                                        , <span class="keywordtype">void</span> * r_container
00134                                        );
00135    
00136    <span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - -</span>
00137    <span class="comment">// For Server, Module or Standalone modes</span>
00138    <span class="comment">//</span>
00139    <span class="comment">// The actual processing</span>
00140    <span class="comment">//</span>
00141    <span class="comment">// PARAMETERS:</span>
00142    <span class="comment">//</span>
00143    <span class="comment">//      p_requestcontainer = pointer to a request object</span>
00144    <span class="comment">//                           appropriate for this server class</span>
00145    <span class="comment">//</span>
00146    <span class="comment">//      r_resultcontainer = pointer to an object of a type</span>
00147    <span class="comment">//                          derived from the MutableServerResult class</span>
00148    <span class="comment">//                          which is appropriate for this type of server.</span>
00149    <span class="comment">//                          (cast to the specific type in the method).</span>
00150    <span class="comment">//</span>
00151    <span class="comment">// RETURN:</span>
00152    <span class="comment">//      WORM_STAT_SUCCESS  = good results</span>
00153    <span class="comment">//      WORM_STAT_BADSTATE = algorithmic, not system, failure (no results obtained)</span>
00154    <span class="comment">//      WORM_STAT_FAILURE  = system failure</span>
00155    <span class="comment">//</span>
00156    <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> <a class="code" href="classServerTemplate.html#b7">ProcessRequest</a>( <span class="keywordtype">void</span> * p_requestcontainer
00157                                   , <span class="keywordtype">void</span> * r_resultcontainer
00158                                   );
00159 
00160 
00161    <span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - -</span>
00162    <span class="comment">// For Client, Module or Standalone modes</span>
00163    <span class="comment">//</span>
00164    <span class="comment">// What to do with the results;</span>
00165    <span class="comment">//</span>
00166    <span class="comment">// PARAMETERS:</span>
00167    <span class="comment">//</span>
00168    <span class="comment">//      p_resultcontainer = pointer to an object of a type</span>
00169    <span class="comment">//                          derived from the MutableServerResult class</span>
00170    <span class="comment">//                          which is appropriate for this type of server.</span>
00171    <span class="comment">//                          (cast to the specific type in the method).</span>
00172    <span class="comment">//</span>
00173    <span class="comment">// MUST RETURN:</span>
00174    <span class="comment">//      WORM_STAT_SUCCESS  = good results</span>
00175    <span class="comment">//      WORM_STAT_BADSTATE = algorithmic, not system, failure (no results obtained)</span>
00176    <span class="comment">//      WORM_STAT_FAILURE  = system failure</span>
00177    <span class="comment">//</span>
00178    <a class="code" href="statuscode_8h.html#a16">WORM_STATUS_CODE</a> <a class="code" href="classServerTemplate.html#b8">HandleResult</a>( <span class="keywordtype">void</span> * p_resultcontainer );
00179 
00180 
00181    <span class="comment">// =======================================================================</span>
00182    <span class="comment">//                  from DBMutableServerBase</span>
00183    <span class="comment">// =======================================================================</span>
00184    
00185    <span class="comment">// HandleParameterLine() -- handle configuration lines which may be either</span>
00186    <span class="comment">//                          lines from a .d file, or passport lines from</span>
00187    <span class="comment">//                          the database.</span>
00188    <span class="comment">// </span>
00189    <span class="comment">// PARAMETERS:</span>
00190    <span class="comment">//       p_parser = pointer to a ComFile or OracleConfigSource object</span>
00191    <span class="comment">//       p_params = pointer to either a struct holding default parameters,</span>
00192    <span class="comment">//                  or to a struct that is being used to hold parameters</span>
00193    <span class="comment">//                  for an arriving processing request.</span>
00194    <span class="comment">// </span>
00195    <span class="comment">// RETURNS:</span>
00196    <span class="comment">//          HANDLE_INVALID --  line invalid</span>
00197    <span class="comment">//          HANDLE_UNUSED  --  line not used</span>
00198    <span class="comment">//          HANDLE_USED    --  line used okay</span>
00199    <span class="comment">//</span>
00200    <a class="code" href="configurable_8h.html#a3">HANDLE_STATUS</a> <a class="code" href="classServerTemplate.html#b9">HandleParameterLine</a>( <a class="code" href="classConfigSource.html">ConfigSource</a> * p_parser
00201                                     , <span class="keywordtype">void</span>         * p_params
00202                                     );
00203 
00204 
00205 
00206    <span class="comment">// =======================================================================</span>
00207    <span class="comment">//                  for ServerTemplate</span>
00208    <span class="comment">// =======================================================================</span>
00209 
00210    <span class="comment">// Structure to hold the default parameters</span>
00211    <span class="comment">//</span>
<a name="l00212"></a><a class="code" href="classServerTemplate.html#n0">00212</a>    ServerTemplate_PARAMS   <a class="code" href="classServerTemplate.html#n0">DefaultParameters</a>;
00213 
00214 
00215 <span class="keyword">public</span>:
00216 
00217 
00218    <span class="comment">// =======================================================================</span>
00219    <span class="comment">//                  from TConfigurable</span>
00220    <span class="comment">// =======================================================================</span>
00221 
00222    <span class="comment">/*</span>
00223 <span class="comment">    *  HandleConfigLine() -- allows programs to handle configuration in a</span>
00224 <span class="comment">    *                        consistent manner.</span>
00225 <span class="comment">    *</span>
00226 <span class="comment">    *  PARMS:</span>
00227 <span class="comment">    *          p_parser -- Pointer to some type of configuration source object,</span>
00228 <span class="comment">    *                      such as ComFile or OracleConfigSource.  The object</span>
00229 <span class="comment">    *                      will have a command string already in the current</span>
00230 <span class="comment">    *                      token for comparison using the Its() method.</span>
00231 <span class="comment">    *</span>
00232 <span class="comment">    * RETURN:</span>
00233 <span class="comment">    *          HANDLE_INVALID --  line invalid</span>
00234 <span class="comment">    *          HANDLE_UNUSED  --  line not used</span>
00235 <span class="comment">    *          HANDLE_USED    --  line used okay</span>
00236 <span class="comment">    *</span>
00237 <span class="comment">    *  Override for child classes to handle parameter lines</span>
00238 <span class="comment">    *  Call &lt;super_class::HandleConfigLine() within derivative classes</span>
00239 <span class="comment">    *  to allow them a whack at the parameter as well.</span>
00240 <span class="comment">    */</span>
00241    <a class="code" href="configurable_8h.html#a3">HANDLE_STATUS</a> <a class="code" href="classServerTemplate.html#a0">HandleConfigLine</a>( <a class="code" href="classConfigSource.html">ConfigSource</a> * p_parser );
00242 
00243 
00244    <span class="comment">// =======================================================================</span>
00245    <span class="comment">//                  for ServerTemplate</span>
00246    <span class="comment">// =======================================================================</span>
00247 
00248    <a class="code" href="classServerTemplate.html#a1">ServerTemplate</a>();
00249    
00250    <a class="code" href="classServerTemplate.html#a2">~ServerTemplate</a>();
00251    
00252 
00253 };
00254 
00255 <span class="preprocessor">#endif // _MSM_ServerTemplate_H</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:09 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
