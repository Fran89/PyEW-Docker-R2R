<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sudsputaway.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>sudsputaway.c</h1><a href="sudsputaway_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00003 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> *    $Id: sudsputaway_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> *    Revision history:</span>
00008 <span class="comment"> *     $Log$
00008 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00008 <span class="comment"> *     first inclusion
00008 <span class="comment"> *</span>
00009 <span class="comment"> *     Revision 1.9  2002/01/08 17:02:29  cjbryan</span>
00010 <span class="comment"> *     In order to accommodate 24-bit broadband data, traces of data of longer than long are now clipped to +/-2147483648</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *     Revision 1.8  2001/04/12 03:47:36  lombard</span>
00013 <span class="comment"> *     Major reorganization of SUDSPA_next to improve efficiency</span>
00014 <span class="comment"> *     Reformatted code; cleaned up lots of comments and logit calls</span>
00015 <span class="comment"> *     Removed mapping of NC component codes (only needed at UW)</span>
00016 <span class="comment"> *     Now traces of data larger than short in are clipped to +/- 32767</span>
00017 <span class="comment"> *     counts; before they were byte-truncated.</span>
00018 <span class="comment"> *     Initializes SUDS structures to zero before filling them.</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> *     Revision 1.7  2001/03/27 22:22:51  cjbryan</span>
00021 <span class="comment"> *     ensured that time portion of suds format is hhmmss and not hhmmss.ss as carried by EventTime variable</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> *     Revision 1.6  2001/03/22 20:55:12  cjbryan</span>
00024 <span class="comment"> *     deleted now obsolete EventInst variable</span>
00025 <span class="comment"> *</span>
00026 <span class="comment"> *     Revision 1.5  2001/03/21 23:15:23  cjbryan</span>
00027 <span class="comment"> *     integrated CVO subnet into output filename</span>
00028 <span class="comment"> *</span>
00029 <span class="comment"> *     Revision 1.4  2001/03/21 16:41:07  alex</span>
00030 <span class="comment"> *     added EventSubnet variable to carry subnet name through to</span>
00031 <span class="comment"> *     filename; deleted now extraneous EventMod variable</span>
00032 <span class="comment"> *</span>
00033 <span class="comment"> *     Revision 1.3  2001/03/21 02:23:03  alex</span>
00034 <span class="comment"> *     *** empty log message ***</span>
00035 <span class="comment"> *</span>
00036 <span class="comment"> *     Revision 1.2  2000/03/10 23:23:43  davidk</span>
00037 <span class="comment"> *     changed the sudsputaway routines to match the new PA_XXX</span>
00038 <span class="comment"> *     routines in putaway.c.</span>
00039 <span class="comment"> *     Moved the SUDSPA_XXX function prototypes to pa_other_head.h</span>
00040 <span class="comment"> *</span>
00041 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00042 <span class="comment"> *     Initial revision</span>
00043 <span class="comment"> *</span>
00044 <span class="comment"> *</span>
00045 <span class="comment"> */</span>
00046 
00047 <span class="comment">/* sudsputaway.c </span>
00048 <span class="comment">   </span>
00049 <span class="comment">        Routines for writing trace data in PC-SUDS format </span>
00050 <span class="comment"></span>
00051 <span class="comment"></span>
00052 <span class="comment">  Thu Jul 22 14:56:37 MDT 1999 Lucky Vidmar</span>
00053 <span class="comment">    Major structural changes to accomodate making all putaway routines</span>
00054 <span class="comment">    into library calls so that they can be shared between trig2disk</span>
00055 <span class="comment">    and wave2disk. Eliminated global variables set and allocated outside</span>
00056 <span class="comment">    of this file. We should only have static globals from now on, with</span>
00057 <span class="comment">    everything else being passed in via the putaway.c calls.</span>
00058 <span class="comment">*/</span>
00059 
00060 <span class="preprocessor">#include &lt;limits.h&gt;</span>
00061 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00062 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00063 <span class="preprocessor">#include &lt;string.h&gt;</span>
00064 <span class="preprocessor">#include &lt;errno.h&gt;</span>
00065 <span class="preprocessor">#include &lt;<a class="code" href="earthworm_8h.html">earthworm.h</a>&gt;</span>
00066 <span class="preprocessor">#include &lt;time.h&gt;</span>
00067 <span class="preprocessor">#include &lt;<a class="code" href="trace__buf_8h.html">trace_buf.h</a>&gt;</span>
00068 <span class="preprocessor">#include &lt;<a class="code" href="swap_8h.html">swap.h</a>&gt;</span>
00069 <span class="preprocessor">#include &lt;<a class="code" href="ws__clientII_8h.html">ws_clientII.h</a>&gt;</span>
00070 <span class="preprocessor">#include &lt;<a class="code" href="sudshead_8h.html">sudshead.h</a>&gt;</span>
00071 <span class="preprocessor">#include &lt;<a class="code" href="pa__subs_8h.html">pa_subs.h</a>&gt;</span>
00072 
<a name="l00073"></a><a class="code" href="sudsputaway_8c.html#a0">00073</a> <span class="preprocessor">#define TAG_FILE        '.tag'        </span><span class="comment">/* file containing the last known file tag */</span>
<a name="l00074"></a><a class="code" href="sudsputaway_8c.html#a1">00074</a> <span class="preprocessor">#define MAXTXT           150</span>
00075 <span class="preprocessor"></span>
00076 
<a name="l00077"></a><a class="code" href="sudsputaway_8c.html#a2">00077</a> FILE    *<a class="code" href="sudsputaway_8c.html#a2">SUDSfp</a>;                      <span class="comment">/* file pointer for the SUDS file */</span>
00078 
<a name="l00079"></a><a class="code" href="sudsputaway_8c.html#a3">00079</a> <span class="keyword">static</span>  <span class="keywordtype">long</span>   *<a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>;           <span class="comment">/* write out SUDS data as long integers */</span>
<a name="l00080"></a><a class="code" href="sudsputaway_8c.html#a4">00080</a> <span class="keyword">static</span>  <span class="keywordtype">short</span>  *<a class="code" href="sudsputaway_8c.html#a4">SudsBufferShort</a>;      <span class="comment">/* write out SUDS data as short integers */</span>
<a name="l00081"></a><a class="code" href="sudsputaway_8c.html#a5">00081</a> <span class="keyword">static</span>  <span class="keywordtype">char</span> <a class="code" href="sudsputaway_8c.html#a5">SudsOutputFormat</a>[<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a>];
00082 
00083 <span class="comment">/* Internal Function Prototypes */</span>
00084 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a6">StructMakeLocal</a> (<span class="keywordtype">void</span> *, <span class="keywordtype">int</span>, <span class="keywordtype">char</span>, <span class="keywordtype">int</span>);
00085 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a7">SwapDo</a> (<span class="keywordtype">void</span> *, <span class="keywordtype">int</span>);
00086 
00087 <span class="comment">/************************************************************************</span>
00088 <span class="comment">* Initialization function,                                              *</span>
00089 <span class="comment">*       This is the Put Away startup intializer. This is called when    *</span>
00090 <span class="comment">*       the system first comes up. Here is a chance to look around      *</span>
00091 <span class="comment">*       and see if it's possible to do business, and to complain        *</span>
00092 <span class="comment">*       if not ,BEFORE an event has to be processed.                    *</span>
00093 <span class="comment">*                                                                       *</span>
00094 <span class="comment">*       For PCSUDS, all we want to do is to make sure that the          *</span>
00095 <span class="comment">*       directory where files should be written exists.                 *</span>
00096 <span class="comment">*************************************************************************/</span>
<a name="l00097"></a><a class="code" href="sudsputaway_8c.html#a8">00097</a> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a8">SUDSPA_init</a> (<span class="keywordtype">int</span> OutBufferLen, <span class="keywordtype">char</span> *OutDir, <span class="keywordtype">char</span> *OutputFormat, 
00098                  <span class="keywordtype">int</span> debug)
00099 {
00107   <span class="keywordflow">if</span> ((<a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a> = (<span class="keywordtype">long</span> *) malloc (OutBufferLen * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>))) == NULL)
00108   {
00109     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_init: couldn't malloc SudsBuffer\n"</span>);
00110     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00111   }
00112   <span class="keywordflow">if</span> ((<a class="code" href="sudsputaway_8c.html#a4">SudsBufferShort</a> = (<span class="keywordtype">short</span> *) malloc (OutBufferLen * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>))) == NULL)
00113   {
00114     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_init: couldn't malloc SudsBufferShort\n"</span>);
00115     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00116   }
00117 
00118   <span class="comment">/* Make sure that the top level output directory exists */</span>
00119   <span class="keywordflow">if</span> (<a class="code" href="dirops__ew_8c.html#a1">CreateDir</a> (OutDir) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00120   {
00121     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SUDSPA_init: Call to CreateDir failed\n"</span>);
00122     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00123   }
00124 
00125   <span class="keywordflow">if</span>(strlen(OutputFormat) &gt;= <span class="keyword">sizeof</span>(SudsOutputFormat))
00126   {
00127     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SUDSPA_init: Error: OutputFormat(%s) is too long! Quitting!\n"</span>,
00128           OutputFormat);
00129     <span class="keywordflow">return</span>(EW_FAILURE);
00130   }
00131   <span class="keywordflow">else</span>
00132   {
00133     strcpy(SudsOutputFormat,OutputFormat);
00134   }
00135   <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>; 
00136 }
00137 
00138 <span class="comment">/************************************************************************</span>
00139 <span class="comment">*   This is the Put Away event initializer. It's called when a snippet  *</span>
00140 <span class="comment">*   has been received, and is about to be processed.                    *</span>
00141 <span class="comment">*   It gets to see the pointer to the TraceRequest array,               *</span>
00142 <span class="comment">*   and the number of loaded trace structures.                          *</span>
00143 <span class="comment">*                                                                       *</span>
00144 <span class="comment">*   For PCSUDS, we need to make sure that the target directory          *</span>
00145 <span class="comment">*   exists, create it if it does not, then open the SUDS file           *</span>
00146 <span class="comment">*   for writing.                                                        *</span>
00147 <span class="comment">*************************************************************************/</span>
<a name="l00148"></a><a class="code" href="sudsputaway_8c.html#a9">00148</a> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a9">SUDSPA_next_ev</a> (<span class="keywordtype">char</span> *EventID, <a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> *ptrReq, <span class="keywordtype">int</span> nReq, 
00149                     <span class="keywordtype">char</span> *OutDir, <span class="keywordtype">char</span> *EventDate, <span class="keywordtype">char</span> *EventTime,
00150                     <span class="keywordtype">char</span> *EventSubnet, <span class="keywordtype">int</span> debug)
00151 
00152 {
00153   <span class="keywordtype">char</span>    SUDSFile[4*<a class="code" href="ahputaway_8c.html#a0">MAXTXT</a>];
00154   <span class="keywordtype">char</span>    hhmmss[7];
00155 
00156   <span class="comment">/* Changed by Eugene Lublinsky, 3/31/Y2K */</span>
00157   <span class="comment">/* There are 2 modes of behavior now: the default one when insmod */</span>
00158   <span class="comment">/* is numeric or the second one when insmod is alphanumeric */</span>
00159   <span class="keywordtype">char</span>  tmpEventID[<a class="code" href="earthworm__defs_8h.html#a18">EVENTID_SIZE</a> + 3];
00160 
00161   <span class="comment">/* We treat suds file slightly differently - by request</span>
00162 <span class="comment">   * from Tom Murray. The files are placed directly into the</span>
00163 <span class="comment">   * top level suds directory, with names as follows:</span>
00164 <span class="comment">   *</span>
00165 <span class="comment">   *    yyyymmdd_hhmmss_insmod_evid.dmx</span>
00166 <span class="comment">   */</span>
00167 
00168   <span class="comment">/* Changed by Eugene Lublinsky, 3/31/Y2K */</span>
00169   <span class="comment">/* choose which way to go */</span>
00170 
00171   <span class="comment">/* Build the file name */</span>
00172   <span class="comment">/* added by murray (and it shows) to set the eventid at 3 characters */</span>
00173   <span class="keywordflow">if</span> (strlen(EventID) &lt; 3)
00174     sprintf (tmpEventID,<span class="stringliteral">"000%s"</span>,EventID) ;
00175   <span class="keywordflow">else</span>
00176     sprintf (tmpEventID,<span class="stringliteral">"%s"</span>,EventID) ;
00177 
00178   <span class="comment">/* ensure that time string is of the form hhmmss (revised EventTime </span>
00179 <span class="comment">     allows a string of the form hhmmss.ss, so truncate it if necessary) */</span>
00180   <span class="keywordflow">if</span> (strlen(EventTime) &gt; 6)
00181   {
00182     strncpy(hhmmss, EventTime, 6);
00183     hhmmss[6] = <span class="charliteral">'\0'</span>;
00184   }
00185   <span class="keywordflow">else</span>
00186     strcpy(hhmmss, EventTime);
00187 
00188   <span class="comment">/* changed by Carol 3/21/01: if no subnet, use network name</span>
00189 <span class="comment">     in filename */</span>
00190   <span class="keywordflow">if</span> (EventSubnet[0] != <span class="charliteral">'\0'</span>)
00191     sprintf (SUDSFile, <span class="stringliteral">"%s/%s_%s_%s_%s.dmx"</span>, OutDir,
00192              EventDate, hhmmss, EventSubnet, 
00193              &amp;tmpEventID[strlen(tmpEventID)-3]);
00194   <span class="keywordflow">else</span>
00195     sprintf (SUDSFile, <span class="stringliteral">"%s/%s_%s_%s_%s.dmx"</span>, OutDir,
00196              EventDate, hhmmss, ptrReq-&gt;<a class="code" href="structTRACE__REQ.html#m2">net</a>, 
00197              &amp;tmpEventID[strlen(tmpEventID)-3]);
00198         
00199   <span class="comment">/* end of changes */</span>
00200 
00201   <span class="keywordflow">if</span> (debug == 1)
00202     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"t"</span>, <span class="stringliteral">"Opening SUDS file %s\n"</span>, SUDSFile);
00203 
00204   <span class="comment">/* open file */</span>
00205   <span class="keywordflow">if</span> ((<a class="code" href="sudsputaway_8c.html#a2">SUDSfp</a> = fopen (SUDSFile, <span class="stringliteral">"wb"</span>)) == NULL)
00206   {
00207     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SUDSPA_next_ev: unable to open file %s: %s\n"</span>, 
00208            SUDSFile, strerror(errno));
00209     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00210   }
00211 
00212   <span class="keywordflow">return</span> (EW_SUCCESS);
00213 }
00214 
00215 <span class="comment">/************************************************************************</span>
00216 <span class="comment">* This is the working entry point into the disposal system. This        *</span>
00217 <span class="comment">* routine gets called for each trace snippet which has been recovered.  *</span>
00218 <span class="comment">* It gets to see the corresponding SNIPPET structure, and the event id  *</span>
00219 <span class="comment">*                                                                       *</span>
00220 <span class="comment">* For PCSUDS, this routine writes to the SUDS file, pointed to by the   *</span>
00221 <span class="comment">* SUDSfp pointer, all of the received trace data in SUDS format:        *</span>
00222 <span class="comment">*                                                                       *</span>
00223 <span class="comment">*      1. SUDS tag - indicating what follows                            *</span>
00224 <span class="comment">*      2. SUDS_STATIONCOMP struct - describe the station                *</span>
00225 <span class="comment">*      3. SUDS tag - indicating what follows                            *</span>
00226 <span class="comment">*      4. SUDS_DESCRIPTRACE struct - describe the trace data            *</span>
00227 <span class="comment">*      5. trace data                                                    *</span>
00228 <span class="comment">*                                                                       *</span>
00229 <span class="comment">*  One bit of complexity is that we need to write the files in the      *</span>
00230 <span class="comment">*  correct byte-order. Based on the OutputFormat parameter, determine   *</span>
00231 <span class="comment">*  whether or not to swap bytes before writing the suds file.           *</span>
00232 <span class="comment">*                                                                       *</span>
00233 <span class="comment">* WARNING: we clip trace data to -2147483648 - +2147483647 so it will   *</span>
00234 <span class="comment">*  fit in a long int. Any incoming data that is longer than 32 bits     *</span>
00235 <span class="comment">*  will be CLIPPED. cjb 5/18/2001                                       *</span>
00236 <span class="comment">*************************************************************************/</span>
00237 <span class="comment">/* Process one channel of data */</span>
<a name="l00238"></a><a class="code" href="sudsputaway_8c.html#a10">00238</a> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a10">SUDSPA_next</a> (<a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> *getThis, <span class="keywordtype">double</span> GapThresh,
00239                  <span class="keywordtype">long</span> OutBufferLen, <span class="keywordtype">int</span> debug)
00240 {
00241   <a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *wf;
00242   <span class="keywordtype">short</span>  *s_data;
00243   <span class="keywordtype">long</span>   *l_data;
00244   <span class="keywordtype">float</span>  *f_data;
00245   <span class="keywordtype">char</span>   *msg_p;        <span class="comment">/* pointer into tracebuf data */</span>
00246   <span class="keywordtype">char</span>    datatype;
00247   <span class="keywordtype">int</span>     data_size;
00248   <span class="keywordtype">int</span>     j;
00249   <span class="keywordtype">int</span>     gap_count = 0;
00250   <span class="keywordtype">long</span>    nsamp, nfill;
00251   <span class="keywordtype">long</span>    nfill_max = 0l;
00252   <span class="keywordtype">long</span>    nsamp_this_scn = 0l;
00253   <span class="keywordtype">long</span>    this_size;
00254   <span class="keywordtype">double</span>  begintime, starttime, endtime;
00255   <span class="keywordtype">double</span>  samprate;
00256   <span class="keywordtype">long</span>    fill = 0l;
00257   <span class="keywordtype">long</span>    <a class="code" href="socket__ew_8h.html#a3">min</a>, max;
00258   <span class="keywordtype">int</span>     total;
00259   <a class="code" href="structSUDS__STRUCTTAG.html">SUDS_STRUCTTAG</a>          tag;
00260   <a class="code" href="structSUDS__DESCRIPTRACE.html">SUDS_DESCRIPTRACE</a>       dt;
00261   <a class="code" href="structSUDS__STATIONCOMP.html">SUDS_STATIONCOMP</a>        sc;
00262   
00263   <span class="comment">/* Check arguments */</span>
00264   <span class="keywordflow">if</span> (getThis == NULL)
00265   {
00266     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SUDSPA_next: invalid argument passed in.\n"</span>);
00267     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00268   }
00269 
00270   <span class="comment">/* Start with a clean slate */</span>
00271   memset(&amp;tag, 0, <span class="keyword">sizeof</span>(tag));
00272   memset(&amp;dt, 0, <span class="keyword">sizeof</span>(dt));
00273   memset(&amp;sc, 0, <span class="keyword">sizeof</span>(sc));
00274   
00275   <span class="comment">/* Used for computing trace statistics */</span>
00276   max = 4096;
00277   <a class="code" href="socket__ew_8h.html#a3">min</a> = 0;
00278   total = 0;
00279 
00280   <span class="keywordflow">if</span> ( (msg_p = getThis-&gt;<a class="code" href="structTRACE__REQ.html#m7">pBuf</a>) == NULL)   <span class="comment">/* pointer to first message */</span>
00281   {
00282     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SUDSPA_next: Message buffer is NULL.\n"</span>);
00283     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00284   }
00285   wf = (<a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *) msg_p;
00286   
00287   <span class="comment">/* Look at the first TRACE_HEADER and get set up of action */</span>
00288   <span class="keywordflow">if</span> (<a class="code" href="swap_8c.html#a4">WaveMsgMakeLocal</a>(wf) &lt; 0)
00289   {
00290     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SUDSPA_next: unknown trace data type: %s\n"</span>,
00291           wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>);
00292     <span class="keywordflow">return</span>( EW_FAILURE );
00293   }
00294 
00295   nsamp = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m1">nsamp</a>;
00296   starttime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m2">starttime</a>;
00297   endtime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m3">endtime</a>;
00298   samprate = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m4">samprate</a>;
00299   <span class="keywordflow">if</span> (samprate &lt; 0.01)
00300   {
00301     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"unreasonable samplerate (%f) for &lt;%s.%s.%s&gt;\n"</span>,
00302           samprate, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00303     <span class="keywordflow">return</span>( EW_FAILURE );
00304   }
00305   begintime = starttime;
00306   datatype = <span class="charliteral">'n'</span>;
00307   <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'s'</span> || wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'i'</span>)
00308   {
00309     <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'2'</span>) datatype = <span class="charliteral">'s'</span>;
00310     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'4'</span>) datatype = <span class="charliteral">'l'</span>;
00311   }
00312   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'t'</span> || wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[0] == <span class="charliteral">'f'</span>)
00313   {
00314     <span class="keywordflow">if</span> (wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>[1] == <span class="charliteral">'4'</span>) datatype = <span class="charliteral">'f'</span>;
00315   }
00316   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'n'</span>)
00317   {
00318     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: unsupported datatype: %s\n"</span>, datatype);
00319     <span class="keywordflow">return</span>( EW_FAILURE );
00320   }
00321 
00322   <span class="keywordflow">if</span> (debug == 1)
00323     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: working on &lt;%s/%s/%s&gt; datatype: %c \n"</span>,
00324                         wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>, datatype);
00325 
00326   <span class="comment">/* loop through all the messages for this s-c-n */</span>
00327   <span class="keywordflow">while</span> (1) 
00328   {
00329     <span class="comment">/* advance message pointer to the data */</span>
00330     msg_p += <span class="keyword">sizeof</span>(TRACE_HEADER);
00331         
00332     <span class="comment">/* check for sufficient memory in output buffer */</span>
00333     this_size = (nsamp_this_scn + nsamp ) * <span class="keyword">sizeof</span>(long);
00334     <span class="keywordflow">if</span> ( OutBufferLen &lt; this_size )
00335     {
00336       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"e"</span>, <span class="stringliteral">"out of space for &lt;%s.%s.%s&gt;; saving long trace.\n"</span>,
00337              wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00338       <span class="keywordflow">break</span>;
00339     }
00340   
00341         <span class="comment">/* if data are floats, clip to longs cjb 5/18/2001 */</span>
00342     <span class="keywordflow">switch</span>( datatype )
00343     {
00344     <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
00345       s_data = (<span class="keywordtype">short</span> *)msg_p;
00346       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp ; j++, nsamp_this_scn++ )
00347         <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[nsamp_this_scn] = (long) s_data[j];
00348       msg_p += <span class="keyword">sizeof</span>(short) * nsamp;
00349       <span class="keywordflow">break</span>;
00350     <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00351       l_data = (<span class="keywordtype">long</span> *)msg_p;
00352       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp; j++, nsamp_this_scn++ )
00353           <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[nsamp_this_scn] = l_data[j];
00354       msg_p += <span class="keyword">sizeof</span>(long) * nsamp;
00355       <span class="keywordflow">break</span>;
00356     <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00357       f_data = (<span class="keywordtype">float</span> *)msg_p;
00358       <span class="comment">/* CLIP the data to long int */</span>
00359       <span class="keywordflow">for</span> ( j = 0; j &lt; nsamp; j++, nsamp_this_scn++ )
00360       {
00361         <span class="keywordflow">if</span> (l_data[j] &lt; (float)LONG_MIN)
00362           <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[nsamp_this_scn] = LONG_MIN;
00363         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l_data[j] &gt; (float) LONG_MAX)
00364           <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[nsamp_this_scn] = LONG_MAX;
00365         <span class="keywordflow">else</span>
00366           <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[nsamp_this_scn] = (long) l_data[j];
00367       }
00368       msg_p += <span class="keyword">sizeof</span>(float) * nsamp;
00369       <span class="keywordflow">break</span>;
00370     }
00371   
00372     <span class="comment">/* End-check based on length of snippet buffer */</span>
00373     <span class="keywordflow">if</span> ((long) msg_p &gt;= ((long) getThis-&gt;<a class="code" href="structTRACE__REQ.html#m15">actLen</a> + (long) getThis-&gt;<a class="code" href="structTRACE__REQ.html#m7">pBuf</a>)) 
00374     {
00375       <span class="keywordflow">if</span> (debug == 1)
00376         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Setting done for &lt;%s.%s.%s&gt;\n"</span>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, 
00377                wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>);
00378       <span class="keywordflow">break</span>; <span class="comment">/* Break out of the while(1) loop 'cuz we're done */</span>
00379     }
00380   
00381     <span class="comment">/* msg_p has been advanced to the next TRACE_BUF; localize bytes *</span>
00382 <span class="comment">     * and check for gaps.                                           */</span>
00383     wf = (<a class="code" href="structTRACE__HEADER.html">TRACE_HEADER</a> *) msg_p;
00384     <span class="keywordflow">if</span> (<a class="code" href="swap_8c.html#a4">WaveMsgMakeLocal</a>(wf) &lt; 0)
00385     {
00386       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"SUDSPA_next: unknown trace data type: %s\n"</span>,
00387             wf-&gt;<a class="code" href="structTRACE__HEADER.html#m8">datatype</a>);
00388       <span class="keywordflow">return</span>( EW_FAILURE );
00389     }
00390     nsamp = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m1">nsamp</a>;
00391     starttime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m2">starttime</a>; 
00392     <span class="comment">/* starttime is set for new packet; endtime is still set for old packet */</span>
00393     <span class="keywordflow">if</span> ( endtime + ( 1.0/samprate ) * GapThresh &lt; starttime ) 
00394     {
00395       <span class="comment">/* there's a gap, so fill it */</span>
00396       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, <span class="stringliteral">"gap in %s.%s.%s: %lf: %lf\n"</span>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>,
00397             endtime, starttime - endtime);
00398       nfill = (long) (samprate * (starttime - endtime) - 1);
00399       <span class="keywordflow">if</span> ( (nsamp_this_scn + nfill) * (long)<span class="keyword">sizeof</span>(long) &gt; OutBufferLen ) 
00400       {
00401         <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"e"</span>, 
00402               <span class="stringliteral">"bogus gap (%d); skipping\n"</span>, nfill);
00403         <span class="keywordflow">return</span>(EW_FAILURE);
00404       }
00405       <span class="comment">/* do the filling */</span>
00406       <span class="keywordflow">for</span> ( j = 0; j &lt; nfill; j++, nsamp_this_scn ++ ) 
00407         <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[nsamp_this_scn] = fill;
00408       <span class="comment">/* keep track of how many gaps and the largest one */</span>
00409       gap_count++;
00410       <span class="keywordflow">if</span> (nfill_max &lt; nfill) 
00411         nfill_max = nfill;
00412     }
00413     <span class="comment">/* Advance endtime to the new packet;        *</span>
00414 <span class="comment">     * process this packet in the next iteration */</span>
00415     endtime = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m3">endtime</a>;
00416   } <span class="comment">/* while(1) */</span>
00417       
00418   <span class="comment">/* figure out min, max, and "noise" */</span>
00419   <span class="keywordflow">for</span> (j = 0; j &lt; 200 &amp;&amp; j &lt; nsamp_this_scn; j++)
00420   {
00421     <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j] &gt; max)
00422       max = <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j];
00423     <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j] &lt; <a class="code" href="socket__ew_8h.html#a3">min</a>)
00424       <a class="code" href="socket__ew_8h.html#a3">min</a> = <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j];
00425     total += <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j];
00426   }
00427   dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m11">avenoise</a> = ((float)total)/ (float)j;  <span class="comment">/* Mean of the first 200 samples */</span>
00428   <span class="keywordflow">for</span> (; j &lt; nsamp_this_scn; j++)
00429   {
00430     <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j] &gt; max)
00431       max = <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j];
00432     <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j] &lt; <a class="code" href="socket__ew_8h.html#a3">min</a>)
00433       <a class="code" href="socket__ew_8h.html#a3">min</a> = <a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j];
00434   }
00435 
00436   <span class="comment">/* If the incoming data were originally short integers, copy the values</span>
00437 <span class="comment">     back to an array of shorts; disk space saving feature requested</span>
00438 <span class="comment">         by Gabriel Reyes cjb 6/11/01 */</span>
00439   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'s'</span>) 
00440   {
00441     <span class="keywordflow">for</span> (j = 0; j &lt; nsamp_this_scn; j++)
00442                 <a class="code" href="sudsputaway_8c.html#a4">SudsBufferShort</a>[j] = (short)<a class="code" href="sudsputaway_8c.html#a3">SudsBuffer</a>[j];
00443   }
00444 
00445   <span class="comment">/* Convert to the appropriate output format */</span>
00446 <span class="preprocessor">#if defined (_INTEL)</span>
00447 <span class="preprocessor"></span>  <span class="comment">/* we are on intel, data will be read on sparc */</span>
00448   <span class="keywordflow">if</span> (strcmp (SudsOutputFormat, <span class="stringliteral">"sparc"</span>) == 0)
00449     <span class="keywordflow">for</span> (j = 0; j &lt; nsamp_this_scn; j++)
00450     {
00451                 <span class="keywordflow">if</span> (datatype == <span class="charliteral">'s'</span>)
00452                         <a class="code" href="swap_8c.html#a0">SwapShort</a>(&amp;SudsBufferShort[j]);
00453                 <span class="keywordflow">else</span>
00454                         <a class="code" href="swap_8c.html#a2">SwapLong</a>(&amp;SudsBuffer[j]);
00455         }
00456 <span class="preprocessor">#elif defined (_SPARC)</span>
00457 <span class="preprocessor"></span>  <span class="comment">/* we are on sparc, data will be read on intel */</span>
00458   <span class="keywordflow">if</span> (strcmp (SudsOutputFormat, <span class="stringliteral">"intel"</span>) == 0)
00459     <span class="keywordflow">for</span> (j = 0; j &lt; nsamp_this_scn; j++)
00460     {
00461                 <span class="keywordflow">if</span> (datatype == <span class="charliteral">'s'</span>)
00462                         <a class="code" href="swap_8c.html#a0">SwapShort</a>(&amp;SudsBufferShort[j]);
00463                 <span class="keywordflow">else</span>
00464                         <a class="code" href="swap_8c.html#a2">SwapLong</a>(&amp;SudsBuffer[j]);
00465         }
00466 <span class="preprocessor">#else</span>
00467 <span class="preprocessor"></span>  <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SUDSPA_next: Can't determine my platform - please compile with either _INTEL or _SPARC set\n"</span>);
00468       <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00469 <span class="preprocessor">#endif</span>
00470 <span class="preprocessor"></span>               
00471   <span class="comment">/* Write out to the SUDS file */</span>
00472   <span class="comment">/* Fill and write TAG for the STATIONCOMP struct */</span>
00473 
00474   tag.<a class="code" href="structSUDS__STRUCTTAG.html#m2">id_struct</a> = <a class="code" href="sudshead_8h.html#a27">STATIONCOMP</a>; <span class="comment">/* what follows is STATIONCOMP */</span>
00475   tag.<a class="code" href="structSUDS__STRUCTTAG.html#m3">len_struct</a> = <span class="keyword">sizeof</span> (SUDS_STATIONCOMP); 
00476   tag.<a class="code" href="structSUDS__STRUCTTAG.html#m4">len_data</a> = 0;
00477   tag.<a class="code" href="structSUDS__STRUCTTAG.html#m0">sync</a> = <span class="charliteral">'S'</span>;
00478 
00479   <span class="keywordflow">if</span> (debug == 1)
00480     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Writing tag for %d (%d)\n"</span>, tag.<a class="code" href="structSUDS__STRUCTTAG.html#m2">id_struct</a>, tag.<a class="code" href="structSUDS__STRUCTTAG.html#m3">len_struct</a>);
00481 
00482   <span class="keywordflow">if</span> (strcmp (SudsOutputFormat, <span class="stringliteral">"sparc"</span>) == 0)
00483     tag.<a class="code" href="structSUDS__STRUCTTAG.html#m1">machine</a> = <span class="charliteral">'1'</span>;
00484   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (SudsOutputFormat, <span class="stringliteral">"intel"</span>) == 0)
00485     tag.<a class="code" href="structSUDS__STRUCTTAG.html#m1">machine</a> = <span class="charliteral">'6'</span>;
00486 
00487   <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a6">StructMakeLocal</a> ((<span class="keywordtype">void</span> *) &amp;tag, STRUCTTAG, tag.machine, debug) 
00488       != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00489   {
00490     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: Call to StructMakeLocal failed. \n"</span>);
00491     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00492   }
00493 
00494   <span class="keywordflow">if</span> (fwrite ((<span class="keywordtype">void</span> *) &amp;tag, <span class="keyword">sizeof</span> (<a class="code" href="structSUDS__STRUCTTAG.html">SUDS_STRUCTTAG</a>), 1, SUDSfp) != 1)
00495   {
00496     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: error writing SUDS tag. \n"</span>);
00497     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00498   }
00499 
00500   <span class="comment">/* Fill and write STATIONCOMP struct */</span>
00501   <span class="comment">/* in SUDS_STATIDENT structure, char st_name[5],</span>
00502 <span class="comment">        char network[4], char component where component = v,n,e</span>
00503 <span class="comment">        cjb 5/18/2001 */</span>
00504   <span class="keywordflow">if</span> (strlen(wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>) &gt; 5) {
00505         strncpy(sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m1">st_name</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, 4);
00506         sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m1">st_name</a>[4] = <span class="charliteral">'\0'</span>;
00507   }
00508   <span class="keywordflow">else</span>
00509         strcpy (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m1">st_name</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>); 
00510 
00511  <span class="keywordflow">if</span> (strlen(wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>) &gt; 4) {
00512         strncpy(sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m0">network</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>, 3);
00513         sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m0">network</a>[3] = <span class="charliteral">'\0'</span>;
00514   }
00515   <span class="keywordflow">else</span>
00516         strcpy (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m0">network</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>); 
00517 
00518   <span class="keywordflow">if</span> (strlen(wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>) &gt;= 3)
00519         sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>[2];
00520   <span class="keywordflow">else</span> 
00521         sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>[0];
00522 
00523   <span class="keywordflow">if</span> ((sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> == <span class="charliteral">'Z'</span>) || (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> == <span class="charliteral">'z'</span>))
00524           sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> = <span class="charliteral">'V'</span>;
00525 
00526   <span class="keywordflow">if</span> ((sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'N'</span>) &amp;&amp; (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'n'</span>)
00527           &amp;&amp; (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'E'</span>) &amp;&amp; (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'e'</span>)
00528           &amp;&amp; (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'V'</span>) &amp;&amp; (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'v'</span>)
00529           &amp;&amp; (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'T'</span>) &amp;&amp; (sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'t'</span>))
00530           <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: unknown station component %c \n"</span>,
00531                 sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a>);
00532 
00533   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'s'</span>)
00534         sc.<a class="code" href="structSUDS__STATIONCOMP.html#m13">data_type</a> = <span class="charliteral">'s'</span>;
00535   <span class="keywordflow">else</span>
00536           sc.<a class="code" href="structSUDS__STATIONCOMP.html#m13">data_type</a> = <span class="charliteral">'l'</span>;
00537   sc.<a class="code" href="structSUDS__STATIONCOMP.html#m14">data_units</a> = <span class="charliteral">'d'</span>;
00538 
00539   <span class="keywordflow">if</span> (debug == 1)
00540     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Writing STATIONCOMP struct for %s.%s.%c\n"</span>, 
00541            sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m1">st_name</a>,
00542            sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m0">network</a>,     
00543            sc.<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a>);
00544 
00545   <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a6">StructMakeLocal</a> ((<span class="keywordtype">void</span> *) &amp;sc, STATIONCOMP, tag.machine, debug) 
00546       != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00547   {
00548     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: Call to StructMakeLocal failed. \n"</span>);
00549     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00550   }
00551 
00552   <span class="keywordflow">if</span> (fwrite ((<span class="keywordtype">void</span> *) &amp;sc, <span class="keyword">sizeof</span> (<a class="code" href="structSUDS__STATIONCOMP.html">SUDS_STATIONCOMP</a>), 1, SUDSfp) != 1)
00553   {
00554     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: error writing SUDS_STATIONCOMP struct. \n"</span>);
00555     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00556   }
00557 
00558   <span class="comment">/* Fill and write TAG for the DESCRIPTRACE struct */</span>
00559   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'s'</span>)
00560         data_size = nsamp_this_scn * <span class="keyword">sizeof</span> (short);
00561   <span class="keywordflow">else</span>
00562         data_size = nsamp_this_scn * <span class="keyword">sizeof</span> (long);
00563   tag.id_struct = <a class="code" href="sudshead_8h.html#a29">DESCRIPTRACE</a>; <span class="comment">/* what follows is DESCRIPTRACE */</span>
00564   tag.len_struct = <span class="keyword">sizeof</span> (SUDS_DESCRIPTRACE); 
00565   tag.len_data = (long) data_size;
00566 
00567   <span class="keywordflow">if</span> (debug == 1)
00568     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Writing tag for %d (%d)\n"</span>, tag.id_struct, tag.len_struct);
00569 
00570   <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a6">StructMakeLocal</a> ((<span class="keywordtype">void</span> *) &amp;tag, STRUCTTAG, tag.machine, debug) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00571   {
00572     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: Call to StructMakeLocal failed. \n"</span>);
00573     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00574   }
00575 
00576   <span class="keywordflow">if</span> (fwrite ((<span class="keywordtype">void</span> *) &amp;tag, <span class="keyword">sizeof</span> (SUDS_STRUCTTAG), 1, SUDSfp) != 1)
00577   {
00578     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: error writing SUDS tag. \n"</span>);
00579     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00580   }
00581 
00582   <span class="comment">/* Fill and write DESCRIPTRACE struct */</span>
00583   <span class="comment">/*strcpy (dt.dt_name.st_name, wf-&gt;sta); </span>
00584 <span class="comment">  strcpy (dt.dt_name.network, wf-&gt;net); </span>
00585 <span class="comment">  dt.dt_name.component = wf-&gt;chan[0];</span>
00586 <span class="comment">  */</span>
00587   <span class="comment">/* in SUDS_STATIDENT structure, char st_name[5],</span>
00588 <span class="comment">        char network[4], char component where component = v,n,e</span>
00589 <span class="comment">        cjb 5/18/2001 */</span>
00590   <span class="keywordflow">if</span> (strlen(wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>) &gt; 5) {
00591         strncpy(dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m1">st_name</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>, 4);
00592         dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m1">st_name</a>[4] = <span class="charliteral">'\0'</span>;
00593   }
00594   <span class="keywordflow">else</span>
00595         strcpy (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m1">st_name</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m5">sta</a>); 
00596 
00597  <span class="keywordflow">if</span> (strlen(wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>) &gt; 4) {
00598         strncpy(dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m0">network</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>, 3);
00599         dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m0">network</a>[3] = <span class="charliteral">'\0'</span>;
00600   }
00601   <span class="keywordflow">else</span>
00602         strcpy (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m0">network</a>, wf-&gt;<a class="code" href="structTRACE__HEADER.html#m6">net</a>); 
00603 
00604   <span class="keywordflow">if</span> (strlen(wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>) &gt;= 3)
00605     dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>[2];
00606   <span class="keywordflow">else</span> 
00607     dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> = wf-&gt;<a class="code" href="structTRACE__HEADER.html#m7">chan</a>[0];
00608 
00609   <span class="keywordflow">if</span> ((dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> == <span class="charliteral">'Z'</span>) || (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> == <span class="charliteral">'z'</span>))
00610           dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> = <span class="charliteral">'V'</span>;
00611 
00612   <span class="keywordflow">if</span> ((dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'N'</span>) &amp;&amp; (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'n'</span>)
00613           &amp;&amp; (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'E'</span>) &amp;&amp; (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'e'</span>)
00614           &amp;&amp; (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'V'</span>) &amp;&amp; (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'v'</span>)
00615           &amp;&amp; (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'T'</span>) &amp;&amp; (dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a> != <span class="charliteral">'t'</span>))
00616           <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: error with station component %c \n"</span>,
00617                 dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m2">component</a>);
00618 
00619 
00620   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'s'</span>)
00621           dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m3">datatype</a> = <span class="charliteral">'s'</span>;
00622   <span class="keywordflow">else</span>
00623           dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m3">datatype</a> = <span class="charliteral">'l'</span>;
00624   dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m1">begintime</a> = begintime;
00625   dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m7">length</a> = nsamp_this_scn;
00626   dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m8">rate</a> = (float) wf-&gt;<a class="code" href="structTRACE__HEADER.html#m4">samprate</a>;
00627   dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m9">mindata</a> = (float) <a class="code" href="socket__ew_8h.html#a3">min</a>;
00628   dt.<a class="code" href="structSUDS__DESCRIPTRACE.html#m10">maxdata</a> = (float) max;
00629 
00630   <span class="comment">/* Ignore the rest for now - see how it works */</span>
00631 
00632   <span class="keywordflow">if</span> (debug == 1)
00633     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Writing DESCRIPTRACE - %d samples (%d,%d) \n"</span>, 
00634            nsamp_this_scn, min, max);
00635 
00636   <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a6">StructMakeLocal</a> ((<span class="keywordtype">void</span> *) &amp;dt, DESCRIPTRACE, tag.machine, debug) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00637   {
00638     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: Call to StructMakeLocal failed. \n"</span>);
00639     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00640   }
00641 
00642   <span class="keywordflow">if</span> (fwrite ((<span class="keywordtype">void</span> *) &amp;dt, <span class="keyword">sizeof</span> (<a class="code" href="structSUDS__DESCRIPTRACE.html">SUDS_DESCRIPTRACE</a>), 1, SUDSfp) != 1)
00643   {
00644     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: error writing DESCRIPTRACE struct. \n"</span>);
00645     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00646   }
00647 
00648   <span class="comment">/* write TRACE data - SudsBuffer holds long data;</span>
00649 <span class="comment">          SudsBufferShort holds short data */</span>
00650   <span class="keywordflow">if</span> (debug == 1)
00651     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Writing %d bytes of DESCRIPTRACE data\n"</span>, data_size);
00652   <span class="keywordflow">if</span> (datatype == <span class="charliteral">'s'</span>)
00653   {
00654         <span class="keywordflow">if</span> ((long)fwrite ((<span class="keywordtype">void</span> *) SudsBufferShort, <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>), data_size, SUDSfp)
00655                 != data_size)
00656         {
00657                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: error writing short TRACE data. \n"</span>);
00658                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00659         }
00660   }
00661   <span class="keywordflow">else</span>
00662   {
00663         <span class="keywordflow">if</span> ((long)fwrite ((<span class="keywordtype">void</span> *) SudsBuffer, <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>), data_size, SUDSfp)
00664                 != data_size)
00665         {
00666                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"et"</span>, <span class="stringliteral">"SUDSPA_next: error writing long TRACE data. \n"</span>);
00667                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00668         }
00669   }
00670   <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00671 }
00672 
00673 
00674 <span class="comment">/************************************************************************</span>
00675 <span class="comment">* This is the Put Away end event routine. It's called after we've       *</span>
00676 <span class="comment">* finished processing one event                                         *</span>
00677 <span class="comment">*                                                                       *</span>
00678 <span class="comment">* For PC-SUDS - close the SUDS file, pointed to by SUDSfp               *</span>
00679 <span class="comment">*               free SudsBuffer memory to be nice to everyone else      *</span>
00680 <span class="comment">*************************************************************************/</span>
<a name="l00681"></a><a class="code" href="sudsputaway_8c.html#a11">00681</a> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a11">SUDSPA_end_ev</a>(<span class="keywordtype">int</span> debug)
00682 {
00683   fclose (SUDSfp);
00684         
00685   <span class="keywordflow">if</span> (debug == 1)
00686     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">"t"</span>, <span class="stringliteral">"Closing SUDS file \n"</span>);
00687 
00688   <span class="keywordflow">return</span>( EW_SUCCESS );
00689 }
00690 
00691 
00692 <span class="comment">/************************************************************************</span>
00693 <span class="comment">*       This is the Put Away close routine. It's called after when      *</span>
00694 <span class="comment">*       we're being shut down.                                          *</span>
00695 <span class="comment">*************************************************************************/</span>
<a name="l00696"></a><a class="code" href="sudsputaway_8c.html#a12">00696</a> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a12">SUDSPA_close</a>(<span class="keywordtype">int</span> debug)
00697 {
00698 
00699   free ((<span class="keywordtype">char</span> *) SudsBufferShort);
00700   free ((<span class="keywordtype">char</span> *) SudsBuffer);
00701   <span class="keywordflow">return</span>( EW_SUCCESS );
00702 }
00703 
00704 
00705 <span class="comment">/*</span>
00706 <span class="comment"> *</span>
00707 <span class="comment"> *  Byte swapping functions</span>
00708 <span class="comment"> */</span>
00709 
00710 <span class="comment">/* swap bytes if necessary, depending on what machine */</span>
00711 <span class="comment">/* we have been compiled, and what machine the data   */</span>
00712 <span class="comment">/* is being read from/being written to                */</span>
00713 
<a name="l00714"></a><a class="code" href="sudsputaway_8c.html#a6">00714</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a6">StructMakeLocal</a>(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">int</span> struct_type, <span class="keywordtype">char</span> data_type, 
00715                            <span class="keywordtype">int</span> debug)
00716 {
00717   <span class="keywordflow">if</span> (ptr == NULL)
00718   {
00719     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"StructMakeLocal: NULL pointer passed in\n"</span>);
00720     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00721   }
00722 
00723 <span class="preprocessor">#if defined (_INTEL)</span>
00724 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (data_type != <span class="charliteral">'6'</span>)
00725   {
00726     <span class="keywordflow">if</span> (debug == 1)
00727       <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Swapping from Intel to Sun \n"</span>);
00728 
00729     <span class="comment">/* if we are on intel, and target data is not intel */</span>
00730     <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a7">SwapDo</a> (ptr, struct_type) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00731     {
00732       <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"StructMakeLocal: Call to SwapDo failed \n"</span>);
00733       <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00734     }
00735   }
00736 
00737 <span class="preprocessor">#elif defined (_SPARC)</span>
00738 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (data_type == <span class="charliteral">'6'</span>)
00739   {
00740     <span class="keywordflow">if</span> (debug == 1)
00741       <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Swapping from Sun to Intel \n"</span>);
00742 
00743     <span class="comment">/* if we are on solaris, and target data is not solaris */</span>
00744     <span class="keywordflow">if</span> (<a class="code" href="sudsputaway_8c.html#a7">SwapDo</a> (ptr, struct_type) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00745     {
00746       <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"StructMakeLocal: Call to SwapDo failed \n"</span>);
00747       <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00748     }
00749   }
00750 
00751 <span class="preprocessor">#endif</span>
00752 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00753 }
00754 
00755 
00756 <span class="comment">/* Do the dirty work by swapping the innards of SUDS */</span>
00757 <span class="comment">/* structures that are of interest to us             */</span>
<a name="l00758"></a><a class="code" href="sudsputaway_8c.html#a7">00758</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sudsputaway_8c.html#a7">SwapDo</a>( <span class="keywordtype">void</span> *ptr, <span class="keywordtype">int</span> struct_type)
00759 {
00760   <a class="code" href="structSUDS__STRUCTTAG.html">SUDS_STRUCTTAG</a> *tag;
00761   <a class="code" href="structSUDS__STATIONCOMP.html">SUDS_STATIONCOMP</a> *sc;
00762   <a class="code" href="structSUDS__DESCRIPTRACE.html">SUDS_DESCRIPTRACE</a> *dt;
00763   <a class="code" href="structSUDS__TRIGGERS.html">SUDS_TRIGGERS</a> *tr;
00764   <a class="code" href="structSUDS__DETECTOR.html">SUDS_DETECTOR</a> *de;
00765   <a class="code" href="structSUDS__TIMECORRECTION.html">SUDS_TIMECORRECTION</a> *tc;
00766 
00767   <span class="keywordflow">if</span> (ptr == NULL)
00768   {
00769     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SwapDo: NULL pointer passed in.\n"</span>);
00770     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00771   }
00772 
00773   <span class="keywordflow">switch</span>( struct_type ) 
00774   {
00775   <span class="keywordflow">case</span> <a class="code" href="sudshead_8h.html#a24">STRUCTTAG</a>:
00776     tag = (<a class="code" href="structSUDS__STRUCTTAG.html">SUDS_STRUCTTAG</a> *) ptr;
00777     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tag-&gt;<a class="code" href="structSUDS__STRUCTTAG.html#m2">id_struct</a>);
00778     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;tag-&gt;<a class="code" href="structSUDS__STRUCTTAG.html#m3">len_struct</a>);
00779     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;tag-&gt;<a class="code" href="structSUDS__STRUCTTAG.html#m4">len_data</a>);
00780     <span class="keywordflow">break</span>;
00781   <span class="keywordflow">case</span> <a class="code" href="sudshead_8h.html#a27">STATIONCOMP</a>:
00782     sc = (<a class="code" href="structSUDS__STATIONCOMP.html">SUDS_STATIONCOMP</a> *) ptr;
00783     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m0">sc_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m3">inst_type</a>);
00784     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m1">azim</a>);
00785     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m2">incid</a>);
00786     <a class="code" href="swap_8c.html#a3">SwapDouble</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m3">st_lat</a>);
00787     <a class="code" href="swap_8c.html#a3">SwapDouble</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m4">st_long</a>);
00788     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m5">elev</a>);
00789     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m10">rocktype</a>);
00790     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m17">max_gain</a>);
00791     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m18">clip_value</a>);
00792     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m19">con_mvolts</a>);
00793     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m20">channel</a>);
00794     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m21">atod_gain</a>);
00795     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m22">effective</a>);
00796     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m23">clock_correct</a>);
00797     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;sc-&gt;<a class="code" href="structSUDS__STATIONCOMP.html#m24">station_delay</a>);
00798     <span class="keywordflow">break</span>;
00799   <span class="keywordflow">case</span> <a class="code" href="sudshead_8h.html#a29">DESCRIPTRACE</a>:
00800     dt = (<a class="code" href="structSUDS__DESCRIPTRACE.html">SUDS_DESCRIPTRACE</a> *) ptr;
00801     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m0">dt_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m3">inst_type</a>);
00802     <a class="code" href="swap_8c.html#a3">SwapDouble</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m1">begintime</a>);
00803     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m2">localtime</a>);
00804     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m5">digi_by</a>);
00805     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m6">processed</a>);
00806     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m7">length</a>);
00807     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m8">rate</a>);
00808     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m9">mindata</a>);
00809     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m10">maxdata</a>);
00810     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m11">avenoise</a>);
00811     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m12">numclip</a>);
00812     <a class="code" href="swap_8c.html#a3">SwapDouble</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m13">time_correct</a>);
00813     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;dt-&gt;<a class="code" href="structSUDS__DESCRIPTRACE.html#m14">rate_correct</a>);
00814     <span class="keywordflow">break</span>;
00815   <span class="keywordflow">case</span> <a class="code" href="sudshead_8h.html#a47">TRIGGERS</a>:
00816     tr = (<a class="code" href="structSUDS__TRIGGERS.html">SUDS_TRIGGERS</a> *) ptr;
00817     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m0">tr_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m3">inst_type</a>);
00818     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m1">sta</a>);
00819     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m2">lta</a>);
00820     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m3">abs_sta</a>);
00821     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m4">abs_lta</a>);
00822     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m5">trig_value</a>);
00823     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m6">num_triggers</a>);
00824     <a class="code" href="swap_8c.html#a3">SwapDouble</a> (&amp;tr-&gt;<a class="code" href="structSUDS__TRIGGERS.html#m7">trig_time</a>);
00825     <span class="keywordflow">break</span>;
00826   <span class="keywordflow">case</span> <a class="code" href="sudshead_8h.html#a50">DETECTOR</a>:
00827     de = (<a class="code" href="structSUDS__DETECTOR.html">SUDS_DETECTOR</a> *) ptr;
00828     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;de-&gt;<a class="code" href="structSUDS__DETECTOR.html#m3">versionnum</a>);
00829     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;de-&gt;<a class="code" href="structSUDS__DETECTOR.html#m4">event_number</a>);
00830     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;de-&gt;<a class="code" href="structSUDS__DETECTOR.html#m5">spareL</a>);
00831     <span class="keywordflow">break</span>;
00832   <span class="keywordflow">case</span> <a class="code" href="sudshead_8h.html#a52">TIMECORRECTION</a>:
00833     tc = (<a class="code" href="structSUDS__TIMECORRECTION.html">SUDS_TIMECORRECTION</a> *) ptr;
00834     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tc-&gt;<a class="code" href="structSUDS__TIMECORRECTION.html#m0">tm_name</a>.<a class="code" href="structSUDS__STATIDENT.html#m3">inst_type</a>);
00835     <a class="code" href="swap_8c.html#a3">SwapDouble</a> (&amp;tc-&gt;<a class="code" href="structSUDS__TIMECORRECTION.html#m1">time_correct</a>);
00836     <a class="code" href="swap_8c.html#a5">SwapFloat</a> (&amp;tc-&gt;<a class="code" href="structSUDS__TIMECORRECTION.html#m2">rate_correct</a>);
00837     <a class="code" href="swap_8c.html#a2">SwapLong</a> (&amp;tc-&gt;<a class="code" href="structSUDS__TIMECORRECTION.html#m5">effective_time</a>);
00838     <a class="code" href="swap_8c.html#a0">SwapShort</a> (&amp;tc-&gt;<a class="code" href="structSUDS__TIMECORRECTION.html#m6">spareM</a>);
00839     <span class="keywordflow">break</span>;
00840   <span class="keywordflow">default</span>:
00841     <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"e"</span>, <span class="stringliteral">"SwapDo: Don't know about type %d\n"</span>, struct_type);
00842     <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00843   }
00844 
00845   <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00846 }
00847 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:11 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
