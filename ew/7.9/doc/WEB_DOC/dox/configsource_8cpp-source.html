<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>configsource.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>configsource.cpp</h1><a href="configsource_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// configsource.cpp: implementation of the ConfigSource class.</span>
00002 <span class="comment">//</span>
00004 <span class="comment"></span>
00005 <span class="preprocessor">#include "<a class="code" href="configsource_8h.html">configsource.h</a>"</span>
00006 
<a name="l00007"></a><a class="code" href="classConfigSource.html#p0">00007</a> <span class="keywordtype">int</span> <a class="code" href="classConfigSource.html#p0">ConfigSource::INVALID_INT</a>    = INT_MIN;
<a name="l00008"></a><a class="code" href="classConfigSource.html#p1">00008</a> <span class="keywordtype">long</span> <a class="code" href="classConfigSource.html#p1">ConfigSource::INVALID_LONG</a>  = LONG_MIN;
<a name="l00009"></a><a class="code" href="classConfigSource.html#p2">00009</a> <span class="keywordtype">double</span> <a class="code" href="classConfigSource.html#p2">ConfigSource::INVALID_DOUBLE</a> = DBL_MIN;
00010 
00012 <span class="comment">// Construction/Destruction</span>
00014 <span class="comment"></span>
<a name="l00015"></a><a class="code" href="classConfigSource.html#a0">00015</a> <a class="code" href="classConfigSource.html#a0">ConfigSource::ConfigSource</a>()
00016 {
00017    <a class="code" href="classConfigSource.html#n0">ReadMode</a> = <a class="code" href="configsource_8h.html#a3">CS_MODE_COMMAND</a>;
00018    strcpy( Token, <span class="stringliteral">""</span> );
00019    strcpy( CurrentLine, <span class="stringliteral">""</span> );
00020    <a class="code" href="classConfigSource.html#n6">TokenIsNull</a>    = <span class="keyword">true</span>;
00021    <a class="code" href="classConfigSource.html#n3">LineParseIndex</a> = 0;
00022    <a class="code" href="classConfigSource.html#n2">LastError</a>      = 0;
00023    strcpy( LastMessage, <span class="stringliteral">""</span> );
00024 }
00025 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00026"></a><a class="code" href="classConfigSource.html#a1">00026</a> <a class="code" href="classConfigSource.html#a1">ConfigSource::~ConfigSource</a>()
00027 {
00028    <a class="code" href="classConfigSource.html#a2">Close</a>();
00029 }
00030 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00031"></a><a class="code" href="classConfigSource.html#a5">00031</a> <span class="keywordtype">char</span>* <a class="code" href="classConfigSource.html#a5">ConfigSource::NextToken</a>()
00032 {
00033    <span class="comment">// Initialize token as empty string</span>
00034    <a class="code" href="classConfigSource.html#n5">Token</a>[0] = <span class="charliteral">'\0'</span>;
00035    <a class="code" href="classConfigSource.html#n6">TokenIsNull</a> = <span class="keyword">true</span>;
00036 
00037         <a class="code" href="classConfigSource.html#n2">LastError</a> = 0;
00038    strcpy( LastMessage, <span class="stringliteral">""</span> );
00039 
00040    <span class="keywordtype">bool</span> _started  = <span class="keyword">false</span>  <span class="comment">// token start found, parsing token</span>
00041       , _isquoted = <span class="keyword">false</span>  <span class="comment">// parsing a quoted token</span>
00042       , _tokenend = <span class="keyword">false</span>  <span class="comment">// end of token found, leave parsing loop</span>
00043       ;
00044 
00045    <a class="code" href="classConfigSource.html#n3">LineParseIndex</a>++; <span class="comment">// Advance off last location (whitespace) in CurrentLine</span>
00046 
00047 
00048    <span class="keywordtype">int</span> _tokenChIndex = 0 ;
00049 
00050    <span class="comment">// Scan for beginning of token.</span>
00051    <span class="comment">// Note that first char in the buffer (CurrentLine) will</span>
00052    <span class="comment">// have been set to a space (token separator) which</span>
00053    <span class="comment">// is why we start with an increment of TokenParseIndex</span>
00054    <span class="comment">//</span>
00055    <span class="keywordtype">int</span> _linelen = strlen( CurrentLine );
00056 
00057         <span class="keywordflow">for</span>( ; (! _tokenend) &amp;&amp; <a class="code" href="classConfigSource.html#n3">LineParseIndex</a> &lt; _linelen ; <a class="code" href="classConfigSource.html#n3">LineParseIndex</a>++ )
00058         {
00059                 <span class="keywordflow">switch</span>( <a class="code" href="classConfigSource.html#n4">CurrentLine</a>[<a class="code" href="classConfigSource.html#n3">LineParseIndex</a>] )
00060       {
00061         <span class="keywordflow">case</span> <span class="charliteral">' '</span>:
00062         <span class="keywordflow">case</span> <span class="charliteral">'\t'</span>:
00063         <span class="keywordflow">case</span> <span class="charliteral">','</span>:
00064              <span class="keywordflow">if</span> ( _started )
00065              {
00066                 <span class="keywordflow">if</span> ( _isquoted )
00067                 {
00068                    <span class="comment">// space, tab or comma within quoted token, include the char</span>
00069                    <a class="code" href="classConfigSource.html#n5">Token</a>[_tokenChIndex++] = <a class="code" href="classConfigSource.html#n4">CurrentLine</a>[<a class="code" href="classConfigSource.html#n3">LineParseIndex</a>];
00070                    <a class="code" href="classConfigSource.html#n6">TokenIsNull</a> = <span class="keyword">false</span>;
00071                 }
00072                 <span class="keywordflow">else</span>
00073                 {
00074                    <span class="comment">// space, tab or comma while parsing non-quoted token -- end of token</span>
00075                    _tokenend = <span class="keyword">true</span>;
00076                    <span class="comment">// Step back line parse index to negate increment at loop termination</span>
00077                    <a class="code" href="classConfigSource.html#n3">LineParseIndex</a>--;
00078                 }
00079              }
00080              <span class="comment">// else  token not started, this is whitespace</span>
00081              <span class="keywordflow">break</span>;
00082 
00083         <span class="keywordflow">case</span> <span class="charliteral">'#'</span>:
00084              <span class="comment">// comment started, assure no further parsing of this line</span>
00085              <a class="code" href="classConfigSource.html#n3">LineParseIndex</a> = _linelen;
00086 
00087         <span class="keywordflow">case</span> <span class="charliteral">'\n'</span>:
00088              <span class="keywordflow">if</span> ( ! _started )
00089              {
00090                 <span class="comment">// end of line before token start found</span>
00091                 <a class="code" href="classConfigSource.html#n5">Token</a>[0] = 0;  <span class="comment">// token is empty string</span>
00092                 <a class="code" href="classConfigSource.html#n6">TokenIsNull</a> = <span class="keyword">true</span>;
00093              }
00094              <span class="comment">// else  end of line after token started</span>
00095              <span class="comment">//       this is end of token (even if started with quote)</span>
00096 
00097              _tokenend = <span class="keyword">true</span>;
00098 
00099              <span class="keywordflow">break</span>;
00100 
00101         <span class="keywordflow">case</span> <span class="charliteral">'"'</span>:
00102              <span class="keywordflow">if</span> ( _isquoted )
00103              {
00104                 <span class="comment">// Already parsing a quoted token, this is the end thereof</span>
00105                 _tokenend = <span class="keyword">true</span>;
00106              }
00107              <span class="keywordflow">else</span>
00108              {
00109                 <span class="comment">// not yet parsing quoted token</span>
00110 
00111                 <span class="keywordflow">if</span> ( _tokenChIndex == 0 )
00112                 {
00113                    <span class="comment">// First char in the token parsing,</span>
00114                    <span class="comment">// start a new token</span>
00115                    _isquoted = <span class="keyword">true</span>;
00116                    _started  = <span class="keyword">true</span>;
00117 <span class="comment">//                   TokenIsNull = false;</span>
00118                 }
00119                 <span class="comment">// else  Not the first char in the token.</span>
00120                 <span class="comment">//       In theory embed quote within token,</span>
00121                 <span class="comment">//       but better to just skip it</span>
00122              }
00123              <span class="keywordflow">break</span>;
00124 
00125         <span class="keywordflow">default</span>:
00126              <span class="comment">// regular character, add to token (fld)</span>
00127              <a class="code" href="classConfigSource.html#n5">Token</a>[_tokenChIndex++] = <a class="code" href="classConfigSource.html#n4">CurrentLine</a>[<a class="code" href="classConfigSource.html#n3">LineParseIndex</a>];
00128              _started  = <span class="keyword">true</span>;
00129              <a class="code" href="classConfigSource.html#n6">TokenIsNull</a> = <span class="keyword">false</span>;
00130                      <span class="keywordflow">break</span>;
00131       }
00132    }
00133 
00134 
00135    <a class="code" href="classConfigSource.html#n5">Token</a>[_tokenChIndex] = 0;  <span class="comment">// null-terminate string</span>
00136 
00137    <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#n5">Token</a>;
00138 
00139 }
00140 <span class="comment">//---------------------------------------------------------------------------</span>
00141 <span class="comment">// Get fixed position token, strips leading and trailing blanks</span>
<a name="l00142"></a><a class="code" href="classConfigSource.html#a7">00142</a> <span class="keywordtype">char</span>* <a class="code" href="classConfigSource.html#a7">ConfigSource::GetToken</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> off) {
00143         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j;
00144         <span class="keywordtype">char</span> ch;
00145         <span class="keywordtype">char</span> fld[1024];
00146         <span class="keywordtype">int</span> j1 = off;
00147         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j2 = off + n;
00148         <span class="keywordflow">if</span>( j2 &gt; strlen( CurrentLine ) )
00149    {
00150                 j2 = strlen( CurrentLine );
00151         }
00152    <span class="keywordflow">for</span>( j = j1 ; j &lt; j2 ; j++ ) {
00153                 ch = <a class="code" href="classConfigSource.html#n4">CurrentLine</a>[j];
00154                 <span class="keywordflow">if</span>(ch == <span class="charliteral">' '</span>)
00155                         <span class="keywordflow">continue</span>;
00156                 <span class="keywordflow">break</span>;
00157         }
00158         <span class="keywordtype">int</span> nfld = 0;
00159         <span class="keywordtype">int</span> jj = 0;
00160         <span class="keywordflow">for</span>( ; j &lt; j2 ; j++ ) {
00161                 ch = <a class="code" href="classConfigSource.html#n4">CurrentLine</a>[j];
00162                 fld[jj++] = ch;
00163                 <span class="keywordflow">if</span>(ch == <span class="charliteral">' '</span>)
00164                         <span class="keywordflow">break</span>;
00165                 nfld = jj;
00166         }
00167         fld[nfld] = 0;
00168         strcpy( Token, fld );
00169         <a class="code" href="classConfigSource.html#n3">LineParseIndex</a> = j2 - 1;
00170         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#n5">Token</a>;
00171 }
00172 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00173"></a><a class="code" href="classConfigSource.html#a8">00173</a> <span class="keywordtype">char</span>* <a class="code" href="classConfigSource.html#a7">ConfigSource::GetToken</a>(<span class="keywordtype">int</span> n) {
00174         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#a7">GetToken</a>( n, LineParseIndex + 1 );
00175 }
00176 <span class="comment">//---------------------------------------------------------------------------</span>
00177 <span class="comment">// Load : Load string into command buffer, initialize for parse.</span>
<a name="l00178"></a><a class="code" href="classConfigSource.html#a9">00178</a> <span class="keywordtype">int</span> <a class="code" href="classConfigSource.html#a9">ConfigSource::Load</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> * p_cmd)
00179 {
00180    <span class="keywordflow">if</span> ( p_cmd == NULL || <a class="code" href="configsource_8h.html#a1">MAX_LINE_LENGTH</a> &lt; strlen(p_cmd) )
00181    {
00182       <span class="keywordflow">return</span> 0;
00183    }
00184         <a class="code" href="classConfigSource.html#n2">LastError</a> = 0;
00185    strcpy( LastMessage, <span class="stringliteral">""</span> );
00186         strcpy( CurrentLine, p_cmd );
00187         <a class="code" href="classConfigSource.html#n3">LineParseIndex</a> = -1;
00188         <a class="code" href="classConfigSource.html#n0">ReadMode</a> = <a class="code" href="configsource_8h.html#a3">CS_MODE_COMMAND</a>;
00189         <span class="keywordflow">return</span> strlen( CurrentLine );
00190 }
00191 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00192"></a><a class="code" href="classConfigSource.html#a10">00192</a> <span class="keywordtype">int</span> <a class="code" href="classConfigSource.html#a10">ConfigSource::Error</a>( <span class="keywordtype">char</span>** r_textual )
00193 {
00194         <span class="keywordtype">int</span> k = <a class="code" href="classConfigSource.html#n2">LastError</a>;
00195    <span class="keywordflow">if</span> ( *r_textual != NULL )
00196    {
00197       *r_textual = <a class="code" href="classConfigSource.html#n7">LastMessage</a>;
00198    }
00199         LastError = 0;
00200         <span class="keywordflow">return</span> k;
00201 }
00202 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00203"></a><a class="code" href="classConfigSource.html#a12">00203</a> <span class="keywordtype">char</span>* <a class="code" href="classConfigSource.html#a12">ConfigSource::String</a>()
00204 {
00205         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#a5">ConfigSource::NextToken</a>();
00206 }
00207 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00208"></a><a class="code" href="classConfigSource.html#a13">00208</a> <span class="keywordtype">int</span> <a class="code" href="classConfigSource.html#a13">ConfigSource::Int</a>()
00209 {
00210    <a class="code" href="classConfigSource.html#a5">NextToken</a>();
00211    <span class="keywordflow">if</span>( 0 &lt; strlen( Token ) )
00212    {
00213           <span class="keywordflow">return</span> atoi(Token);
00214    }
00215    <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#p0">INVALID_INT</a>;
00216 }
00217 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00218"></a><a class="code" href="classConfigSource.html#a14">00218</a> <span class="keywordtype">int</span> <a class="code" href="classConfigSource.html#a13">ConfigSource::Int</a>(<span class="keywordtype">int</span> n) {
00219    <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#a13">Int</a>( n, LineParseIndex + 1 );
00220 }
00221 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00222"></a><a class="code" href="classConfigSource.html#a15">00222</a> <span class="keywordtype">int</span> <a class="code" href="classConfigSource.html#a13">ConfigSource::Int</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> off) {
00223    <a class="code" href="classConfigSource.html#a7">GetToken</a>(n, off);
00224    <span class="keywordflow">if</span>( 0 &lt; strlen( Token ) )
00225    {
00226       <span class="keywordflow">return</span> atoi(Token);
00227    }
00228    <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#p0">INVALID_INT</a>;
00229 }
00230 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00231"></a><a class="code" href="classConfigSource.html#a16">00231</a> <span class="keywordtype">long</span> <a class="code" href="classConfigSource.html#a16">ConfigSource::Long</a>()
00232 {
00233         <a class="code" href="classConfigSource.html#a5">NextToken</a>();
00234         <span class="keywordflow">if</span>( 0 &lt; strlen( Token ) )
00235    {
00236                 <span class="keywordflow">return</span> atol(Token);
00237    }
00238         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#p1">INVALID_LONG</a>;
00239 }
00240 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00241"></a><a class="code" href="classConfigSource.html#a17">00241</a> <span class="keywordtype">long</span> <a class="code" href="classConfigSource.html#a16">ConfigSource::Long</a>(<span class="keywordtype">int</span> n) {
00242         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#a16">Long</a>( n, LineParseIndex + 1 );
00243 }
00244 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00245"></a><a class="code" href="classConfigSource.html#a18">00245</a> <span class="keywordtype">long</span> <a class="code" href="classConfigSource.html#a16">ConfigSource::Long</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> off) {
00246         <a class="code" href="classConfigSource.html#a7">GetToken</a>(n, off);
00247         <span class="keywordflow">if</span>( 0 &lt; strlen( Token ) )
00248    {
00249       <span class="keywordflow">return</span> atol(Token);
00250    }
00251         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#p0">INVALID_INT</a>;
00252 }
00253 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00254"></a><a class="code" href="classConfigSource.html#a19">00254</a> <span class="keywordtype">double</span> <a class="code" href="classConfigSource.html#a19">ConfigSource::Double</a>()
00255 {
00256         <a class="code" href="classConfigSource.html#a5">NextToken</a>();
00257         <span class="keywordflow">if</span>( 0 &lt; strlen( Token ) )
00258    {
00259                 <span class="keywordflow">return</span> atof(Token);
00260         }
00261    <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#p2">INVALID_DOUBLE</a>;
00262 }
00263 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00264"></a><a class="code" href="classConfigSource.html#a20">00264</a> <span class="keywordtype">double</span> <a class="code" href="classConfigSource.html#a19">ConfigSource::Double</a>(<span class="keywordtype">int</span> n) {
00265         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#a19">Double</a>( n, LineParseIndex + 1 );
00266 }
00267 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00268"></a><a class="code" href="classConfigSource.html#a21">00268</a> <span class="keywordtype">double</span> <a class="code" href="classConfigSource.html#a19">ConfigSource::Double</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> off) {
00269         <a class="code" href="classConfigSource.html#a7">GetToken</a>(n, off);
00270         <span class="keywordflow">if</span>( 0 &lt; strlen( Token ) )
00271    {
00272            <span class="keywordflow">return</span> atof(Token);
00273    }
00274         <span class="keywordflow">return</span> <a class="code" href="classConfigSource.html#p2">INVALID_DOUBLE</a>;
00275 }
00276 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00277"></a><a class="code" href="classConfigSource.html#a22">00277</a> <span class="keywordtype">bool</span> <a class="code" href="classConfigSource.html#a22">ConfigSource::Its</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* p_str)
00278 {
00279         <span class="keywordflow">return</span> ( strcmp( Token, p_str ) == 0 );
00280 }
00281 <span class="comment">//---------------------------------------------------------------------------</span>
00282 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:00 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
