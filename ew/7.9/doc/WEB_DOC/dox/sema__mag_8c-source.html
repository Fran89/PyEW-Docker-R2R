<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sema_mag.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>sema_mag.c</h1><a href="sema__mag_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: sema__mag_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.1  2000/02/14 18:53:30  lucky</span>
00011 <span class="comment"> *     Initial revision</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> */</span>
00015 
00016            <span class="comment">/**************************************************************</span>
00017 <span class="comment">            *                sema_ew.c  Windows NT version               *</span>
00018 <span class="comment">            *                                                            *</span>
00019 <span class="comment">            *  This file contains system-dependent functions for         *</span>
00020 <span class="comment">            *  handling semaphores and mutexes.                          *</span>
00021 <span class="comment">            **************************************************************/</span>
00022 
00023 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00024 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00025 <span class="preprocessor">#include &lt;mw_functions.h&gt;</span>
00026 
<a name="l00027"></a><a class="code" href="sema__mag_8c.html#a0">00027</a> HANDLE <a class="code" href="sema__ew_8c.html#a0">mutSem</a>;            <span class="comment">/* Mutex semaphore handle */</span>
<a name="l00028"></a><a class="code" href="sema__mag_8c.html#a1">00028</a> HANDLE <a class="code" href="sema__ew_8c.html#a1">semahandle</a>;        <span class="comment">/* Handle of event semaphore */</span>
00029 
00030 
00031 <span class="comment">/************************* CreateMutex_ew **************************</span>
00032 <span class="comment"> *  Set up mutex semaphore to arbitrate the use of some variable   *</span>
00033 <span class="comment"> *  by different threads.  Since the mutex is unnamed, it can be   *</span>
00034 <span class="comment"> *  used by only one process.                                      *</span>
00035 <span class="comment"> *******************************************************************/</span>
00036 
<a name="l00037"></a><a class="code" href="sema__mag_8c.html#a2">00037</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a2">CreateMutex_ew</a>( <span class="keywordtype">void</span> )
00038 {
00039    <a class="code" href="sema__ew_8c.html#a0">mutSem</a> = CreateMutex( 0, FALSE, 0 );
00040    <span class="keywordflow">if</span> ( <a class="code" href="sema__ew_8c.html#a0">mutSem</a> == 0 )
00041       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"et"</span>, <span class="stringliteral">"Error creating the mutex semaphore.\n"</span> );
00042    <span class="keywordflow">return</span>;
00043 }
00044 
00045 
00046 <span class="comment">/************************** RequestMutex ***************************</span>
00047 <span class="comment"> *  Wait until the mutex is available.  Then, grab it.             *</span>
00048 <span class="comment"> *******************************************************************/</span>
00049 
<a name="l00050"></a><a class="code" href="sema__mag_8c.html#a3">00050</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a3">RequestMutex</a>( <span class="keywordtype">void</span> )
00051 {
00052    WaitForSingleObject( mutSem, INFINITE );      <span class="comment">/* Wait forever */</span>
00053    <span class="keywordflow">return</span>;
00054 }
00055 
00056 
00057 <span class="comment">/************************ ReleaseMutex_ew **************************</span>
00058 <span class="comment"> *                  Release the muxtex semaphore                   *</span>
00059 <span class="comment"> *******************************************************************/</span>
00060 
<a name="l00061"></a><a class="code" href="sema__mag_8c.html#a4">00061</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a4">ReleaseMutex_ew</a>( <span class="keywordtype">void</span> )
00062 {
00063    <span class="keywordflow">if</span> ( ReleaseMutex( mutSem ) == 0 )
00064       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"et"</span>, <span class="stringliteral">"Error releasing the mutex semaphore.\n"</span> );
00065    <span class="keywordflow">return</span>;
00066 }
00067 
00068 
00069 <span class="comment">/*************************** CloseMutex ****************************</span>
00070 <span class="comment"> *              We are done with the mutex semaphore.              *</span>
00071 <span class="comment"> *******************************************************************/</span>
00072 
<a name="l00073"></a><a class="code" href="sema__mag_8c.html#a5">00073</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a5">CloseMutex</a>( <span class="keywordtype">void</span> )
00074 {
00075    CloseHandle( mutSem );
00076    <span class="keywordflow">return</span>;
00077 }
00078 
00079 
00080 <span class="comment">/********************** CreateSpecificMutex ************************</span>
00081 <span class="comment"> *  Set up mutex semaphore to arbitrate the use of resources.      *</span>
00082 <span class="comment"> *******************************************************************/</span>
00083 
<a name="l00084"></a><a class="code" href="sema__mag_8c.html#a6">00084</a> <span class="keywordtype">void</span> <a class="code" href="earthworm__complex__funcs_8h.html#a8">CreateSpecificMutex</a>( HANDLE* mp )
00085 {
00086    *mp = CreateMutex( 0, FALSE, 0 );
00087    <span class="keywordflow">if</span> ( *mp == 0 )
00088       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"et"</span>, <span class="stringliteral">"Error creating specific mutex semaphore.\n"</span> );
00089    <span class="keywordflow">return</span>;
00090 }
00091 
00092 
00093 <span class="comment">/********************** RequestSpecificMutex ***********************</span>
00094 <span class="comment"> *                   Request the mutex semaphore                   *</span>
00095 <span class="comment"> *******************************************************************/</span>
00096 
<a name="l00097"></a><a class="code" href="sema__mag_8c.html#a7">00097</a> <span class="keywordtype">void</span> <a class="code" href="earthworm__complex__funcs_8h.html#a10">RequestSpecificMutex</a>( HANDLE* mp )
00098 {
00099    WaitForSingleObject( *mp, INFINITE );
00100    <span class="keywordflow">return</span>;
00101 }
00102 
00103 
00104 <span class="comment">/********************** ReleaseSpecificMutex ***********************</span>
00105 <span class="comment"> *                   Release the mutex semaphore                   *</span>
00106 <span class="comment"> *******************************************************************/</span>
00107 
<a name="l00108"></a><a class="code" href="sema__mag_8c.html#a8">00108</a> <span class="keywordtype">void</span> <a class="code" href="earthworm__complex__funcs_8h.html#a11">ReleaseSpecificMutex</a>( HANDLE* mp )
00109 {
00110    <span class="keywordflow">if</span> ( ReleaseMutex( *mp ) == 0 )
00111       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"et"</span>, <span class="stringliteral">"Error releasing specific mutex semaphore.\n"</span> );
00112    <span class="keywordflow">return</span>;
00113 }
00114 
00115 
00116 <span class="comment">/*********************** CloseSpecificMutex ************************</span>
00117 <span class="comment"> *              We are done with the mutex semaphore.              *</span>
00118 <span class="comment"> *******************************************************************/</span>
00119 
<a name="l00120"></a><a class="code" href="sema__mag_8c.html#a9">00120</a> <span class="keywordtype">void</span> <a class="code" href="earthworm__complex__funcs_8h.html#a9">CloseSpecificMutex</a>( HANDLE* mp )
00121 {
00122    CloseHandle( *mp );
00123    <span class="keywordflow">return</span>;
00124 }
00125 
00126 
00127 <span class="comment">/************************* CreateSemaphore_ew **********************</span>
00128 <span class="comment"> *                         Create a semaphore                      *</span>
00129 <span class="comment"> *  The semaphore is not posted when it is created.                *</span>
00130 <span class="comment"> *******************************************************************/</span>
00131 
<a name="l00132"></a><a class="code" href="sema__mag_8c.html#a10">00132</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a10">CreateSemaphore_ew</a>( <span class="keywordtype">void</span> )
00133 {
00134    <span class="keyword">const</span> LONG InitialCount = 0;                <span class="comment">/* Initially unset */</span>
00135    <span class="keyword">const</span> LONG MaxCount     = 1000000000;       <span class="comment">/* One billion */</span>
00136 
00137    <a class="code" href="sema__ew_8c.html#a1">semahandle</a> = CreateSemaphore( NULL, InitialCount, MaxCount, NULL );
00138    <span class="keywordflow">if</span> ( <a class="code" href="sema__ew_8c.html#a1">semahandle</a> == NULL )
00139    {
00140       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"et"</span>, <span class="stringliteral">"CreateSemaphore() error: %d  Exiting.\n"</span>,
00141              GetLastError() );
00142       exit( -1 );
00143    }
00144    <span class="keywordflow">return</span>;
00145 }
00146 
00147 
00148 <span class="comment">/*************************** PostSemaphore *************************</span>
00149 <span class="comment"> *                        Post the semaphore.                      *</span>
00150 <span class="comment"> *  The semaphore counter is incremented.                          *</span>
00151 <span class="comment"> *******************************************************************/</span>
00152 
<a name="l00153"></a><a class="code" href="sema__mag_8c.html#a11">00153</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a11">PostSemaphore</a>( <span class="keywordtype">void</span> )
00154 {
00155    <span class="keywordflow">if</span> ( ReleaseSemaphore( semahandle, 1, NULL ) == <a class="code" href="earthworm__defs_8h.html#a9">FALSE</a> )
00156       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"et"</span>, <span class="stringliteral">"ReleaseSemaphore() error: %d\n"</span>, GetLastError() );
00157    <span class="keywordflow">return</span>;
00158 }
00159 
00160 
00161 <span class="comment">/************************** WaitSemPost *************************</span>
00162 <span class="comment"> *            Wait for the semaphore to be signaled.            *</span>
00163 <span class="comment"> ****************************************************************/</span>
00164 
<a name="l00165"></a><a class="code" href="sema__mag_8c.html#a12">00165</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a12">WaitSemPost</a>( <span class="keywordtype">void</span> )
00166 {
00167    <span class="keywordflow">if</span> ( WaitForSingleObject( semahandle, INFINITE ) == WAIT_FAILED )
00168       <a class="code" href="logit_8c.html#a18">logit</a>( <span class="stringliteral">"et"</span>, <span class="stringliteral">"WaitForSingleObject() error: %d\n"</span>, GetLastError() );
00169    <span class="keywordflow">return</span>;
00170 }
00171 
00172 
00173 <span class="comment">/************************* DestroySemaphore *********************</span>
00174 <span class="comment"> *                        Kill the semaphore.                   *</span>
00175 <span class="comment"> ****************************************************************/</span>
00176 
<a name="l00177"></a><a class="code" href="sema__mag_8c.html#a13">00177</a> <span class="keywordtype">void</span> <a class="code" href="sema__ew_8c.html#a13">DestroySemaphore</a>( <span class="keywordtype">void</span> )
00178 {
00179    CloseHandle( semahandle );
00180    <span class="keywordflow">return</span>;
00181 }
00182 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:09 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
