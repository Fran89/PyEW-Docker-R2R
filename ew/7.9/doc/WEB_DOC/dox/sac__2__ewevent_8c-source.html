<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sac_2_ewevent.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>sac_2_ewevent.c</h1><a href="sac__2__ewevent_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00003 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> *    $Id: sac__2__ewevent_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> *    Revision history:</span>
00008 <span class="comment"> *     $Log$
00008 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00008 <span class="comment"> *     first inclusion
00008 <span class="comment"> *</span>
00009 <span class="comment"> *     Revision 1.6  2002/03/22 20:02:38  lucky</span>
00010 <span class="comment"> *     Pre v6.1 checkin</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *     Revision 1.5  2001/07/27 20:41:58  lucky</span>
00013 <span class="comment"> *     *** empty log message ***</span>
00014 <span class="comment"> *</span>
00015 <span class="comment"> *     Revision 1.4  2001/07/01 21:55:23  davidk</span>
00016 <span class="comment"> *     Cleanup of the Earthworm Database API and the applications that utilize it.</span>
00017 <span class="comment"> *     The "ewdb_api" was cleanup in preparation for Earthworm v6.0, which is</span>
00018 <span class="comment"> *     supposed to contain an API that will be backwards compatible in the</span>
00019 <span class="comment"> *     future.  Functions were removed, parameters were changed, syntax was</span>
00020 <span class="comment"> *     rewritten, and other stuff was done to try to get the code to follow a</span>
00021 <span class="comment"> *     general format, so that it would be easier to read.</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> *     Applications were modified to handle changed API calls and structures.</span>
00024 <span class="comment"> *     They were also modified to be compiler warning free on WinNT.</span>
00025 <span class="comment"> *</span>
00026 <span class="comment"> *     Revision 1.3  2001/06/21 21:25:00  lucky</span>
00027 <span class="comment"> *     State of the code after LocalMag review was implemented and partially tested.</span>
00028 <span class="comment"> *</span>
00029 <span class="comment"> *     Revision 1.2  2001/06/06 20:54:46  lucky</span>
00030 <span class="comment"> *     Changes made to support multitude magnitudes, as well as amplitude picks. This is w</span>
00031 <span class="comment"> *     in progress - checkin in for the sake of safety.</span>
00032 <span class="comment"> *</span>
00033 <span class="comment"> *     Revision 1.1  2001/05/15 02:15:27  davidk</span>
00034 <span class="comment"> *     Initial revision</span>
00035 <span class="comment"> *</span>
00036 <span class="comment"> *     Revision 1.5  2001/04/17 17:30:00  davidk</span>
00037 <span class="comment"> *     changed a bad subscript in a logging statement, due to a compiler warning on NT.</span>
00038 <span class="comment"> *</span>
00039 <span class="comment"> *     Revision 1.4  2001/04/16 18:31:41  lucky</span>
00040 <span class="comment"> *     Added a check for a valid coda length before assining the SAC header</span>
00041 <span class="comment"> *     value to a db structure entry.</span>
00042 <span class="comment"> *</span>
00043 <span class="comment"> *     Revision 1.3  2001/01/19 18:04:23  lucky</span>
00044 <span class="comment"> *     Added a check for mag label "DurCoda" as well as "Md" before looking</span>
00045 <span class="comment"> *     for a coda length</span>
00046 <span class="comment"> *</span>
00047 <span class="comment"> *     Revision 1.2  2001/01/08 19:05:06  lucky</span>
00048 <span class="comment"> *     Fixed a bug in ProduceSAC_NextStationForEvent whereby only one</span>
00049 <span class="comment"> *     pick out of many would be written to the SAC header.</span>
00050 <span class="comment"> *</span>
00051 <span class="comment"> *     Revision 1.1  2000/12/18 18:55:12  lucky</span>
00052 <span class="comment"> *     Initial revision</span>
00053 <span class="comment"> *</span>
00054 <span class="comment"> *     Revision 1.12  2000/12/06 17:50:47  lucky</span>
00055 <span class="comment"> *     We now correctly keep track of the pick onset</span>
00056 <span class="comment"> *</span>
00057 <span class="comment"> *     Revision 1.11  2000/11/08 18:46:33  lucky</span>
00058 <span class="comment"> *     Modified SAC_NextStationforEvent: let's stop pretending - we only</span>
00059 <span class="comment"> *     produce sac for the first Waveform of any SCN.</span>
00060 <span class="comment"> *</span>
00061 <span class="comment"> *     Revision 1.10  2000/09/13 15:36:51  lucky</span>
00062 <span class="comment"> *     Fixed FirstMotion character handling;</span>
00063 <span class="comment"> *     Fixed handling of the coda length</span>
00064 <span class="comment"> *</span>
00065 <span class="comment"> *     Revision 1.9  2000/09/07 21:17:45  lucky</span>
00066 <span class="comment"> *     Final version after the Review pages have been demonstrated.</span>
00067 <span class="comment"> *</span>
00068 <span class="comment"> *     Revision 1.6  2000/08/31 16:10:24  lucky</span>
00069 <span class="comment"> *     Before mallocing snippet buffer, we need to calculate correct iByteLen field.</span>
00070 <span class="comment"> *</span>
00071 <span class="comment"> *     Revision 1.5  2000/08/30 18:42:51  lucky</span>
00072 <span class="comment"> *     Added malloc of binSnippet before data is copied from the sacdata buffer</span>
00073 <span class="comment"> *     to the EWEvent structure.</span>
00074 <span class="comment"> *</span>
00075 <span class="comment"> *     Revision 1.4  2000/08/30 17:41:57  lucky</span>
00076 <span class="comment"> *     InitEWEvent has been changed to include optional allocation of</span>
00077 <span class="comment"> *     pChanInfo space. This must be optional because GetEWEventInfo mallocs</span>
00078 <span class="comment"> *     space on the fly.</span>
00079 <span class="comment"> *</span>
00080 <span class="comment"> *     Revision 1.3  2000/08/25 18:24:45  lucky</span>
00081 <span class="comment"> *     Fixed to work with S and P arrivals, as well as the new, explicitly</span>
00082 <span class="comment"> *     allocated pChanInfo.</span>
00083 <span class="comment"> *</span>
00084 <span class="comment"> *     Revision 1.2  2000/08/19 00:10:12  lucky</span>
00085 <span class="comment"> *     Made SAC_reftime and SAC_Ktostr non-static -- needed in other modules</span>
00086 <span class="comment"> *</span>
00087 <span class="comment"> *     Revision 1.1  2000/08/16 17:18:11  lucky</span>
00088 <span class="comment"> *     Initial revision</span>
00089 <span class="comment"> *</span>
00090 <span class="comment"> *     Revision 1.13  2000/06/29 17:24:42  lucky</span>
00091 <span class="comment"> *     Added to Sac2EWEvent the translation of the coda duration from the sac header.</span>
00092 <span class="comment"> *     The coda duration is written to EW structs.</span>
00093 <span class="comment"> *</span>
00094 <span class="comment"> *     Revision 1.12  2000/06/28 22:53:07  lucky</span>
00095 <span class="comment"> *     Increased the maximum number of Phases per event to 1000 to accomodate</span>
00096 <span class="comment"> *     extremely large Dewey-type events.</span>
00097 <span class="comment"> *     If BuildPhs fails, we record the failure, but do not exit. This way,</span>
00098 <span class="comment"> *     even if one arrival writing fails we still get the remaining ones</span>
00099 <span class="comment"> *     in the arc message.</span>
00100 <span class="comment"> *</span>
00101 <span class="comment"> *     Revision 1.11  2000/06/28 22:22:34  lucky</span>
00102 <span class="comment"> *     Added a check in EWEvent2ArcMsg so that only the arrival-type channels</span>
00103 <span class="comment"> *     are written to Arc message. Recall:channels may be arrivals, station</span>
00104 <span class="comment"> *     magnitudes, or even just waveform data.</span>
00105 <span class="comment"> *</span>
00106 <span class="comment"> *     Revision 1.10  2000/06/26 18:14:42  lucky</span>
00107 <span class="comment"> *     Fixed creation of hypoinverse arc files with NSN locations.</span>
00108 <span class="comment"> *</span>
00109 <span class="comment"> *     Revision 1.9  2000/06/22 23:29:11  lucky</span>
00110 <span class="comment"> *     Fixed BuildPhs to work with USNSN messages'</span>
00111 <span class="comment"> *</span>
00112 <span class="comment"> *     Revision 1.8  2000/06/20 21:42:51  lucky</span>
00113 <span class="comment"> *     *** empty log message ***</span>
00114 <span class="comment"> *</span>
00115 <span class="comment"> *     Revision 1.7  2000/06/16 17:23:36  lucky</span>
00116 <span class="comment"> *     Set tObsPhase to be same as tCalcPhase when read from sac headers.</span>
00117 <span class="comment"> *</span>
00118 <span class="comment"> *     Revision 1.6  2000/06/13 19:05:58  lucky</span>
00119 <span class="comment"> *     Fixed to work with the new hypo2ora, as well as the review stuff.</span>
00120 <span class="comment"> *</span>
00121 <span class="comment"> *     Revision 1.5  2000/06/07 22:09:52  lucky</span>
00122 <span class="comment"> *     Added ArcMsg2EWEvent calls</span>
00123 <span class="comment"> *</span>
00124 <span class="comment"> *</span>
00125 <span class="comment"> *     Revision 1.1  2000/02/14 18:51:48  lucky</span>
00126 <span class="comment"> *     Initial revision</span>
00127 <span class="comment"> *</span>
00128 <span class="comment"> *</span>
00129 <span class="comment"> */</span>
00130 
00131 <span class="preprocessor">#include &lt;<a class="code" href="earthworm_8h.html">earthworm.h</a>&gt;</span>
00132 <span class="preprocessor">#include &lt;sac_2_ewevent.h&gt;</span>
00133 
00134 <span class="keyword">extern</span>          time_t <a class="code" href="time__ew_8c.html#a5">timegm_ew</a> (<span class="keyword">struct</span> tm *);
00135 
00136 <span class="keywordtype">double</span>  <a class="code" href="sac__2__ewevent_8c.html#a2">SAC_reftime</a> (<span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *);
00137 size_t  <a class="code" href="sac__2__ewevent_8c.html#a3">SAC_Ktostr</a> (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>, <span class="keywordtype">char</span> *);
00138 
00139 
00140 <span class="comment">/* Global Variable */</span>
<a name="l00141"></a><a class="code" href="sac__2__ewevent_8c.html#a0">00141</a> <span class="keywordtype">float</span> <a class="code" href="sac__2__ewevent_8c.html#a0">WriteSAC_dGapThresh</a>=1.5;
00142 
00143 
00144 <span class="comment">/********************************************************</span>
00145 <span class="comment">*</span>
00146 <span class="comment">*  Sac2EWEvent:</span>
00147 <span class="comment">*      Fills the EWEventInfoStruct structure pointed </span>
00148 <span class="comment">*      to by pEvent, with the data from the SAC header </span>
00149 <span class="comment">*      pointed to by sacheadp, with data for one</span>
00150 <span class="comment">*      channel of trace data.</span>
00151 <span class="comment">*</span>
00152 <span class="comment">*      Returns EW_SUCCESS if everything went OK, </span>
00153 <span class="comment">*       EW_FAILURE otherwise.</span>
00154 <span class="comment">*</span>
00155 <span class="comment">*</span>
00156 <span class="comment">*   Author: Lucky Vidmar    04/2000</span>
00157 <span class="comment">*</span>
00158 <span class="comment">********************************************************/</span>
<a name="l00159"></a><a class="code" href="sac__2__ewevent_8c.html#a4">00159</a> <span class="keywordtype">int</span>     <a class="code" href="sac__2__ewevent_8c.html#a4">Sac2EWEvent</a> (EWEventInfoStruct *pEvent, <span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *sacheadp,
00160                                         <span class="keywordtype">char</span> *sacdatap, <span class="keywordtype">int</span> CopyData)
00161 {
00162 
00163         <span class="keywordtype">double</span>                          tref;
00164         <span class="keywordtype">int</span>                             i, tmp, toalloc;
00165         <span class="keywordtype">int</span>                                     wt;
00166         EWDB_OriginStruct       *pOrigin;
00167         EWDB_ArrivalStruct      *pArrival;
00168         EWDB_StationMagStruct   *pStaMag;
00169         EWDB_WaveformStruct     *pWaveform;
00170         EWDB_StationStruct      *pStation;
00171         EWChannelDataStruct     *pChan;
00172         EWChannelDataStruct     *pOldChan;
00173 
00174 
00175 
00176         <span class="keywordflow">if</span> ((pEvent == NULL) || (sacheadp == NULL))
00177         {
00178                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid parameters passed in.\n"</span>);
00179                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00180         }
00181 
00182 
00183         <span class="comment">/* Check how many channels we processed */</span>
00184         <span class="keywordflow">if</span> (pEvent-&gt;iNumChans &gt;= pEvent-&gt;iNumAllocChans)
00185         {
00186                 toalloc = (int) (pEvent-&gt;iNumAllocChans + CHAN_ALLOC_INCR);
00187 
00188                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Max Channels (%d) reached. Alloc to %d\n"</span>,
00189                                                                         pEvent-&gt;iNumAllocChans, toalloc);
00190 
00191                 pOldChan = pEvent-&gt;pChanInfo;
00192                 <span class="keywordflow">if</span> ((pEvent-&gt;pChanInfo = (EWChannelDataStruct *) malloc
00193                                                         (toalloc * <span class="keyword">sizeof</span> (EWChannelDataStruct))) == NULL)
00194                 {
00195                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>,  <span class="stringliteral">"Could not malloc %d pChanInfo entries.\n"</span>, toalloc);
00196                         <span class="keywordflow">return</span>  (EW_FAILURE);
00197                 }
00198 
00199                 memcpy (pEvent-&gt;pChanInfo, pOldChan,
00200                                 (pEvent-&gt;iNumAllocChans * sizeof (EWChannelDataStruct)));
00201 
00202                 <span class="keywordflow">for</span> (tmp = pEvent-&gt;iNumChans; tmp &lt; toalloc; tmp++)
00203                         <a class="code" href="init__ewevent_8c.html#a1">InitEWChan</a>(&amp;pEvent-&gt;pChanInfo[tmp]);
00204 
00205                 pEvent-&gt;iNumAllocChans = toalloc;
00206 
00207                 free (pOldChan);
00208 
00209         }
00210 
00211 
00212         <span class="comment">/* Origin structure</span>
00213 <span class="comment">         *********************/</span>
00214         <span class="keywordflow">if</span> ((pOrigin = &amp;(pEvent-&gt;PrefOrigin)) == NULL)
00215         {
00216                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid pEvent -- can't get PrefOrigin.\n"</span>);
00217                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00218         }
00219 
00220 
00221         <span class="comment">/* Make sure that we have origin time</span>
00222 <span class="comment">         **************************************/</span>
00223         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m7">o</a> == (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00224         {
00225                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"No origin time in SAC header.\n"</span>);
00226                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00227         }
00228 
00229         <span class="comment">/* Absolute event origin time</span>
00230 <span class="comment">         ******************************/</span>
00231         <span class="keywordflow">if</span> ((tref = <a class="code" href="sac__2__ewevent_8c.html#a2">SAC_reftime</a> (sacheadp)) &lt; 0)
00232         {
00233                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to SAC_reftime failed.\n"</span>);
00234                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00235         }
00236 
00237         pOrigin-&gt;tOrigin = (double) sacheadp-&gt;<a class="code" href="structSAChead.html#m7">o</a> + tref;
00238 
00239         <span class="comment">/* Fill in the event location </span>
00240 <span class="comment">         *****************************/</span>
00241 
00242         <span class="comment">/* Lattitude */</span>
00243         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m35">evla</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00244                 pOrigin-&gt;dLat = sacheadp-&gt;<a class="code" href="structSAChead.html#m35">evla</a>;
00245 
00246         <span class="comment">/* Longitude */</span>
00247         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m36">evlo</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00248                 pOrigin-&gt;dLon = sacheadp-&gt;<a class="code" href="structSAChead.html#m36">evlo</a>;
00249 
00250         <span class="comment">/* Depth */</span>
00251         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m38">evdp</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00252                 pOrigin-&gt;dDepth = sacheadp-&gt;<a class="code" href="structSAChead.html#m38">evdp</a>;
00253 
00254 
00255 
00256 
00257         <span class="comment">/******* Channel Data *******/</span>
00258 
00259         <span class="keywordflow">if</span> ((pChan = &amp;(pEvent-&gt;pChanInfo[pEvent-&gt;iNumChans])) == NULL)
00260         {
00261                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid pEvent -- can't get pChanInfo[%d].\n"</span>, pEvent-&gt;iNumChans);
00262                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00263         }
00264         
00265         pChan-&gt;iNumArrivals = 0;
00266         pChan-&gt;iNumWaveforms = 1;
00267         
00268         
00269         <span class="comment">/******* Station struct *******/</span>
00270         
00271         <span class="keywordflow">if</span> ((pStation = &amp;(pChan-&gt;Station)) == NULL)
00272         {
00273                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid EWChannel -- can't get Station.\n"</span>);
00274                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00275         }
00276 
00277         <a class="code" href="sac__2__ewevent_8c.html#a3">SAC_Ktostr</a> (pStation-&gt;Sta,  7, sacheadp-&gt;<a class="code" href="structSAChead.html#m89">kstnm</a>);
00278         <a class="code" href="sac__2__ewevent_8c.html#a3">SAC_Ktostr</a> (pStation-&gt;Comp, 9, sacheadp-&gt;<a class="code" href="structSAChead.html#m108">kcmpnm</a>);
00279         <a class="code" href="sac__2__ewevent_8c.html#a3">SAC_Ktostr</a> (pStation-&gt;Net,  9, sacheadp-&gt;<a class="code" href="structSAChead.html#m109">knetwk</a>);
00280 
00281         <span class="comment">/* Station Latitude */</span>
00282         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m31">stla</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00283                 pStation-&gt;Lat = sacheadp-&gt;<a class="code" href="structSAChead.html#m31">stla</a>;
00284 
00285         <span class="comment">/* Station Longitude */</span>
00286         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m32">stlo</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00287                 pStation-&gt;Lon = sacheadp-&gt;<a class="code" href="structSAChead.html#m32">stlo</a>;
00288 
00289         <span class="comment">/* Station Elevation */</span>
00290         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m33">stel</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00291                 pStation-&gt;Elev = sacheadp-&gt;<a class="code" href="structSAChead.html#m33">stel</a>;
00292         
00293 
00294         <span class="comment">/* P-wave information */</span>
00295         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m8">a</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00296         {
00297                 i = pChan-&gt;iNumArrivals;
00298 
00299 
00300                 <span class="comment">/******* Arrival struct *******/</span>
00301                 <span class="keywordflow">if</span> ((pArrival = &amp;(pChan-&gt;Arrivals[i])) == NULL)
00302                 {
00303                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid EWChannel; can't get P-wave Arrivals.\n"</span>);
00304                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00305                 }
00306         
00307                 pArrival-&gt;pStation = pStation;
00308 
00309                 <span class="comment">/* Arrival time */</span>
00310                 <span class="keywordflow">if</span> ((tref = <a class="code" href="sac__2__ewevent_8c.html#a2">SAC_reftime</a> (sacheadp)) &lt; 0)
00311                 {
00312                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to SAC_reftime failed.\n"</span>);
00313                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00314                 }
00315         
00316                 pArrival-&gt;tCalcPhase = (double) sacheadp-&gt;<a class="code" href="structSAChead.html#m8">a</a> + tref;
00317                 pArrival-&gt;tObsPhase = (double) sacheadp-&gt;<a class="code" href="structSAChead.html#m8">a</a> + tref;
00318                 pArrival-&gt;szObsPhase[0] = sacheadp-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[0];
00319                 pArrival-&gt;szObsPhase[1] = sacheadp-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[1];
00320                 pArrival-&gt;szObsPhase[2] = sacheadp-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[2];
00321                 pArrival-&gt;szObsPhase[3] = <span class="charliteral">'\0'</span>;
00322                 pArrival-&gt;cMotion = sacheadp-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[1];
00323                 pArrival-&gt;cOnset = sacheadp-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[3];
00324         
00325                 <span class="comment">/* Convert weight code into dSigma */</span>
00326                 wt = sacheadp-&gt;<a class="code" href="structSAChead.html#m93">ka</a>[2] - <span class="charliteral">'0'</span>;
00327         
00328                 <span class="keywordflow">if</span> (wt == 3)
00329                         pArrival-&gt;dSigma = 0.08;
00330                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wt == 2)
00331                         pArrival-&gt;dSigma = 0.05;
00332                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wt == 1)
00333                         pArrival-&gt;dSigma = 0.03;
00334                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wt == 0)
00335                         pArrival-&gt;dSigma = 0.02;
00336                 <span class="keywordflow">else</span>
00337                         pArrival-&gt;dSigma = 99.99;
00338                         
00339         
00340                 pArrival-&gt;dDist = sacheadp-&gt;<a class="code" href="structSAChead.html#m50">dist</a>;
00341                 pArrival-&gt;dAzm = sacheadp-&gt;<a class="code" href="structSAChead.html#m51">az</a>;
00342         
00343                 <span class="comment">/******* StaMag struct *******/</span>
00344         
00345                 <span class="keywordflow">if</span> ((pStaMag = &amp;(pChan-&gt;Stamags[i])) == NULL)
00346                 {
00347                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid EWChannel -- can't get StaMags.\n"</span>);
00348                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00349                 }
00350         
00351                 <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m20">f</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00352                 {
00353                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaDurXtp = sacheadp-&gt;<a class="code" href="structSAChead.html#m20">f</a> - pArrival-&gt;tCalcPhase + tref;
00354                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaTermXtp = pArrival-&gt;tCalcPhase + 
00355                                                                                 pStaMag-&gt;StaMagUnion.CodaDur.tCodaDurXtp;
00356                 }
00357                 <span class="keywordflow">else</span>
00358                 {
00359                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaDurXtp = 0.0;
00360                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaTermXtp = pArrival-&gt;tCalcPhase;
00361                 }
00362                 
00363                 pStaMag-&gt;iMagType = <a class="code" href="earthworm__defs_8h.html#a34">MAGTYPE_DURATION</a>;
00364 
00365                 pChan-&gt;iNumArrivals = pChan-&gt;iNumArrivals + 1;
00366                 pChan-&gt;iNumStaMags = pChan-&gt;iNumStaMags + 1;
00367         }
00368 
00369         
00370         <span class="comment">/* S-wave information */</span>
00371         <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m10">t0</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00372         {
00373                 i = pChan-&gt;iNumArrivals;
00374 
00375 
00376                 <span class="comment">/******* Arrival struct *******/</span>
00377                 <span class="keywordflow">if</span> ((pArrival = &amp;(pChan-&gt;Arrivals[i])) == NULL)
00378                 {
00379                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid EWChannel; can't get S-wave Arrivals.\n"</span>);
00380                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00381                 }
00382         
00383                 pArrival-&gt;pStation = pStation;
00384 
00385                 <span class="comment">/* Arrival time */</span>
00386                 <span class="keywordflow">if</span> ((tref = <a class="code" href="sac__2__ewevent_8c.html#a2">SAC_reftime</a> (sacheadp)) &lt; 0)
00387                 {
00388                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to SAC_reftime failed.\n"</span>);
00389                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00390                 }
00391         
00392                 pArrival-&gt;tCalcPhase = (double) sacheadp-&gt;<a class="code" href="structSAChead.html#m10">t0</a> + tref;
00393                 pArrival-&gt;tObsPhase = (double) sacheadp-&gt;<a class="code" href="structSAChead.html#m10">t0</a> + tref;
00394                 pArrival-&gt;szObsPhase[0] = sacheadp-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[0];
00395                 pArrival-&gt;szObsPhase[1] = sacheadp-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[1];
00396                 pArrival-&gt;szObsPhase[2] = sacheadp-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[2];
00397                 pArrival-&gt;szObsPhase[3] = <span class="charliteral">'\0'</span>;
00398                 pArrival-&gt;cMotion = sacheadp-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[1];
00399                 pArrival-&gt;cOnset = sacheadp-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[3];
00400         
00401                 <span class="comment">/* Convert weight code into dSigma */</span>
00402                 wt = sacheadp-&gt;<a class="code" href="structSAChead.html#m94">kt0</a>[2] - <span class="charliteral">'0'</span>;
00403         
00404                 <span class="keywordflow">if</span> (wt == 3)
00405                         pArrival-&gt;dSigma = 0.08;
00406                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wt == 2)
00407                         pArrival-&gt;dSigma = 0.05;
00408                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wt == 1)
00409                         pArrival-&gt;dSigma = 0.03;
00410                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wt == 0)
00411                         pArrival-&gt;dSigma = 0.02;
00412                 <span class="keywordflow">else</span>
00413                         pArrival-&gt;dSigma = 99.99;
00414                         
00415         
00416                 pArrival-&gt;dDist = sacheadp-&gt;<a class="code" href="structSAChead.html#m50">dist</a>;
00417                 pArrival-&gt;dAzm = sacheadp-&gt;<a class="code" href="structSAChead.html#m51">az</a>;
00418         
00419 
00420                 <span class="comment">/******* StaMag struct *******/</span>
00421         
00422                 <span class="keywordflow">if</span> ((pStaMag = &amp;(pChan-&gt;Stamags[i])) == NULL)
00423                 {
00424                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid EWChannel -- can't get StaMags.\n"</span>);
00425                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00426                 }
00427         
00428                 <span class="keywordflow">if</span> (sacheadp-&gt;<a class="code" href="structSAChead.html#m20">f</a> != (float) <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>)
00429                 {
00430                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaDurXtp = sacheadp-&gt;<a class="code" href="structSAChead.html#m20">f</a> - pArrival-&gt;tCalcPhase + tref;
00431                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaTermXtp = pArrival-&gt;tCalcPhase + 
00432                                                                                 pStaMag-&gt;StaMagUnion.CodaDur.tCodaDurXtp;
00433                 }
00434                 <span class="keywordflow">else</span>
00435                 {
00436                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaDurXtp = 0.0;
00437                         pStaMag-&gt;StaMagUnion.CodaDur.tCodaTermXtp = 0.0;
00438                 }
00439 
00440                 pStaMag-&gt;iMagType = <a class="code" href="earthworm__defs_8h.html#a34">MAGTYPE_DURATION</a>;
00441                 
00442                 pChan-&gt;iNumArrivals = pChan-&gt;iNumArrivals + 1;
00443                 pChan-&gt;iNumStaMags = pChan-&gt;iNumStaMags + 1;
00444 
00445         }
00446 
00447 
00448         <span class="keywordflow">if</span> (pChan-&gt;iNumArrivals == 0)
00449         {
00450                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Warning: No picks found in SAC header.\n"</span>);
00451         }
00452 
00453 
00454         <span class="comment">/******* Waveform struct *******/</span>
00455         <span class="keywordflow">if</span> (CopyData == 1)
00456         {
00457                 <span class="keywordflow">if</span> ((pWaveform = &amp;(pChan-&gt;Waveforms[0])) == NULL)
00458                 {
00459                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid EWChannel -- can't get Waveform.\n"</span>);
00460                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00461                 }
00462         
00463                 <span class="comment">/* Allocate space of the snippet data */</span>
00464                 pWaveform-&gt;iByteLen = sacheadp-&gt;<a class="code" href="structSAChead.html#m69">npts</a> * <span class="keyword">sizeof</span> (float);
00465         <span class="keywordflow">if</span> ((pWaveform-&gt;binSnippet = malloc (pWaveform-&gt;iByteLen)) == NULL)
00466         {
00467             <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Could not malloc binSnippet.\n"</span>);
00468             <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00469         }
00470 
00471                 memcpy (pWaveform-&gt;binSnippet, sacdatap, ((size_t) sacheadp-&gt;<a class="code" href="structSAChead.html#m69">npts</a> * sizeof (<span class="keywordtype">float</span>)));
00472         }
00473 
00474 
00475         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00476 }
00477 
00478 
00479 
00480 
00481 
00482 
00483 <span class="comment">/********************************************************</span>
00484 <span class="comment">*</span>
00485 <span class="comment">*  SacHeaderInit:</span>
00486 <span class="comment">*      Initialize the SAC header structure pointed to </span>
00487 <span class="comment">*      by sacheadp -- be sure to malloc it before </span>
00488 <span class="comment">*      calling this function.</span>
00489 <span class="comment">*</span>
00490 <span class="comment">*      Also sets default (constant) values in the header</span>
00491 <span class="comment">*   </span>
00492 <span class="comment">*      Returns EW_SUCCESS if everything went OK, </span>
00493 <span class="comment">*       EW_FAILURE otherwise.</span>
00494 <span class="comment">*</span>
00495 <span class="comment">*</span>
00496 <span class="comment">*   Author: Lucky Vidmar    04/2000</span>
00497 <span class="comment">*</span>
00498 <span class="comment">********************************************************/</span>
<a name="l00499"></a><a class="code" href="sac__2__ewevent_8c.html#a5">00499</a> <span class="keywordtype">int</span>     <a class="code" href="sac__2__ewevent_8c.html#a5">SacHeaderInit</a> (<span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *sacheadp)
00500 {
00501 
00502         <span class="keywordtype">int</span> i;
00503         <span class="keyword">struct </span><a class="code" href="structSAChead2.html">SAChead2</a> *head2;         <span class="comment">/* use a simple structure here - we */</span>
00504                                                                 <span class="comment">/* don't care what * the variables are - */</span>
00505                                                                 <span class="comment">/* set them to 'undefined' */</span>
00506         <span class="keywordflow">if</span> (sacheadp == NULL)
00507         {
00508                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid parameters passed in.\n"</span>);
00509                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00510         }
00511 
00512         <span class="comment">/* change to a simpler format */</span>
00513         head2 = (<span class="keyword">struct </span><a class="code" href="structSAChead2.html">SAChead2</a> *) sacheadp;
00514 
00515         <span class="comment">/*    set all of the floats to 'undefined'    */</span>
00516         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a19">NUM_FLOAT</a>; ++i) 
00517                 head2-&gt;<a class="code" href="structSAChead2.html#m0">SACfloat</a>[i] = <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>;
00518 
00519         <span class="comment">/*    set all of the ints to 'undefined'  */</span>
00520         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a20">MAXINT</a>-5; ++i) 
00521                 head2-&gt;<a class="code" href="structSAChead2.html#m1">SACint</a>[i] = <a class="code" href="sachead_8h.html#a4">SACUNDEF</a>;
00522 
00523         <span class="comment">/*    except for the logical integers - set them to 1 */</span>
00524         <span class="keywordflow">for</span> ( ; i &lt; <a class="code" href="sachead_8h.html#a20">MAXINT</a>; ++i) 
00525                 head2-&gt;<a class="code" href="structSAChead2.html#m1">SACint</a>[i] = 1;
00526 
00527         <span class="comment">/*    set all of the strings to 'undefined'   */</span>
00528         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sachead_8h.html#a21">MAXSTRING</a>; ++i) 
00529                 (void) strncpy(head2-&gt;<a class="code" href="structSAChead2.html#m2">SACstring</a>[i], SACSTRUNDEF,K_LEN);
00530 
00531         <span class="comment">/*    SAC I.D. number */</span>
00532         head2-&gt;<a class="code" href="structSAChead2.html#m0">SACfloat</a>[9] = <a class="code" href="sachead_8h.html#a2">SAC_I_D</a>;
00533 
00534         <span class="comment">/*    header version number */</span>
00535         head2-&gt;<a class="code" href="structSAChead2.html#m1">SACint</a>[6] = <a class="code" href="sachead_8h.html#a1">SACVERSION</a>;
00536 
00537 
00538         <span class="comment">/* Set default values that remain constant */</span>
00539         sacheadp-&gt;b      = 0;                           <span class="comment">/* beginning time relative to reference time */</span>
00540         sacheadp-&gt;iftype = <a class="code" href="sachead_8h.html#a17">SAC_ITIME</a>;           <span class="comment">/* File type is time series */</span>
00541         sacheadp-&gt;leven  = 1;                           <span class="comment">/* evenly spaced data */</span>
00542         sacheadp-&gt;idep   = <a class="code" href="sachead_8h.html#a11">SAC_IUNKN</a>;           <span class="comment">/* unknown independent data type */</span>
00543         sacheadp-&gt;iztype = <a class="code" href="sachead_8h.html#a16">SAC_IBEGINTIME</a>;      <span class="comment">/* Reference time is Begin time */</span>
00544         sacheadp-&gt;ievtyp = <a class="code" href="sachead_8h.html#a11">SAC_IUNKN</a>;           <span class="comment">/* event type */</span>
00545 
00546         <span class="comment">/* Label strings */</span>
00547         strncpy(sacheadp-&gt;ko, <span class="stringliteral">"Origin "</span>, K_LEN);
00548         strncpy(sacheadp-&gt;ka, <span class="stringliteral">"Arrival "</span>, K_LEN);
00549         strncpy(sacheadp-&gt;kt0, <span class="stringliteral">"S-Wave "</span>, K_LEN);
00550 
00551         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00552 
00553 }
00554 
00555 
00556 
00557 <span class="comment">/******************************************************</span>
00558 <span class="comment"> * SAC_reftime() reads the reference time in the SAC  *</span>
00559 <span class="comment"> *   header and returns it in double seconds since    *</span>
00560 <span class="comment"> *   January 1, 1970 00:00:00 GMT                     *</span>
00561 <span class="comment"> *   Returns: -1 on error                             *</span>
00562 <span class="comment"> ******************************************************/</span>
<a name="l00563"></a><a class="code" href="sac__2__ewevent_8c.html#a2">00563</a> <span class="keywordtype">double</span> <a class="code" href="sac__2__ewevent_8c.html#a2">SAC_reftime</a>( <span class="keyword">struct</span> <a class="code" href="structSAChead.html">SAChead</a> *psac )
00564 {
00565    <span class="keyword">struct </span>tm stm;
00566    time_t    tt;
00567    <span class="keywordtype">double</span>    tref;
00568 
00569 <span class="comment">/* Find seconds from 1970.01.01 to Jan 1 of the correct year</span>
00570 <span class="comment"> ***********************************************************/</span>
00571    stm.tm_year  = (int) psac-&gt;<a class="code" href="structSAChead.html#m60">nzyear</a> - 1900l;  <span class="comment">/* tm_year = yrs since 1900 */</span>
00572    stm.tm_mon   = 0;                           <span class="comment">/* January */</span>
00573    stm.tm_mday  = 1;                           <span class="comment">/* 1st */</span>
00574    stm.tm_hour  = (int) psac-&gt;<a class="code" href="structSAChead.html#m62">nzhour</a>;
00575    stm.tm_min   = (int) psac-&gt;<a class="code" href="structSAChead.html#m63">nzmin</a>;
00576    stm.tm_sec   = (int) psac-&gt;<a class="code" href="structSAChead.html#m64">nzsec</a>;
00577    stm.tm_isdst = 0;
00578    stm.tm_wday  = 0;                           <span class="comment">/* not used by timegm */</span>
00579    stm.tm_yday  = 0;                           <span class="comment">/* not used by timegm */</span>
00580 
00581         tt = <a class="code" href="time__ew_8c.html#a5">timegm_ew</a> (&amp;stm);
00582 
00583         <span class="keywordflow">if</span> (tt &lt; 0) 
00584         {
00585                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to timegm_ew failed.\n"</span>);
00586                 <span class="keywordflow">return</span> (double) tt;
00587         }
00588 
00589 <span class="comment">/* Then add the number of seconds for the day-of-year plus milliseconds.</span>
00590 <span class="comment"> ***********************************************************************/</span>
00591    tref = (double)tt +                  <span class="comment">/* sec since 1970 to Jan 1 this year */</span>
00592           86400.*(psac-&gt;<a class="code" href="structSAChead.html#m61">nzjday</a>-1) +     <span class="comment">/* sec since Jan 1 in this year      */</span>
00593           (double)psac-&gt;<a class="code" href="structSAChead.html#m65">nzmsec</a>/1000.;   <span class="comment">/* milliseconds */</span>
00594   
00595    <span class="keywordflow">return</span>( tref );
00596 }
00597 
00598 
00599 <span class="comment">/****************************************************************</span>
00600 <span class="comment"> * SAC_Ktostr() convert a SAC header K-field (which is filled   *</span>
00601 <span class="comment"> *   with white-space) into a null-terminated character string  *</span>
00602 <span class="comment"> *   Returns the length of the new string.                      *</span>
00603 <span class="comment"> ****************************************************************/</span>
<a name="l00604"></a><a class="code" href="sac__2__ewevent_8c.html#a3">00604</a> size_t <a class="code" href="sac__2__ewevent_8c.html#a3">SAC_Ktostr</a>( <span class="keywordtype">char</span> *s1, <span class="keywordtype">int</span> len1, <span class="keywordtype">char</span> *s2 )
00605 {
00606    <span class="keywordtype">int</span> i;
00607    <span class="keywordtype">char</span> tmp[<a class="code" href="sachead_8h.html#a10">K_LEN</a>+1];
00608 
00609 <span class="comment">/* NULL-fill the target</span>
00610 <span class="comment"> **********************/</span>
00611    <span class="keywordflow">for</span>( i=0; i&lt;len1; i++ ) s1[i]=<span class="charliteral">'\0'</span>;
00612 
00613 <span class="comment">/* Is the K-field NULL ? </span>
00614 <span class="comment"> ***********************/</span>
00615    strncpy( tmp, s2, K_LEN ); 
00616    tmp[<a class="code" href="sachead_8h.html#a10">K_LEN</a>] = <span class="charliteral">'\0'</span>;
00617    <span class="keywordflow">if</span>( strcmp( tmp, SACSTRUNDEF ) == 0 )  <span class="keywordflow">return</span>( 0 );
00618 
00619 <span class="comment">/* Null terminate after last non-space character </span>
00620 <span class="comment"> ***********************************************/</span>
00621    <span class="keywordflow">for</span>( i=<a class="code" href="sachead_8h.html#a10">K_LEN</a>-1; i&gt;=0; i-- )     <span class="comment">/* start at the end of the string */</span>
00622    {
00623      <span class="keywordflow">if</span>( tmp[i]!=<span class="charliteral">' '</span> &amp;&amp;  tmp[i]!=<span class="charliteral">'\0'</span> )  <span class="comment">/* find last non-space char */</span>
00624      {
00625         tmp[i+1]=<span class="charliteral">'\0'</span>;   <span class="comment">/* null-terminate after last non-space char */</span>
00626         <span class="keywordflow">break</span>;
00627      }
00628    }
00629    <span class="keywordflow">if</span>( i&lt;0 ) <span class="keywordflow">return</span>( 0 );  <span class="comment">/* K-field was empty */</span>
00630 
00631    strncpy( s1, tmp, len1-1 );
00632    <span class="keywordflow">return</span>( strlen( s1 ) );
00633 }
00634 
00635 
00636 
00637 <span class="comment">/************************************************************************* </span>
00638 <span class="comment"> *                            WriteSAC_init()                            *</span>
00639 <span class="comment"> *       Initializes the SAC writing environment.  Uses the SACPABase    *</span>
00640 <span class="comment"> *        routines for writing SAC data                                  *</span>
00641 <span class="comment"> *************************************************************************/</span>
<a name="l00642"></a><a class="code" href="sac__2__ewevent_8c.html#a6">00642</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a6">WriteSAC_init</a>(<span class="keywordtype">char</span> * szOutDir,<span class="keywordtype">char</span> * szOutputFormat, <span class="keywordtype">int</span> bDebug)
00643 {
00644   <span class="comment">/* Initialize SAC Putaway Base   environment */</span>
00645   
00646    <span class="keywordflow">if</span>(bDebug)
00647      <a class="code" href="sacputaway_8c.html#a41">SACPABase_Debug</a>(TRUE);
00648    <span class="keywordflow">return</span>(<a class="code" href="sacputaway_8c.html#a43">SACPABase_init</a>(MAX_SNIPPET_LEN+SACHEADERSIZE, szOutDir,TRUE,szOutputFormat));
00649 }
00650 
00651 
00652 <span class="comment">/************************************************************************* </span>
00653 <span class="comment"> *                            WriteSAC_shutdown()                        *</span>
00654 <span class="comment"> *       Shuts down the SAC writing environment.  Uses the SACPABase     *</span>
00655 <span class="comment"> *        routines for writing SAC data                                  *</span>
00656 <span class="comment"> *************************************************************************/</span>
<a name="l00657"></a><a class="code" href="sac__2__ewevent_8c.html#a7">00657</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a7">WriteSAC_shutdown</a>(<span class="keywordtype">void</span>)
00658 {
00659   <span class="comment">/* Close SAC Putaway Base   environment */</span>
00660   
00661    <span class="keywordflow">return</span>(<a class="code" href="sacputaway_8c.html#a54">SACPABase_close</a>());
00662 }
00663 
00664 <span class="comment">/************************************************************************* </span>
00665 <span class="comment"> *                            WriteSAC_StartEvent ()                     *</span>
00666 <span class="comment"> *       Initializes a SAC event, and records data that is related to    *</span>
00667 <span class="comment"> *        the entire event.                                              *</span>
00668 <span class="comment"> *        Uses the SACPABase routines for writing SAC data.              *</span>
00669 <span class="comment"> *************************************************************************/</span>
<a name="l00670"></a><a class="code" href="sac__2__ewevent_8c.html#a8">00670</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a8">WriteSAC_Event_BAD</a> (EWEventInfoStruct * pEvent, <span class="keywordtype">int</span> WriteHtml)
00671 {
00672   <span class="keywordtype">int</span> rc,i;
00673 
00674   rc=<a class="code" href="sac__2__ewevent_8c.html#a9">WriteSAC_StartEvent</a>(pEvent);
00675   <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00676   {
00677     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"WriteSAC_StartEvent() failed with rc=%d for idEvent %d\n"</span>,
00678           rc,pEvent-&gt;Event.idEvent);
00679     <span class="keywordflow">return</span>(EW_FAILURE);
00680   }
00681 
00682   <span class="keywordflow">for</span>(i=0;i&lt;pEvent-&gt;iNumChans;i++)
00683   {
00684 
00685         <span class="keywordflow">if</span> (WriteHtml == 1)
00686         {
00687                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">"t"</span>, <span class="stringliteral">"STARTING CHANNEL %d of %d\n"</span>, 
00688                                         i, pEvent-&gt;iNumChans);
00689                 printf (<span class="stringliteral">" "</span>);
00690         }
00691 
00692     rc=<a class="code" href="sac__2__ewevent_8c.html#a11">ProduceSAC_NextStationForEvent</a>(&amp;(pEvent-&gt;pChanInfo[i]));
00693     <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00694     {
00695       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"ProduceSAC_NextStationForEvent() failed with rc=%d "</span>
00696             <span class="stringliteral">"for chan record %d of %d.\n"</span>,
00697         rc,i,pEvent-&gt;iNumChans);
00698     }
00699 
00700 
00701     rc=<a class="code" href="sac__2__ewevent_8c.html#a12">WriteSAC_NextStationForEvent</a>(&amp;(pEvent-&gt;pChanInfo[i]));
00702     <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00703     {
00704       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"WriteSAC_NextStationForEvent() failed with rc=%d "</span>
00705             <span class="stringliteral">"for chan record %d of %d.\n"</span>,
00706         rc,i,pEvent-&gt;iNumChans);
00707     }
00708   }  <span class="comment">/* end for i &lt; iNumChans */</span>
00709 
00710   <span class="keywordflow">return</span>(<a class="code" href="sac__2__ewevent_8c.html#a10">WriteSAC_EndEvent</a>());
00711 }
00712 
00713 <span class="comment">/************************************************************************* </span>
00714 <span class="comment"> *                            WriteSAC_StartEvent ()                     *</span>
00715 <span class="comment"> *       Initializes a SAC event, and records data that is related to    *</span>
00716 <span class="comment"> *        the entire event.                                              *</span>
00717 <span class="comment"> *        Uses the SACPABase routines for writing SAC data.              *</span>
00718 <span class="comment"> *************************************************************************/</span>
<a name="l00719"></a><a class="code" href="sac__2__ewevent_8c.html#a9">00719</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a9">WriteSAC_StartEvent</a>(EWEventInfoStruct * pEvent)
00720 {
00721   <span class="keywordtype">char</span> szEventID[20];
00722   <a class="code" href="struct__SAC__OriginStruct.html">SAC_OriginStruct</a> SAC_Origin;
00723 
00724   sprintf(szEventID,<span class="stringliteral">"%d"</span>,pEvent-&gt;Event.idEvent);
00725   
00726   SAC_Origin.<a class="code" href="struct__SAC__OriginStruct.html#m2">dElev</a>=pEvent-&gt;PrefOrigin.dDepth;
00727   SAC_Origin.<a class="code" href="struct__SAC__OriginStruct.html#m0">dLat</a>=pEvent-&gt;PrefOrigin.dLat;
00728   SAC_Origin.<a class="code" href="struct__SAC__OriginStruct.html#m1">dLon</a>=pEvent-&gt;PrefOrigin.dLon;
00729   SAC_Origin.<a class="code" href="struct__SAC__OriginStruct.html#m3">tOrigin</a>=pEvent-&gt;PrefOrigin.tOrigin;
00730 
00731   <span class="keywordflow">return</span>(<a class="code" href="sacputaway_8c.html#a44">SACPABase_next_ev</a>(szEventID,SAC_Origin.<a class="code" href="struct__SAC__OriginStruct.html#m3">tOrigin</a>,&amp;SAC_Origin));
00732 }
00733 
00734 <span class="comment">/************************************************************************* </span>
00735 <span class="comment"> *                            WriteSAC_EndEvent ()                       *</span>
00736 <span class="comment"> *       Marks the end of a SAC event.                                   *</span>
00737 <span class="comment"> *        Uses the SACPABase routines for writing SAC data.              *</span>
00738 <span class="comment"> *************************************************************************/</span>
<a name="l00739"></a><a class="code" href="sac__2__ewevent_8c.html#a10">00739</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a10">WriteSAC_EndEvent</a>(<span class="keywordtype">void</span>)
00740 {
00741   <span class="keywordflow">return</span>(<a class="code" href="sacputaway_8c.html#a53">SACPABase_end_ev</a>());
00742 }
00743 
00744 <span class="comment">/************************************************************************* </span>
00745 <span class="comment"> *                            WriteSAC_StartEvent ()                     *</span>
00746 <span class="comment"> *       Initializes a SAC event, and records data that is related to    *</span>
00747 <span class="comment"> *        the entire event.                                              *</span>
00748 <span class="comment"> *        Uses the SACPABase routines for writing SAC data.              *</span>
00749 <span class="comment"> *************************************************************************/</span>
<a name="l00750"></a><a class="code" href="sac__2__ewevent_8c.html#a11">00750</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a11">ProduceSAC_NextStationForEvent</a>(EWChannelDataStruct * pChannel)
00751 {
00752   <span class="keywordtype">int</span> i,j,rc;
00753   <a class="code" href="structTRACE__REQ.html">TRACE_REQ</a> TR;
00754   <a class="code" href="struct__SAC__ArrivalStruct.html">SAC_ArrivalStruct</a> AS;
00755   <a class="code" href="struct__SAC__StationStruct.html">SAC_StationStruct</a> SS;
00756   <a class="code" href="struct__SAC__ResponseStruct.html">SAC_ResponseStruct</a> RS;
00757   EWDB_ArrivalStruct * pArrival;
00758   EWDB_WaveformStruct * pWaveform;
00759   <span class="comment">/*  SAC_AmpPickStruct AmpPick;</span>
00760 <span class="comment">      EWDB_StationMagStruct * pStaMag; */</span>
00761 
00762 
00763         EWDB_StationStruct * pStation=&amp;(pChannel-&gt;Station);
00764                   
00765 
00766                   <span class="keywordflow">if</span>(pChannel-&gt;iNumWaveforms &lt; 1)
00767                   {
00768                         <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"ProduceSAC_NextStationForEvent() No waveforms for %s,%s,%s!  Not much"</span>
00769                                           <span class="stringliteral">" point in creating a SAC file for that station!\n"</span>,
00770                                           pStation-&gt;Sta,pStation-&gt;Comp,pStation-&gt;Net);
00771                         <span class="keywordflow">return</span>(EW_FAILURE);
00772                   }
00773 
00774 
00775                   pWaveform = &amp;(pChannel-&gt;Waveforms[0]);
00776                   <span class="keywordflow">if</span>(pWaveform-&gt;iByteLen &lt;= 0)
00777                   {
00778                         <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"ProduceSAC_NextStationForEvent() Waveform for "</span>
00779                                   <span class="stringliteral">"%s,%s,%s is 0 bytes long.  \nNot much"</span>
00780                           <span class="stringliteral">" point in creating a SAC file for that station!\n"</span>,
00781                           pStation-&gt;Sta,pStation-&gt;Comp,pStation-&gt;Net);
00782                         <span class="keywordflow">return</span>(EW_FAILURE);
00783                   }
00784 
00785                   <a class="code" href="sacputaway_8c.html#a46">SACPABase_next_scn</a>(pStation-&gt;Sta,pStation-&gt;Comp,pStation-&gt;Net);
00786 
00787                   strcpy(TR.<a class="code" href="structTRACE__REQ.html#m0">sta</a>,pStation-&gt;Sta);
00788                   strcpy(TR.<a class="code" href="structTRACE__REQ.html#m1">chan</a>,pStation-&gt;Comp);
00789                   strcpy(TR.<a class="code" href="structTRACE__REQ.html#m2">net</a>,pStation-&gt;Net);
00790 
00791                   TR.<a class="code" href="structTRACE__REQ.html#m4">reqStarttime</a> = TR.<a class="code" href="structTRACE__REQ.html#m13">actStarttime</a> = pWaveform-&gt;tStart;
00792                   TR.<a class="code" href="structTRACE__REQ.html#m5">reqEndtime</a> = TR.<a class="code" href="structTRACE__REQ.html#m14">actEndtime</a> = pWaveform-&gt;tEnd;
00793                   TR.<a class="code" href="structTRACE__REQ.html#m7">pBuf</a>=pWaveform-&gt;binSnippet;
00794                   TR.<a class="code" href="structTRACE__REQ.html#m8">bufLen</a> = TR.<a class="code" href="structTRACE__REQ.html#m15">actLen</a> = pWaveform-&gt;iByteLen;
00795 
00796                   <span class="comment">/* Note we are not setting the samprate parameter!!!!!!</span>
00797 <span class="comment">                         Hopefully this does not create a problem.  We don't</span>
00798 <span class="comment">                         want to have to go through all of the header byte</span>
00799 <span class="comment">                         swapping here.  davidk 000303</span>
00800 <span class="comment">                         Maybe we could just get it from pResponse</span>
00801 <span class="comment">                  *******************************************************/</span>
00802 
00803                   rc=<a class="code" href="sacputaway_8c.html#a47">SACPABase_write_trace</a>(&amp;TR,WriteSAC_dGapThresh);
00804 
00805                   <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00806                   {
00807                         <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_write_trace() failed with rc=%d for %s,%s,%s\n"</span>,
00808                                   rc,pStation-&gt;Sta,pStation-&gt;Comp,pStation-&gt;Net);
00809                         <span class="keywordflow">return</span>(EW_FAILURE);
00810                   }
00811 
00812                   <span class="comment">/* Write arrival picks */</span>
00813                   <span class="keywordflow">for</span> (i = 0; i &lt; pChannel-&gt;iNumArrivals; i++)
00814                   {
00815                                 <span class="keywordflow">if</span> ((pArrival = &amp;pChannel-&gt;Arrivals[i]) == NULL)
00816                                 {
00817                                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid EWChannel; Can't get P-wave Arrival.\n"</span>);
00818                                         <span class="keywordflow">return</span> (EW_FAILURE);
00819                                 }
00820 
00821                                 <span class="keywordflow">if</span> ((pArrival-&gt;szObsPhase[0] == <span class="charliteral">'P'</span>) || 
00822                                                 (pArrival-&gt;szObsPhase[0] == <span class="charliteral">'p'</span>))
00823                                 {
00824                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m0">tPhase</a>=pArrival-&gt;tObsPhase;
00825                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m1">cPhase</a>=<span class="charliteral">'P'</span>;
00826                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m3">dDist</a>=pArrival-&gt;dDist;
00827                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m4">dAzm</a>=pArrival-&gt;dAzm;
00828                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m6">cFMotion</a>=pArrival-&gt;cMotion;
00829                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m7">cOnset</a>=pArrival-&gt;cOnset;
00830                   
00831                                   <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.02)
00832                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=0;
00833                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.03)
00834                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=1;
00835                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.05)
00836                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=2;
00837                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.08)
00838                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=3;
00839                                   <span class="keywordflow">else</span>
00840                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=4;
00841 
00842 
00843                                         <span class="comment">/* Find the coda length */</span>
00844                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a>=0;
00845                                         <span class="keywordflow">for</span> (j = 0; j &lt; pChannel-&gt;iNumStaMags  &amp;&amp; !AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a>; j++)
00846                                         {
00847                                                 <span class="keywordflow">if</span> (pChannel-&gt;Stamags[j].iMagType == <a class="code" href="earthworm__defs_8h.html#a34">MAGTYPE_DURATION</a>)
00848                                                 {
00849                                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a> = pChannel-&gt;Stamags[j].StaMagUnion.CodaDur.tCodaDurXtp;
00850                                                 }
00851                                         }
00852 
00853                                         rc=<a class="code" href="sacputaway_8c.html#a48">SACPABase_write_parametric</a>(&amp;AS, PWAVE);
00854                                         <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00855                                         {
00856                                                 <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_write_parametric (PWAVE) \n"</span>
00857                                                                 <span class="stringliteral">"failed with rc=%d for %s,%s,%s\n"</span>,
00858                                                                 rc,pStation-&gt;Sta,pStation-&gt;Comp,pStation-&gt;Net);
00859                                                 <span class="keywordflow">return</span>(EW_FAILURE);
00860                                         }
00861 
00862                                 } <span class="comment">/* Processing Pwave */</span>
00863 
00864                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pArrival-&gt;szObsPhase[0] == <span class="charliteral">'S'</span>) || 
00865                                                         (pArrival-&gt;szObsPhase[0] == <span class="charliteral">'s'</span>))
00866                                 {
00867                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m0">tPhase</a>=pArrival-&gt;tObsPhase;
00868                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m1">cPhase</a>=<span class="charliteral">'S'</span>;
00869                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m3">dDist</a>=pArrival-&gt;dDist;
00870                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m4">dAzm</a>=pArrival-&gt;dAzm;
00871                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m6">cFMotion</a>=pArrival-&gt;cMotion;
00872                                   AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m7">cOnset</a>=pArrival-&gt;cOnset;
00873                   
00874                                   <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.02)
00875                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=0;
00876                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.03)
00877                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=1;
00878                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.05)
00879                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=2;
00880                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pArrival-&gt;dSigma  &lt;=0.08)
00881                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=3;
00882                                   <span class="keywordflow">else</span>
00883                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m5">iPhaseWt</a>=4;
00884 
00885                                         <span class="comment">/* Find the coda length */</span>
00886                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a>=0;
00887                                         <span class="keywordflow">for</span> (j = 0; j &lt; pChannel-&gt;iNumStaMags  &amp;&amp; !AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a>; j++)
00888                                         {
00889                                                 <span class="keywordflow">if</span> (pChannel-&gt;Stamags[j].iMagType == <a class="code" href="earthworm__defs_8h.html#a34">MAGTYPE_DURATION</a>)
00890                                                 {
00891                                                         AS.<a class="code" href="struct__SAC__ArrivalStruct.html#m2">dCodaLen</a> = pChannel-&gt;Stamags[j].StaMagUnion.CodaDur.tCodaDurXtp;
00892                                                 }
00893                                         }
00894 
00895                                         rc=<a class="code" href="sacputaway_8c.html#a48">SACPABase_write_parametric</a>(&amp;AS, SWAVE);
00896                                         <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00897                                         {
00898                                                 <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"SACPABase_write_parametric (SWAVE) \n"</span>
00899                                                                 <span class="stringliteral">"failed with rc=%d for %s,%s,%s\n"</span>,
00900                                                                 rc,pStation-&gt;Sta,pStation-&gt;Comp,pStation-&gt;Net);
00901                                                 <span class="keywordflow">return</span>(EW_FAILURE);
00902                                         }
00903 
00904                                 } <span class="comment">/* Processing Swave */</span>
00905 
00906                                 <span class="keywordflow">else</span>
00907                                 {
00908                                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Unknown arrival type ***%c***; continuing.\n"</span>,
00909                                                                         pArrival-&gt;szObsPhase[0]);
00910                                 }
00911 
00912                   } <span class="comment">/* loop over arrivals */</span>
00913 
00914                   SS.<a class="code" href="struct__SAC__StationStruct.html#m0">dLat</a>=pStation-&gt;Lat;
00915                   SS.<a class="code" href="struct__SAC__StationStruct.html#m1">dLon</a>=pStation-&gt;Lon;
00916                   SS.<a class="code" href="struct__SAC__StationStruct.html#m2">dElev</a>=pStation-&gt;Elev;
00917                   SS.<a class="code" href="struct__SAC__StationStruct.html#m3">bResponseIsValid</a>=pChannel-&gt;bResponseIsValid;
00918 
00919                   <span class="keywordflow">if</span>(pChannel-&gt;bResponseIsValid)
00920                   {
00921 
00922                         <span class="keywordflow">if</span> ((pChannel-&gt;ResponseInfo.tfsFunc.iNumPoles &gt; 0) || 
00923                                 (pChannel-&gt;ResponseInfo.tfsFunc.iNumZeroes &gt; 0))
00924                         {
00925                                 SS.<a class="code" href="struct__SAC__StationStruct.html#m4">pResponse</a>=&amp;RS;
00926                                 RS.<a class="code" href="struct__SAC__ResponseStruct.html#m0">dGain</a>=pChannel-&gt;ResponseInfo.dGain;
00927                                 RS.<a class="code" href="struct__SAC__ResponseStruct.html#m1">iNumPoles</a>=pChannel-&gt;ResponseInfo.tfsFunc.iNumPoles;
00928                                 RS.<a class="code" href="struct__SAC__ResponseStruct.html#m2">iNumZeroes</a>=pChannel-&gt;ResponseInfo.tfsFunc.iNumZeroes;
00929                                 <span class="comment">/* This assumes that SAC_PZNum and EWDBNum are of the</span>
00930 <span class="comment">                               same size and layout</span>
00931 <span class="comment">                            *****************************************/</span>
00932                             memcpy(&amp;(RS.<a class="code" href="struct__SAC__ResponseStruct.html#m3">Poles</a>),&amp;(pChannel-&gt;ResponseInfo.tfsFunc.Poles),
00933                                                                    RS.<a class="code" href="struct__SAC__ResponseStruct.html#m1">iNumPoles</a> * <span class="keyword">sizeof</span>(RS.<a class="code" href="struct__SAC__ResponseStruct.html#m3">Poles</a>[0]));
00934                             memcpy(&amp;(RS.<a class="code" href="struct__SAC__ResponseStruct.html#m4">Zeroes</a>),&amp;(pChannel-&gt;ResponseInfo.tfsFunc.Zeroes),
00935                                                                                    RS.<a class="code" href="struct__SAC__ResponseStruct.html#m2">iNumZeroes</a> * <span class="keyword">sizeof</span>(RS.<a class="code" href="struct__SAC__ResponseStruct.html#m4">Zeroes</a>[0]));
00936                         }
00937                   }
00938 
00939   rc=<a class="code" href="sacputaway_8c.html#a50">SACPABase_write_stainfo</a>(&amp;SS);
00940   <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00941   {
00942     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"ProduceSAC_NextStationForEvent():SACPABase_write_stainfo() \n"</span>
00943           <span class="stringliteral">"failed with rc=%d for %s,%s,%s\n"</span>,
00944           rc,pStation-&gt;Sta,pStation-&gt;Comp,pStation-&gt;Net);
00945     <span class="keywordflow">return</span>(EW_FAILURE);
00946   }
00947 
00948   
00949   <span class="keywordflow">return</span>(EW_SUCCESS);
00950 }
00951 
00952 <span class="comment">/************************************************************************* </span>
00953 <span class="comment"> *                            WriteSACEvent ()                           *</span>
00954 <span class="comment"> *        Write the information from the sac header to the file          *</span>
00955 <span class="comment"> *************************************************************************/</span>
<a name="l00956"></a><a class="code" href="sac__2__ewevent_8c.html#a12">00956</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a12">WriteSAC_NextStationForEvent</a>(EWChannelDataStruct * pChannel)
00957 {
00958 
00959         <span class="keywordtype">int</span>             rc;
00960 
00961   rc=<a class="code" href="sacputaway_8c.html#a51">SACPABase_end_scn</a>();
00962 
00963   <span class="keywordflow">if</span>(rc != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00964   {
00965     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"ProduceSAC_NextStationForEvent():SACPABase_end_scn() \n"</span>
00966           <span class="stringliteral">"failed with rc=%d for %s,%s,%s\n"</span>,
00967           rc, pChannel-&gt;Station.Sta, pChannel-&gt;Station.Comp,
00968                         pChannel-&gt;Station.Net);
00969     <span class="keywordflow">return</span>(EW_FAILURE);
00970   }
00971 
00972         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00973 }
00974 
00975 
<a name="l00976"></a><a class="code" href="sac__2__ewevent_8c.html#a13">00976</a> <span class="keywordtype">int</span> <a class="code" href="sac__2__ewevent_8c.html#a13">WriteSAC_Set_dGapThresh</a>(<span class="keywordtype">float</span> IN_dGapThresh)
00977 {
00978   <a class="code" href="sac__2__ewevent_8c.html#a0">WriteSAC_dGapThresh</a>=IN_dGapThresh;
00979   <span class="keywordflow">return</span>(EW_SUCCESS);
00980 }
00981 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:08 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
