<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mutableservermessage.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>mutableservermessage.h</h1><a href="mutableservermessage_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// mutableserverresult.h: interface for the MutableServerResult class.</span>
00002 <span class="comment">//</span>
00004 <span class="comment"></span>
00005 <span class="preprocessor">#if !defined(MUTABLESERVERMESSAGE_H)</span>
<a name="l00006"></a><a class="code" href="mutableservermessage_8h.html#a0">00006</a> <span class="preprocessor"></span><span class="preprocessor">#define MUTABLESERVERMESSAGE_H</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#if _MSC_VER &gt; 1000</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#pragma once</span>
00010 <span class="preprocessor"></span><span class="preprocessor">#endif // _MSC_VER &gt; 1000</span>
00011 <span class="preprocessor"></span>
00012 
00013 <span class="comment">// microsoft pragma to avoid warnings relating to the container</span>
00014 <span class="comment">// template names being too long</span>
00015 <span class="preprocessor">#pragma warning(disable:4786)</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include &lt;string&gt;</span>  <span class="comment">// for std::string</span>
00018 <span class="preprocessor">#include &lt;vector&gt;</span>  <span class="comment">// for std::vector</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="worm__exceptions_8h.html">worm_exceptions.h</a>&gt;</span>
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment">enum MSR_PARSE_STATE</span>
00023 <span class="comment">{</span>
00024 <span class="comment">  MSR_PARSE_COMPLETE   = 0</span>
00025 <span class="comment">, MSR_PARSE_INCOMPLETE = 1</span>
00026 <span class="comment">, MSR_PARSE_ERROR      = 2</span>
00027 <span class="comment">};</span>
00028 <span class="comment">*/</span>
00029 
00030 
<a name="l00031"></a><a class="code" href="classMutableServerMessage.html">00031</a> <span class="keyword">class </span><a class="code" href="classMutableServerMessage.html">MutableServerMessage</a> 
00032 {
00033 <span class="keyword">protected</span>:
00034    
<a name="l00035"></a><a class="code" href="classMutableServerMessage.html#n0">00035</a>    std::string <a class="code" href="classMutableServerMessage.html#n0">MessageBuffer</a>;
00036 
00037    <span class="comment">// ----------------------------------------------------------</span>
00038    <span class="comment">//     virtual methods from MutableServerMessage</span>
00039    <span class="comment">//     to be implemented for a complete derivative classes</span>
00040    <span class="comment">// ----------------------------------------------------------</span>
00041 
00042    <span class="comment">// BufferInitAlloc -- when preparing to format a message</span>
00043    <span class="comment">//                    using FormatBuffer()], this is</span>
00044    <span class="comment">//                    first called.  The result is,</span>
00045    <span class="comment">//                    for the first call, MessageBuffer</span>
00046    <span class="comment">//                    will be assured to be at least this</span>
00047    <span class="comment">//                    long.</span>
00048    <span class="comment">//                    Overriding this method allows</span>
00049    <span class="comment">//                    derivative classes to minimize</span>
00050    <span class="comment">//                    reallocations as message bits are appended</span>
00051    <span class="comment">//                    to the message buffer;</span>
00052    <span class="comment">//</span>
00053    <span class="comment">// NOTE: In each derivative implementation,</span>
00054    <span class="comment">//       call &lt;super_class&gt;::BufferInitAlloc() to get the</span>
00055    <span class="comment">//       space needed by that super class (and all baser</span>
00056    <span class="comment">//       classes), then add the size needed by the</span>
00057    <span class="comment">//       derivative to arrive at the total size needed.</span>
00058    <span class="comment">//       The 10 specified here is for the message-</span>
00059    <span class="comment">//       terminating '\n' and a slight overrun space.</span>
00060    <span class="comment">//</span>
<a name="l00061"></a><a class="code" href="classMutableServerMessage.html#b0">00061</a>    <span class="keyword">virtual</span> <span class="keywordtype">long</span> <a class="code" href="classMutableServerMessage.html#b0">BufferInitAlloc</a>() { <span class="keywordflow">return</span> 10L; }
00062 
00063 
00064    <span class="comment">// FormatDerivativeData</span>
00065    <span class="comment">//</span>
00066    <span class="comment">//     Method by which derivative classes append</span>
00067    <span class="comment">//     their content to MessageBuffer.</span>
00068    <span class="comment">//</span>
00069    <span class="comment">//</span>
00070    <span class="comment">//  NOTE: ALWAYS CALL &lt;super_class&gt;::FormatDerivativeData()</span>
00071    <span class="comment">//        at the start of each implementation to allow</span>
00072    <span class="comment">//        base classes to append their stuff (if any)</span>
00073    <span class="comment">//        to the buffer.</span>
00074    <span class="comment">//        Thus the buffer is built up from the base-most class.</span>
00075    <span class="comment">//</span>
00076    <span class="comment">// THROW worm_exception for errors</span>
00077    <span class="comment">//</span>
<a name="l00078"></a><a class="code" href="classMutableServerMessage.html#b1">00078</a>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classMutableServerMessage.html#b1">FormatDerivativeData</a>() { <span class="keywordflow">return</span>; }
00079 
00080 
00081    <span class="comment">// ParseDerivativeData</span>
00082    <span class="comment">//</span>
00083    <span class="comment">//     Method by which derivative classes extract</span>
00084    <span class="comment">//     their content to MessageBuffer.</span>
00085    <span class="comment">//</span>
00086    <span class="comment">//  NOTE: Always call &lt;super_class&gt;::ParseDerivativeData()</span>
00087    <span class="comment">//        at the top of each implementation to allow</span>
00088    <span class="comment">//        base classes to get their data out of the</span>
00089    <span class="comment">//        buffer first.</span>
00090    <span class="comment">//</span>
00091    <span class="comment">//  USAGE:</span>
00092    <span class="comment">//</span>
00093    <span class="comment">//     If parsing a multi-line message ('\n'-terminated lines),</span>
00094    <span class="comment">//     use a loop consisting of:</span>
00095    <span class="comment">//</span>
00096    <span class="comment">//       i = MessageBuffer.find("\n")  to find the first line end,</span>
00097    <span class="comment">//       MessageBuffer.substr(0, i)    to extract the string</span>
00098    <span class="comment">//                                        (excluding the '\n')</span>
00099    <span class="comment">//       MessageBuffer.erase(0, i+1)     to remove that portion</span>
00100    <span class="comment">//</span>
00101    <span class="comment">//     Since the message should be terminated by an additional</span>
00102    <span class="comment">//     '\n', when the string returned in the second step</span>
00103    <span class="comment">//     is of zero length, that is the end of the message.</span>
00104    <span class="comment">//</span>
00105    <span class="comment">//     (If find() does not, it returns MessageBuffer.npos)</span>
00106    <span class="comment">//</span>
00107    <span class="comment">// THROW worm_exception for errors</span>
00108    <span class="comment">//</span>
<a name="l00109"></a><a class="code" href="classMutableServerMessage.html#b2">00109</a>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classMutableServerMessage.html#b2">ParseDerivativeData</a>() { <span class="keywordflow">return</span>; }
00110 
00111 <span class="keyword">public</span>:
00112 
00113         <a class="code" href="classMutableServerMessage.html#a0">MutableServerMessage</a>();
00114 
00115    <span class="comment">// FormatBuffer()</span>
00116    <span class="comment">//</span>
00117    <span class="comment">//   -- calls BufferInitAlloc()</span>
00118    <span class="comment">//   -- calls FormatDerivativeData()</span>
00119    <span class="comment">//   -- terminates the buffer with an additional '\n'</span>
00120    <span class="comment">//      (that is, a line of zero length)</span>
00121    <span class="comment">//</span>
00122    <span class="comment">// THROWs worm_exception for errors</span>
00123    <span class="comment">//</span>
00124    <span class="keywordtype">void</span> <a class="code" href="classMutableServerMessage.html#a1">FormatBuffer</a>();
00125 
00126    <span class="comment">// GetBufferLength()</span>
00127    <span class="comment">// GetBuffer()</span>
00128    <span class="comment">//</span>
00129    <span class="comment">//       Used to obtain an ascii buffer suitable for</span>
00130    <span class="comment">//       transmission across a socket or ring.</span>
00131    <span class="comment">// </span>
00132    <span class="keywordtype">long</span> <a class="code" href="classMutableServerMessage.html#a2">GetBufferLength</a>() <span class="keyword">const</span>;
00133    <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classMutableServerMessage.html#a3">GetBuffer</a>() <span class="keyword">const</span>;
00134 
00135    <span class="comment">// ParseMessageLine -- used to handle a buffer which contains</span>
00136    <span class="comment">//                     only one '\n' terminated line, and which,</span>
00137    <span class="comment">//                     therefore may or may not be a complete</span>
00138    <span class="comment">//                     message.</span>
00139    <span class="comment">//</span>
00140    <span class="comment">//   This method:</span>
00141    <span class="comment">//   -- calls BufferInitAlloc()</span>
00142    <span class="comment">//   -- if strlen(p_buffer) &gt; 0:</span>
00143    <span class="comment">//      -- appends buffer to MessageBuffer</span>
00144    <span class="comment">//      -- if p_append_nl == true</span>
00145    <span class="comment">//         -- appends '\n' to MessageBuffer</span>
00146    <span class="comment">//   -- else  [[ strlen(p_buffer) == 0 ]]</span>
00147    <span class="comment">//      -- if p_append_nl == true</span>
00148    <span class="comment">//         -- appends '\n' to MessageBuffer</span>
00149    <span class="comment">//      -- calls ParseDerivativeData()</span>
00150    <span class="comment">//</span>
00151    <span class="comment">// p_buffer: single line of a message</span>
00152    <span class="comment">//           (terminating '\n' stripped off)</span>
00153    <span class="comment">//</span>
00154    <span class="comment">// p_append_nl: should '\n' be appended to p_buffer</span>
00155    <span class="comment">//           </span>
00156    <span class="comment">// p_clearbuffer: used to clear MessageBuffer for first</span>
00157    <span class="comment">//                line of message.</span>
00158    <span class="comment">//</span>
00159    <span class="comment">// RETURNS:</span>
00160    <span class="comment">//      true  = this line completed the message and parsing completed</span>
00161    <span class="comment">//      false = this line did not finish the message</span>
00162    <span class="comment">//</span>
00163    <span class="comment">// THROWs worm_exception for errors</span>
00164    <span class="comment">//</span>
00165    <span class="keywordtype">bool</span> <a class="code" href="classMutableServerMessage.html#a4">ParseMessageLine</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> * p_buffer
00166                         ,       <span class="keywordtype">bool</span>   p_append_nl   = <span class="keyword">true</span>
00167                         ,       <span class="keywordtype">bool</span>   p_clearbuffer = <span class="keyword">false</span>
00168                         );
00169 
00170    <span class="comment">// ParseFromBuffer -- used to parse a buffer which is known to</span>
00171    <span class="comment">//                    be complete.  Specifically, messages</span>
00172    <span class="comment">//                    which arrive from a ring.</span>
00173    <span class="comment">//</span>
00174    <span class="comment">// THROWs worm_exception for errors</span>
00175    <span class="comment">//</span>
00176    <span class="keywordtype">void</span> <a class="code" href="classMutableServerMessage.html#a5">ParseFromBuffer</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> * p_buffer );
00177 };
00178 
00179 <span class="preprocessor">#endif // !defined(MUTABLESERVERMESSAGE_H)</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:06 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
