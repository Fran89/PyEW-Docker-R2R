<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>global_pick_rw.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>global_pick_rw.c</h1><a href="global__pick__rw_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="preprocessor">#include &lt;<a class="code" href="global__pick__rw_8h.html">global_pick_rw.h</a>&gt;</span>
00003 
00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
00005 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00007 
00008 <span class="preprocessor">#include &lt;<a class="code" href="kom_8h.html">kom.h</a>&gt;</span>  <span class="comment">/* string parsing */</span>
00009 
00010 
00011 <span class="comment">/*</span>
00012 <span class="comment">** Version currently handled by this code</span>
00013 <span class="comment">*/</span>
<a name="l00014"></a><a class="code" href="global__pick__rw_8c.html#a0">00014</a> <span class="preprocessor">#define GLOBAL_PICK_VERSION (short)1</span>
00015 <span class="preprocessor"></span>
00016 
00017 
00018 <span class="comment">/* ------------------------------------------------------------------------- */</span>
00019 
<a name="l00020"></a><a class="code" href="global__pick__rw_8c.html#a1">00020</a> <a class="code" href="global__msg_8h.html#a1">GLOBAL_MSG_STATUS</a> <a class="code" href="global__pick__rw_8c.html#a1">InitGlobalPick</a>( <a class="code" href="structGLOBAL__PICK__MSG.html">GLOBAL_PICK_STRUCT</a> * p_struct )
00021 {
00022    <span class="keywordflow">if</span> ( p_struct == NULL )
00023    {
00024      <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a4">GLOBAL_MSG_NULL</a>;
00025    }
00026    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m0">version</a> = <a class="code" href="global__pick__rw_8c.html#a0">GLOBAL_PICK_VERSION</a>;
00027    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m1">logo</a>.<a class="code" href="structMSG__LOGO.html#m2">instid</a> = 0;
00028    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m1">logo</a>.<a class="code" href="structMSG__LOGO.html#m1">mod</a> = 0;
00029    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m1">logo</a>.<a class="code" href="structMSG__LOGO.html#m0">type</a> = 0;
00030    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m2">sequence</a> = 0;
00031    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m3">station</a>, <span class="stringliteral">"?"</span> );
00032    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m4">channel</a>, <span class="stringliteral">"?"</span> );
00033    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m5">network</a>, <span class="stringliteral">"?"</span> );
00034    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m6">location</a>, <span class="stringliteral">"?"</span> );
00035    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m7">pick_time</a>, <span class="stringliteral">"?"</span> );
00036    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m8">phase_name</a>, <span class="stringliteral">"?"</span> );
00037    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m9">quality</a> = 0.0;
00038    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m10">polarity</a> = <span class="charliteral">'?'</span>;
00039 
00040    <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a>;
00041 }
00042 
00043 <span class="comment">/* ------------------------------------------------------------------------- */</span>
00044 
<a name="l00045"></a><a class="code" href="global__pick__rw_8c.html#a2">00045</a> <a class="code" href="global__msg_8h.html#a1">GLOBAL_MSG_STATUS</a> <a class="code" href="global__pick__rw_8c.html#a2">WritePickToBuffer</a>( <a class="code" href="structGLOBAL__PICK__MSG.html">GLOBAL_PICK_STRUCT</a> * p_struct
00046                                    , <span class="keywordtype">char</span>               * p_buffer
00047                                    , <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>         p_length
00048                                    )
00049 {
00050    <span class="keywordtype">char</span> _author[10];
00051 
00052    <span class="keywordflow">if</span> ( p_struct == NULL )
00053    {
00054       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a4">GLOBAL_MSG_NULL</a>;
00055    }
00056 
00057    <span class="keywordflow">if</span> ( p_buffer == NULL )
00058    {
00059       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a8">GLOBAL_MSG_BADPARAM</a>;
00060    }
00061 
00062    <span class="keywordflow">if</span> ( p_length &lt; <a class="code" href="global__pick__rw_8h.html#a0">GLOBAL_PICK_MAXBUFSIZE</a> )
00063    {
00064       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a9">GLOBAL_MSG_TOOSMALL</a>;
00065    }
00066 
00067    <span class="keywordflow">if</span> ( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m0">version</a> != <a class="code" href="global__pick__rw_8c.html#a0">GLOBAL_PICK_VERSION</a> )
00068    {
00069       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a5">GLOBAL_MSG_VERSINVALID</a>;
00070    }
00071 
00072    <a class="code" href="global__msg_8c.html#a2">EncodeAuthor</a>( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m1">logo</a>, _author );
00073 
00074    sprintf( p_buffer
00075           , <span class="stringliteral">"%s %d %d %s %s %s %s %s %s %1.4f %c\n"</span>
00076           ,  _author
00077           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m2">sequence</a>
00078           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m0">version</a>
00079           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m3">station</a>
00080           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m4">channel</a>
00081           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m5">network</a>
00082           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m6">location</a>
00083           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m7">pick_time</a>
00084           , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m8">phase_name</a>
00085                   , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m9">quality</a>
00086                   , p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m10">polarity</a>
00087           );
00088 
00089    <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a>;
00090 }
00091 
00092 <span class="comment">/* ------------------------------------------------------------------------- */</span>
00093 
<a name="l00094"></a><a class="code" href="global__pick__rw_8c.html#a3">00094</a> <a class="code" href="global__msg_8h.html#a1">GLOBAL_MSG_STATUS</a> <a class="code" href="global__pick__rw_8c.html#a3">StringToPick</a>( <a class="code" href="structGLOBAL__PICK__MSG.html">GLOBAL_PICK_STRUCT</a> * p_struct, <span class="keywordtype">char</span> * p_string )
00095 {
00096    <span class="keywordtype">char</span> _str[80];
00097    <span class="keywordtype">long</span> _lng;
00098 
00099    <span class="keywordflow">if</span> ( p_struct == NULL )
00100    {
00101       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a4">GLOBAL_MSG_NULL</a>;
00102    }
00103 
00104    <span class="keywordflow">if</span> ( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m0">version</a> != <a class="code" href="global__pick__rw_8c.html#a0">GLOBAL_PICK_VERSION</a> )
00105    {
00106       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a5">GLOBAL_MSG_VERSINVALID</a>;
00107    }
00108 
00109    <span class="keywordflow">if</span> ( p_string == NULL )
00110    {
00111       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a8">GLOBAL_MSG_BADPARAM</a>;
00112    }
00113 
00114    <a class="code" href="global__pick__rw_8c.html#a1">InitGlobalPick</a>(p_struct);
00115 
00116    <a class="code" href="kom_8c.html#a13">k_put</a>(p_string);
00117 
00118    <span class="comment">/*  Author  */</span>
00119    strcpy( _str , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00120 
00121    <span class="keywordflow">if</span> ( strlen(_str) == 0 )
00122    {
00123       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00124    }
00125 
00126    <span class="keywordflow">if</span> ( <a class="code" href="global__msg_8c.html#a3">DecodeAuthor</a>( &amp;(p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m1">logo</a>), _str ) != <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a> )
00127    {
00128       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00129    }
00130 
00131    <span class="comment">/*  sequence number  */</span>
00132    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m2">sequence</a> = <a class="code" href="kom_8c.html#a12">k_long</a>();
00133    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00134    {
00135       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00136    }
00137 
00138    <span class="comment">/*  version number  */</span>
00139    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m0">version</a> = (short)<a class="code" href="kom_8c.html#a12">k_long</a>();
00140    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00141    {
00142       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00143    }
00144 
00145    <span class="keywordflow">if</span> ( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m0">version</a> != <a class="code" href="global__pick__rw_8c.html#a0">GLOBAL_PICK_VERSION</a> )
00146    {
00147       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a5">GLOBAL_MSG_VERSINVALID</a>;
00148    }
00149 
00150    <span class="comment">/*  Station  */</span>
00151    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m3">station</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00152    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m3">station</a>) == 0 )
00153    {
00154       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00155    }
00156 
00157    <span class="comment">/*  Channel  */</span>
00158    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m4">channel</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00159    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m4">channel</a>) == 0 )
00160    {
00161       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00162    }
00163 
00164    <span class="comment">/*  Network  */</span>
00165    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m5">network</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00166    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m5">network</a>) == 0 )
00167    {
00168       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00169    }
00170 
00171    <span class="comment">/*  Location  */</span>
00172    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m6">location</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00173    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m6">location</a>) == 0 )
00174    {
00175       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00176    }
00177 
00178    <span class="comment">/*  Pick Time  */</span>
00179    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m7">pick_time</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00180    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m7">pick_time</a>) == 0 )
00181    {
00182       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00183    }
00184 
00185    <span class="comment">/*  Phase Name  */</span>
00186    strcpy( p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m8">phase_name</a> , <a class="code" href="kom_8c.html#a16">k_str</a>() );
00187    <span class="keywordflow">if</span> ( strlen(p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m8">phase_name</a>) == 0 )
00188    {
00189       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00190    }
00191 
00192    <span class="comment">/*  Quality  */</span>
00193    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m9">quality</a> = <a class="code" href="kom_8c.html#a17">k_val</a>();
00194    <span class="keywordflow">if</span> ( <a class="code" href="kom_8c.html#a9">k_err</a>() != 0 )
00195    {
00196       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00197    }
00198 
00199    <span class="comment">/*  Polarity  */</span>
00200    strcpy( _str, <a class="code" href="kom_8c.html#a16">k_str</a>() );
00201    <span class="keywordflow">if</span> ( strlen(_str) == 0 )
00202    {
00203       <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a6">GLOBAL_MSG_FORMATERROR</a>;
00204    }
00205    p_struct-&gt;<a class="code" href="structGLOBAL__PICK__MSG.html#m10">polarity</a> = _str[0];
00206 
00207    <span class="keywordflow">return</span> <a class="code" href="global__msg_8h.html#a18a3">GLOBAL_MSG_SUCCESS</a>;
00208 }
00209 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:02 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
