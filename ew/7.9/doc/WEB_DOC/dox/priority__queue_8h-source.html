<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>priority_queue.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>priority_queue.h</h1><a href="priority__queue_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*   priority_queue.h</span>
00002 <span class="comment">**</span>
00003 <span class="comment">**   These are the defines and prototypes for a priority-sorted,</span>
00004 <span class="comment">**   stack-based queue of messages.</span>
00005 <span class="comment">**</span>
00006 <span class="comment">**   CAUTION: RETURN CODES DIFFER SLIGHTLY FROM MEM_CIR_QUEUE AND</span>
00007 <span class="comment">**            SOME NON-ZERO RETURN CODES ARE NORMAL (see defs, below)</span>
00008 <span class="comment">**</span>
00009 <span class="comment">**   CAUTION: THIS QUEUE TYPE MANAGES ITS OWN MUTEX FOR ACCESS CONTROL</span>
00010 <span class="comment">**            THERE IS NO NEED FOR THE CALLER TO DUPLICATE SUCH.</span>
00011 <span class="comment">**</span>
00012 <span class="comment">**   20020318 dbh - created</span>
00013 <span class="comment">*/</span>
00014 
00015 <span class="preprocessor">#ifndef PRIORITY_QUEUE_H</span>
00016 <span class="preprocessor"></span><span class="preprocessor">#define PRIORITY_QUEUE_H</span>
00017 <span class="preprocessor"></span>
00018 <span class="preprocessor">#include &lt;<a class="code" href="transport_8h.html">transport.h</a>&gt;</span>  <span class="comment">/* for MSG_LOGO */</span>
00019 
00020 <span class="comment">/*</span>
00021 <span class="comment">** RETURN CODES</span>
00022 <span class="comment">*/</span>
<a name="l00023"></a><a class="code" href="priority__queue_8h.html#a0">00023</a> <span class="preprocessor">#define EW_PRI_NOITEM       3 </span><span class="comment">/* no item found in queue */</span>
<a name="l00024"></a><a class="code" href="priority__queue_8h.html#a1">00024</a> <span class="preprocessor">#define EW_PRI_RETREJECT    2 </span><span class="comment">/* no space for this priority */</span>
<a name="l00025"></a><a class="code" href="priority__queue_8h.html#a2">00025</a> <span class="preprocessor">#define EW_PRI_RETDROP      1 </span><span class="comment">/* earlier item dropped for space */</span>
<a name="l00026"></a><a class="code" href="priority__queue_8h.html#a3">00026</a> <span class="preprocessor">#define EW_PRI_RETNORMAL    0 </span><span class="comment">/* normal */</span>
<a name="l00027"></a><a class="code" href="priority__queue_8h.html#a4">00027</a> <span class="preprocessor">#define EW_PRI_RETNOTREADY -1 </span><span class="comment">/* queue not ready */</span>
<a name="l00028"></a><a class="code" href="priority__queue_8h.html#a5">00028</a> <span class="preprocessor">#define EW_PRI_RETMSGSIZE  -2 </span><span class="comment">/* message too large (or &lt; 0) */</span>
<a name="l00029"></a><a class="code" href="priority__queue_8h.html#a6">00029</a> <span class="preprocessor">#define EW_PRI_RETQNULL    -3 </span><span class="comment">/* PRI_QUEUE pointer is NULL */</span>
<a name="l00030"></a><a class="code" href="priority__queue_8h.html#a7">00030</a> <span class="preprocessor">#define EW_PRI_RETMALLOC   -4 </span><span class="comment">/* memory allocation problem */</span>
<a name="l00031"></a><a class="code" href="priority__queue_8h.html#a8">00031</a> <span class="preprocessor">#define EW_PRI_RETBADPRI   -5 </span><span class="comment">/* invalid priority */</span>
<a name="l00032"></a><a class="code" href="priority__queue_8h.html#a9">00032</a> <span class="preprocessor">#define EW_PRI_RETPARAM    -6 </span><span class="comment">/* invalid parameter value */</span>
00033 
00034 <span class="comment">/*</span>
00035 <span class="comment">** PRIORITY LEVELS</span>
00036 <span class="comment">**</span>
00037 <span class="comment">** CAUTION: Note that the highest priority (most important)</span>
00038 <span class="comment">**          items are assigned EW_PRIORITY_MIN.</span>
00039 <span class="comment">**          That is, these defines are for the programming</span>
00040 <span class="comment">**          domain, not the work domain.</span>
00041 <span class="comment">*/</span>
<a name="l00042"></a><a class="code" href="priority__queue_8h.html#a10">00042</a> <span class="preprocessor">#define EW_PRIORITY_NONE   0 </span><span class="comment">/* state when no message present */</span>
<a name="l00043"></a><a class="code" href="priority__queue_8h.html#a11">00043</a> <span class="preprocessor">#define EW_PRIORITY_MIN    1 </span><span class="comment">/* the highest priority */</span>
<a name="l00044"></a><a class="code" href="priority__queue_8h.html#a12">00044</a> <span class="preprocessor">#define EW_PRIORITY_MAX    9 </span><span class="comment">/* the lowest priority */</span>
<a name="l00045"></a><a class="code" href="priority__queue_8h.html#a13">00045</a> <span class="preprocessor">#define EW_PRIORITY_COUNT 10 </span><span class="comment">/* simplifies loops */</span>
00046 
<a name="l00047"></a><a class="code" href="priority__queue_8h.html#a14">00047</a> <span class="preprocessor">#define EW_PRIORITY_DEF    9 </span><span class="comment">/* default priority =&gt; lowest work priority */</span>
00048 
00049 
<a name="l00050"></a><a class="code" href="priority__queue_8h.html#a15">00050</a> <span class="keyword">typedef</span> <span class="keywordtype">short</span> <a class="code" href="priority__queue_8h.html#a15">EW_PRIORITY</a>;
00051 
00052 
<a name="l00053"></a><a class="code" href="priority__queue_8h.html#a16">00053</a> <span class="keyword">typedef</span> <span class="keywordtype">char</span>*  <a class="code" href="priority__queue_8h.html#a16">PRI_DATA</a>;
00054 
00055 
<a name="l00056"></a><a class="code" href="structPRI__QUEUE__ENTRY.html">00056</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00057"></a><a class="code" href="structPRI__QUEUE__ENTRY.html#m0">00057</a>    <a class="code" href="priority__queue_8h.html#a15">EW_PRIORITY</a>    pri;
<a name="l00058"></a><a class="code" href="structPRI__QUEUE__ENTRY.html#m1">00058</a>    <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>       logo;
<a name="l00059"></a><a class="code" href="structPRI__QUEUE__ENTRY.html#m2">00059</a>    <span class="keywordtype">long</span>           length;
<a name="l00060"></a><a class="code" href="structPRI__QUEUE__ENTRY.html#m3">00060</a>    <a class="code" href="priority__queue_8h.html#a16">PRI_DATA</a>       data;
00061 } <a class="code" href="structPRI__QUEUE__ENTRY.html">PRI_QUEUE_ENTRY</a>;
00062 
<a name="l00063"></a><a class="code" href="structPRI__QUEUE.html">00063</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00064 <span class="keyword"></span>{
<a name="l00065"></a><a class="code" href="structPRI__QUEUE.html#m0">00065</a>    <span class="keywordtype">int</span>                queuesize;
<a name="l00066"></a><a class="code" href="structPRI__QUEUE.html#m1">00066</a>    <span class="keywordtype">int</span>                itemsused;
<a name="l00067"></a><a class="code" href="structPRI__QUEUE.html#m2">00067</a>    <span class="keywordtype">long</span>               itemmaxsize;
<a name="l00068"></a><a class="code" href="structPRI__QUEUE.html#m3">00068</a>    <span class="keywordtype">int</span> insert_indices[<a class="code" href="priority__queue_8h.html#a13">EW_PRIORITY_COUNT</a>]; <span class="comment">/* sort management */</span>
<a name="l00069"></a><a class="code" href="structPRI__QUEUE.html#m4">00069</a>    <a class="code" href="structPRI__QUEUE__ENTRY.html">PRI_QUEUE_ENTRY</a> ** sorted;  <span class="comment">/* sorted pointers to objects */</span>
<a name="l00070"></a><a class="code" href="structPRI__QUEUE.html#m5">00070</a>    <a class="code" href="structPRI__QUEUE__ENTRY.html">PRI_QUEUE_ENTRY</a> *  entries; <span class="comment">/* queue entries */</span>
<a name="l00071"></a><a class="code" href="structPRI__QUEUE.html#m6">00071</a>    <span class="keywordtype">char</span>            *  data;    <span class="comment">/* data storage */</span>
<a name="l00072"></a><a class="code" href="structPRI__QUEUE.html#m7">00072</a>    mutex_t            lock;
00073 } <a class="code" href="structPRI__QUEUE.html">PRI_QUEUE</a>;
00074 
00075 
00076 <span class="comment">/*********************************************************</span>
00077 <span class="comment">** init_pri_queue( PRI_QUEUE * p_queue</span>
00078 <span class="comment">**               , unsigned long p_max_items</span>
00079 <span class="comment">**               , unsigned long p_max_item_size )</span>
00080 <span class="comment">**</span>
00081 <span class="comment">** Allocates and initializes all arrays and grabs a mutex</span>
00082 <span class="comment">** for access control.</span>
00083 <span class="comment">**</span>
00084 <span class="comment">** parameters</span>
00085 <span class="comment">**    p_max_items:     the maximum number of objects stored</span>
00086 <span class="comment">**                     prior to dropping lower priorities.</span>
00087 <span class="comment">**    p_max_item_size: size to use for storage of items.</span>
00088 <span class="comment">**</span>
00089 <span class="comment">** returns: EW_PRI_RETNORMAL</span>
00090 <span class="comment">**                         EW_PRI_RETQNULL</span>
00091 <span class="comment">**          EW_PRI_RETPARAM  (p_max_items &lt; 1)</span>
00092 <span class="comment">**          EW_PRI_RETMALLOC</span>
00093 <span class="comment">**********************************************************/</span>
00094 <span class="keywordtype">int</span> <a class="code" href="priority__queue_8c.html#a3">init_pri_queue</a>( <a class="code" href="structPRI__QUEUE.html">PRI_QUEUE</a> * p_queue
00095                   , <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> p_max_items
00096                   , <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> p_max_item_size );
00097 
00098 <span class="comment">/*********************************************************</span>
00099 <span class="comment">** release_pri_stack() releases allocated memory</span>
00100 <span class="comment">**********************************************************/</span>
00101 <span class="keywordtype">void</span> <a class="code" href="priority__queue_8c.html#a4">release_pri_queue</a>( <a class="code" href="structPRI__QUEUE.html">PRI_QUEUE</a> * p_queue );
00102 
00103 <span class="comment">/*********************************************************</span>
00104 <span class="comment">** getNumOfElementsInQueue() returns number of items in queue</span>
00105 <span class="comment">**********************************************************/</span>
00106 <span class="keywordtype">int</span> <a class="code" href="priority__queue_8c.html#a5">getNumOfElementsInQueue</a>( <a class="code" href="structPRI__QUEUE.html">PRI_QUEUE</a> * p_queue );
00107 
00108 <span class="comment">/*********************************************************</span>
00109 <span class="comment">** add_item( PRI_QUEUE * p_queue</span>
00110 <span class="comment">**         , EW_PRIORITY p_priority</span>
00111 <span class="comment">**         , MSG_LOGO    p_logo</span>
00112 <span class="comment">**         , long        p_size</span>
00113 <span class="comment">**         , DATA        p_data )</span>
00114 <span class="comment">**</span>
00115 <span class="comment">** Adds an object to the stack in priority order</span>
00116 <span class="comment">** (The object is dropped if insufficient space available,</span>
00117 <span class="comment">** item of lesser priority or of same priority but earlier</span>
00118 <span class="comment">** may also be dropped to make space).</span>
00119 <span class="comment">**</span>
00120 <span class="comment">** parameters</span>
00121 <span class="comment">**    p_queue:     PRI_QUEUE to act upon</span>
00122 <span class="comment">**    p_priority:  Priority of the object</span>
00123 <span class="comment">**    p_logo:      Message logo</span>
00124 <span class="comment">**    p_size:      Length of message data</span>
00125 <span class="comment">**    p_data:      Message data</span>
00126 <span class="comment">**</span>
00127 <span class="comment">** returns:  EW_PRI_RETREJECT</span>
00128 <span class="comment">**           EW_PRI_RETDROP</span>
00129 <span class="comment">**           EW_PRI_RETNORMAL</span>
00130 <span class="comment">**           EW_PRI_RETNOTREADY</span>
00131 <span class="comment">**           EW_PRI_RETMSGSIZE</span>
00132 <span class="comment">**           EW_PRI_RETQNULL</span>
00133 <span class="comment">**           EW_PRI_RETBADPRI</span>
00134 <span class="comment">**********************************************************/</span>
00135 <span class="keywordtype">int</span> <a class="code" href="priority__queue_8c.html#a6">add_item</a>( <a class="code" href="structPRI__QUEUE.html">PRI_QUEUE</a> * p_queue
00136             , EW_PRIORITY p_priority
00137             , <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>    p_logo
00138             , <span class="keywordtype">long</span>        p_size
00139             , PRI_DATA    p_data
00140             );
00141 
00142 <span class="comment">/*********************************************************</span>
00143 <span class="comment">** peek_next_item( PRI_QUEUE   * p_queue</span>
00144 <span class="comment">**               , MSG_LOGO    * p_logoptr  )</span>
00145 <span class="comment">**               , EW_PRIORITY * p_priptr  )</span>
00146 <span class="comment">**</span>
00147 <span class="comment">** Gets the highest available object currently stored on</span>
00148 <span class="comment">** the stack.</span>
00149 <span class="comment">**</span>
00150 <span class="comment">** parameters</span>
00151 <span class="comment">**    p_queue:     PRI_QUEUE to act upon</span>
00152 <span class="comment">**    p_logo:      Pointer to Message logo to fill</span>
00153 <span class="comment">**    p_priptr:    Pointer to EQ_PRIORITY to fill</span>
00154 <span class="comment">**</span>
00155 <span class="comment">** returns:  EW_PRI_RETNORMAL (data ready)</span>
00156 <span class="comment">**           EW_PRI_RETNOTREADY</span>
00157 <span class="comment">**           EW_PRI_NOITEM    (no item was in queue)</span>
00158 <span class="comment">**           EW_PRI_RETQNULL</span>
00159 <span class="comment">*********************************************************/</span>
00160 <span class="keywordtype">int</span> <a class="code" href="priority__queue_8c.html#a7">peek_next_item</a>( <a class="code" href="structPRI__QUEUE.html">PRI_QUEUE</a>   * p_queue
00161                   , <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>    * p_logoptr
00162                   , EW_PRIORITY * p_priptr
00163                   );
00164 
00165 <span class="comment">/*********************************************************</span>
00166 <span class="comment">** pop_next_item( PRI_QUEUE * p_queue</span>
00167 <span class="comment">**              , MSG_LOGO  * p_logoptr</span>
00168 <span class="comment">**              , long      * p_sizeptr</span>
00169 <span class="comment">**              , DATA        p_data    )</span>
00170 <span class="comment">**</span>
00171 <span class="comment">** Gets the highest available object currently stored on</span>
00172 <span class="comment">** the stack.</span>
00173 <span class="comment">**</span>
00174 <span class="comment">** parameters</span>
00175 <span class="comment">**    p_queue:     PRI_QUEUE to act upon</span>
00176 <span class="comment">**    p_logo:      Pointer to Message logo to fill</span>
00177 <span class="comment">**    p_size:      Pointer to long to fill with message length</span>
00178 <span class="comment">**    p_data:      Message data</span>
00179 <span class="comment">**</span>
00180 <span class="comment">** returns:  EW_PRI_RETNORMAL (data ready)</span>
00181 <span class="comment">**           EW_PRI_RETNOTREADY</span>
00182 <span class="comment">**           EW_PRI_NOITEM    (no item was in queue)</span>
00183 <span class="comment">**           EW_PRI_RETQNULL</span>
00184 <span class="comment">*********************************************************/</span>
00185 <span class="keywordtype">int</span> <a class="code" href="priority__queue_8c.html#a8">pop_next_item</a>( <a class="code" href="structPRI__QUEUE.html">PRI_QUEUE</a> * p_queue
00186                  , <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>  * p_logoptr
00187                  , <span class="keywordtype">long</span>      * p_sizeptr
00188                  , PRI_DATA    p_data
00189                  );
00190 
00191 
00192 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:07 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
