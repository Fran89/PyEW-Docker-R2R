<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>request_template.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>request_template.h</h1><a href="request__template_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * request_template.h -- Template and example of a request message class</span>
00003 <span class="comment"> *                       for use in the mutable server model.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> *                       In addition to passport handling (which is provided</span>
00006 <span class="comment"> *                       as a result of deriving from the MutableServerRequest</span>
00007 <span class="comment"> *                       class,</span>
00008 <span class="comment"> *                       this example class is expected to also handle</span>
00009 <span class="comment"> *                       an integer and a char string of undetermined length</span>
00010 <span class="comment"> *                       (to demonstrate memory allocation and cleanup).</span>
00011 <span class="comment"> */</span>
00012  
00013 <span class="comment">// STEP 1: Do a global replacement of the string "RequestTemplate"</span>
00014 <span class="comment">//         with the name of your new class</span>
00015 <span class="comment">//</span>
00016 <span class="preprocessor">#if ! defined(_MSM_RequestTemplate_H)</span>
<a name="l00017"></a><a class="code" href="request__template_8h.html#a0">00017</a> <span class="preprocessor"></span><span class="preprocessor">#define _MSM_RequestTemplate_H</span>
00018 <span class="preprocessor"></span>
00019 
00020 <span class="comment">// STEP 2: If the new class should be derived from a class other than</span>
00021 <span class="comment">//         MutableServerRequest, replace this with the appropriate</span>
00022 <span class="comment">//         include.</span>
00023 <span class="comment">//         This specific include requires the project make file to have</span>
00024 <span class="comment">//         /earthworm/..../src/libsrc_cpp/servers/messaging</span>
00025 <span class="comment">//         in the include path.</span>
00026 <span class="preprocessor">#include &lt;<a class="code" href="mutableserverrequest_8h.html">mutableserverrequest.h</a>&gt;</span>
00027 
00028 
00029 
00030 <span class="comment">// STEP 3: If the new class should be derived from a class other than</span>
00031 <span class="comment">//         MutableServerRequest, replace it with the appropriate</span>
00032 <span class="comment">//         base class name.</span>
<a name="l00033"></a><a class="code" href="classRequestTemplate.html">00033</a> <span class="keyword">class </span><a class="code" href="classRequestTemplate.html">RequestTemplate</a> : <span class="keyword">public</span> <a class="code" href="classMutableServerRequest.html">MutableServerRequest</a>
00034 {
00035 <span class="keyword">protected</span>:
00036 
00037 
00038    <span class="comment">// ----------------------------------------------------------</span>
00039    <span class="comment">//     virtual methods from MutableServerMessage</span>
00040    <span class="comment">//     to be implemented for a complete derivative class.</span>
00041    <span class="comment">//</span>
00042    <span class="comment">// THAT IS: These methods were declared in a base class (as</span>
00043    <span class="comment">//          an interface), but they must be redeclared here</span>
00044    <span class="comment">//          and implemented in request_template.cpp</span>
00045    <span class="comment">//          to be able to use the final class.</span>
00046    <span class="comment">//</span>
00047    <span class="comment">// NONE OF THIS NEEDS TO BE CHANGED, SEARCH FOR THE STRING</span>
00048    <span class="comment">// RequestTemplate TO LOCATE THE FIRST ITEMS TO CHANGE.</span>
00049    <span class="comment">// ----------------------------------------------------------</span>
00050 
00051    <span class="comment">// BufferInitAlloc -- when preparing to format a message</span>
00052    <span class="comment">//                    using FormatBuffer()], this is</span>
00053    <span class="comment">//                    first called.  The result is,</span>
00054    <span class="comment">//                    for the first call, MessageBuffer</span>
00055    <span class="comment">//                    will be assured to be at least this</span>
00056    <span class="comment">//                    long.</span>
00057    <span class="comment">//                    Overriding this method allows</span>
00058    <span class="comment">//                    derivative classes to minimize</span>
00059    <span class="comment">//                    reallocations as bits are appended</span>
00060    <span class="comment">//                    to the message buffer;</span>
00061    <span class="comment">//</span>
00062    <span class="comment">// NOTE: In each derivative implementation,</span>
00063    <span class="comment">//       call &lt;super_class&gt;::BufferInitAlloc() to get the</span>
00064    <span class="comment">//       space needed by that super class (and all baser</span>
00065    <span class="comment">//       classes), then add the size needed by the</span>
00066    <span class="comment">//       derivative to arrive at the total size needed.</span>
00067    <span class="comment">//       The 10 specified here is for the message-</span>
00068    <span class="comment">//       terminating '\n' and a slight overrun space.</span>
00069    <span class="comment">//</span>
00070    <span class="keywordtype">long</span> <a class="code" href="classRequestTemplate.html#b0">BufferInitAlloc</a>();
00071 
00072 
00073    <span class="comment">// FormatDerivativeData</span>
00074    <span class="comment">//</span>
00075    <span class="comment">//     Method by which derivative classes append</span>
00076    <span class="comment">//     their content to MessageBuffer.</span>
00077    <span class="comment">//</span>
00078    <span class="comment">//  NOTE: ALWAYS CALL &lt;super_class&gt;::FormatDerivativeData()</span>
00079    <span class="comment">//        at the start of each implementation to allow</span>
00080    <span class="comment">//        base classes to append their stuff (if any)</span>
00081    <span class="comment">//        to the buffer.</span>
00082    <span class="comment">//        Thus the buffer is built upwards from the base-most</span>
00083    <span class="comment">//        class to the most-derived class.</span>
00084    <span class="comment">//        Generally, a newline is used to separate lines.</span>
00085    <span class="comment">//</span>
00086    <span class="comment">// THROW worm_exception for errors</span>
00087    <span class="comment">//</span>
00088    <span class="comment">//       (The worm_exception class is included through</span>
00089    <span class="comment">//        some base class.  Example of use is in the cpp file)</span>
00090    <span class="comment">//</span>
00091    <span class="keywordtype">void</span> <a class="code" href="classRequestTemplate.html#b1">FormatDerivativeData</a>();
00092 
00093 
00094    <span class="comment">// ParseDerivativeData</span>
00095    <span class="comment">//</span>
00096    <span class="comment">//     Method by which derivative classes extract</span>
00097    <span class="comment">//     their content to MessageBuffer.</span>
00098    <span class="comment">//</span>
00099    <span class="comment">//  NOTE: Always call &lt;super_class&gt;::ParseDerivativeData()</span>
00100    <span class="comment">//        at the top of each implementation to allow</span>
00101    <span class="comment">//        base classes to get their data out of the</span>
00102    <span class="comment">//        buffer first.</span>
00103    <span class="comment">//</span>
00104    <span class="comment">//  USAGE:</span>
00105    <span class="comment">//</span>
00106    <span class="comment">//     If parsing a multi-line message ('\n'-terminated lines),</span>
00107    <span class="comment">//     use a loop consisting of:</span>
00108    <span class="comment">//</span>
00109    <span class="comment">//       i = MessageBuffer.find("\n")  to find the first line end,</span>
00110    <span class="comment">//       MessageBuffer.substr(0, i)    to extract the string</span>
00111    <span class="comment">//                                        (excluding the '\n')</span>
00112    <span class="comment">//       MessageBuffer.erase(0, i+1)     to remove that portion</span>
00113    <span class="comment">//</span>
00114    <span class="comment">//     Since the message should be terminated by an additional</span>
00115    <span class="comment">//     '\n', when the string returned in the second step</span>
00116    <span class="comment">//     is of zero length, that is the end of the message.</span>
00117    <span class="comment">//</span>
00118    <span class="comment">//     (If find() does not, it returns MessageBuffer.npos)</span>
00119    <span class="comment">//</span>
00120    <span class="comment">// THROW worm_exception for errors</span>
00121    <span class="comment">//</span>
00122    <span class="keywordtype">void</span> <a class="code" href="classRequestTemplate.html#b2">ParseDerivativeData</a>();
00123 
00124    <span class="comment">// ----------------------------------------------------------</span>
00125    <span class="comment">//             for MutableServerRequest class</span>
00126    <span class="comment">// ----------------------------------------------------------</span>
00127 
00128    <span class="comment">// Only Passport-related items were implemented in the</span>
00129    <span class="comment">// MutableServerRequest class, so they may be ignored here.</span>
00130    
00131    <span class="comment">// IF THE NEW CLASS IS NOT DERIVED FROM MutableServerRequest</span>
00132    <span class="comment">// REMOVE THESE COMMENT LINES.</span>
00133    
00134 
00135    <span class="comment">// ----------------------------------------------------------</span>
00136    <span class="comment">//             for RequestTemplate class</span>
00137    <span class="comment">// ----------------------------------------------------------</span>
00138    
00139 <span class="comment">// STEP 4: ADD CLASS-SPECIFIC VARIABLES AND FUNCTIONS/METHODS</span>
00140 
00141    <span class="comment">// THIS IS THE FIRST LOCATION WHERE ITEMS FOR THE</span>
00142    <span class="comment">// RequestTemplate CLASS ARE TO BE ENTERED.</span>
00143    
00144    <span class="comment">// THIS IS THE APPROPRIATE LOCATIONS TO DECLARE CONTAINER</span>
00145    <span class="comment">// VARIABLES.</span>
00146    <span class="comment">//</span>
00147    <span class="comment">// SINCE THIS REQUEST EXAMPLE IS TO SHOW AN int AND A char pointer,</span>
00148    <span class="comment">// DECLARE RELEVANT VARIABLES HERE:</span>
00149    
<a name="l00150"></a><a class="code" href="classRequestTemplate.html#n0">00150</a>    <span class="keywordtype">int</span>  <a class="code" href="classRequestTemplate.html#n0">MyInt</a>;
00151    
<a name="l00152"></a><a class="code" href="classRequestTemplate.html#n1">00152</a>    <span class="keywordtype">char</span> <a class="code" href="classRequestTemplate.html#n1">MyCharPointer</a>;
00153    
<a name="l00154"></a><a class="code" href="classRequestTemplate.html#n2">00154</a>    <span class="keywordtype">int</span>  <a class="code" href="classRequestTemplate.html#n2">MyStringLength</a>; <span class="comment">// used to avoid unneeded reallocations.</span>
00155    
00156    <span class="comment">/*</span>
00157 <span class="comment">   void MyExampleMethod( int some_parameter );</span>
00158 <span class="comment">   */</span>
00159    
00160 <span class="keyword">public</span>:  <span class="comment">// How others use this class</span>
00161 
00162    <span class="comment">// ----------------------------------------------------------</span>
00163    <span class="comment">//             for RequestTemplate class</span>
00164    <span class="comment">// ----------------------------------------------------------</span>
00165 
00166 <span class="comment">// STEP 5: ADD CLASS-SPECIFIC METHOD DECLARATIONS.</span>
00167 
00168    <span class="comment">// TO PERFORM INITIALIZATION, DECLARE A CONSTRUCTOR</span>
00169    <a class="code" href="classRequestTemplate.html#a0">RequestTemplate</a>();
00170    
00171    <span class="comment">// IF YOU NEED TO PERFORM [MEMORY] CLEANUP AFTER FINISHED WITH THE</span>
00172    <span class="comment">// CLASS, DO SO IN THE DESTRUCTOR.</span>
00173    <span class="comment">// IF NO CLEANUP IS NEEDED, THIS DECLARATION MAY BE</span>
00174    <span class="comment">// REMOVED (ALONG WITH THE DEFINITION IN THE cpp FILE).</span>
00175    <a class="code" href="classRequestTemplate.html#a1">~RequestTemplate</a>();
00176 
00177 
00178    <span class="comment">// ADD DECLARATIONS FOR ACCESSOR METHODS (FUNCTIONS) TO</span>
00179    <span class="comment">// GET TO THE VARIABLES SPECIFIC TO THIS CLASS:</span>
00180    
00181    <span class="keywordtype">void</span> <a class="code" href="classRequestTemplate.html#a2">SetMyInteger</a>( <span class="keywordtype">int</span> p_int );
00182    
00183    <span class="comment">// SetMyString()</span>
00184    <span class="comment">//</span>
00185    <span class="comment">// PARAMETERS:</span>
00186    <span class="comment">//       p_str may be NULL</span>
00187    <span class="comment">//</span>
00188    <span class="comment">// RETURNS:</span>
00189    <span class="comment">//      true = set okay</span>
00190    <span class="comment">//     false = failed to allocate memory for the buffer</span>
00191    <span class="keywordtype">bool</span> <a class="code" href="classRequestTemplate.html#a3">SetMyString</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> * p_str );
00192    
00193    
00194    <span class="comment">// Adding 'const' at the end prevents the caller from</span>
00195    <span class="comment">// changing the value in a way that would alter the contents</span>
00196    <span class="comment">// of the class instance.</span>
00197    
00198    <span class="keywordtype">int</span> <a class="code" href="classRequestTemplate.html#a4">GetMyInteger</a>() <span class="keyword">const</span>;
00199    
00200    <span class="comment">// GetMyString() may return NULL</span>
00201    <span class="keywordtype">char</span> * <a class="code" href="classRequestTemplate.html#a5">GetMyString</a>() <span class="keyword">const</span>;
00202 
00203 
00204    
00205    <span class="comment">// ===========================================================</span>
00206    <span class="comment">// EVERYTHING FOLLOWING (BETWEEN THE DOUBLE-DASHED LINES)</span>
00207    <span class="comment">// MAY BE DELETED IN ACTUAL IMPLEMENTATIONS.</span>
00208    
00209    
00210    <span class="comment">// THE FOLLOWING METHODS ARE ALSO AVAILABLE BY USERS OF</span>
00211    <span class="comment">// THIS CLASS AS A RESULT OF ITS DERIVING FROM THESE OTHER</span>
00212    <span class="comment">// BASE CLASSES.</span>
00213    
00214    
00215    <span class="comment">// ----------------------------------------------------------</span>
00216    <span class="comment">//     Methods from MutableServerMessage class</span>
00217    <span class="comment">// ----------------------------------------------------------</span>
00218    
00219    <span class="comment">// FormatBuffer()</span>
00220    <span class="comment">//</span>
00221    <span class="comment">//   MUST CALL THIS BEFORE CALLING</span>
00222    <span class="comment">//      GetBufferLength() and GetBuffer()</span>
00223    <span class="comment">//</span>
00224    <span class="comment">//   -- calls BufferInitAlloc()</span>
00225    <span class="comment">//   -- calls FormatDerivativeData()</span>
00226    <span class="comment">//   -- terminates the buffer with an additional '\n'</span>
00227    <span class="comment">//      (that is, a line of zero length)</span>
00228    <span class="comment">//</span>
00229    <span class="comment">// THROWs worm_exception for errors</span>
00230    <span class="comment">//</span>
00231    <span class="comment">//void FormatBuffer();</span>
00232 
00233    <span class="comment">// GetBufferLength()</span>
00234    <span class="comment">// GetBuffer()</span>
00235    <span class="comment">//</span>
00236    <span class="comment">//       Used to obtain an ascii buffer suitable for</span>
00237    <span class="comment">//       transmission across a socket or ring.</span>
00238    <span class="comment">// </span>
00239    <span class="comment">//long GetBufferLength() const;</span>
00240    <span class="comment">//const char * GetBuffer() const;</span>
00241 
00242    <span class="comment">// ParseMessageLine -- used to handle a buffer which contains</span>
00243    <span class="comment">//                     only one '\n' terminated line, and which,</span>
00244    <span class="comment">//                     therefore may or may not be a complete</span>
00245    <span class="comment">//                     message.</span>
00246    <span class="comment">//</span>
00247    <span class="comment">//   This method:</span>
00248    <span class="comment">//   -- calls BufferInitAlloc()</span>
00249    <span class="comment">//   -- if strlen(p_buffer) &gt; 0:</span>
00250    <span class="comment">//      -- appends buffer to MessageBuffer</span>
00251    <span class="comment">//      -- if p_append_nl == true</span>
00252    <span class="comment">//         -- appends '\n' to MessageBuffer</span>
00253    <span class="comment">//   -- else  [[ strlen(p_buffer) == 0 ]]</span>
00254    <span class="comment">//      -- if p_append_nl == true</span>
00255    <span class="comment">//         -- appends '\n' to MessageBuffer</span>
00256    <span class="comment">//      -- calls ParseDerivativeData()</span>
00257    <span class="comment">//</span>
00258    <span class="comment">// p_buffer: single line of a message</span>
00259    <span class="comment">//           (terminating '\n' stripped off)</span>
00260    <span class="comment">//</span>
00261    <span class="comment">// p_append_nl: should '\n' be appended to p_buffer</span>
00262    <span class="comment">//           </span>
00263    <span class="comment">// p_clearbuffer: used to clear MessageBuffer for first</span>
00264    <span class="comment">//                line of message.</span>
00265    <span class="comment">//</span>
00266    <span class="comment">// RETURNS:</span>
00267    <span class="comment">//      true  = this line completed the message and parsing completed</span>
00268    <span class="comment">//      false = this line did not finish the message</span>
00269    <span class="comment">//</span>
00270    <span class="comment">// THROWs worm_exception for errors</span>
00271    <span class="comment">//</span>
00272    <span class="comment">//bool ParseMessageLine( const char * p_buffer</span>
00273    <span class="comment">//                     ,       bool   p_append_nl   = true</span>
00274    <span class="comment">//                     ,       bool   p_clearbuffer = false</span>
00275    <span class="comment">//                     );</span>
00276 
00277    <span class="comment">// ParseFromBuffer -- used to parse a buffer which is known to</span>
00278    <span class="comment">//                    be complete.  Specifically, messages</span>
00279    <span class="comment">//                    which arrive from a ring.</span>
00280    <span class="comment">//</span>
00281    <span class="comment">// THROWs worm_exception for errors</span>
00282    <span class="comment">//</span>
00283    <span class="comment">//void ParseFromBuffer( const char * p_buffer );</span>
00284    
00285 
00286    <span class="comment">// ----------------------------------------------------------</span>
00287    <span class="comment">//       Methods from MutableServerRequest class</span>
00288    <span class="comment">// ----------------------------------------------------------</span>
00289 
00290    <span class="comment">//void ClearPassport();</span>
00291 
00292    <span class="comment">//void AddPassportLine( const char * p_line );</span>
00293 
00294    <span class="comment">//void AddPassportLine( std::string p_line );</span>
00295 
00296    <span class="comment">//int GetPassportLineCount();</span>
00297 
00298    <span class="comment">// GetPassportLine() -- return one of the passport lines.</span>
00299    <span class="comment">//</span>
00300    <span class="comment">//  p_index must be in the range 0 - GetPassportLineCount()</span>
00301    <span class="comment">//</span>
00302    <span class="comment">// RETURNS:</span>
00303    <span class="comment">//        the passport line</span>
00304    <span class="comment">//     or NULL if index out of range, etc.</span>
00305    <span class="comment">//</span>
00306    <span class="comment">//const char * GetPassportLine( int p_index );</span>
00307 
00308    <span class="comment">// EVERYTHING ABOVE (BETWEEN THE DOUBLE-DASHED LINES)</span>
00309    <span class="comment">// MAY BE DELETED IN ACTUAL IMPLEMENTATIONS.</span>
00310    <span class="comment">// ===========================================================</span>
00311 
00312 
00313 <span class="comment">// DON'T DELETE THIS CLASS-TERMINATING BRACKET</span>
00314 };
00315 
00316 <span class="preprocessor">#endif // _MSM_RequestTemplate_H</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:07 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
