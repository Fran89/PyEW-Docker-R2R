<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>transport.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>transport.h</h1><a href="transport_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00004 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *    $Id: transport_8h-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *    Revision history:</span>
00009 <span class="comment"> *     $Log$
00009 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00009 <span class="comment"> *     first inclusion
00009 <span class="comment"> *</span>
00010 <span class="comment"> *     Revision 1.4  2001/05/04 23:39:11  dietz</span>
00011 <span class="comment"> *     changed SHM_HEAD.flag from short to int so it can hold processids.</span>
00012 <span class="comment"> *     changed prototype for tport_putflag accordingly.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *     Revision 1.3  2000/09/07 21:56:33  lucky</span>
00015 <span class="comment"> *     Changed NTRACK_PUT and NTRACK_GET to 200 and 500 respectively</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> *     Revision 1.2  2000/06/02 17:14:58  dietz</span>
00018 <span class="comment"> *     added TPORT_FATAL definition</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> *     Revision 1.1  2000/02/14 20:05:54  lucky</span>
00021 <span class="comment"> *     Initial revision</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> */</span>
00025 
00026 
00027     <span class="comment">/********************************************************************/</span>
00028     <span class="comment">/*                                                                  */</span>
00029     <span class="comment">/*                          transport.h                             */</span>
00030     <span class="comment">/*                                                                  */</span>
00031     <span class="comment">/*             Include file for transport functions                 */</span>
00032     <span class="comment">/*                to access shared memory regions.                  */</span>
00033     <span class="comment">/*                                                                  */</span>
00034     <span class="comment">/* This include file requires that _SOLARIS, _WIN32, or _OS2 be     */</span>
00035     <span class="comment">/* defined in the makefile.                                         */</span>
00036     <span class="comment">/*                                                                  */</span>
00037     <span class="comment">/********************************************************************/</span>
00038 
00039 <span class="preprocessor">#ifndef TRANSPORT_H</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define TRANSPORT_H</span>
00041 <span class="preprocessor"></span>
00042 <span class="preprocessor">#include &lt;<a class="code" href="platform_8h.html">platform.h</a>&gt;</span>
00043 
00044 <span class="comment">/* Structure types used in transport.c */</span>
00045 
<a name="l00046"></a><a class="code" href="structSHM__HEAD.html">00046</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{                   <span class="comment">/********** shared memory header *********/</span>
<a name="l00047"></a><a class="code" href="structSHM__HEAD.html#m0">00047</a>         <span class="keywordtype">long</span>             nbytes;   <span class="comment">/* total size of shared memory region    */</span>
<a name="l00048"></a><a class="code" href="structSHM__HEAD.html#m1">00048</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>    keymax;   <span class="comment">/* # usable bytes (nbytes - SHM_HEAD)    */</span>
<a name="l00049"></a><a class="code" href="structSHM__HEAD.html#m2">00049</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>    keyin;    <span class="comment">/* index of next available byte          */</span>
<a name="l00050"></a><a class="code" href="structSHM__HEAD.html#m3">00050</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>    keyold;   <span class="comment">/* index of oldest complete message      */</span>
<a name="l00051"></a><a class="code" href="structSHM__HEAD.html#m4">00051</a>         <span class="keywordtype">int</span>              flag;     <span class="comment">/* flag watched by attached programs     */</span>
00052 } <a class="code" href="structSHM__HEAD.html">SHM_HEAD</a>;                        <span class="comment">/*****************************************/</span>
00053 
00054 
<a name="l00055"></a><a class="code" href="structSHM__INFO.html">00055</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{                   <span class="comment">/******* shared memory information *******/</span>
<a name="l00056"></a><a class="code" href="structSHM__INFO.html#m0">00056</a>         <a class="code" href="structSHM__HEAD.html">SHM_HEAD</a> *       addr;     <span class="comment">/* pointer to beginning of shred mem reg */</span>
<a name="l00057"></a><a class="code" href="structSHM__INFO.html#m1">00057</a>         <span class="keywordtype">long</span>             <a class="code" href="getutil_8c.html#a9">key</a>;      <span class="comment">/* key to shared memory region           */</span>
00058                                    <span class="comment">/*                                       */</span>
00059 <span class="preprocessor">#ifdef _SOLARIS                    </span><span class="comment">/* SOLARIS ONLY:                         */</span>
00060         <span class="keywordtype">long</span>             mid;      <span class="comment">/* shared memory region identifier       */</span>
00061         <span class="keywordtype">long</span>             sid;      <span class="comment">/* associated semaphore identifier       */</span>
00062 <span class="preprocessor">#endif                             </span><span class="comment">/*                                       */</span>
00063 <span class="preprocessor">#ifdef _OS2                        </span><span class="comment">/* OS2 ONLY:                             */</span>
00064         PVOID            objAlloc; <span class="comment">/* pointer to memory object              */</span>
00065         HMTX             hmtx;     <span class="comment">/* mutex semaphore handle                */</span>
00066 <span class="preprocessor">#endif                             </span><span class="comment">/*                                       */</span>
00067 <span class="preprocessor">#ifdef  _WINNT                     </span><span class="comment">/* WIN NT or 95 ONLY                     */</span>
00068         HANDLE           hShare;   <span class="comment">/* shared memory region handle           */</span>
00069         HANDLE           hMutex;   <span class="comment">/* mutex handle                          */</span>
00070 <span class="preprocessor">#endif                             </span><span class="comment">/*                                       */</span>
00071 } <a class="code" href="structSHM__INFO.html">SHM_INFO</a>;                        <span class="comment">/*****************************************/</span>
00072 
00073 
<a name="l00074"></a><a class="code" href="structMSG__LOGO.html">00074</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{                   <span class="comment">/******** description of message *********/</span>
<a name="l00075"></a><a class="code" href="structMSG__LOGO.html#m0">00075</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>    <a class="code" href="getutil_8c.html#a16">type</a>;     <span class="comment">/* message is of this type               */</span>
<a name="l00076"></a><a class="code" href="structMSG__LOGO.html#m1">00076</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>    mod;      <span class="comment">/* was created by this module id         */</span>
<a name="l00077"></a><a class="code" href="structMSG__LOGO.html#m2">00077</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>    instid;   <span class="comment">/* at this installation                  */</span>
00078 } <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>;                        <span class="comment">/*****************************************/</span>
00079 
00080 
<a name="l00081"></a><a class="code" href="structTPORT__HEAD.html">00081</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{                     <span class="comment">/******** transport layer header *********/</span>
<a name="l00082"></a><a class="code" href="structTPORT__HEAD.html#m0">00082</a>         <span class="keywordtype">char</span>             start;      <span class="comment">/* byte to flag beginning of this msg    */</span>
<a name="l00083"></a><a class="code" href="structTPORT__HEAD.html#m1">00083</a>         <span class="keywordtype">long</span>             size;       <span class="comment">/* size of msg (not including TPORT_HEAD)*/</span>
<a name="l00084"></a><a class="code" href="structTPORT__HEAD.html#m2">00084</a>         <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>         logo;       <span class="comment">/* description of message source         */</span>
<a name="l00085"></a><a class="code" href="structTPORT__HEAD.html#m3">00085</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>    seq;        <span class="comment">/* sequence number of message            */</span>
00086 } <a class="code" href="structTPORT__HEAD.html">TPORT_HEAD</a>;                        <span class="comment">/*****************************************/</span>
00087 
00088 
<a name="l00089"></a><a class="code" href="structMSG__TRACK.html">00089</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{                     <span class="comment">/***** sequence #, outpointer tracker ****/</span>
<a name="l00090"></a><a class="code" href="structMSG__TRACK.html#m0">00090</a>         <span class="keywordtype">long</span>             memkey;     <span class="comment">/* key to memory region being accessed   */</span>
<a name="l00091"></a><a class="code" href="structMSG__TRACK.html#m1">00091</a>         <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a>         logo;       <span class="comment">/* description of message source         */</span>
<a name="l00092"></a><a class="code" href="structMSG__TRACK.html#m2">00092</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>    seq;        <span class="comment">/* sequence number of message            */</span>
<a name="l00093"></a><a class="code" href="structMSG__TRACK.html#m3">00093</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>    keyout;     <span class="comment">/* points to msg after last one "got"    */</span>
<a name="l00094"></a><a class="code" href="structMSG__TRACK.html#m4">00094</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>    active;     <span class="comment">/* 0 until msg of logo is found in memkey*/</span>
00095 } <a class="code" href="structMSG__TRACK.html">MSG_TRACK</a>;                         <span class="comment">/*****************************************/</span>
00096 
00097 
00098 <span class="comment">/* Definitions for tracking message logos (type,module,class) */</span>
<a name="l00099"></a><a class="code" href="transport_8h.html#a0">00099</a> <span class="preprocessor">#define WILD          0   </span><span class="comment">/* wildcard for message descriptor       */</span>
<a name="l00100"></a><a class="code" href="transport_8h.html#a1">00100</a> <span class="preprocessor">#define NTRACK_PUT  200   </span><span class="comment">/* max # message trackers for a "putter" */</span>
<a name="l00101"></a><a class="code" href="transport_8h.html#a2">00101</a> <span class="preprocessor">#define NTRACK_GET  500   </span><span class="comment">/* max # message trackers for a "getter" */</span>
<a name="l00102"></a><a class="code" href="transport_8h.html#a3">00102</a> <span class="preprocessor">#define FIRST_BYTE  111   </span><span class="comment">/* byte-value to flag beginning of msg   */</span>
00103                           <span class="comment">/* Note: To work on both Solaris &amp; OS2,  */</span>
00104                           <span class="comment">/*       FIRST_BYTE must be from 0-127   */</span>
00105 
00106 <span class="comment">/* Definition for internal use in transport functions */</span>
<a name="l00107"></a><a class="code" href="transport_8h.html#a4">00107</a> <span class="preprocessor">#define TPORT_FATAL -99   </span><span class="comment">/* a fatal error has occurred, function should exit */</span>
00108 
00109 <span class="comment">/* Definitions of return values for tport_putmsg() and/or tport_copyto() */</span>
<a name="l00110"></a><a class="code" href="transport_8h.html#a5">00110</a> <span class="preprocessor">#define PUT_OK        1   </span><span class="comment">/* put the message in memory, no problems           */</span>
<a name="l00111"></a><a class="code" href="transport_8h.html#a6">00111</a> <span class="preprocessor">#define PUT_NOTRACK  -1   </span><span class="comment">/* NTRACK_PUT exceeded; msg not sent [tport_putmsg] */</span>
<a name="l00112"></a><a class="code" href="transport_8h.html#a7">00112</a> <span class="preprocessor">#define PUT_TOOBIG   -2   </span><span class="comment">/* message is too big for shared memory             */</span>
00113 
00114 <span class="comment">/* Definitions of return values for tport_getmsg() and/or tport_copyfrom() */</span>
<a name="l00115"></a><a class="code" href="transport_8h.html#a8">00115</a> <span class="preprocessor">#define GET_OK           1  </span><span class="comment">/* got a requested message (modid,type,class)     */</span>
<a name="l00116"></a><a class="code" href="transport_8h.html#a9">00116</a> <span class="preprocessor">#define GET_NONE         0  </span><span class="comment">/* no messages of requested logo(s) in memory     */</span>
<a name="l00117"></a><a class="code" href="transport_8h.html#a10">00117</a> <span class="preprocessor">#define GET_MISS        -1  </span><span class="comment">/* got a message, but missed some [tport_getmsg]  */</span>
<a name="l00118"></a><a class="code" href="transport_8h.html#a11">00118</a> <span class="preprocessor">#define GET_NOTRACK     -2  </span><span class="comment">/* got a message, but NTRACK_GET was exceeded     */</span>
<a name="l00119"></a><a class="code" href="transport_8h.html#a12">00119</a> <span class="preprocessor">#define GET_TOOBIG      -3  </span><span class="comment">/* next message of requested logo(s) is too       */</span>
00120                             <span class="comment">/* long for caller's buffer; no msg retrieved     */</span>
<a name="l00121"></a><a class="code" href="transport_8h.html#a13">00121</a> <span class="preprocessor">#define GET_MISS_LAPPED -4  </span><span class="comment">/* got a message, but some were overwritten       */</span>
00122                             <span class="comment">/* before we saw to them [tport_copyfrom]         */</span>
<a name="l00123"></a><a class="code" href="transport_8h.html#a14">00123</a> <span class="preprocessor">#define GET_MISS_SEQGAP -5  </span><span class="comment">/* got a message, but there was a gap in seq #'s; */</span>
00124                             <span class="comment">/* missed msgs were either never in the ring, or  */</span>
00125                             <span class="comment">/* were previously found "toobig" [tport_copyfrom]*/</span>
00126 
00127 <span class="comment">/* Definitions for semaphore operations */</span>
<a name="l00128"></a><a class="code" href="transport_8h.html#a15">00128</a> <span class="preprocessor">#define SHM_INUSE    -1   </span><span class="comment">/* add to semval to flag that memory is in use */</span>
<a name="l00129"></a><a class="code" href="transport_8h.html#a16">00129</a> <span class="preprocessor">#define SHM_FREE      1   </span><span class="comment">/* add to semval to flag that memory is free   */</span>
00130 
00131 <span class="comment">/* Definitions for shared memory header flag */</span>
<a name="l00132"></a><a class="code" href="transport_8h.html#a17">00132</a> <span class="preprocessor">#define TERMINATE  -999   </span><span class="comment">/* tells attached programs to detach &amp; terminate */</span>
00133 
00134 
00135 <span class="comment">/* These functions are in transport.c */</span>
00136 
00137 <span class="keywordtype">void</span>  <a class="code" href="transport_8c.html#a15">tport_create</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <span class="keywordtype">long</span>, <span class="keywordtype">long</span> );
00138 <span class="keywordtype">void</span>  <a class="code" href="transport_8c.html#a16">tport_destroy</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> * );
00139 <span class="keywordtype">void</span>  <a class="code" href="transport_8c.html#a17">tport_attach</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <span class="keywordtype">long</span> );
00140 <span class="keywordtype">void</span>  <a class="code" href="transport_8c.html#a18">tport_detach</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> * );
00141 <span class="keywordtype">int</span>   <a class="code" href="transport_8c.html#a19">tport_putmsg</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a> *, <span class="keywordtype">long</span>, <span class="keywordtype">char</span> * );
00142 <span class="keywordtype">int</span>   <a class="code" href="transport_8c.html#a20">tport_getmsg</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a> *, <span class="keywordtype">short</span>, <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a> *,
00143                     <span class="keywordtype">long</span> *, <span class="keywordtype">char</span> *, <span class="keywordtype">long</span> );
00144 <span class="keywordtype">void</span>  <a class="code" href="transport_8c.html#a21">tport_putflag</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <span class="keywordtype">int</span> );  
00145 <span class="keywordtype">int</span>   <a class="code" href="transport_8c.html#a22">tport_getflag</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> * );
00146 <span class="keywordtype">int</span>   <a class="code" href="transport_8c.html#a24">tport_buffer</a>  ( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a> *, <span class="keywordtype">short</span>, <span class="keywordtype">unsigned</span>,
00147                       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> );
00148 <span class="keywordtype">int</span>   <a class="code" href="transport_8c.html#a26">tport_copyto</a>  ( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a> *, <span class="keywordtype">long</span>, <span class="keywordtype">char</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> );
00149 <span class="keywordtype">int</span>   <a class="code" href="transport_8c.html#a25">tport_copyfrom</a>( <a class="code" href="structSHM__INFO.html">SHM_INFO</a> *, <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a> *, <span class="keywordtype">short</span>, <a class="code" href="structMSG__LOGO.html">MSG_LOGO</a> *,
00150                       <span class="keywordtype">long</span> *, <span class="keywordtype">char</span> *, <span class="keywordtype">long</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * );
00151 
00152 <span class="comment">/* SOLARIS ONLY: */</span>
00153 <span class="comment">/* This union definition is in sys/sem.h in SunOS, but not in Solaris */</span>
00154 <span class="comment">/* It's an argument template for semctl system calls on semaphores    */</span>
00155 <span class="preprocessor">#ifdef _SOLARIS</span>
00156 <span class="preprocessor"></span><span class="keyword">union </span>semun
00157 {
00158         <span class="keywordtype">int</span>              val;   <span class="comment">/* value for SETVAL */</span>
00159         <span class="keyword">struct </span>semid_ds *buf;   <span class="comment">/* buffer for IPC_STAT &amp; IPC_SET */</span>
00160         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>  *array; <span class="comment">/* array for GETALL &amp; SETALL */</span>
00161 };
00162 <span class="preprocessor">#endif</span>
00163 <span class="preprocessor"></span>
00164 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:12 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
