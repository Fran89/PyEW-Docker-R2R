<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>glevt_2_ewevent.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>glevt_2_ewevent.c</h1><a href="glevt__2__ewevent_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *   THIS FILE IS UNDER RCS - DO NOT MODIFY UNLESS YOU HAVE</span>
00003 <span class="comment"> *   CHECKED IT OUT USING THE COMMAND CHECKOUT.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> *    $Id: glevt__2__ewevent_8c-source.html 2161 2006-05-19 16:55:03Z paulf $</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> *    Revision history:</span>
00008 <span class="comment"> *     $Log$
00008 <span class="comment"> *     Revision 1.1  2006/05/19 16:55:02  paulf
00008 <span class="comment"> *     first inclusion
00008 <span class="comment"> *</span>
00009 <span class="comment"> *     Revision 1.3  2002/07/16 20:03:20  davidk</span>
00010 <span class="comment"> *     removed //comments</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *     Revision 1.2  2002/07/16 19:48:12  davidk</span>
00013 <span class="comment"> *     Changed the code that parses the global event message, so</span>
00014 <span class="comment"> *     that it reads the message one line at a time, instead of a fixed</span>
00015 <span class="comment"> *     number of bytes (supposing a line) at a time.</span>
00016 <span class="comment"> *     By reading exactly 96 bytes for the first line, the code bombed</span>
00017 <span class="comment"> *     when reading the message as a text file on NT because of the</span>
00018 <span class="comment"> *     0x0d 0x0a (CR LF) 2 character EOL sequence.  The 2 char sequence</span>
00019 <span class="comment"> *     caused there to be 1 extra char on each line, and thus the parser</span>
00020 <span class="comment"> *     was off by 1 extra char(byte) each line.</span>
00021 <span class="comment"> *     The new code extracts one line per time from the message, no matter</span>
00022 <span class="comment"> *     the line's length, but then uses the same sscanf() parsing code</span>
00023 <span class="comment"> *     as before.</span>
00024 <span class="comment"> *</span>
00025 <span class="comment"> *     Revision 1.1  2002/06/28 21:06:22  lucky</span>
00026 <span class="comment"> *     Initial revision</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> *</span>
00029 <span class="comment"> *</span>
00030 <span class="comment"> */</span>
00031 
00032 
00033 <span class="comment">/*</span>
00034 <span class="comment"> * glevt_2_ewevent.c :  Routines to produce and parse global solution</span>
00035 <span class="comment"> *   messages of type TYPE_EVENTGLOBAL</span>
00036 <span class="comment"> *</span>
00037 <span class="comment"> *</span>
00038 <span class="comment"> */</span>
00039 
00040 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00041 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00042 <span class="preprocessor">#include &lt;string.h&gt;</span>
00043 <span class="preprocessor">#include &lt;time.h&gt;</span>
00044 <span class="preprocessor">#include &lt;math.h&gt;</span>
00045 <span class="preprocessor">#include &lt;<a class="code" href="chron3_8h.html">chron3.h</a>&gt;</span>
00046 <span class="preprocessor">#include &lt;<a class="code" href="earthworm_8h.html">earthworm.h</a>&gt;</span>
00047 <span class="preprocessor">#include &lt;<a class="code" href="rw__glevt_8h.html">rw_glevt.h</a>&gt;</span>
00048 
00049 <span class="comment">/******************************************************************************</span>
00050 <span class="comment"> GlEvt2EWEvent() fills EWEvent structure from a string in GlobalEvent format </span>
00051 <span class="comment">******************************************************************************/</span>
<a name="l00052"></a><a class="code" href="glevt__2__ewevent_8c.html#a0">00052</a> <span class="keywordtype">int</span>     <a class="code" href="glevt__2__ewevent_8c.html#a0">GlEvt2EWEvent</a> (EWEventInfoStruct *pEWEvent, <span class="keywordtype">char</span> *pGlEvt, <span class="keywordtype">int</span> GlEvtLen)
00053 {
00054 
00055         <span class="keywordtype">char</span>            line[256];
00056         <span class="keywordtype">char</span>            *tmpstr;
00057         <span class="keywordtype">int</span>                     i;
00058         <a class="code" href="structGlarc__sum__struct.html">GlarcSum</a>        Sum;
00059         <a class="code" href="structGlarc__pck__struct.html">GlarcPhase</a>      <a class="code" href="struct__PhaseStruct.html">Phase</a>;
00060   <span class="keywordtype">char</span>    *pCurrLine, *pEOL;
00061   <span class="keywordtype">int</span>     iLineNum=1;
00062   <span class="keywordtype">int</span>     iLineSize;
00063 
00064 
00065 
00066 
00067         <span class="keywordflow">if</span> ((pEWEvent == NULL) || (pGlEvt == NULL) || (GlEvtLen &lt;= 0))
00068         {
00069                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid arguments passed in.\n"</span>);
00070                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00071         }
00072 
00073 
00074   <span class="comment">/* set iLineSize for later user */</span>
00075   iLineSize = <span class="keyword">sizeof</span>(line);
00076 
00077         <span class="comment">/* First read the summary line */</span>
00078   
00079   pCurrLine = pGlEvt;
00080   pEOL = strchr(pCurrLine,<span class="charliteral">'\n'</span>);
00081   <span class="keywordflow">if</span>(!pEOL)
00082   {
00083     <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"Error reading line %d from global event message\n"</span>,iLineNum);
00084     <span class="keywordflow">return</span>(EW_FAILURE);
00085   }
00086   *pEOL = (char)NULL;
00087   strncpy(line,pCurrLine,iLineSize);
00088   pCurrLine = pEOL + 1;
00089   iLineNum++;
00090 
00091 <span class="comment">/*      strncpy (line, pGlEvt, 78);</span>
00092 <span class="comment">        line[78] = '\0';</span>
00093 <span class="comment">*/</span>
00094         <span class="keywordflow">if</span> (<a class="code" href="glevt__2__ewevent_8c.html#a1">read_glevt_sumcard</a> (&amp;Sum, line) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00095         {
00096                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to read_glevt_sumcard failed.\n"</span>);
00097                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00098         }
00099 
00100         <span class="comment">/* Initialize the Event structure */</span>
00101         <span class="keywordflow">if</span> (<a class="code" href="init__ewevent_8c.html#a0">InitEWEvent</a> (pEWEvent) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00102         {
00103                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to InitEWEvent failed.\n"</span>);
00104                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00105         }
00106 
00107 
00108         <span class="comment">/* </span>
00109 <span class="comment">         * Set magnitude values to 0 as we don't have any info on it here</span>
00110 <span class="comment">         */</span>
00111         pEWEvent-&gt;iNumMags = 0;
00112         pEWEvent-&gt;iPrefMag = -1;
00113         pEWEvent-&gt;iMd = -1;
00114         pEWEvent-&gt;iML = -1;
00115 
00116         pEWEvent-&gt;iNumChans = Sum.<a class="code" href="structGlarc__sum__struct.html#m5">nph</a>;
00117         pEWEvent-&gt;Event.idEvent = Sum.<a class="code" href="structGlarc__sum__struct.html#m0">qid</a>;
00118         pEWEvent-&gt;PrefOrigin.tOrigin = Sum.<a class="code" href="structGlarc__sum__struct.html#m1">ot</a>;
00119         pEWEvent-&gt;PrefOrigin.dLat = Sum.<a class="code" href="structGlarc__sum__struct.html#m2">lat</a>;
00120         pEWEvent-&gt;PrefOrigin.dLon = Sum.<a class="code" href="structGlarc__sum__struct.html#m3">lon</a>;
00121         pEWEvent-&gt;PrefOrigin.dDepth = Sum.<a class="code" href="structGlarc__sum__struct.html#m4">z</a>;
00122         pEWEvent-&gt;PrefOrigin.dRms = Sum.<a class="code" href="structGlarc__sum__struct.html#m8">rms</a>;
00123         pEWEvent-&gt;PrefOrigin.dDmin = (float) Sum.<a class="code" href="structGlarc__sum__struct.html#m7">dmin</a>;
00124         pEWEvent-&gt;PrefOrigin.iGap = Sum.<a class="code" href="structGlarc__sum__struct.html#m6">gap</a>;
00125 
00126         pEWEvent-&gt;PrefOrigin.iAssocRd = Sum.<a class="code" href="structGlarc__sum__struct.html#m5">nph</a>;
00127         pEWEvent-&gt;PrefOrigin.iAssocPh = Sum.<a class="code" href="structGlarc__sum__struct.html#m5">nph</a>;
00128         pEWEvent-&gt;PrefOrigin.iUsedRd = Sum.<a class="code" href="structGlarc__sum__struct.html#m5">nph</a>;
00129         pEWEvent-&gt;PrefOrigin.iUsedPh = Sum.<a class="code" href="structGlarc__sum__struct.html#m5">nph</a>;
00130 
00131         pEWEvent-&gt;PrefOrigin.BindToEvent = <a class="code" href="earthworm__defs_8h.html#a8">TRUE</a>;
00132         pEWEvent-&gt;PrefOrigin.SetPreferred = <a class="code" href="earthworm__defs_8h.html#a8">TRUE</a>;
00133 
00134 
00135         <span class="keywordflow">if</span> (pEWEvent-&gt;iNumChans &gt; pEWEvent-&gt;iNumAllocChans)
00136         {
00137                 free (pEWEvent-&gt;pChanInfo);
00138 
00139                 <span class="keywordflow">if</span> ((pEWEvent-&gt;pChanInfo = (EWChannelDataStruct *) malloc 
00140                                                 (pEWEvent-&gt;iNumChans * <span class="keyword">sizeof</span> (EWChannelDataStruct))) == NULL)
00141                 {
00142                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Could not malloc %d channel info structs\n"</span>, pEWEvent-&gt;iNumChans);
00143                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00144                 }
00145 
00146                 pEWEvent-&gt;iNumAllocChans = pEWEvent-&gt;iNumChans;
00147 
00148                 <span class="keywordflow">for</span> (i = 0; i &lt; pEWEvent-&gt;iNumAllocChans; i++)
00149                 {
00150                         <a class="code" href="init__ewevent_8c.html#a1">InitEWChan</a>(&amp;pEWEvent-&gt;pChanInfo[i]);
00151                 }
00152         }
00153 
00154 
00155         <span class="keywordflow">for</span> (i = 0; i &lt; pEWEvent-&gt;iNumChans; i++)
00156         {
00157 
00158     pEOL = strchr(pCurrLine,<span class="charliteral">'\n'</span>);
00159     <span class="keywordflow">if</span>(!pEOL)
00160     {
00161       <a class="code" href="logit_8c.html#a18">logit</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"Error reading line %d from global event message\n"</span>,iLineNum);
00162       <span class="keywordflow">return</span>(EW_FAILURE);
00163     }
00164     *pEOL = (char)NULL;
00165     strncpy(line,pCurrLine,iLineSize);
00166     pCurrLine = pEOL + 1;
00167     iLineNum++;
00168 
00169 
00170     
00171     
00172                 <span class="keywordflow">if</span> (<a class="code" href="glevt__2__ewevent_8c.html#a2">read_glevt_phasecard</a> (&amp;Phase, line) != <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>)
00173                 {
00174                         <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Call to read_glevt_phasecard failed.\n"</span>);
00175                         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00176                 }
00177 
00178                 strcpy (pEWEvent-&gt;pChanInfo[i].Station.Sta, <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.<a class="code" href="struct__PhaseStruct.html#m0">sta</a>);
00179                 strcpy (pEWEvent-&gt;pChanInfo[i].Station.Comp, <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.comp);
00180                 strcpy (pEWEvent-&gt;pChanInfo[i].Station.Net, <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.net);
00181 
00182     <span class="comment">/* the location should be null, not a single &lt;SPACE&gt; DK 071002 */</span>
00183                 strcpy (pEWEvent-&gt;pChanInfo[i].Station.Loc, <span class="stringliteral">""</span>);
00184 
00185 
00186                 <span class="comment">/* Arrival pick info */</span>
00187                 pEWEvent-&gt;pChanInfo[i].iNumArrivals = 1;
00188                 pEWEvent-&gt;pChanInfo[i].Arrivals[0].cMotion  = <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.fm;
00189 
00190                 <span class="keywordflow">if</span> (<a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.wt == 3)
00191                         pEWEvent-&gt;pChanInfo[i].Arrivals[0].dSigma  = 0.08;
00192                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.wt == 2)
00193                         pEWEvent-&gt;pChanInfo[i].Arrivals[0].dSigma  = 0.05;
00194                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.wt == 1)
00195                         pEWEvent-&gt;pChanInfo[i].Arrivals[0].dSigma  = 0.03;
00196                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.wt == 0)
00197                         pEWEvent-&gt;pChanInfo[i].Arrivals[0].dSigma  = 0.02;
00198                 <span class="keywordflow">else</span> 
00199                         pEWEvent-&gt;pChanInfo[i].Arrivals[0].dSigma  = 99.99;
00200 
00201 
00202                 pEWEvent-&gt;pChanInfo[i].Arrivals[0].tCalcPhase  = <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.at;
00203                 strcpy (pEWEvent-&gt;pChanInfo[i].Arrivals[0].szCalcPhase, <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.<a class="code" href="struct__PhaseStruct.html#m1">phase</a>);
00204                 pEWEvent-&gt;pChanInfo[i].Arrivals[0].tObsPhase  = <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.at;
00205                 strcpy (pEWEvent-&gt;pChanInfo[i].Arrivals[0].szObsPhase, <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.<a class="code" href="struct__PhaseStruct.html#m1">phase</a>);
00206                 strcpy (pEWEvent-&gt;pChanInfo[i].Arrivals[0].szExtSource, <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.pickAuthor);
00207                 strcpy (pEWEvent-&gt;pChanInfo[i].Arrivals[0].szExternalPickID, <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.ExtPickID);
00208 
00209 
00210                 <span class="comment">/* Amplitude information */</span>
00211                 pEWEvent-&gt;pChanInfo[i].iNumStaMags = 1;
00212                 pEWEvent-&gt;pChanInfo[i].Stamags[0].StaMagUnion.PeakAmp.dAmp1 = (float) <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.pAmp;
00213                 pEWEvent-&gt;pChanInfo[i].Stamags[0].StaMagUnion.PeakAmp.tAmp1 = <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.ampTime;
00214                 pEWEvent-&gt;pChanInfo[i].Stamags[0].StaMagUnion.PeakAmp.dAmpPeriod1 = (float) <a class="code" href="parse__usnsn_8h.html#a44">Phase</a>.period;
00215 
00216                 pEWEvent-&gt;pChanInfo[i].Stamags[0].StaMagUnion.PeakAmp.dAmp2 = (float) <a class="code" href="earthworm__defs_8h.html#a27">MAG_NULL</a>;
00217                 pEWEvent-&gt;pChanInfo[i].Stamags[0].StaMagUnion.PeakAmp.tAmp2 = (float) <a class="code" href="earthworm__defs_8h.html#a27">MAG_NULL</a>;
00218                 pEWEvent-&gt;pChanInfo[i].Stamags[0].StaMagUnion.PeakAmp.dAmpPeriod2 = (float) <a class="code" href="earthworm__defs_8h.html#a27">MAG_NULL</a>;
00219 
00220 
00221                 tmpstr = tmpstr + 97;
00222         }
00223 
00224         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00225 }
00226 
00227 
00228 
00229 <span class="comment">/*********************************************************************************/</span>
00230 <span class="comment">/* read_glevt_sumcard() reads the first line of a global arc message             */</span>
00231 <span class="comment">/*                               Fills information in the GlarcSum structure                     */</span>
00232 <span class="comment">/*********************************************************************************/</span>
<a name="l00233"></a><a class="code" href="glevt__2__ewevent_8c.html#a1">00233</a> <span class="keywordtype">int</span>     <a class="code" href="glevt__2__ewevent_8c.html#a1">read_glevt_sumcard</a> (<a class="code" href="structGlarc__sum__struct.html">GlarcSum</a> *pSum, <span class="keywordtype">char</span> *sumcard )
00234 {
00235         <span class="keywordtype">char</span>    otime[16], <a class="code" href="geo__to__km_8c.html#a4">lat</a>[16], <a class="code" href="geo__to__km_8c.html#a5">lon</a>[16], depth[16], version[16]; 
00236         <span class="keywordtype">char</span>    nph[16], gap[16], dmin[16], rms[16], evtid[16];
00237         <span class="keywordtype">int</span>             narg;
00238 
00239         <span class="keywordflow">if</span> ((pSum == NULL) || (sumcard == NULL))
00240         {
00241                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid arguments passed in.\n"</span>);
00242                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00243         }
00244 
00245         <span class="comment">/* Here is what it should look like:</span>
00246 <span class="comment"></span>
00247 <span class="comment">                20020603191112.39  52.4299 -120.0782  399.32   9    0     0  3.18       1139 1</span>
00248 <span class="comment">                20020430185616.12 -12.1426 -112.8750  200.00  14    0     0  1.39         14 1</span>
00249 <span class="comment">                01234567890123456789012345678901234567890123456789012345678901234567890123456789</span>
00250 <span class="comment">        */</span>
00251 
00252         narg =  sscanf (sumcard, <span class="stringliteral">"%s %s %s %s %s %s %s %s %s %s"</span>,
00253                                                 otime, lat, lon, depth,  nph, 
00254                                                 gap, dmin, rms, evtid, version);
00255 
00256         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m5">nph</a> = atoi (nph);
00257         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m0">qid</a> = atoi (evtid);
00258         <a class="code" href="chron3_8c.html#a11">epochsec17</a> (&amp;pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m1">ot</a>, otime);
00259         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m2">lat</a> = (float) atof (lat);
00260         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m3">lon</a> = (float) atof (lon);
00261         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m4">z</a> = (float) atof (depth);
00262         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m8">rms</a> = (float) atof (rms);
00263         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m7">dmin</a> = atoi (dmin);
00264         pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m6">gap</a> = atoi (gap);
00265 
00266         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00267 }
00268 
00269 
00270 <span class="comment">/*********************************************************************************/</span>
00271 <span class="comment">/* read_glevt_phasecard() reads the phase lines of a global arc message          */</span>
00272 <span class="comment">/*                               Fills information in the GlarcPhase structure                   */</span>
00273 <span class="comment">/*********************************************************************************/</span>
<a name="l00274"></a><a class="code" href="glevt__2__ewevent_8c.html#a2">00274</a> <span class="keywordtype">int</span>     <a class="code" href="glevt__2__ewevent_8c.html#a2">read_glevt_phasecard</a> (<a class="code" href="structGlarc__pck__struct.html">GlarcPhase</a> *pPhase, <span class="keywordtype">char</span> *phasecard )
00275 {
00276         <span class="keywordtype">char</span>    atime[32], sta[16], comp[16], net[16], fmwt[16], label[16]; 
00277         <span class="keywordtype">char</span>    amp[16], period[16], amptime[32], author[32], pickID[32];
00278         <span class="keywordtype">int</span>             narg;
00279 
00280         <span class="keywordflow">if</span> ((pPhase == NULL) || (phasecard == NULL))
00281         {
00282                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid arguments passed in.\n"</span>);
00283                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00284         }
00285 
00286 
00287         <span class="comment">/* Here is what it should look like:</span>
00288 <span class="comment"></span>
00289 <span class="comment">                CMN  VHZ NC U1 xxxxxxxxxP 19950831183134.90      275   0.2 20020531195801.29\n</span>
00290 <span class="comment">                CMN  VHZ NC U1 xxxxxxxxxP 19950831183134.90 xxxxauthor ExtPckID      275   0.2 20020531195801.29\n</span>
00291 <span class="comment">                012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678</span>
00292 <span class="comment">        */</span>
00293 
00294 
00295         narg =  sscanf (phasecard, <span class="stringliteral">"%s %s %s %s %s %s %s %s %s %s %s %s"</span>,
00296                                                 sta, comp, net, fmwt, label, atime, author, pickID, amp, period, amptime);
00297 
00298 
00299         strcpy (pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m0">sta</a>, sta); 
00300         strcpy (pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m2">comp</a>, comp); 
00301         strcpy (pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m1">net</a>, net); 
00302         strcpy (pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m3">phase</a>, label); 
00303         strcpy (pPhase-&gt;pickAuthor, author); 
00304         strcpy (pPhase-&gt;ExtPickID, pickID); 
00305         <a class="code" href="chron3_8c.html#a11">epochsec17</a> (&amp;pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m4">at</a>, atime);
00306 
00307         <a class="code" href="chron3_8c.html#a11">epochsec17</a> (&amp;pPhase-&gt;ampTime, amptime);
00308         pPhase-&gt;pAmp = (long) atoi (amp);
00309         pPhase-&gt;period = atof (period);
00310 
00311         <span class="keywordflow">if</span> (strlen (fmwt) == 2)
00312         {
00313                 pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m5">fm</a> = fmwt[0]; 
00314                 pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m6">wt</a> = fmwt[1] - <span class="charliteral">'0'</span>; 
00315         }
00316         <span class="keywordflow">else</span>
00317         {
00318                 pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m5">fm</a> = <span class="charliteral">' '</span>;
00319                 pPhase-&gt;<a class="code" href="structGlarc__pck__struct.html#m6">wt</a> = fmwt[0] - <span class="charliteral">'0'</span>; 
00320         }
00321 
00322         <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a5">EW_SUCCESS</a>;
00323 }
00324 
00325 
00326 
00327 
00328 <span class="comment">/*******************************************************************************************/</span>
00329 <span class="comment">/* write_glevt_phasecard() builds a character-string phase-card from GlarcPhase structure  */</span>
00330 <span class="comment">/*******************************************************************************************/</span>
<a name="l00331"></a><a class="code" href="glevt__2__ewevent_8c.html#a3">00331</a> <span class="keywordtype">int</span>     <a class="code" href="glevt__2__ewevent_8c.html#a3">write_glevt_phasecard</a> (<a class="code" href="structGlarc__pck__struct.html">GlarcPhase</a> *pPhs, <span class="keywordtype">char</span> *phscard )
00332 {
00333         <span class="keywordtype">char</span>   line[120];
00334         <span class="keywordtype">char</span>   timestr[18];
00335         <span class="keywordtype">char</span>   timestr2[18];
00336 
00337         <span class="keywordflow">if</span> ((pPhs == NULL) || (phscard == NULL))
00338         {
00339                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid arguments passed in.\n"</span>);
00340                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00341         }
00342 
00343 <span class="comment">/*----------------------------------------------------------------------</span>
00344 <span class="comment">Sample format phase card </span>
00345 <span class="comment">CMN  VHZ NC U1 xxxxxxxxxP 19950831183134.90      275   0.2 20020531195801.29\n</span>
00346 <span class="comment">CMN  VHZ NC U1 xxxxxxxxxP 19950831183134.90 xxxxauthor ExtPckID      275   0.2 20020531195801.29\n</span>
00347 <span class="comment">0123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789</span>
00348 <span class="comment"></span>
00349 <span class="comment">-------------------------------------------------------------------------*/</span>
00350 
00351 <span class="comment">/***  Convert julian seconds character string  ***/</span>
00352                 <a class="code" href="chron3_8c.html#a9">date17</a>( pPhs-&gt;<a class="code" href="structGlarc__pck__struct.html#m4">at</a>, timestr );
00353 
00354                 <span class="keywordflow">if</span> (pPhs-&gt;ampTime &lt;= 0)
00355                         strcpy (timestr2, <span class="stringliteral">"            -1.00"</span>);
00356                 <span class="keywordflow">else</span>
00357                         <a class="code" href="chron3_8c.html#a9">date17</a>( pPhs-&gt;ampTime, timestr2 );
00358 
00359 
00360 <span class="comment">/***  Write all info to an global phase card  ***/</span>
00361                 sprintf( line,     <span class="stringliteral">"%-5s "</span>,      pPhs-&gt;<a class="code" href="structGlarc__pck__struct.html#m0">sta</a>);
00362                 sprintf( line+5,   <span class="stringliteral">"%3s "</span>,       pPhs-&gt;<a class="code" href="structGlarc__pck__struct.html#m2">comp</a>);
00363                 sprintf( line+9,   <span class="stringliteral">"%2s "</span>,       pPhs-&gt;<a class="code" href="structGlarc__pck__struct.html#m1">net</a>);
00364                 sprintf( line+12,  <span class="stringliteral">"%c"</span>,         pPhs-&gt;<a class="code" href="structGlarc__pck__struct.html#m5">fm</a>);
00365                 sprintf( line+13,  <span class="stringliteral">"%c "</span>,        pPhs-&gt;<a class="code" href="structGlarc__pck__struct.html#m6">wt</a>);
00366                 sprintf( line+15,  <span class="stringliteral">"%10s "</span>,      pPhs-&gt;<a class="code" href="structGlarc__pck__struct.html#m3">phase</a>);
00367                 sprintf( line+26,  <span class="stringliteral">"%17s "</span>,      timestr);
00368                 sprintf( line+44,  <span class="stringliteral">"%10s "</span>,  pPhs-&gt;pickAuthor);
00369                 sprintf( line+55,  <span class="stringliteral">"%8s "</span>,   pPhs-&gt;ExtPickID);
00370                 sprintf( line+64,  <span class="stringliteral">"%8d "</span>,       pPhs-&gt;pAmp);
00371                 sprintf( line+73,  <span class="stringliteral">"%5.1f "</span>, pPhs-&gt;period);
00372                 sprintf( line+79,  <span class="stringliteral">"%17s\n\0"</span>,   timestr2);
00373 
00374                 strcpy( phscard, line );
00375                 <span class="keywordflow">return</span> (EW_SUCCESS);
00376 }
00377 
00378 <span class="comment">/*********************************************************************************/</span>
00379 <span class="comment">/* write_glevt_sumcard() builds a summary card for global arc message            */</span>
00380 <span class="comment">/*                               from the RPT_HYP structure                                                                      */</span>
00381 <span class="comment">/*********************************************************************************/</span>
<a name="l00382"></a><a class="code" href="glevt__2__ewevent_8c.html#a4">00382</a> <span class="keywordtype">int</span>     <a class="code" href="glevt__2__ewevent_8c.html#a4">write_glevt_sumcard</a> (<a class="code" href="structGlarc__sum__struct.html">GlarcSum</a> *pSum, <span class="keywordtype">char</span> *sumcard )
00383 {
00384                 <span class="keywordtype">char</span>   line[109];
00385                 <span class="keywordtype">char</span>   timestr[18];
00386 
00387         <span class="keywordflow">if</span> ((pSum == NULL) || (sumcard == NULL))
00388         {
00389                 <a class="code" href="logit_8c.html#a18">logit</a> (<span class="stringliteral">""</span>, <span class="stringliteral">"Invalid arguments passed in.\n"</span>);
00390                 <span class="keywordflow">return</span> <a class="code" href="earthworm__defs_8h.html#a6">EW_FAILURE</a>;
00391         }
00392 
00393 <span class="comment">/*----------------------------------------------------------------------------------------</span>
00394 <span class="comment">Proposed Global hypocenter built below. Base format is Hypo71; event id from Glass</span>
00395 <span class="comment">  (78 chars, including newline):</span>
00396 <span class="comment">0123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 </span>
00397 <span class="comment">20020501181423.40  54.4589 -108.6209  100.00  11    0     0  7.03         36 1</span>
00398 <span class="comment">20020430185616.12 -12.1426 -112.8750  200.00  14    0     0  1.39         14 1</span>
00399 <span class="comment">------------------------------------------------------------------------------------------*/</span>
00400 
00401 <span class="comment">/***  Convert julian seconds character string  ***/</span>
00402                 <a class="code" href="chron3_8c.html#a9">date17</a>( pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m1">ot</a>, timestr );
00403 
00404 <span class="comment">/***  Write all info to an Earthworm hypocenter card  ***/</span>
00405                 sprintf( line,    <span class="stringliteral">"%17s "</span>,       timestr          );
00406                 sprintf( line+18, <span class="stringliteral">"%8.4f "</span>,      pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m2">lat</a>        );
00407                 sprintf( line+27, <span class="stringliteral">"%9.4f "</span>,      pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m3">lon</a>        );
00408                 sprintf( line+37, <span class="stringliteral">"%7.2f "</span>,      pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m4">z</a>          );
00409                 sprintf( line+45, <span class="stringliteral">"%3d "</span>,        pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m5">nph</a>  );
00410                 sprintf( line+49, <span class="stringliteral">"%4.0f "</span>,      pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m6">gap</a>  );
00411                 sprintf( line+54, <span class="stringliteral">"%5.0f "</span>,      pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m7">dmin</a> );
00412                 sprintf( line+60, <span class="stringliteral">"%5.2f "</span>,      pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m8">rms</a>  );
00413                 sprintf( line+66, <span class="stringliteral">"%10ld "</span>,      pSum-&gt;<a class="code" href="structGlarc__sum__struct.html#m0">qid</a>   );
00414                 sprintf( line+77, <span class="stringliteral">"1\n\0"</span>);
00415 
00416                 strcpy( sumcard, line );
00417 
00418                 <span class="keywordflow">return</span> (EW_SUCCESS);
00419 }
00420 
00421 
00422 
</pre></div><hr><address style="align: right;"><small>Generated on Tue May 6 09:16:02 2003 for Earthworm Libs by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
