<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      q3302ew â€“ Earthworm
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://earthwormcentral.com/trac/ew/search" />
        <link rel="help" href="TracGuide.html" />
        <link rel="alternate" href="http://earthwormcentral.com/trac/ew/wiki/q3302ew?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="http://earthwormcentral.com/trac/ew/wiki" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/jsgantt.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/tracjsgantt.css" type="text/css" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://earthwormcentral.com/trac/ew/search/opensearch" title="Search Earthworm" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/tracjsgantt/jsgantt.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/ew/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://earthwormcentral.com/trac/ew"><img src="../chrome/site/images/ew.logo_tiny.png" alt="" /></a>
      </div>
      <form id="search" action="http://earthwormcentral.com/trac/ew/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://earthwormcentral.com/trac/ew/login">Login</a></li><li><a href="TracGuide.html">Help/Guide</a></li><li><a href="http://earthwormcentral.com/trac/ew/about">About Trac</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://earthwormcentral.com/trac/ew/wiki">Wiki</a></li><li><a href="http://earthwormcentral.com/trac/ew/timeline">Timeline</a></li><li><a href="http://earthwormcentral.com/trac/ew/roadmap">Roadmap</a></li><li><a href="http://earthwormcentral.com/trac/ew/browser">Browse Source</a></li><li><a href="http://earthwormcentral.com/trac/ew/query">View Tickets</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="http://earthwormcentral.com/trac/ew/wiki">wiki:</a><a class="pathentry" href="q3302ew.html" title="View q3302ew">q3302ew</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="WikiStart.html">Start Page</a></li><li><a href="TitleIndex.html">Index</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/wiki/q3302ew?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby">
            <span><a href="http://earthwormcentral.com/trac/ew/wiki/q3302ew?action=diff&amp;version=2" title="Version 2 by branden">Last modified</a> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2012-04-08T17%3A38%3A48-07%3A00&amp;precision=second" title="2012-04-08T17:38:48-07:00 in Timeline">17 months</a> ago</span>
            <span class="trac-print">Last modified on 04/08/12 17:38:48</span>
          </div>
          <div id="wikipage"><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="q3302ew.html#EarthwormModule:q3302ew">Earthworm Module: q3302ew</a>
    <ol>
      <li>
        <a href="q3302ew.html#Function">Function</a>
      </li>
      <li>
        <a href="q3302ew.html#Details">Details</a>
      </li>
      <li>
        <a href="q3302ew.html#ConfigurationFileCommands">Configuration File Commands</a>
        <ol>
          <li>
            <a href="q3302ew.html#ExampleConfigurationFile">Example Configuration File</a>
          </li>
          <li>
            <a href="q3302ew.html#FunctionalCommandListing">Functional Command Listing</a>
          </li>
          <li>
            <a href="q3302ew.html#AlphabeticalCommandListingDescription">Alphabetical Command Listing &amp; Description</a>
          </li>
          <li>
            <a href="q3302ew.html#DescriptorFileExample">Descriptor File Example</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="q3302ew.html#HelpfulHints">Helpful Hints</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="EarthwormModule:q3302ew"><a class="wiki" href="Earthworm.html">Earthworm</a> Module: q3302ew</h1>
<p>
<strong>Contributed by: ISTI</strong>
</p>
<h2 id="Function">Function</h2>
<p>
A Quanterra Q330 data feeding program, rewritten by ISTI using Lib330 from Quanterra (not MountainAir).
</p>
<h2 id="Details">Details</h2>
<p>
q3302ew is a standard Earthworm module with heartbeats and status messages for when problems arrise. The communications with the Q330 is via UDP datagram's and thus any ports used in the configuration file, must  be openned for UDP traffic on the server on which it is run. This module will work under Solaris, Linux, and Windows.
</p>
<h2 id="ConfigurationFileCommands">Configuration File Commands</h2>
<p>
On startup, q3302ew reads the configuration file named on the command line. As always, the configuraton file contains comments:
</p>
<pre class="wiki">#  marks the line as a comment (example: # This is a comment).
</pre><p>
Command names must be typed in the control file exactly as shown in this document (upper/lower case matters!). 
</p>
<h3 id="ExampleConfigurationFile">Example Configuration File</h3>
<pre class="wiki">#
# q3302ew configuration file
#

## The following items are typical Earthworm items

 ModuleId       MOD_Q3302EW     # module id for this module.  Make sure to
				# add this to earthworm.h if it is not already
				# there

 RingName       WAVE_RING       # transport ring to use for input/output,

 HeartbeatInt   10              # Heartbeat interval in seconds
                  
 LogFile        1               # If 0, don't write logfile;; if 1, do
                                # if 2, log to module log but not stderr/stdout

## The following items tell us how to talk to the Q330

IPAddress		192.168.1.166		# The Q330 IP address
BasePort		5330			# The Q330 base port
DataPort		1			# Which Q330 dataport to use
SerialNumber		0x010000069a412636	# The serial number of the Q330
AuthCode		0x0			# The Q330 auth code

## The following items may help traversing some firewalls

SourcePortControl	9999	# UDP port to use as a source, when talking to
				# the Q330's control port

SourcePortData		9998	# UDP port to use as a source when talking to
				# the Q330's data port


## The following items help control the log verbosity

LogLevel	sd, rm, vb, sm 	# Comma seperated list of: 
				# sd - Logs Q330 status on connect
				# cr - Logs command retries
				# rm - Pings and sends a user message
				#      to Q330 on connect/disconnect
				# vb - Logs messages for items like
				#      filter delays
				# sm - Logs 800 series messages
				# pd - Logs all packets sent/received

StatusInterval  240		# time in seconds between status updates


## The following items offer some control over connections

FailedRegistrationsBeforeSleep  5	# How many failed connection attempts
					# before we give it a break for a bit
MinutesToSleepBeforeRetry	3	# How long should that break be?


## Some options to control dutycycle
## comment out to disable

#Dutycycle_MaxConnectTime	10	# We'll disconnect after this many 
					# minutes of being connected
#Dutycycle_BufferLevel		10	# Disconnect when the Q330's buffer is
					# this percentage filled.	
#Dutycycle_SleepTime		30	# Wait this many minutes before 
					# connecting again, when we've stopped
					# for either of the above reasons

## Where should we keep our continuity files?
## These will be named: Q3302EW_cont_[dot_d_filename] and have '.bint' 
## and '.binq' extensions.  
ContinuityFileDirectory	/tmp
</pre><h3 id="FunctionalCommandListing">Functional Command Listing</h3>
<p>
Below are the configure commands recognized by q3302ew, grouped by the function they influence. Most of the commands are required, but several are optional.
</p>
<pre class="wiki">Earthworm system setup:
MyModuleId	required
RingName	required
HeartbeatInt	required


Output Control:
LogFile	required
LogLevel	required
StatusInterval	required


Communications setup:
IPAddress	required
BasePort	required
SerialNumber	required
AuthCode	required
SourcePortControl
SourcePortData
FailedRegistrationsBeforeSleep
MinutesToSleepBeforeRetry
Dutycycle_MaxConnectTime
Dutycycle_BufferLevel
Dutycycle_SleepTime


Misc:
ContinuityFileDirectory	 Required
</pre><h3 id="AlphabeticalCommandListingDescription">Alphabetical Command Listing &amp; Description</h3>
<p>
In the following section, all configuration file commands are listed in alphabetical order. Listed along with the command (bold-type) are its arguments (in red), the name of the subroutine that processes the command, and the function within the module that the command influences. A detailed description of the command and is also given. Default values and example commands are listed after each command description.
</p>
<p>
The following list is organized by:
</p>
<p>
command [argument here]
</p>
<p>
<strong>AuthCode [auth]</strong>
</p>
<p>
The authcode is the authorization password to the Q330 if used. If not used, this should be set to the hex value 0x0.
</p>
<pre class="wiki">Default: required field
Example: authcode 0x0
</pre><p>
<strong>BasePort [port]</strong>
</p>
<p>
This is the base UDP port of the Q330 to be accessed (typically 5330).
</p>
<pre class="wiki">baseport 5330
</pre><p>
<strong>ContinuityFileDirectory [path]</strong>
</p>
<p>
This defines where continuity files should be written. This helps the system re-establish data continuity after restarts etc...<br />
These files will be written to the current working directory of the Q3302EW process unless otherwise configured here.
</p>
<pre class="wiki">    Default: the current working directory of the q3302ew process
    Example: ContinuityFileDirectory /tmp
</pre><p>
<strong>IPAddress [dpnum]</strong>
</p>
<p>
This is the Q330 dataport to be accessed. Valid values are 1, 2, 3, 4
</p>
<pre class="wiki">    Default: none, required option
    Example: DataPort 1
</pre><p>
<strong>Dutycycle_BufferLevel [pcnt]</strong>
</p>
<p>
When the Q330's buffer level is down to pcnt percent filled, disconnect and wait for the number of minutes configured in Dutycycle_SleepTime before reconnecting and drawing the buffer back down to pcnt again.
</p>
<p>
Comment out to disable.
</p>
<pre class="wiki">    Default: none
    Example: Dutycycle_BufferLevel 10
</pre><p>
  
<strong>Dutycycle_MaxConnectTime [minutes]</strong>
</p>
<p>
After retrieving data from the Q330 for this many minutes, disconnect and wait the number of minutes configured in Dutycycle_SleepTime before reconnecting for and retrieving data from the Q330 for this many minutes again.
</p>
<p>
Comment out to disable.
</p>
<pre class="wiki">    Default: none
    Example: Dutycycle_MaxConnectTime 10
</pre><p>
<strong>Dutycycle_SleepTime [minutes]</strong>
</p>
<p>
When data acquisition has been stopped as a result of Dutycycle_MaxConnectTime or Dutycycle_BufferLevel, sleep this many minutes before reconnecting again.
</p>
<p>
Comment out to disable.
</p>
<pre class="wiki">    Default: none
    Example: Dutycycle_SleepTime 30
</pre><p>
<strong>FailedRegistrationsBeforeSleep [num]</strong>
</p>
<p>
Defines the number of failed registration attempts that should be made before sleeping for a period of time. After this number of failed attempts, we'll sleep for the number of minutes configured in MinutesToSleepBeforeRetry
</p>
<pre class="wiki">    Default: none, required option
    Example: FailedRegistrationsBeforeSleep 5
</pre><p>
<strong>HeartbeatInt [beat]</strong>
</p>
<p>
This is the heartbeat interval in seconds.
</p>
<p>
<strong>IPAddress [addr]</strong>
</p>
<p>
This is the IP address of the Q330 to be accessed. On most systems, this may be a hostname as well.
</p>
<pre class="wiki">Default:  none, required option
      
IPAddress 192.168.1.100
</pre><p>
<strong>LogFile [switch]</strong>
</p>
<p>
Sets the on-off switch for writing a log file to disk. If switch is 0, no log file will be written. If switch is 1, q3302ew will write a daily log file(s) called q3302ewxx.log_yymmdd where xx is q3302ew's config filename  and yymmdd is the current UTC date (ex: 960123) on the system clock. The file(s) will be written in the EW_LOG directory (environment variable).
</p>
<pre class="wiki">Default:  none
</pre><p>
<strong>LogLevel [lvls]</strong>
</p>
<p>
Configure the level of detail that is added to the LOG channel by Q3302EW. The LOG channel is also decoded and sent to the logging system, so this can be very useful in debugging. "lvls" should be a comma separated list of:
</p>
<ul><li>sd - Logs Q330 status on connect
</li><li>cr - Logs command retries
</li><li>rm - Pings and sends a user message to Q330 on connect/disconnect
</li><li>vb - Logs messages for items like filter delays
</li><li>sm - Logs 800 series messages
</li><li>pd - Logs all packets sent/received
<pre class="wiki">    Default: none, required option
    Example: LogLevel sd, rm, vb, sm
</pre></li></ul><p>
<strong>MinutesToSleepBeforeRetry [num]</strong>
</p>
<p>
After the number of failed registration attempts configured in FailedRegistrationsBeforeSleep, Q3302EW will sleep for this many minutes before trying to connect and register successfully.
</p>
<pre class="wiki">    Default: none, required option
    Example: MinutesToSleepBeforeRetry 3
</pre><p>
<strong>MyModuleId [mod_id]</strong>
</p>
<p>
Sets the module id for labeling all outgoing messages. mod_id is a character string (valid strings are listed in earthworm.d) that relates (in earthworm.d) to a unique single-byte number.
</p>
<pre class="wiki">Default:  none				
Calnet:   MyModuleId MOD_Q2EW
</pre><p>
<strong>RingName [ring]</strong>
</p>
<p>
This is the ring into which the waveforms and messages are sent.
</p>
<pre class="wiki">Default:  none, required option				
Example: RingName WAVE_RING
</pre><p>
<strong>SerialNumber [num]</strong>
</p>
<p>
This is the serial number of the Q330 to be accessed. This is needed for the authentication handshaking. This is a hex value and must be preceeded with an 0x.
</p>
<pre class="wiki">Default: none, required option
Example: 0x010000069A37E501
</pre><p>
<strong>SourcePortControl [port]</strong>
</p>
<p>
This option forces the source port of the control connection to the Q330 to a particular value. This may be useful to negotiate firewalls that restrict outgoing ports. Leaving this option commented out will cause the system to assign an available port, which is the recomended setting.
</p>
<pre class="wiki">    Default: Use system assigned source port (typical)
    Example: SourcePortControl 9999
</pre><p>
<strong>SourcePortData [port]</strong>
</p>
<p>
This option forces the source port of the data connection to the Q330 to a particular value. This may be useful to negotiate firewalls that restrict outgoing ports. Leaving this option commented out will cause the system to assign an available port, which is the recomended setting.
</p>
<pre class="wiki">    Default: Use system assigned source port (typical)
    Example: SourcePortData 9998
</pre><p>
<strong>StatusInterval [secs]</strong>
</p>
<p>
This is the frequency, in seconds, to display status checkpoints in the logfile
</p>
<pre class="wiki">Default: none, this is required 
Example: StatusInterval 120
</pre><h3 id="DescriptorFileExample">Descriptor File Example</h3>
<p>
Here is a copy of the q3302ew.desc file as implemented. 
</p>
<pre class="wiki">modName  q3302ew
modId    MOD_Q3302EW
instId   INST_UNKNOWN

restartMe	# restart 

#
#    Heartbeat Specification.  If the status manager does not receive
#    a heartbeat message every  seconds from this module, an
#    error will be reported (client module dead).   is the maximum
#    number of pager messages that will be reported and  is the
#    maximum number of email messages that will be reported.  If the
#    page or mail limit is exceeded, no further errors will be reported
#    until the status manager is restarted.
#
tsec: 20  page: 0  mail: 99
</pre><h2 id="HelpfulHints">Helpful Hints</h2>
</div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="http://earthwormcentral.com/trac/ew/wiki/q3302ew?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="http://earthwormcentral.com/trac/ew/about"><strong>Trac 0.12.4</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>