<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      rock2ew â€“ Earthworm
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://earthwormcentral.com/trac/ew/search" />
        <link rel="help" href="TracGuide.html" />
        <link rel="alternate" href="http://earthwormcentral.com/trac/ew/wiki/rock2ew?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="http://earthwormcentral.com/trac/ew/wiki" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/jsgantt.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/tracjsgantt.css" type="text/css" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://earthwormcentral.com/trac/ew/search/opensearch" title="Search Earthworm" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/tracjsgantt/jsgantt.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/ew/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://earthwormcentral.com/trac/ew"><img src="../chrome/site/images/ew.logo_tiny.png" alt="" /></a>
      </div>
      <form id="search" action="http://earthwormcentral.com/trac/ew/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://earthwormcentral.com/trac/ew/login">Login</a></li><li><a href="TracGuide.html">Help/Guide</a></li><li><a href="http://earthwormcentral.com/trac/ew/about">About Trac</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://earthwormcentral.com/trac/ew/wiki">Wiki</a></li><li><a href="http://earthwormcentral.com/trac/ew/timeline">Timeline</a></li><li><a href="http://earthwormcentral.com/trac/ew/roadmap">Roadmap</a></li><li><a href="http://earthwormcentral.com/trac/ew/browser">Browse Source</a></li><li><a href="http://earthwormcentral.com/trac/ew/query">View Tickets</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="http://earthwormcentral.com/trac/ew/wiki">wiki:</a><a class="pathentry" href="rock2ew.html" title="View rock2ew">rock2ew</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="WikiStart.html">Start Page</a></li><li><a href="TitleIndex.html">Index</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/wiki/rock2ew?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby">
            <span><a href="http://earthwormcentral.com/trac/ew/wiki/rock2ew?action=diff&amp;version=3" title="Version 3 by branden">Last modified</a> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2012-03-19T18%3A14%3A55-07%3A00&amp;precision=second" title="2012-03-19T18:14:55-07:00 in Timeline">18 months</a> ago</span>
            <span class="trac-print">Last modified on 03/19/12 18:14:55</span>
          </div>
          <div id="wikipage"><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="rock2ew.html#EarthwormModule:rock2ew">Earthworm Module: rock2ew</a>
    <ol>
      <li>
        <a href="rock2ew.html#Function">Function</a>
      </li>
      <li>
        <a href="rock2ew.html#Details">Details</a>
        <ol>
          <li>
            <a href="rock2ew.html#RockhoundtoEarthwormDataRelay">Rockhound to Earthworm Data Relay</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="rock2ew.html#HelpfulHints">Helpful Hints</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="EarthwormModule:rock2ew"><a class="wiki" href="Earthworm.html">Earthworm</a> Module: rock2ew</h1>
<p>
<strong>Contributed by: </strong>
</p>
<h2 id="Function">Function</h2>
<p>
Provides a data relay from a Kinemetrics-Rockhound-compatible instrument into Earthworm via export/import. (new in EW v7.3)
</p>
<h2 id="Details">Details</h2>
<h3 id="RockhoundtoEarthwormDataRelay">Rockhound to Earthworm Data Relay</h3>
<p>
The Rock-to-EW module provides a data relay to the USGS Earthworm software package.   Rock-to-EW emulates an Earthworm "export_generic" module, providing a TCP/IP listen port for external "import" programs to connect to.
</p>
<p>
The data-output operation of this module is similar to "export_generic":  Messages are queued in a memory based FIFO, and sent to the receiving "import_generic", or similar program, via a TCP connection.  If the available bandwidth of the link is lower than the aggregate rate of messages being queued for shipping, the FIFO will eventually overflow.  In that case, an error is logged, and the queue becomes circular.  That is, if the queue is configured to be N messages long, it will contain the most recent N messages.  Two-way heartbeats are used to assure that the link is actually capable of transmitting data.  The heartbeats consist of agreed-upon text strings sent at an agreed-upon rate.  If a proper heartbeat is not received in time, it is presumed that the link is broken.  In this case, Rock-to-EW will log the error, close the connection, and then wait for the import program to reestablish the connection.
</p>
<p>
The Rock-to-EW module supports simultaneous connections from more than one "import" client.  Each connection operates via a separate listen-port number; see the 'ListenPortNums' parameter for configuration details.  Having each connection on a separate listen-port number allows the module to keep track of which messages have been delivered to which "import" client.
</p>
<p>
The optional 'ListenPortAddr' parameter may be used to specify a specific host address or IP to use when binding to the listen port.
</p>
<p>
When the delivery of a message to an "import" client fails, the module will delay by the 'RetryDelayMS' number of milliseconds before attempting to resend the message.
</p>
<p>
When the connection to an "import" client is lost and then restored, the module will resume the sending of messages starting with the last unsent message in the queue, provided that the queue has not overflowed and the time elapsed is not greater than the 'DropTimeoutSecs' parameter value.
</p>
<p>
Messages generated by this module are in the Earthworm TRACEBUF2 format, using the module and installation ID values specified in the 'EwModuleId' and 'EwInstallId' parameters.
</p>
<p>
The 'ChannelNames' parameter may be used to select which channels are delivered.  If any channel-name entries are specified then the channel name for each message must match a given entry, or the message will be discarded.  If no channel-name entries are specified then all messages will be delivered.  The specified channel-name entries are separated by commas.
</p>
<p>
During the first 10 seconds after the module starts up, warning and debug messages will be sent to both the console and the "SMARTSLog.txt" log file.  After 10 seconds, messages will only be sent to the "SMARTSLog.txt" log file.  This is to prevent the possibility of repetitive console messages interfering with console-command operations (i.e., communications with the ROCKTalk program).
</p>
<p>
All debug messages are sent to the "SMARTSLog.txt" log file, and the following debug-mask values are supported:<br />
Debug mask 0x0001  =   Debug level 1 (basic debug output)<br />
Debug mask 0x0002  =   Debug level 2 (more debug output)<br />
Debug mask 0x0004  =   Debug level 3 (even more debug output)<br />
Debug mask 0x0008  =   Debug level 4 (verbose, per-message debug output)
 
</p>
<p>
Category: DATARELAY  <br />
Publishes: Output <br />
Subscribes to: RECORDER_Output<br />
and/or CONTINUOUSRECORDER_Output<br />
and/or KMITESTRECORDER_Output<br />
and/or DATAINTEGRATOR_Output<br />
and/or CHANNELDATASOURCE_Output 
</p>
<p>
Parameters added to module specific .cfg file:
</p>
<p>
<strong>Earthworm module ID number</strong><br />
Name: EwModuleId<br />
Type: int <br />
Range: 1 to 255 <br />
Default: 99 <br />
Example: EwModuleId=99
</p>
<p>
<strong>Earthworm installation ID number</strong><br />
Name: EwInstallId<br />
Type: int <br />
Range: 1 to 255 <br />
Default: 255 <br />
Example: EwInstallId=255
</p>
<p>
<strong>Optional listen-port host address or IP</strong><br />
Name: ListenPortAddr<br />
Type: String<br />
Range: 0 to 128 characters <br />
Default: none <br />
Example: ListenPortAddr=192.168.0.10
</p>
<p>
<strong>List of listen-port numbers (comma-separated)</strong><br />
Name: ListenPortNums <br />
Type: String<br />
Range: 1 to 128 characters <br />
Default: 16005 <br />
Example: ListenPortNums=16005,16006,16007
</p>
<p>
<strong>Maximum number of messages in queue (0 = no limit)</strong><br />
Name: MaxQueueSize<br />
Type: int <br />
Range: 0 to 9999999 <br />
Default: 100 <br />
Example: MaxQueueSize=99
</p>
<p>
<strong>List of channel names to be sent (comma-separated, empty = send all)</strong><br />
Name: ChannelNames<br />
Type: String <br />
Range: 1 to 128 characters <br />
Default: none<br />
Example: ChannelNames=C1,C2
</p>
<p>
<strong>Interval between sent heartbeat messages (seconds)</strong><br />
Name: SendAliveIntvlSecs<br />
Type: int <br />
Range: 0 to 9999 <br />
Default: 30 <br />
Example: SendAliveIntvlSecs=30
</p>
<p>
<strong>Text of sent heartbeat messages</strong><br />
Name: SendAliveMsgText<br />
Type: String<br />
Range: 0 to 128 characters <br />
Default: alive <br />
Example: SendAliveMsgText=alive
</p>
<p>
<strong>Maximum interval between received heartbeat messages (seconds)</strong><br />
Name: RecvAliveIntvlSecs<br />
Type: int <br />
Range: 0 to 9999 <br />
Default: 150 <br />
Example: RecvAliveIntvlSecs=150
</p>
<p>
<strong>Expected text of received heartbeat messages</strong><br />
Name: RecvAliveMsgText<br />
Type: String<br />
Range: 0 to 128 characters <br />
Default: alive <br />
Example: RecvAliveMsgText=alive
</p>
<p>
<strong>Retry delay after failed message sends (milliseconds)</strong><br />
Name: RetryDelayMS<br />
Type: int <br />
Range: 0 to 9999999 <br />
Default: 2000 <br />
Example: RetryDelayMS=2000
</p>
<p>
<strong>Disconnect time after which queuing is dropped (seconds)</strong><br />
Name: DropTimeoutSecs<br />
Type: int <br />
Range: 0 to 9999999 <br />
Default: 300 <br />
Example: DropTimeoutSecs=300
</p>
<p>
 
 
</p>
<p>
 
The Rock-to-EW entries for the Rockhound 'modules.cfg' file are as follows:
</p>
<pre class="wiki">Type=RockToEW
Category=DATARELAY
Descr=Rock-to-EW Data Relay
Help=Converts instrument data into a stream of Earthworm TRACEBUF messages, delivered via a TCP/IP port
Subscribes=CHANNELDATASOURCE~Output
Config=EwModuleId|int||99|1|255|0|Earthworm Module ID|Earthworm module ID number
Config=EwInstallId|int||255|1|255|0|Earthworm Install ID|Earthworm installation ID number
Config=ListenPortAddr|String|||0|128||Listen Port Address|Optional listen-port host address or IP
Config=ListenPortNums|String||16005|1|128||Listen Port Numbers|List of listen-port numbers (comma-separated)
Config=MaxQueueSize|int||100|0|9999999|0|Maximum Queue Size|Maximum number of messages in queue (0 = no limit)
Config=ChannelNames|String|||0|128||Channel Names|List of channel names to be sent (comma-separated, empty = send all)
Config=SendAliveIntvlSecs|int||30|0|9999|0|Send Alive Interval (secs)|Interval between sent heartbeat messages (seconds)
Config=SendAliveMsgText|String||alive|0|128||Send Alive Text|Text of sent heartbeat messages
Config=RecvAliveIntvlSecs|int||150|0|9999|0|Receive Alive Interval (secs)|Maximum interval between received heartbeat messages (seconds)
Config=RecvAliveMsgText|String||alive|0|128||Receive Alive Text|Expected text of received heartbeat messages
Config=RetryDelayMS|int||2000|0|9999999|0|Retry Delay (ms)|Retry delay after failed message sends (milliseconds)
Config=DropTimeoutSecs|int||300|0|9999999|0|Drop Timeout (secs)|Disconnect time after which queuing is dropped (seconds)
MaxUses=1
</pre><h2 id="HelpfulHints">Helpful Hints</h2>
</div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="http://earthwormcentral.com/trac/ew/wiki/rock2ew?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="http://earthwormcentral.com/trac/ew/about"><strong>Trac 0.12.4</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>