<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      pkfilter â€“ Earthworm
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://earthwormcentral.com/trac/ew/search" />
        <link rel="help" href="TracGuide.html" />
        <link rel="alternate" href="http://earthwormcentral.com/trac/ew/wiki/pkfilter?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="http://earthwormcentral.com/trac/ew/wiki" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/jsgantt.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/tracjsgantt.css" type="text/css" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://earthwormcentral.com/trac/ew/search/opensearch" title="Search Earthworm" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/tracjsgantt/jsgantt.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/ew/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://earthwormcentral.com/trac/ew"><img src="../chrome/site/images/ew.logo_tiny.png" alt="" /></a>
      </div>
      <form id="search" action="http://earthwormcentral.com/trac/ew/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://earthwormcentral.com/trac/ew/login">Login</a></li><li><a href="TracGuide.html">Help/Guide</a></li><li><a href="http://earthwormcentral.com/trac/ew/about">About Trac</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://earthwormcentral.com/trac/ew/wiki">Wiki</a></li><li><a href="http://earthwormcentral.com/trac/ew/timeline">Timeline</a></li><li><a href="http://earthwormcentral.com/trac/ew/roadmap">Roadmap</a></li><li><a href="http://earthwormcentral.com/trac/ew/browser">Browse Source</a></li><li><a href="http://earthwormcentral.com/trac/ew/query">View Tickets</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="http://earthwormcentral.com/trac/ew/wiki">wiki:</a><a class="pathentry" href="pkfilter.html" title="View pkfilter">pkfilter</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="WikiStart.html">Start Page</a></li><li><a href="TitleIndex.html">Index</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/wiki/pkfilter?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby">
            <span><a href="http://earthwormcentral.com/trac/ew/wiki/pkfilter?action=diff&amp;version=1" title="Version 1 by branden">Last modified</a> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2012-03-25T13%3A56%3A36-07%3A00&amp;precision=second" title="2012-03-25T13:56:36-07:00 in Timeline">18 months</a> ago</span>
            <span class="trac-print">Last modified on 03/25/12 13:56:36</span>
          </div>
          <div id="wikipage"><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="pkfilter.html#EarthwormModule:pkfilter">Earthworm Module: pkfilter</a>
    <ol>
      <li>
        <a href="pkfilter.html#Function">Function</a>
      </li>
      <li>
        <a href="pkfilter.html#Details">Details</a>
        <ol>
          <li>
            <a href="pkfilter.html#ExampleConfigurationFile">Example Configuration File</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="pkfilter.html#HelpfulHints">Helpful Hints</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="EarthwormModule:pkfilter"><a class="wiki" href="Earthworm.html">Earthworm</a> Module: pkfilter</h1>
<p>
<strong>Contributed by: </strong>
</p>
<h2 id="Function">Function</h2>
<p>
A duplicate pick removal filter. (new in EW v7.0)
</p>
<h2 id="Details">Details</h2>
<p>
The purpose of pkfilter is to reduce the number of "duplicate" picks from a given "station". For pkfilter, all components which have matching station code and network code are considered to be the from the same "station". The rules for what are considered "duplicate" picks can be found in the specifications file used to design this program:
</p>
<p>
<a class="wiki" href="pkfilter.designspecs.txt.html">pkfilter.designspecs.txt</a>
</p>
<p>
Pkfilter is location-code friendly and will handle both the TYPE*2K and TYPE*SCNL versions picks and codas.
</p>
<p>
This module was written by Lynn Dietz for the CISN.
</p>
<h3 id="ExampleConfigurationFile">Example Configuration File</h3>
<pre class="wiki">pkfilter is a pick filtering module designed to prevent duplicate picks. Below is a copy of the .d file with detailed notes on each parameter

# pkfilter configuration file

# Basic Earthworm setup:
#------------------------
 MyModuleId   MOD_PKFILTER    # module id for this instance of pkfilter 
 InRing       PICK_RING       # shared memory ring for input
 OutRing      FILTERPICK_RING # shared memory ring for output
 HeartbeatInt 30              # seconds between heartbeats
 LogFile      1               # 0 log to stderr/stdout only 
                              # 1 log to stderr/stdout and to disk file
                              # 2 log to disk file only
 Debug        1

# List the message logos to grab from InRing, WILDCARDs permitted.
# Multiple "GetLogo" commands are allowed, with no hardcoded limit.
#         Installation    Module      Message Types
#-----------------------------------------------------------------
 GetLogo  INST_WILDCARD  MOD_WILDCARD # TYPE_PICK_SCNL &amp; TYPE_CODA_SCNL
                                      # TYPE_PICK2K &amp; TYPE_CODA2K

# Pick Filtering Parameters
#--------------------------
 PickHistory          5      # Keep track of this many picks which have
                             # made it thru the filter for each station.

 PickTolerance        3.0    # If pick times are within this many seconds of
                             # each other, they are "duplicates."

 OlderPickAllowed     1      # 0=reject any non-duplicate pick whose 
                             #   timestamp is earlier than the youngest 
                             #   passed pick for this station.
                             # 1=accept a non-duplicate pick whose timestamp
                             #   is earlier than the youngest passed pick,
                             #   but place a limit on how old it can be.
                             #   Must also use the "OlderPickLimit" command.
                             # 2=accept any non-duplicate pick whose 
                             #   timestamp is earlier than the youngest   
                             #   passed pick.

 OlderPickLimit       30     # Required only if OlderPickAllowed = 1
                             # Accept an pick whose timestamp is between
                             # PickTolerance and OlderPickLimit sec     
                             # earlier than the youngest passed pick
                             # from this station.

 DuplicateOnQuality   1      # If non-zero, transfer a duplicate when its
                             #  quality is better than the original.

 QualDiffAllowed      1      # Required quality difference for later pick to
                             # be allowed to pass as a duplicate.
                             #  0 means any pick greater than current pick
                             #  1 means a pick of 1 replaces a pick of 3 
                             #  2 means a pick of 0 replaces a pick of 3 
                             #  3 is invalid because it is equivalent to 
                             #    turning off the duplicate on quality test 

# List of Allowed Components
#---------------------------
# If you want ALL component codes to be eligible to pass thru 
# pkfilter, comment out all "AllowComponent" commands.
# If you want to limit which component codes pass thru pkfilter,
# use one "AllowComponent" command for each allowed component code.
# A component refers to the CHANNEL name in the SCNL tuple.
 AllowComponent   VDZ
 AllowComponent   VHZ
 AllowComponent   VLZ
 AllowComponent   SHZ
 AllowComponent   SLZ
 AllowComponent   EHZ
 AllowComponent   HHZ
 AllowComponent   BHZ
 AllowComponent   DP1
 AllowComponent   DP2
 AllowComponent   DP3
 AllowComponent   EP1
 AllowComponent   EP2
 AllowComponent   EP3

# Coda Filtering Parameters
#--------------------------
 CodaFilter       1          # Possible coda filtering values:
                             #  0 = allow no codas thru filter
                             #  1 = allow only codas which match passed
                             #      picks to pass thru filter 
                             #  2 = allow all codas thru

# Optional commands:
#-------------------
 MaxMessageSize   128        # length (bytes) of largest msg to be processed
                             # from InRing.  Default=MAX_BYTES_PER_EQ

 UseOriginalLogo  1          # 0  apply pkfilter's logo to any messages that
                             #    pass the filter test (normal Earthworm behavior)
                             # non-zero means apply the original logo to any
                             #    messages that pass the filter test.  This
                             #    also requires that InRing and OutRing be 
                             #    different to avoid "missed message" or
                             #    "sequence gap" storms in pick-reading modules.
</pre><h2 id="HelpfulHints">Helpful Hints</h2>
</div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="http://earthwormcentral.com/trac/ew/wiki/pkfilter?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="http://earthwormcentral.com/trac/ew/about"><strong>Trac 0.12.4</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>