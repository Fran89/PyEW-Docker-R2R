<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      Example_Configurations – Earthworm
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://earthwormcentral.com/trac/ew/search" />
        <link rel="help" href="TracGuide.html" />
        <link rel="alternate" href="http://earthwormcentral.com/trac/ew/wiki/Example_Configurations?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="http://earthwormcentral.com/trac/ew/wiki" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/jsgantt.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/tracjsgantt.css" type="text/css" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://earthwormcentral.com/trac/ew/search/opensearch" title="Search Earthworm" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/tracjsgantt/jsgantt.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/ew/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://earthwormcentral.com/trac/ew"><img src="../chrome/site/images/ew.logo_tiny.png" alt="" /></a>
      </div>
      <form id="search" action="http://earthwormcentral.com/trac/ew/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://earthwormcentral.com/trac/ew/login">Login</a></li><li><a href="TracGuide.html">Help/Guide</a></li><li><a href="http://earthwormcentral.com/trac/ew/about">About Trac</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://earthwormcentral.com/trac/ew/wiki">Wiki</a></li><li><a href="http://earthwormcentral.com/trac/ew/timeline">Timeline</a></li><li><a href="http://earthwormcentral.com/trac/ew/roadmap">Roadmap</a></li><li><a href="http://earthwormcentral.com/trac/ew/browser">Browse Source</a></li><li><a href="http://earthwormcentral.com/trac/ew/query">View Tickets</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="http://earthwormcentral.com/trac/ew/wiki">wiki:</a><a class="pathentry" href="Example_Configurations.html" title="View Example_Configurations">Example_Configurations</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="WikiStart.html">Start Page</a></li><li><a href="TitleIndex.html">Index</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/wiki/Example_Configurations?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby">
            <span><a href="http://earthwormcentral.com/trac/ew/wiki/Example_Configurations?action=diff&amp;version=9" title="Version 9 by branden">Last modified</a> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2011-11-16T15%3A45%3A34-08%3A00&amp;precision=second" title="2011-11-16T15:45:34-08:00 in Timeline">22 months</a> ago</span>
            <span class="trac-print">Last modified on 11/16/11 15:45:34</span>
          </div>
          <div id="wikipage"><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="Example_Configurations.html#EarthwormExampleConfigurations">Earthworm Example Configurations</a>
    <ol>
      <li>
        <a href="Example_Configurations.html#Example1">Example 1</a>
      </li>
      <li>
        <a href="Example_Configurations.html#Example2">Example 2</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="EarthwormExampleConfigurations"><a class="wiki" href="Earthworm.html">Earthworm</a> Example Configurations</h1>
<p>
This section provides a more detailed description of Earthworm structure and features. Two examples are used to present a number of concepts in increasing level of detail.
</p>
<h2 id="Example1">Example 1</h2>
<p>
<a style="padding:0; border:none" href="http://earthwormcentral.com/trac/ew/attachment/wiki/Example_Configurations/diagram1.gif"><img width="500px" src="../raw-attachment/wiki/Example_Configurations/diagram1.gif" /></a>
</p>
<p>
<strong>Diagram 1</strong> shows a very simple construction to illustrate the basic concepts. The circle in the diagram represents a message ring, and the rectangles represent modules. Each module can establish linkages to message ring(s) via its configuration file. A module may specify one input ring, from which it can receive desired message types, and one output ring into which it may broadcast its output messages. These linkages are represented in the diagram by the arrows to and from the single message ring.
</p>
<p>
Briefly, this system would function as follows: The system is started by executing the program startstop. Its job is to create the message ring(s) and start the modules. It does this by reading its configuration file (<a class="wiki" href="startstop.html">startstop</a>.d), which lists the ring(s) to be created, the modules to be started, and the configuration files each module will read. As each module starts, it reads its configuration file, which specifies the identity of the instance of that module (in case several copies of a module are desired), the names of the message rings the module is to use for input and output, and any other module-specific parameters.
</p>
<p>
<a class="wiki" href="adsend.html">adsend</a> is a digitizer module which controls an A/D converter, and outputs trace data messages. <a class="wiki" href="pick_ew.html">pick_ew</a> is the Rex Allen picking algorithm that listens to trace data messages, and produces pick- and coda-messages. <a class="wiki" href="binder_ew.html">binder_ew</a> listens to pick messages and produces trial location messages. eqproc consists of a number of sub-modules which pre-process <a class="wiki" href="binder_ew.html">binder_ew</a>'s trial locations, and run <a class="missing wiki">hypoinverse?</a>. The output of eqproc is a message containing the hypo-inverse arc output. <a class="wiki" href="menlo_report.html">menlo_report</a> listens to arc messages, and passes them to remote computer(s) for further processing.
</p>
<h2 id="Example2">Example 2</h2>
<p>
<a style="padding:0; border:none" href="http://earthwormcentral.com/trac/ew/attachment/wiki/Example_Configurations/diagram2.gif"><img width="500px" src="../raw-attachment/wiki/Example_Configurations/diagram2.gif" /></a>
</p>
<p>
<strong>Diagram 2</strong> shows a simplified version of the configuration in operation at University of Washington, Seattle. Several key features have been omitted for the purpose of this example.
</p>
<p>
Note that multiple message rings are used. There are two main reasons for this. One is conceptual: the configuration is easier to understand and maintain if different rings are used to carry related types of messages (and the diagram is easier to draw). The other is performance related: if the rate of message production into a single ring is too high, the computer may be unable to run all receiving modules quickly enough, with the result that some modules may miss messages of interest (note that this is a detectable error, and constitutes a system crash). Given contemporary processor speeds, this is generally no longer a problem. Missed messages do indicate that the hardware is being severely over-driven.
</p>
<p>
Internal names: Earthworm uses names to identify four types of system components. Each set is defined by a table of names and associated numeric values. In operation, the user creates the desired entries in these tables, and then uses the names in the configuration files. At run time, utilities are used to resolve the names to their respective numeric values. The four categories of names are:
</p>
<ul><li><strong>Installation Ids:</strong> These are the names given to the various institutions that operate Earthworm systems. It is the only set of names that is centrally administered. That is, installation names and the associated numeric values must be requested from Golden. The reason for this is that as Earthworms exchange data, only the Installation Id uniquely identifies the source of a message. This table is part of a compile-time C header file, .../include/earthworm.h. All other name sets are run-time; the defining tables are kept in .../run/params/earthworm.d. This file is read during system startup, and thus can be altered without recompiling any source code. The syntax of the table is as per standard Earthworm parameter files (contributed by Carl). A # marks the start of a comment field.
</li></ul><ul><li><strong>Message Rings:</strong> These are all the ring names known to the local Earthworm system. The associated numeric values must be valid shared memory key values. This table is kept in <a class="missing wiki">earthworm?</a>.d, and read by various utility routines at startup time. Each individual installation is free to define its own set if it so chooses. Earthworm releases, however, include the default set.
</li></ul><ul><li><strong>Module names:</strong> These are all module names known to the local Earthworm system. The conventions are as with Message Ring names.
</li></ul><ul><li><strong>Message types:</strong> As with Module names above.
</li></ul><p>
The modules <a class="wiki" href="copystatus.html">copystatus</a> and <a class="wiki" href="statmgr.html">statmgr</a> are part of the Earthworm error-processing scheme. The scheme offers two services: detection of lost heartbeats and individualized processing of various errors. Such processing includes use of pagers, email, permissible rates, limiting the number of notifications, and restarting the offending module. The scheme is optional in two ways: First, a given Earthworm configuration may choose to not run <a class="wiki" href="statmgr.html">statmgr</a>. In this case, no system-wide error processing will be performed. Second, if <a class="wiki" href="statmgr.html">statmgr</a> is run, each module can decide whether to utilize the scheme. To participate, a module must do three things:
</p>
<p>
First, submit to <a class="wiki" href="statmgr.html">statmgr</a> a file (.desc) containing processing instructions for the various errors that it can generate. This is done be creating such a file in the run/params/ directory, and making a corresponding entry in statmgrs parameter file (statmgr.d).
</p>
<p>
Second a participating module must broadcast periodic heartbeat messages, at or above the promised rate, as stated in its .desc file. These will be received by <a class="wiki" href="statmgr.html">statmgr</a>. If <a class="wiki" href="statmgr.html">statmgr</a> does not receive a heartbeat within the advertised time period, it will initiate the actions specified in the .desc file. Such actions can include issuing notification, and terminating and restarting the offending module. This restart feature has proven to be very useful for communication modules that are subject to unusual failure modes.
</p>
<p>
Third, a module may issue status (error) messages in the standard format. These are received by <a class="wiki" href="statmgr.html">statmgr</a>, and the actions specified in the .desc file are taken. Since the architecture allows one input and one output per module, helper modules called <a class="wiki" href="copystatus.html">copystatus</a> are used to move status and heartbeat messages from various rings to the ring to which <a class="wiki" href="statmgr.html">statmgr</a> is listening.
</p>
<p>
This configuration has three sources of trace data, all of which broadcast into a message ring named Wave_Ring:
</p>
<p>
Four <a class="wiki" href="reftek2ew.html">reftek2ew</a> modules, each of which controls a communications line, receives trace data from a remote Reftek data logger, and broadcasts standard Earthworm format trace data.
</p>
<p>
A sun_demux module (now extinct), which receives trace data from University of Washington's own digitizer, demultiplexes it, and produces standard trace data messages,
</p>
<p>
And an <a class="wiki" href="import_generic.html">import-generic</a> module: this is the long-distance message receiver. It communicates with its companion module export_scn via a TCP socket connection. Any type of Earthworm messages can be shipped in this way; in this case, several channels of trace data are being received from Menlo Park. The shipping delay is on the order of several seconds, plus transmission time.
</p>
<p>
The trace data messages must be in the standard internal Earthworm format, as described in .../src/include/trace_buf.h. Briefly, this format consists of a header followed by a variable number of data samples, represented as either 16 or 32 bit signed integers in either byte order. This format supports two channel identification schemes: The dominant scheme consists of three ASCII strings defining the 'station', 'component', 'network', and 'location' (SCNL names). The second is the 'pin number'. This is an integer that can be used to identify the sensor and signal path of a channel. It addresses the case where a given sensor is acquired by two different telemetry paths. It also provides support for processing data from sensors that do not have SCNL names.
</p>
<p>
<strong>Four modules listen to the messages on the Wave_Ring:</strong>
</p>
<ul><li><a class="missing wiki">waveserverV?</a>: This module maintains rotating histories of selected channels, and offers a service capable of supplying requested segments of historic trace data.
</li></ul><ul><li><a class="wiki" href="export_scn.html">export_scn</a>: This is the long-distance shipping module (companion to <a class="wiki" href="import_generic.html">import_generic</a>), specialized to send specific data channels (Station, Component, Network names). In this application, several selected channels of data are being sent to another installation.
</li></ul><ul><li><a class="wiki" href="copystatus.html">copystatus</a>, which conducts status messages and heartbeats to the Hypo_ring. <a class="wiki" href="statmgr.html">statmgr</a> is listening to that ring, and will be able to receive and process them.
</li></ul><ul><li><a class="wiki" href="pick_ew.html">pick_ew</a>, as above, listens to selected trace channels, and produces pick and coda messages (along with status and heartbeat messages). These are broadcast into Pick_Ring.
</li></ul><p>
<strong>Three modules listen to the messages on Pick_Ring:</strong> 
</p>
<ul><li><a class="wiki" href="binder_ew.html">binder_ew</a> is the event associator (conceived and written by Carl Johnson). This module listens to pick messages, and produces trial location messages as well as link messages that relate picks to trial locations (via sequence numbers).
</li></ul><ul><li><a class="wiki" href="eqproc.html">eqproc</a> is the first of a series of sub-modules that perform event locations via <a class="missing wiki">hypoinverse?</a>. The sub-modules are linked via operating system pipes, and as a group behave as an Earthworm module. Briefly, their functions are as follows: <a class="wiki" href="eqproc.html">eqproc</a> assembles the trial locations produced by <a class="wiki" href="binder_ew.html">binder_ew</a> with the associated pick and coda messages produced by <a class="wiki" href="pick_ew.html">pick_ew</a>, and if the event has not been recalled by <a class="wiki" href="binder_ew.html">binder_ew</a> within a time-out period, sends the assembled event parameters to <a class="wiki" href="eqbuf.html">eqbuf</a>. This acts as a buffer, in case events are produced faster than the remaining sub-modules can process them. From there it passes to <a class="wiki" href="eqcoda.html">eqcoda</a>, which computes coda durations from the coda measurements generated by <a class="wiki" href="pick_ew.html">pick_ew</a>. It is then passed to <a class="wiki" href="eqverify.html">eqverify</a>, which applies a series of sanity checks to eliminate spurious events. From there it is passed to hypo_mgr (extinct module, now hypo71_mgr and hypo2000_mgr), which is the encapsulation layer for <a class="missing wiki">hypoinverse?</a>. <a class="missing wiki">hypoinverse?</a> has not been modified for Earthworm. The standard FORTRAN source code is used, permitting any future changes to <a class="missing wiki">hypoinverse?</a> to be directly inserted. The result of hypo_mgr is a message containing the standard <a class="missing wiki">hypoinverse?</a> arc file information. This message is broadcast into the Hypo_Ring.
</li></ul><ul><li>As before, <a class="wiki" href="copystatus.html">copystatus</a> is used to conduct heartbeat and status messages from the Pick_Ring to the Hypo_Ring, where <a class="wiki" href="statmgr.html">statmgr</a> can hear them.
</li></ul><p>
<strong>Three modules listen to the messages on Hypo_Ring:</strong>
</p>
<ul><li><a class="wiki" href="statmgr.html">statmgr</a>: As mentioned above, this module processes error messages, and takes specified actions if a module's heartbeat ceases.
</li></ul><ul><li><a class="wiki" href="export_generic.html">export_generic</a>: this is the general long distance message shipper. In this case used to ship hypo-center messages to another institution.
</li></ul><ul><li><a class="wiki" href="uw_report.html">uw_report</a>: used to send hypocentral and pick information to the University of Washington processing and archiving system.
</li></ul></div>
        
        
      </div>
      
    <div id="attachments">
        <h3 class="foldable">Attachments</h3>
        <ul>
            <li>
    <a href="http://earthwormcentral.com/trac/ew/attachment/wiki/Example_Configurations/diagram1.gif" title="View attachment">diagram1.gif</a><a href="../raw-attachment/wiki/Example_Configurations/diagram1.gif" class="trac-rawlink" title="Download">​</a>
       (<span title="12512 bytes">12.2 KB</span>) -
      added by <em>branden</em> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2011-11-13T16%3A41%3A04-08%3A00&amp;precision=second" title="2011-11-13T16:41:04-08:00 in Timeline">22 months</a> ago.
            </li>
            <li>
    <a href="http://earthwormcentral.com/trac/ew/attachment/wiki/Example_Configurations/diagram2.gif" title="View attachment">diagram2.gif</a><a href="../raw-attachment/wiki/Example_Configurations/diagram2.gif" class="trac-rawlink" title="Download">​</a>
       (<span title="7802 bytes">7.6 KB</span>) -
      added by <em>branden</em> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2011-11-13T16%3A41%3A10-08%3A00&amp;precision=second" title="2011-11-13T16:41:10-08:00 in Timeline">22 months</a> ago.
            </li>
        </ul>
    </div>

    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="http://earthwormcentral.com/trac/ew/wiki/Example_Configurations?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="http://earthwormcentral.com/trac/ew/about"><strong>Trac 0.12.4</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>