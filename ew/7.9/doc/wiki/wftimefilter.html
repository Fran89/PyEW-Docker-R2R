<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      wftimefilter â€“ Earthworm
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://earthwormcentral.com/trac/ew/search" />
        <link rel="help" href="TracGuide.html" />
        <link rel="alternate" href="http://earthwormcentral.com/trac/ew/wiki/wftimefilter?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="http://earthwormcentral.com/trac/ew/wiki" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/jsgantt.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/tracjsgantt.css" type="text/css" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://earthwormcentral.com/trac/ew/search/opensearch" title="Search Earthworm" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/tracjsgantt/jsgantt.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/ew/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://earthwormcentral.com/trac/ew"><img src="../chrome/site/images/ew.logo_tiny.png" alt="" /></a>
      </div>
      <form id="search" action="http://earthwormcentral.com/trac/ew/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://earthwormcentral.com/trac/ew/login">Login</a></li><li><a href="TracGuide.html">Help/Guide</a></li><li><a href="http://earthwormcentral.com/trac/ew/about">About Trac</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://earthwormcentral.com/trac/ew/wiki">Wiki</a></li><li><a href="http://earthwormcentral.com/trac/ew/timeline">Timeline</a></li><li><a href="http://earthwormcentral.com/trac/ew/roadmap">Roadmap</a></li><li><a href="http://earthwormcentral.com/trac/ew/browser">Browse Source</a></li><li><a href="http://earthwormcentral.com/trac/ew/query">View Tickets</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="http://earthwormcentral.com/trac/ew/wiki">wiki:</a><a class="pathentry" href="wftimefilter.html" title="View wftimefilter">wftimefilter</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="WikiStart.html">Start Page</a></li><li><a href="TitleIndex.html">Index</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/wiki/wftimefilter?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby">
            <span><a href="http://earthwormcentral.com/trac/ew/wiki/wftimefilter?action=diff&amp;version=1" title="Version 1 by branden">Last modified</a> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2012-03-25T14%3A04%3A26-07%3A00&amp;precision=second" title="2012-03-25T14:04:26-07:00 in Timeline">18 months</a> ago</span>
            <span class="trac-print">Last modified on 03/25/12 14:04:26</span>
          </div>
          <div id="wikipage"><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="wftimefilter.html#EarthwormModule:wftimefilter">Earthworm Module: wftimefilter</a>
    <ol>
      <li>
        <a href="wftimefilter.html#Function">Function</a>
      </li>
      <li>
        <a href="wftimefilter.html#Details">Details</a>
        <ol>
          <li>
            <a href="wftimefilter.html#ExampleConfigurationFile">Example Configuration File</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="wftimefilter.html#HelpfulHints">Helpful Hints</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="EarthwormModule:wftimefilter"><a class="wiki" href="Earthworm.html">Earthworm</a> Module: wftimefilter</h1>
<p>
<strong>Contributed by: Lynn Dietz for the CISN</strong>
</p>
<h2 id="Function">Function</h2>
<p>
Sanitizer of waveform packets to eliminate out of order and badly timed packets (overlaps and dups etc). (new in EW v7.0)
</p>
<h2 id="Details">Details</h2>
<p>
This new module was created to "sanitize" incoming waveform data  streams to the liking of Earthworm modules. It reads waveform data (compressed or uncompressed) from one transport ring and writes it to another ring, filtering out duplicate data, time overlaps and bogus future timestamped data. Timestamp checks are done for each channel independently. The check for bogus future timestamps requires that the system clock is set to network time.
</p>
<p>
Wftimefilter can be configured to output the messages using the original installation/moduleid or its own installation/moduleid. However, it does not alter the contents of the message in any way.
</p>
<p>
Systems which are importing data using import_ack/export*ack should probably use wftimefilter to remove possible duplicate data after  an import/export reconnect. Systems importing waveform data from  non-Earthworm data sources should also consider running wftimefilter to ensure that only chronological timeseries enter their own Earthworm processing. 
</p>
<p>
Modifed to allow additional optional behavior:
</p>
<ol><li>Rejecting packets that have a sample-rate different than the expected one for the channel.  
</li><li>Limiting per-channel logging, to limit logfile size and increase readability.
</li><li>Adding per-channel daily summaries of errors and warnings.
</li><li>Adding the ability to issue a STATUS message to a ring as a part of the daily summary.
</li><li>Default behavior should be unchanged.
</li></ol><h3 id="ExampleConfigurationFile">Example Configuration File</h3>
<pre class="wiki"># wftimefilter configuration file

# Basic Earthworm setup:
#-----------------------
 MyModuleId    MOD_WFTIMEFILTER # module id for this instance of wftimefilter 
 InRing        RAW_RING         # shared memory ring for input
 OutRing       WAVE_RING        # shared memory ring for output
 HeartbeatInt  30               # seconds between heartbeats to statmgr
 LogFile       1                # 0 log to stderr/stdout only 
                                # 1 log to stderr/stdout and to disk file
                                # 2 log to disk file only

# List the message logos to grab from InRing, WILDCARDs permitted.
# Multiple "GetLogo" commands are allowed, with no hardcoded limit.
# The four valid message types are:
# TYPE_TRACEBUF, TYPE_TRACEBUF2, TYPE_TRACE_COMP_UA, TYPE_TRACE2_COMP_UA
#         Installation   Module        Message Types
#-----------------------------------------------------------------
 GetLogo  INST_WILDCARD  MOD_WILDCARD  TYPE_TRACEBUF2

# Waveform Filtering Parameters
#------------------------------
 MaxMessageSize    4096  # length (bytes) of largest msg to be processed

 UseOriginalInstId    1  # 0  apply wftimefilter's installationid to 
                         #    any messages that pass the test. 
                         # non-zero means apply the original instid.

 UseOriginalModId     0  # 0  apply wftimefilter's moduleid to 
                         #    any messages that pass the test 
                         # non-zero means apply the original instid.

 LogGap             0.0  # Minumum gap duration (seconds) for which we'll make
                         # a log entry.

 TimeJumpTolerance  600  # (in seconds) This term is used to catch packets with
                         # dubious timestamps.  If a time gap is detected in an
                         # incoming data stream, the new packet's timestamp is
                         # compared to the system clock.  If it is later than
                         # the current system time by more than TimeJumpTolerance
                         # seconds, wftimefilter assumes the packet timestamp is 
                         # bogus (it's in the future) and ignores the entire packet.
                         # NOTE: if you use this feature with small tolerances,
                         # the system clock must be kept on network time!!!
                         # 
                         # Set to -1 if you never want to compare packet times
                         # to the system clock.
                         # Valid values are -1 or any number &gt;= 0.0


#AllowChangesInSampleRate 1
                         # Set to 0 to disallow packets with a different sample-rate
                         # than the rate already observed for that channel.

#################################################################################
## LOGGING And STATUS Commands
#################################################################################
#LimitLoggingOfBadChannels 0
                         # Set to 1 to 
                         # suppress log messages from channels that  
                         # exceed the MaxPackets daily log thresholds.
                         # This way, one (or more) bad channel(s) will not generate a
                         # huge logfile.

#MaxPacketsToLogPerChannelPerDay 3
                         # If LimitLoggingOfBadChannels is enabled, then
                         # this is this number is the MAXIMUM number of
                         # filtered packets that will be logged per channel per day.

#MaxPacketsToLogPerWarningPerDay 3
                         # If LimitLoggingOfBadChannels is enabled, then
                         # this is this number is the MAXIMUM number of
                         # packet warnings that will be logged per channel per day.
                         # Currently, warnings issued for gaps between packets, and
                         # possibly changes in sample rate depending on the value
                         # of AllowChangesInSampleRate.

                         
#LogDailySummary 0
                         # Set to 1 to log a daily summary of the packets processed
                         # and number of errors and warning generated per channel.

#IssueDailyStatusWithSummaryOfBadPackets 0
                         # Set to 1 to have program issue a STATUS ERROR message each day
                         # if bad packets are processed that day.

#LogOnlyChannelsWithProblems 0
                         # If LogDailySummary is set to 1, then set this param 
                         # to 1 to cause only channels with problems to be logged
                         # in the daily summary.
</pre><h2 id="HelpfulHints">Helpful Hints</h2>
</div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="http://earthwormcentral.com/trac/ew/wiki/wftimefilter?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="http://earthwormcentral.com/trac/ew/about"><strong>Trac 0.12.4</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>