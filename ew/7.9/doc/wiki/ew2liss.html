<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      ew2liss – Earthworm
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://earthwormcentral.com/trac/ew/search" />
        <link rel="help" href="TracGuide.html" />
        <link rel="alternate" href="http://earthwormcentral.com/trac/ew/wiki/ew2liss?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="http://earthwormcentral.com/trac/ew/wiki" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/jsgantt.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/tracjsgantt.css" type="text/css" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://earthwormcentral.com/trac/ew/search/opensearch" title="Search Earthworm" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/tracjsgantt/jsgantt.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/ew/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://earthwormcentral.com/trac/ew"><img src="../chrome/site/images/ew.logo_tiny.png" alt="" /></a>
      </div>
      <form id="search" action="http://earthwormcentral.com/trac/ew/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://earthwormcentral.com/trac/ew/login">Login</a></li><li><a href="TracGuide.html">Help/Guide</a></li><li><a href="http://earthwormcentral.com/trac/ew/about">About Trac</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://earthwormcentral.com/trac/ew/wiki">Wiki</a></li><li><a href="http://earthwormcentral.com/trac/ew/timeline">Timeline</a></li><li><a href="http://earthwormcentral.com/trac/ew/roadmap">Roadmap</a></li><li><a href="http://earthwormcentral.com/trac/ew/browser">Browse Source</a></li><li><a href="http://earthwormcentral.com/trac/ew/query">View Tickets</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="http://earthwormcentral.com/trac/ew/wiki">wiki:</a><a class="pathentry" href="ew2liss.html" title="View ew2liss">ew2liss</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="WikiStart.html">Start Page</a></li><li><a href="TitleIndex.html">Index</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/wiki/ew2liss?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby">
            <span><a href="http://earthwormcentral.com/trac/ew/wiki/ew2liss?action=diff&amp;version=6" title="Version 6 by branden">Last modified</a> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2012-05-02T09%3A24%3A17-07%3A00&amp;precision=second" title="2012-05-02T09:24:17-07:00 in Timeline">17 months</a> ago</span>
            <span class="trac-print">Last modified on 05/02/12 09:24:17</span>
          </div>
          <div id="wikipage"><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="ew2liss.html#EarthwormModule:ew2liss">Earthworm Module: ew2liss</a>
    <ol>
      <li>
        <a href="ew2liss.html#Function">Function</a>
      </li>
      <li>
        <a href="ew2liss.html#Details">Details</a>
      </li>
      <li>
        <a href="ew2liss.html#ConfigurationFileCommands">Configuration File Commands</a>
        <ol>
          <li>
            <a href="ew2liss.html#FUNCTIONALCOMMANDLISTING">FUNCTIONAL COMMAND LISTING</a>
          </li>
          <li>
            <a href="ew2liss.html#ALPHABETICCOMMANDLISTINGDESCRIPTION">ALPHABETIC COMMAND LISTING &amp; DESCRIPTION</a>
          </li>
          <li>
            <a href="ew2liss.html#SampleConfigurationFile">Sample Configuration File</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="ew2liss.html#HelpfulHints">Helpful Hints</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="EarthwormModule:ew2liss"><a class="wiki" href="Earthworm.html">Earthworm</a> Module: ew2liss</h1>
<p>
<strong>Contributed by: </strong>
</p>
<h2 id="Function">Function</h2>
<p>
Ew2liss is the Earthworm module for serving Earthworm trace data in LISS (Live Internet Seismic Server) format.
</p>
<h2 id="Details">Details</h2>
<p>
Ew2liss is the Earthworm module for serving Earthworm trace data in LISS (Live Internet Seismic Server: <a class="ext-link" href="http://earthquake.usgs.gov/monitoring/operations/"><span class="icon">​</span>http://earthquake.usgs.gov/monitoring/operations/</a>) format. The LISS is a very simple service that provides trace data in miniSEED format in near-real-time over the Internet. The ew2liss module will convert selected SCNs (station-component-network) of trace data from an Earthworm transport ring, convert that data to miniSEED format, and serve the data to a single LISS client (such as <a class="wiki" href="liss2ew.html">liss2ew</a>) over a TCP/IP network connection.
</p>
<p>
One LISS normally has data for a single station. One or more components are sent together in the data stream. In some cases, one component is provided in more than one sample-rate. The `location code' is used in this case to label the different kinds of data. Note that nothing prevents ew2liss from handling SCNs from many stations except this LISS convention. It may be that ew2liss and liss2ew could be used to exchange data between Earthworm installations. Since LISS uses Steim-2 compression, this format should use less network bandwidth than Earthworm's export_scn/import pair. Performing the compression and decompression will use more CPU time, however.
</p>
<p>
<strong>A comment about timing</strong> 
</p>
<p>
Earthworm trace data (TRACE_BUF format) includes "starttime" and "endtime" (8-byte floating-point numbers) to mark the start and end times of each message. It also includes sample count (an integer) and samplerate (an 8-byte floating-point number). Frequently this samplerate value has been set to the <strong>nominal</strong> sample rate; the start and end times are assumed to be actual measured values.
</p>
<p>
The miniSEED format includes only a start time for each record. The sample rate is encoded in the data fixed record as two two-byte integers. These two integers are treated as multipliers if positive, divisors if negative; this a wide range of sample rate values can be expressed. In converting from Earthworm TRACE_BUF messages to miniSEED, errors would be introduced if the nominal sample rate was used to set the miniSEED sample rate factors. Instead, a <strong>best</strong> rate is determined from the starttime, endtime, and sample count values. Then this new sample rate is rounded to the nearest 0.0001 samples per second. This rounded is intended to reduce the discretization introduced by the conversion to the short integer rate factors. Finally, this new sample rate is used to set the miniSEED sample rate factors.
</p>
<h2 id="ConfigurationFileCommands">Configuration File Commands</h2>
<p>
On startup, ew2liss reads the configuration file named on the command line. Commands in this file set all the parameters used for configuring the Earthworm LISS server module. (LISS is the Live Internet Seismic Server.) In the control file, lines may begin with a valid ew2liss command (listed below) or with one of 2 special characters:
</p>
<pre class="wiki">#  marks the line as a comment (example: # This is a comment).

@  allows control files to be nested; one control file can be
   accessed from another with the command "@" followed by
   a string representing the path name of the next control file
   (example: @model.d).
</pre><p>
Command names must be typed in the control file exactly as shown in this document (upper/lower case matters!). Blank lines are also permitted in the control file.
</p>
<h3 id="FUNCTIONALCOMMANDLISTING">FUNCTIONAL COMMAND LISTING</h3>
<p>
Below are the commands recognized by ew2liss, grouped by the function they influence. Most of the commands are required; they may be specified in any order in the control file.
</p>
<pre class="wiki">   Earthworm system setup:
                MyModuleId            required
                InRing                 required
                HeartBeatInterval      required
                GetWavesFrom       required
                Debug              optional

        LISS server parameters:
                LISSaddr                required
                LISSport                required
                SeqFile          required
                SocketTimeout           optional

        Data input parameters:
                MaxSCNs                 required
                ServeSCN              required
</pre><h3 id="ALPHABETICCOMMANDLISTINGDESCRIPTION">ALPHABETIC COMMAND LISTING &amp; DESCRIPTION</h3>
<p>
In the following section, all configuration file commands are listed in alphabetical order. Listed along with the command (bold-type) are its arguments (in red), the name of the subroutine that processes the command, and the function within the module that the command influences. A detailed description of the command and is also given. Default values and example commands are listed after each command description.
</p>
<p>
The following list is organized by:
</p>
<p>
command [argument here]
</p>
<p>
<strong>Debug</strong><br />
Processed by: ReadConfig<br />
Function: Earthworm setup
</p>
<p>
Turns on debug logging for ew2liss. Currently does nothing at all.
</p>
<pre class="wiki">Default:  no debug logging
Example:  Debug
</pre><p>
<strong>GetWavesFrom [inst mod_id]</strong><br />
Function: Earthworm setup
</p>
<p>
Controls the TRACE_BUF messages input to ew2liss. Ew2liss will only process TRACE_BUF messages that come from module mod_id at installation inst. inst and mod_id are character strings (valid strings are listed in earthworm.d) which are related to single-byte numbers that uniquely identify each installation and module. Only 1 "GetWavesFrom" command may be issued; wildcards (INST_WILDCARD and MOD_WILDCARD) will force ew2liss to process all TRACE_BUF messages, regardless of their place of origin.
</p>
<pre class="wiki">Default:  none
Example:   GetWavesFrom  INST_MENLO  MOD_WILDCARD
</pre><p>
<strong>HeartBeatInterval [nsec]</strong><br />
Processed by: ReadConfig<br />
Function: Earthworm Setup
</p>
<p>
Defines the number of seconds, nsec between TYPE_HEARTBEAT messages issued by ew2liss.
</p>
<pre class="wiki">Default:  none
Example:  HeartBeatInterval 30
</pre><p>
<strong>InRing [ring]</strong><br />
Processed by: ReadConfig<br />
Function: Earthworm setup
</p>
<p>
Tells ew2liss which shared memory region to use for input. ring is a character string (valid strings are listed in earthworm.d) that relates (in earthworm.d) to a unique number for the key to the shared memory region.
</p>
<pre class="wiki">Default:  none
Example:  InRing WAVE_RING
</pre><p>
<strong>LISSaddr [address]</strong><br />
Processed by: ReadConfig<br />
Function: LISS parameters
</p>
<p>
Specify the address of the nework interface on the earthworm computer that you want to use for serving LISS. This can be either on IP address (four period-separated numbers) or the domain name of the server.
</p>
<pre class="wiki">Default:  none
Example:  LISSaddr      123.45.6.78
</pre><p>
<strong>LISSport [port]</strong><br />
Processed by: ReadConfig<br />
Function: LISS parameters
</p>
<p>
Specifies the IP port number for the LISS. Normally this is 4000. But if you run more than one instance of ew2liss on one computer, they cannot use the same LISSaddr and LISSport.
</p>
<pre class="wiki">Default:  none
Example:  LISSport  4000
</pre><p>
<strong>LogFile [switch]</strong><br />
Processed by: ReadConfig<br />
Function: Earthworm Setup
</p>
<p>
Sets the on-off switch for writing a log file to disk. If switch is 0, no log file will be written. If switch is non-zero, ew2liss will write daily log file(s) called nnnnnxx.log_yyyymmdd where nnnnn is the name of the configuration file (with the suffix `.d' removed), xx is ew2liss's module id (set with MyModuleId command) and yyyymmdd is the current UTC date (ex: 19960123) on the system clock. The file(s) will be written in the EW_LOG directory (environment variable).
</p>
<pre class="wiki">Default:  none
Example:  LogFile   1
</pre><p>
<strong>MaxSCNs [n]</strong><br />
Processed by: ReadConfig<br />
Function: Data Selection
</p>
<p>
Specifies the number of ServeSCN commands to be found in this configuration file.
</p>
<pre class="wiki">Default:  none
Example:  MaxSCNs   3
</pre><p>
<strong>MyModuleId [mod_id]</strong><br />
Processed by: ReadConfig<br />
Function: Earthworm setup
</p>
<p>
Sets the module id for labeling all outgoing trigger, heartbeat, and error messages. mod_id is a character string (valid strings are listed in earthworm.d) that relates to a unique single-byte number.
</p>
<pre class="wiki">Default:  none
Example:  MyModuleId MOD_L2E_ANMO
</pre><p>
<strong>SeqFile [filename]</strong><br />
Processed by: ReadConfig<br />
Function: LISS Parameter
</p>
<p>
Specifies the filename for the sequence number file, kept in the EW_PARAMS directory (environment variable). If this file does not exist, ew2liss will try to create it. From then on, it records the last sequence number used on a miniSEED record. These numbers are six digit decimal numbers.
</p>
<pre class="wiki">Default:  none
Example:  SeqFile seq.lsn
</pre><p>
<strong>ServeSCN [station component net location]</strong><br />
Processed by: ReadConfig<br />
Function: Data selection
</p>
<p>
Specifies one stream of data to be read from the transport ring and served as LISS data. The station, component, and network are used to set the earthworm SCN of this data stream. These three parameters must be given explicitly (no wildcards). LISS channels may also identified by a location code. If you want, you can inlude a two-digit location code here; otherwise leave this blank. You must give one ServeSCN command for each SCN that you want to serve.
</p>
<pre class="wiki">Default:  none
Example:  ServeSCN SEA BHZ UW
</pre><p>
<strong>SocketTimeout [seconds]</strong><br />
Processed by: ReadConfig<br />
Function: LISS parameters
</p>
<p>
Defines the number of seconds to wait for response from the LISS. This time interval must not be large than the HeartBeatInterval. Unlike in certain other Earthworm modules, you cannot turn off the timeout by using a value of -1.
</p>
<pre class="wiki">Default:  same as HeartBeatInterval
Example:  SocketTimeout   20
</pre><h3 id="SampleConfigurationFile">Sample Configuration File</h3>
<pre class="wiki">#
#                     Configuration File for ew2liss
#
MyModId          MOD_EW2LISS
InRing          WAVE_RING        # Transport ring to read trace data from
HeartBeatInterval     30         # Heartbeat interval, in seconds,
LogFile               1          # 1 -&gt; Keep log, 0 -&gt; no log file

#
# Specify logo of the messages to grab from the InRing.
# TYPE_TRACEBUF is assumed, therefore only module ID and
# installation ID need to be specified
#
GetWavesFrom    INST_WILDCARD MOD_WILDCARD  # TYPE_TRACEBUF (assumed)

LISSaddr   123.45.6.78           # IP address of the LISS (server)
                                 # If you have DNS configured, you may also
                                 # give the domain name of the LISS.
LISSport    4000                 # Port number for LISS; often this is 4000

SocketTimeout  30                # Socket timeout in seconds; not more than
                                 # HeartBeatInterval

SeqFile    seq.lsn               # Name of sequence number file.
MaxSCNs        3                 # Number of SCNs to accept; must be at least
                                 # the number of ServeSCN commands.
# List each sta/comp/net that you want to serve with a
# "ServeSCN" command. Location code (LC) is a 2-digit numerical code that
# you may use to further identify the data stream.
# Location code may be omitted (left blank); all other entries must be
# given explicitly (no wildcards).

#          site comp net LC
#          ---- ---- --- --
ServeSCN  SEA   BHZ  UW 00
ServeSCN  SEA   BHN  UW 00
ServeSCN  SEA   BHE  UW 00
</pre><h2 id="HelpfulHints">Helpful Hints</h2>
</div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="http://earthwormcentral.com/trac/ew/wiki/ew2liss?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="http://earthwormcentral.com/trac/ew/about"><strong>Trac 0.12.4</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>