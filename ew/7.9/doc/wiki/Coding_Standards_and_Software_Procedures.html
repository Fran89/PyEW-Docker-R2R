<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      Coding_Standards_and_Software_Procedures â€“ Earthworm
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://earthwormcentral.com/trac/ew/search" />
        <link rel="help" href="TracGuide.html" />
        <link rel="alternate" href="http://earthwormcentral.com/trac/ew/wiki/Coding_Standards_and_Software_Procedures?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="http://earthwormcentral.com/trac/ew/wiki" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/jsgantt.css" type="text/css" /><link rel="stylesheet" href="../chrome/tracjsgantt/tracjsgantt.css" type="text/css" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://earthwormcentral.com/trac/ew/search/opensearch" title="Search Earthworm" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/tracjsgantt/jsgantt.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/ew/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://earthwormcentral.com/trac/ew"><img src="../chrome/site/images/ew.logo_tiny.png" alt="" /></a>
      </div>
      <form id="search" action="http://earthwormcentral.com/trac/ew/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://earthwormcentral.com/trac/ew/login">Login</a></li><li><a href="TracGuide.html">Help/Guide</a></li><li><a href="http://earthwormcentral.com/trac/ew/about">About Trac</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://earthwormcentral.com/trac/ew/wiki">Wiki</a></li><li><a href="http://earthwormcentral.com/trac/ew/timeline">Timeline</a></li><li><a href="http://earthwormcentral.com/trac/ew/roadmap">Roadmap</a></li><li><a href="http://earthwormcentral.com/trac/ew/browser">Browse Source</a></li><li><a href="http://earthwormcentral.com/trac/ew/query">View Tickets</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="http://earthwormcentral.com/trac/ew/wiki">wiki:</a><a class="pathentry" href="Coding_Standards_and_Software_Procedures.html" title="View Coding_Standards_and_Software_Procedures">Coding_Standards_and_Software_Procedures</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="WikiStart.html">Start Page</a></li><li><a href="TitleIndex.html">Index</a></li><li class="last"><a href="http://earthwormcentral.com/trac/ew/wiki/Coding_Standards_and_Software_Procedures?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby">
            <span><a href="http://earthwormcentral.com/trac/ew/wiki/Coding_Standards_and_Software_Procedures?action=diff&amp;version=3" title="Version 3 by branden">Last modified</a> <a class="timeline" href="http://earthwormcentral.com/trac/ew/timeline?from=2012-01-19T18%3A43%3A20-08%3A00&amp;precision=second" title="2012-01-19T18:43:20-08:00 in Timeline">20 months</a> ago</span>
            <span class="trac-print">Last modified on 01/19/12 18:43:20</span>
          </div>
          <div id="wikipage"><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="Coding_Standards_and_Software_Procedures.html#EarthwormSoftwareStandards">Earthworm Software Standards</a>
    <ol>
      <li>
        <a href="Coding_Standards_and_Software_Procedures.html#EarthwormSoftwareProcedures">Earthworm Software Procedures</a>
        <ol>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a1.CoreSoftware">1. Core Software</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a2.ContributedSoftware">2. Contributed Software</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a3.EncapsulatedSoftware">3. Encapsulated Software</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a4.ContributingNewSoftware">4. Contributing New Software</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a5.Modifyingexistingmodules">5. Modifying existing modules</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="Coding_Standards_and_Software_Procedures.html#EarthwormCodingStandards">Earthworm Coding Standards</a>
        <ol>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a1.Flexibility">1. Flexibility</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a2.Systemindependence">2. System independence</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a3.Reducingthetedium">3. Reducing the tedium</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a4.Robustness">4. Robustness</a>
          </li>
          <li>
            <a href="Coding_Standards_and_Software_Procedures.html#a5.Maintainability">5. Maintainability</a>
          </li>
        </ol>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="EarthwormSoftwareStandards">Earthworm Software Standards</h1>
<p>
Update August 14, 2000
</p>
<h2 id="EarthwormSoftwareProcedures">Earthworm Software Procedures</h2>
<p>
Earthworm effort began as a grass-roots effort by developers. As such, its spirit was to focus on producing high-quality code and to minimize meetings, rules, and procedures. However, success brings problems; as the number of contributors and users has grown, so has the need for a stated set of operating procedures. Thus, the following is offered in the spirit of "A loose consensus and some working code."
</p>
<p>
The Earthworm effort has several objectives: first, it is to provide a rapid response system suitable for critical monitoring applications; second, it is to operate as a vehicle to integrate the products of various seismic installations into a common software package available to all. The first objective implies that the system be robust and reliable, which, in turn requires a closely knit organization to provide rigorous standards, testing, and rapid bug-fixing. It further requires that the system be maintainable, and be suitable for use at a variety of installations, including those with modest levels of resources. The second objective leads toward a policy of open inclusion of various offerings, produced for a variety of purposes and operating environments, and therefore engineered to varying degrees of robustness and reliability.
</p>
<p>
In response to these needs, an Earthworm Central has evolved, which maintains the Earthworm software, accepts contributions, develops code, produces documentation, and releases Earthworm versions. This group is also responsible for quality assurance and bug fixes. There are currently three rough categories of software within the Earthworm effort: core, contributed, encapsulated.
</p>
<h3 id="a1.CoreSoftware">1. Core Software</h3>
<p>
The core software is intended to meet the requirements of the mission-critical objectives. The focus here is to maintain the quality of the core software in terms of reliability, maintainability, robustness, and longevity. This, in turn, comes down to issues like portability, failure modes, and error-detection, -processing, and -recovery. core software is modified as needed under the control of Earthworm Central to fix errors and provide enhancements. The distribution system consists mainly of numbered releases and patches of various degrees of formality, depending on the urgency of the fix.
</p>
<h3 id="a2.ContributedSoftware">2. Contributed Software</h3>
<p>
The Contributed software consists of ancillary programs submitted for inclusion with the Earthworm distribution, but which, for whatever reason, don't fit into the core category. These are distributed <strong>as is</strong>. An index and descriptions of these programs will be maintained.
</p>
<h3 id="a3.EncapsulatedSoftware">3. Encapsulated Software</h3>
<p>
A few exotic codes belong to the encapsulated category. These are part of the core offering, but are maintained by the original authors rather than Earthworm Central, either due to the complexity of the algorithm, or because they interface to other systems which may be changing. Examples include hypo-inverse and the 'coupler' package to the NOAA tsunami warning system. The approach is that the author, or the author's institution is responsible for the quality and maintenance of the code.
</p>
<h3 id="a4.ContributingNewSoftware">4. Contributing New Software</h3>
<p>
Anyone is welcome to create and contribute software. As mentioned above, most any relevant software will be accepted into the distribution as contributed. It is only requested that source code, some documentation, and a link to the author be provided. Core software is usually created or solicited in response to user needs. The objective in such cases is to offer the highest-quality code, in terms of the above requirements, in the most timely manner possible. After it is acquired it is normally reviewed and released to selected sites for testing. Any required changes as a result of testing and review will be communicated to the author. Such changes may then be implemented either by the author or by others as dictated by schedule and available resources.
</p>
<h3 id="a5.Modifyingexistingmodules">5. Modifying existing modules</h3>
<p>
Modifications to contributed software are on request by the author. The author may simply request to replace the software currently in the distribution with a new version, and it will be replaced on the Earthworm ftp site.
</p>
<p>
New versions of encapsulated software are generally accepted as they are produced, and released by various methods as required by the urgency of the situation. Any observed malfunctions are reported to the author.
</p>
<p>
Since the performance of core software is the responsibility of Earthworm Central, changes to core are made under its control. Reported bugs and deficiencies are discussed, and implementation of the fix is assigned, reviewed, and incorporated by Earthworm Central as required. Enhancements produced by others will similarly be evaluated and inserted by Earthworm Central.
</p>
<h2 id="EarthwormCodingStandards">Earthworm Coding Standards</h2>
<p>
Coding standards is a noxious and intrusive idea which invades a developer's creative privacy (limited as it is), stifles innovation, and destroys morale. At best it is ignored; at worst it incites a counter-productive reaction. Yet in order to have any hope of having the system be portable, maintainable, and mission critical, some common conventions are needed. Thus the intent here is to state coding objectives rather than standards, and to explain traditional practices and conventions as they have (not necessarily as they should have) evolved within the Earthworm group.
</p>
<h3 id="a1.Flexibility">1. Flexibility</h3>
<p>
One module, one function: We've found (the hard way) that the idea that 'a module should do only one thing' to be extremely important. It's more expedient to write one module to do several related functions, but the result is a complex module with numerous switches and options, and a maintenance and stability problem, in that enhancements to one of the functions may affect the others. Single-function modules, on the other hand, results in code which is simpler to understand and maintain. Separate, similar modules may lead to identical code in multiple modules. The solution is to place such code into utility functions, and place those functions into the utility library (/src/libsrc/util).
</p>
<p>
One input, one output: In principle, a module can connect to any number of transport rings and use any number of 'back-door' communication schemes. However, the idea of standard-in and standard-out (one input ring, one output ring) has merit. It is the basis of the 'erector set' feature of Earthworm, which allows users to assemble custom systems. In practice, we've found that modules with multiple input and output streams quickly lead to reduced flexibility. Other than performance, there's no harm in a module dumping various kinds of messages onto one output ring, and contemporary hardware can easily support very high traffic on transport rings.
</p>
<h3 id="a2.Systemindependence">2. System independence</h3>
<p>
OS Kernel functions: Given our limited resources, the principle is to run on the two most dominant platforms of the day; currently, these are NT and Solaris. To date, Earthworm has survived five operating systems. In the process, the tradition has developed of using wrapper routines for system-specific calls, and producing different versions of such routines for each operating system. Such routines are kept in system-specific libraries (currently .../src/libsrc/solaris and .../src/libsrc/winnt), and the correct library is specified at link-time via environment variables. Thus, for example, the routine sleep_ew() wraps the NT "Sleep()" call, and the Solaris "nanosleep()" call, and modules which use the sleep_ew() function can run on either system.
</p>
<p>
To preserve this, of course, implies that wrapper routines will be produced as needed.
</p>
<h3 id="a3.Reducingthetedium">3. Reducing the tedium</h3>
<p>
Start with a template. The Earthworm architecture imposes an overhead burden on a module. This includes connecting to transport rings, reading and writing messages, reading the parameter file, error logging, etc. We've found that the most painless way of coding this is to start with an existing module which is similar in structure to the module to be written, and to modify it as needed. Another approach is to use the "template" module in /src/diagnostic_tools/template. This tends to reduce these tasks to cut and past operations, and produces code which is easy for others to maintain.
</p>
<p>
Earthworm utilities: /src/libsrc/util/ contains various utility routines such as message parsers and format generators. Using these can save much tedious effort, and aids portability.
</p>
<h3 id="a4.Robustness">4. Robustness</h3>
<p>
Error reporting. This is best appreciated by those who get stuck installing and maintaining Earthworm systems. A major frustration is the situation when a module which exits with no error message, or a message which not meaningful to the people who must maintain the system. This occurs most often during configuration, when the parameter files are being created and debugged. A shocking amount of installation time can be spent resolving such problems. A more serious case is when a module exits during run-time because of an unusual asynchronous condition (e.g. receiving an oversize message) without adequately reporting the cause. If such events are rare, finding the problem can become extremely difficult and the consequence of such failures is potentially very serious.
</p>
<p>
"Works as long as there are no earthquakes". There are numerous horror stories of systems which had performed well for long time, and failed when a major earthquake occurred. Some classic problem areas include:
</p>
<ul><li>Careless algorithm design, which fails to correctly handle extreme input values (or volume).
</li><li>Code which requests additional resources during an event. For example, a module which requests additional memory proportional to the size of an event may fail only during large events, when sufficient memory may be temporarily unavailable.
</li><li>Insufficient internal buffering. CPU time will likely become more scarce during a large event, and a module must survive such periods gracefully. Note that a standard practice for such modules is to use a separate thread to acquire input messages, and to use the library buffering routines between the acquisition thread the processing thread.
</li></ul><p>
Memory leaks. There have been modules which passed various tests, but which caused the system to hang after weeks of running by slowly draining available memory. This, plus the event-driven failure mode above, makes run-time memory requests a very dangerous practice. It is far better to do all malloc()'s only at start-up time and 'waste' memory, rather than crashing the system later.
</p>
<h3 id="a5.Maintainability">5. Maintainability</h3>
<p>
Given the 'community' objective of the Earthworm distribution, it is crucial that the code be easily understood, modified, and maintained by others. People with various skill levels and available time should be able to understand and modify the distributed code. Considerations here include:
</p>
<ul><li>Long, leading comments which give the reader insight into the motivations for the code being as it is. Consider that the reader may be less skilled and familiar with the algorithm than the author.
</li><li>Simple, flexible coding. Most developers are familiar with horrors of dense, 'elegant' code, written in a minimum number of lines of source code. The usual excuse for this practice is efficiency, but this is hard to justify given modern hardware and optimizing compilers. More realistically, this is usually a pathetic attempt by the author to impress the reader with their cleverness. This style creates problems in that it takes longer to understand the code, and more code has to be disturbed to make modifications.
</li><li>Intuitive naming conventions. Cute or terse file and variable names may be convenient and amusing to the author, but make things difficult for people who follow, and detract from the author's reputation.
</li><li>Documentation. The primary documentation is comments in the source code. Beyond that, the author is encouraged to write a short description for publication on the Earthworm web site.
</li></ul></div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="http://earthwormcentral.com/trac/ew/wiki/Coding_Standards_and_Software_Procedures?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="http://earthwormcentral.com/trac/ew/about"><strong>Trac 0.12.4</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>